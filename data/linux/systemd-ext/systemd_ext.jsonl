{"text": "systemd.exec\nIndex\nÂ·\nDirectives\nsystemd 258\nName\nsystemd.exec â Execution environment configuration\nSynopsis\nservice\n.service\n,\nsocket\n.socket\n,\nmount\n.mount\n,\nswap\n.swap\nDescription\nÂ¶\nUnit configuration files for services, sockets, mount points, and swap devices share a subset of\nconfiguration options which define the execution environment of spawned processes.\nThis man page lists the configuration options shared by these four unit types. See\nsystemd.unit\n(5)\nfor the common\noptions of all unit configuration files, and\nsystemd.service\n(5)\n,\nsystemd.socket\n(5)\n,\nsystemd.swap\n(5)\n, and\nsystemd.mount\n(5)\nfor more\ninformation on the specific unit configuration files. The execution specific configuration options are configured\nin the [Service], [Socket], [Mount], or [Swap] sections, depending on the unit type.\nIn addition, options which control resources through Linux Control Groups (cgroups) are listed in\nsystemd.resource-control\n(5)\n.\nThose options complement options listed here.\nImplicit Dependencies\nÂ¶\nA few execution parameters result in additional, automatic dependencies to be added:\nUnits with\nWorkingDirectory=\n,\nRootDirectory=\n,\nRootImage=\n,\nRuntimeDirectory=\n,\nStateDirectory=\n,\nCacheDirectory=\n,\nLogsDirectory=\nor\nConfigurationDirectory=\nset automatically gain dependencies of type\nRequires=\nand\nAfter=\non all mount units required to access the specified\npaths. This is equivalent to having them listed explicitly in\nRequiresMountsFor=\n.\nUnits with\nPrivateTmp=yes\nautomatically gain dependencies of type\nWants=\nand\nAfter=\non all mounts required to access\n/tmp/\nand\n/var/tmp/\n. They will also gain an automatic\nAfter=\ndependency on\nsystemd-tmpfiles-setup.service\n(8)\n.\nUnits with\nPrivateTmp=disconnected\nautomatically gain dependencies\nof type\nWants=\nand\nAfter=\non the mount required to access\n/var/\n, unless\nDefaultDependencies=no\nand/or\nRootDirectory=/RootImage=\nare specified.\nUnits whose standard output or error output is connected to\njournal\nor\nkmsg\n(or their combinations with console output, see below) automatically acquire\ndependencies of type\nAfter=\non\nsystemd-journald.socket\n.\nUnits using\nLogNamespace=\nwill automatically gain ordering and\nrequirement dependencies on the two socket units associated with\nsystemd-journald@.service\ninstances.\nPaths\nÂ¶\nThe following settings may be used to change a service's view of the filesystem. Please note that the paths\nmust be absolute and must not contain a \"\n..\n\" path component.\nExecSearchPath=\nÂ¶\nTakes a colon separated list of absolute paths relative to which the executable\nused by the\nExec*=\n(e.g.\nExecStart=\n,\nExecStop=\n, etc.) properties can be found.\nExecSearchPath=\noverrides\n$PATH\nif\n$PATH\nis not supplied by the user through\nEnvironment=\n,\nEnvironmentFile=\nor\nPassEnvironment=\n. Assigning an empty string removes previous assignments\nand setting\nExecSearchPath=\nto a value multiple times will append\nto the previous setting.\nAdded in version 250.\nWorkingDirectory=\nÂ¶\nTakes a directory path relative to the service's root directory specified by\nRootDirectory=\n, or the special value \"\n~\n\". Sets the working directory for\nexecuted processes. If set to \"\n~\n\", the home directory of the user specified in\nUser=\nis used. If not set, defaults to the root directory when systemd is running as a\nsystem instance and the respective user's home directory if run as user. If the setting is prefixed with the\n\"\n-\n\" character, a missing working directory is not considered fatal. If\nRootDirectory=\n/\nRootImage=\nis not set, then\nWorkingDirectory=\nis relative to the root of the system running the service manager. Note\nthat setting this parameter might result in additional dependencies to be added to the unit (see\nabove).\nRootDirectory=\nÂ¶\nTakes a directory path relative to the host's root directory (i.e. the root of the system\nrunning the service manager). Sets the root directory for executed processes, with the\npivot_root\n(2)\nor\nchroot\n(2)\nsystem call. If this is used, it must be ensured that the process binary and all its auxiliary files\nare available in the new root. Note that setting this parameter might result in additional\ndependencies to be added to the unit (see above).\nThe\nMountAPIVFS=\nand\nPrivateUsers=\nsettings are particularly useful\nin conjunction with\nRootDirectory=\n. For details, see below.\nIf\nRootDirectory=\n/\nRootImage=\nare used together with\nNotifyAccess=\nthe notification socket is automatically mounted from the host into\nthe root environment, to ensure the notification interface can work correctly.\nNote that services using\nRootDirectory=\n/\nRootImage=\nwill\nnot be able to log via the syslog or journal protocols to the host logging infrastructure, unless the\nrelevant sockets are mounted from the host, specifically:\nThe host's\nos-release\n(5)\nfile will be made available for the service (read-only) as\n/run/host/os-release\n.\nIt will be updated automatically on soft reboot (see:\nsystemd-soft-reboot.service\n(8)\n),\nin case the service is configured to survive it.\nExampleÂ 1.Â Mounting logging sockets into root environment\nBindReadOnlyPaths=/dev/log /run/systemd/journal/socket /run/systemd/journal/stdout\nIn place of the directory path a \"\n.v/\n\" versioned directory may be specified,\nsee\nsystemd.v\n(7)\nfor\ndetails.\nThis option is only available for system services, or for services running in per-user\ninstances of the service manager in which case\nPrivateUsers=\nis implicitly enabled\n(requires unprivileged user namespaces support to be enabled in the kernel via the\n\"\nkernel.unprivileged_userns_clone=\n\" sysctl).\nRootImage=\nÂ¶\nTakes a path to a block device node or regular file as argument. This call is similar\nto\nRootDirectory=\nhowever mounts a file system hierarchy from a block device node\nor loopback file instead of a directory. The device node or file system image file needs to contain a\nfile system without a partition table, or a file system within an MBR/MS-DOS or GPT partition table\nwith only a single Linux-compatible partition, or a set of file systems within a GPT partition table\nthat follows the\nDiscoverable Partitions Specification\n.\nWhen\nDevicePolicy=\nis set to \"\nclosed\n\" or\n\"\nstrict\n\", or set to \"\nauto\n\" and\nDeviceAllow=\nis\nset, then this setting adds\n/dev/loop-control\nwith\nrw\nmode,\n\"\nblock-loop\n\" and \"\nblock-blkext\n\" with\nrwm\nmode\nto\nDeviceAllow=\n. See\nsystemd.resource-control\n(5)\nfor the details about\nDevicePolicy=\nor\nDeviceAllow=\n. Also, see\nPrivateDevices=\nbelow, as it may change the setting of\nDevicePolicy=\n.\nUnits making use of\nRootImage=\nautomatically gain an\nAfter=\ndependency on\nsystemd-udevd.service\n.\nThe host's\nos-release\n(5)\nfile will be made available for the service (read-only) as\n/run/host/os-release\n.\nIt will be updated automatically on soft reboot (see:\nsystemd-soft-reboot.service\n(8)\n),\nin case the service is configured to survive it.\nIn place of the image path a \"\n.v/\n\" versioned directory may be specified, see\nsystemd.v\n(7)\nfor\ndetails.\nThis option is only available for system services and is not supported for services\nrunning in per-user instances of the service manager.\nAdded in version 233.\nRootImageOptions=\nÂ¶\nTakes a comma-separated list of mount options that will be used on disk images specified by\nRootImage=\n. Optionally a partition name can be prefixed, followed by colon, in\ncase the image has multiple partitions, otherwise partition name \"\nroot\n\" is implied.\nOptions for multiple partitions can be specified in a single line with space separators. Assigning an empty\nstring removes previous assignments. Duplicated options are ignored. For a list of valid mount options, please\nrefer to\nmount\n(8)\n.\nValid partition names follow the\nDiscoverable Partitions Specification\n:\nroot\n,\nusr\n,\nhome\n,\nsrv\n,\nesp\n,\nxbootldr\n,\ntmp\n,\nvar\n.\nThis option is only available for system services and is not supported for services\nrunning in per-user instances of the service manager.\nAdded in version 247.\nRootEphemeral=\nÂ¶\nTakes a boolean argument. If enabled, executed processes will run in an ephemeral\ncopy of the root directory or root image. The ephemeral copy is placed in\n/var/lib/systemd/ephemeral-trees/\nwhile the service is active and is cleaned up\nwhen the service is stopped or restarted. If\nRootDirectory=\nis used and the root\ndirectory is a subvolume, the ephemeral copy will be created by making a snapshot of the subvolume.\nTo make sure making ephemeral copies can be made efficiently, the root directory or root image\nshould be located on the same filesystem as\n/var/lib/systemd/ephemeral-trees/\n.\nWhen using\nRootEphemeral=\nwith root directories,\nbtrfs\n(5)\nshould be used as the filesystem and the root directory should ideally be a subvolume which\nsystemd\ncan snapshot to make the ephemeral copy. For root images, a filesystem\nwith support for reflinks should be used to ensure an efficient ephemeral copy.\nThis option is only available for system services and is not supported for services\nrunning in per-user instances of the service manager.\nAdded in version 254.\nRootHash=\nÂ¶\nTakes a data integrity (dm-verity) root hash specified in hexadecimal, or the path to a file\ncontaining a root hash in ASCII hexadecimal format. This option enables data integrity checks using dm-verity,\nif the used image contains the appropriate integrity data (see above) or if\nRootVerity=\nis used.\nThe specified hash must match the root hash of integrity data, and is usually at least 256 bits (and hence 64\nformatted hexadecimal characters) long (in case of SHA256 for example). If this option is not specified, but\nthe image file carries the \"\nuser.verity.roothash\n\" extended file attribute (see\nxattr\n(7)\n), then the root\nhash is read from it, also as formatted hexadecimal characters. If the extended file attribute is not found (or\nis not supported by the underlying file system), but a file with the\n.roothash\nsuffix is\nfound next to the image file, bearing otherwise the same name (except if the image has the\n.raw\nsuffix, in which case the root hash file must not have it in its name), the root hash\nis read from it and automatically used, also as formatted hexadecimal characters.\nIf the disk image contains a separate\n/usr/\npartition it may also be\nVerity protected, in which case the root hash may configured via an extended attribute\n\"\nuser.verity.usrhash\n\" or a\n.usrhash\nfile adjacent to the disk\nimage. There's currently no option to configure the root hash for the\n/usr/\nfile\nsystem via the unit file directly.\nThis option is only available for system services and is not supported for services\nrunning in per-user instances of the service manager.\nAdded in version 246.\nRootHashSignature=\nÂ¶\nTakes a PKCS7 signature of the\nRootHash=\noption as a path to a\nDER-encoded signature file, or as an ASCII base64 string encoding of a DER-encoded signature prefixed\nby \"\nbase64:\n\". The dm-verity volume will only be opened if the signature of the root\nhash is valid and signed by a public key present in the kernel keyring. If this option is not\nspecified, but a file with the\n.roothash.p7s\nsuffix is found next to the image\nfile, bearing otherwise the same name (except if the image has the\n.raw\nsuffix,\nin which case the signature file must not have it in its name), the signature is read from it and\nautomatically used.\nIf the disk image contains a separate\n/usr/\npartition it may also be\nVerity protected, in which case the signature for the root hash may configured via a\n.usrhash.p7s\nfile adjacent to the disk image. There's currently no option to\nconfigure the root hash signature for the\n/usr/\nvia the unit file\ndirectly.\nThis option is only available for system services and is not supported for services\nrunning in per-user instances of the service manager.\nAdded in version 246.\nRootVerity=\nÂ¶\nTakes the path to a data integrity (dm-verity) file. This option enables data integrity checks\nusing dm-verity, if\nRootImage=\nis used and a root-hash is passed and if the used image itself\ndoes not contain the integrity data. The integrity data must be matched by the root hash. If this option is not\nspecified, but a file with the\n.verity\nsuffix is found next to the image file, bearing otherwise\nthe same name (except if the image has the\n.raw\nsuffix, in which case the verity data file must\nnot have it in its name), the verity data is read from it and automatically used.\nThis option is supported only for disk images that contain a single file system, without an\nenveloping partition table. Images that contain a GPT partition table should instead include both\nroot file system and matching Verity data in the same image, implementing the\nDiscoverable Partitions Specification\n.\nThis option is only available for system services and is not supported for services\nrunning in per-user instances of the service manager.\nAdded in version 246.\nRootImagePolicy=\n,\nMountImagePolicy=\n,\nExtensionImagePolicy=\nÂ¶\nTakes an image policy string as per\nsystemd.image-policy\n(7)\nto use when mounting the disk images (DDI) specified in\nRootImage=\n,\nMountImage=\n,\nExtensionImage=\n, respectively. If not specified\nthe following policy string is the default for\nRootImagePolicy=\nand\nMountImagePolicy\n:\nroot=verity+signed+encrypted+unprotected+absent: \\\nusr=verity+signed+encrypted+unprotected+absent: \\\nhome=encrypted+unprotected+absent: \\\nsrv=encrypted+unprotected+absent: \\\ntmp=encrypted+unprotected+absent: \\\nvar=encrypted+unprotected+absent\nThe default policy for\nExtensionImagePolicy=\nis:\nroot=verity+signed+encrypted+unprotected+absent: \\\nusr=verity+signed+encrypted+unprotected+absent\nAdded in version 254.\nMountAPIVFS=\nÂ¶\nTakes a boolean argument. If on, a private mount namespace for the unit's processes is created\nand the API file systems\n/proc/\n,\n/sys/\n,\n/dev/\nand\n/run/\n(as an empty \"\ntmpfs\n\") are mounted inside of it, unless they are\nalready mounted. Note that this option has no effect unless used in conjunction with\nRootDirectory=\n/\nRootImage=\nas these four mounts are\ngenerally mounted in the host anyway, and unless the root directory is changed, the private mount namespace\nwill be a 1:1 copy of the host's, and include these four mounts. Note that the\n/dev/\nfile\nsystem of the host is bind mounted if this option is used without\nPrivateDevices=\n. To run\nthe service with a private, minimal version of\n/dev/\n, combine this option with\nPrivateDevices=\n.\nIn order to allow propagating mounts at runtime in a safe manner,\n/run/systemd/propagate/\non the host will be used to set up new mounts, and\n/run/host/incoming/\nin the private namespace\nwill be used as an intermediate step to store them before being moved to the final mount point.\nAdded in version 233.\nBindLogSockets=\nÂ¶\nTakes a boolean argument. If true, sockets from\nsystemd-journald.socket\n(8)\nwill be bind mounted into the mount namespace. This is particularly useful when a different instance\nof\n/run/\nis employed, to make sure processes running in the namespace\ncan still make use of\nsd-journal\n(3)\n.\nThis option is implied when\nLogNamespace=\nis used,\nwhen\nMountAPIVFS=yes\n, or when\nPrivateDevices=yes\nis used\nin conjunction with either\nRootDirectory=\nor\nRootImage=\n.\nAdded in version 257.\nProtectProc=\nÂ¶\nTakes one of \"\nnoaccess\n\", \"\ninvisible\n\",\n\"\nptraceable\n\" or \"\ndefault\n\" (which it defaults to). When set, this\ncontrols the \"\nhidepid=\n\" mount option of the \"\nprocfs\n\" instance for\nthe unit that controls which directories with process metainformation\n(\n/proc/\nPID\n) are visible and accessible: when set to\n\"\nnoaccess\n\" the ability to access most of other users' process metadata in\n/proc/\nis taken away for processes of the service. When set to\n\"\ninvisible\n\" processes owned by other users are hidden from\n/proc/\n. If \"\nptraceable\n\" all processes that cannot be\nptrace()\n'ed by a process are hidden to it. If \"\ndefault\n\" no\nrestrictions on\n/proc/\naccess or visibility are made. For further details see\nThe /proc\nFilesystem\n. It is generally recommended to run most system services with this option set to\n\"\ninvisible\n\". This option is implemented via file system namespacing, and thus cannot\nbe used with services that shall be able to install mount points in the host file system\nhierarchy. Note that the root user is unaffected by this option, so to be effective it has to be used\ntogether with\nUser=\nor\nDynamicUser=yes\n, and also without the\n\"\nCAP_SYS_PTRACE\n\" capability, which also allows a process to bypass this feature. It\ncannot be used for services that need to access metainformation about other users' processes. This\noption implies\nMountAPIVFS=\n.\nIf the kernel does not support per-mount point\nhidepid=\nmount options this\nsetting remains without effect, and the unit's processes will be able to access and see other process\nas if the option was not used.\nThis option is only available for system services and is not supported for services\nrunning in per-user instances of the service manager.\nAdded in version 247.\nProcSubset=\nÂ¶\nTakes one of \"\nall\n\" (the default) and \"\npid\n\". If\n\"\npid\n\", all files and directories not directly associated with process management and\nintrospection are made invisible in the\n/proc/\nfile system configured for the\nunit's processes. This controls the \"\nsubset=\n\" mount option of the\n\"\nprocfs\n\" instance for the unit. For further details see\nThe /proc\nFilesystem\n. Note that Linux exposes various kernel APIs via\n/proc/\n,\nwhich are made unavailable with this setting. Since these APIs are used frequently this option is\nuseful only in a few, specific cases, and is not suitable for most non-trivial programs.\nMuch like\nProtectProc=\nabove, this is implemented via file system mount\nnamespacing, and hence the same restrictions apply: it is only available to system services, it\ndisables mount propagation to the host mount table, and it implies\nMountAPIVFS=\n. Also, like\nProtectProc=\nthis setting is gracefully\ndisabled if the used kernel does not support the \"\nsubset=\n\" mount option of\n\"\nprocfs\n\".\nAdded in version 247.\nBindPaths=\n,\nBindReadOnlyPaths=\nÂ¶\nConfigures unit-specific bind mounts. A bind mount makes a particular file or directory\navailable at an additional place in the unit's view of the file system. Any bind mounts created with this\noption are specific to the unit, and are not visible in the host's mount table. This option expects a\nwhitespace separated list of bind mount definitions. Each definition consists of a colon-separated triple of\nsource path, destination path and option string, where the latter two are optional. If only a source path is\nspecified the source and destination is taken to be the same. The option string may be either\n\"\nrbind\n\" or \"\nnorbind\n\" for configuring a recursive or non-recursive bind\nmount. If the destination path is omitted, the option string must be omitted too.\nEach bind mount definition may be prefixed with \"\n-\n\", in which case it will be ignored\nwhen its source path does not exist.\nBindPaths=\ncreates regular writable bind mounts (unless the source file system mount\nis already marked read-only), while\nBindReadOnlyPaths=\ncreates read-only bind mounts. These\nsettings may be used more than once, each usage appends to the unit's list of bind mounts. If the empty string\nis assigned to either of these two options the entire list of bind mounts defined prior to this is reset. Note\nthat, in this case, both read-only and regular bind mounts are reset, regardless which of the two settings is\nused.\nUsing this option implies that a mount namespace is allocated for the unit, i.e. it implies the\neffect of\nPrivateMounts=\n(see below).\nThis option is particularly useful when\nRootDirectory=\n/\nRootImage=\nis used. In this case, the source path refers to a path on the host file system, while the destination path\nrefers to a path below the root directory of the unit.\nNote that the destination directory must exist or systemd must be able to create it. Thus, it\nis not possible to use those options for mount points nested underneath paths specified in\nInaccessiblePaths=\n, or under\n/home/\nand other protected\ndirectories if\nProtectHome=yes\nis\nspecified.\nTemporaryFileSystem=\nwith \"\n:ro\n\" or\nProtectHome=tmpfs\nshould be used instead.\nAdded in version 233.\nMountImages=\nÂ¶\nThis setting is similar to\nRootImage=\nin that it mounts a file\nsystem hierarchy from a block device node or loopback file, but the destination directory can be\nspecified as well as mount options. This option expects a whitespace separated list of mount\ndefinitions. Each definition consists of a colon-separated tuple of source path and destination\ndefinitions, optionally followed by another colon and a list of mount options.\nMount options may be defined as a single comma-separated list of options, in which case they\nwill be implicitly applied to the root partition on the image, or a series of colon-separated tuples\nof partition name and mount options. Valid partition names and mount options are the same as for\nRootImageOptions=\nsetting described above.\nEach mount definition may be prefixed with \"\n-\n\", in which case it will be\nignored when its source path does not exist. The source argument is a path to a block device node or\nregular file. If source or destination contain a \"\n:\n\", it needs to be escaped as\n\"\n\\:\n\". The device node or file system image file needs to follow the same rules as\nspecified for\nRootImage=\n. Any mounts created with this option are specific to the\nunit, and are not visible in the host's mount table.\nThese settings may be used more than once, each usage appends to the unit's list of mount\npaths. If the empty string is assigned, the entire list of mount paths defined prior to this is\nreset.\nNote that the destination directory must exist or systemd must be able to create it. Thus, it\nis not possible to use those options for mount points nested underneath paths specified in\nInaccessiblePaths=\n, or under\n/home/\nand other protected\ndirectories if\nProtectHome=yes\nis specified.\nWhen\nDevicePolicy=\nis set to \"\nclosed\n\" or\n\"\nstrict\n\", or set to \"\nauto\n\" and\nDeviceAllow=\nis\nset, then this setting adds\n/dev/loop-control\nwith\nrw\nmode,\n\"\nblock-loop\n\" and \"\nblock-blkext\n\" with\nrwm\nmode\nto\nDeviceAllow=\n. See\nsystemd.resource-control\n(5)\nfor the details about\nDevicePolicy=\nor\nDeviceAllow=\n. Also, see\nPrivateDevices=\nbelow, as it may change the setting of\nDevicePolicy=\n.\nThis option is only available for system services and is not supported for services\nrunning in per-user instances of the service manager.\nAdded in version 247.\nExtensionImages=\nÂ¶\nThis setting is similar to\nMountImages=\nin that it mounts a file\nsystem hierarchy from a block device node or loopback file, but instead of providing a destination\npath, an overlay will be set up. This option expects a whitespace separated list of mount\ndefinitions. Each definition consists of a source path, optionally followed by a colon and a list of\nmount options.\nA read-only OverlayFS will be set up on top of\n/usr/\nand\n/opt/\nhierarchies for sysext images and\n/etc/\nhierarchy for confext images. The order in which the images are listed will determine the\norder in which the overlay is laid down: images specified first to last will result in overlayfs\nlayers bottom to top.\nMount options may be defined as a single comma-separated list of options, in which case they\nwill be implicitly applied to the root partition on the image, or a series of colon-separated tuples\nof partition name and mount options. Valid partition names and mount options are the same as for\nRootImageOptions=\nsetting described above.\nEach mount definition may be prefixed with \"\n-\n\", in which case it will be\nignored when its source path does not exist. The source argument is a path to a block device node or\nregular file. If the source path contains a \"\n:\n\", it needs to be escaped as\n\"\n\\:\n\". The device node or file system image file needs to follow the same rules as\nspecified for\nRootImage=\n. Any mounts created with this option are specific to the\nunit, and are not visible in the host's mount table.\nThese settings may be used more than once, each usage appends to the unit's list of image\npaths. If the empty string is assigned, the entire list of mount paths defined prior to this is\nreset.\nEach sysext image must carry a\n/usr/lib/extension-release.d/extension-release.IMAGE\nfile while each confext image must carry a\n/etc/extension-release.d/extension-release.IMAGE\nfile, with the appropriate metadata which matches\nRootImage=\n/\nRootDirectory=\nor the host. See:\nos-release\n(5)\n.\nTo disable the safety check that the extension-release file name matches the image file name, the\nx-systemd.relax-extension-release-check\nmount option may be appended.\nThis option can be used together with a\nnotify-reload\nservice type and\nsystemd.v\n(7)\nto manage configuration updates. When such a service carrying confext images is reloaded via\nsystemctl reload foo.service\nor equivalent D-Bus method, the confext itself will\nbe reloaded to pick up any changes. This only applies to confext extensions. Note that in case a\nservice has this configuration enabled at first, and then it is subsequently removed in an update\nfollowed by a daemon-reload operation, reloading the confexts will be a no-op, and a full service\nrestart is required instead. See\nsystemd.service\n(5)\nalso for details.\nWhen\nDevicePolicy=\nis set to \"\nclosed\n\" or\n\"\nstrict\n\", or set to \"\nauto\n\" and\nDeviceAllow=\nis\nset, then this setting adds\n/dev/loop-control\nwith\nrw\nmode,\n\"\nblock-loop\n\" and \"\nblock-blkext\n\" with\nrwm\nmode\nto\nDeviceAllow=\n. See\nsystemd.resource-control\n(5)\nfor the details about\nDevicePolicy=\nor\nDeviceAllow=\n. Also, see\nPrivateDevices=\nbelow, as it may change the setting of\nDevicePolicy=\n.\nIn place of the image path a \"\n.v/\n\" versioned directory may be specified, see\nsystemd.v\n(7)\nfor\ndetails.\nThis option is only available for system services and is not supported for services\nrunning in per-user instances of the service manager.\nAdded in version 248.\nExtensionDirectories=\nÂ¶\nThis setting is similar to\nBindReadOnlyPaths=\nin that it mounts a file\nsystem hierarchy from a directory, but instead of providing a destination path, an overlay will be set\nup. This option expects a whitespace separated list of source directories.\nA read-only OverlayFS will be set up on top of\n/usr/\nand\n/opt/\nhierarchies for sysext images and\n/etc/\nhierarchy for confext images. The order in which the directories are listed will determine\nthe order in which the overlay is laid down: directories specified first to last will result in overlayfs\nlayers bottom to top.\nEach directory listed in\nExtensionDirectories=\nmay be prefixed with \"\n-\n\",\nin which case it will be ignored when its source path does not exist. Any mounts created with this option are\nspecific to the unit, and are not visible in the host's mount table.\nThese settings may be used more than once, each usage appends to the unit's list of directories\npaths. If the empty string is assigned, the entire list of mount paths defined prior to this is\nreset.\nEach sysext directory must contain a\n/usr/lib/extension-release.d/extension-release.IMAGE\nfile while each confext directory must carry a\n/etc/extension-release.d/extension-release.IMAGE\nfile, with the appropriate metadata which matches\nRootImage=\n/\nRootDirectory=\nor the host. See:\nos-release\n(5)\n.\nThis option can be used together with a\nnotify-reload\nservice type and\nsystemd.v\n(7)\nto manage configuration updates. When such a service carrying confext directories is reloaded via\nsystemctl reload foo.service\nor equivalent D-Bus method, the confext itself will\nbe reloaded to pick up any changes. This only applies to confext extensions. Note that in case a\nservice has this configuration enabled at first, and then it is subsequently removed in an update\nfollowed by a daemon-reload operation, reloading the confexts will be a no-op, and a full service\nrestart is required instead. See\nsystemd.service\n(5)\nalso for details.\nNote that usage from user units requires overlayfs support in unprivileged user namespaces,\nwhich was first introduced in kernel v5.11.\nIn place of the directory path a \"\n.v/\n\" versioned directory may be specified,\nsee\nsystemd.v\n(7)\nfor\ndetails.\nThis option is only available for system services, or for services running in per-user\ninstances of the service manager in which case\nPrivateUsers=\nis implicitly enabled\n(requires unprivileged user namespaces support to be enabled in the kernel via the\n\"\nkernel.unprivileged_userns_clone=\n\" sysctl).\nAdded in version 251.\nUser/Group Identity\nÂ¶\nThese options are only available for system services and are not supported for services\nrunning in per-user instances of the service manager.\nUser=\n,\nGroup=\nÂ¶\nSet the UNIX user or group that the processes are executed as, respectively. Takes a single\nuser or group name, or a numeric ID as argument. For system services (services run by the system service\nmanager, i.e. managed by PID 1) and for user services of the root user (services managed by root's instance of\nsystemd --user\n), the default is \"\nroot\n\", but\nUser=\nmay be\nused to specify a different user. For user services of any other user, switching user identity is not\npermitted, hence the only valid setting is the same user the user's service manager is running as. If no group\nis set, the default group of the user is used. This setting does not affect commands whose command line is\nprefixed with \"\n+\n\".\nNote that this enforces only weak restrictions on the user/group name syntax, but will generate\nwarnings in many cases where user/group names do not adhere to the following rules: the specified\nname should consist only of the characters a-z, A-Z, 0-9, \"\n_\n\" and\n\"\n-\n\", except for the first character which must be one of a-z, A-Z and\n\"\n_\n\" (i.e. digits and \"\n-\n\" are not permitted as first character). The\nuser/group name must have at least one character, and at most 31. These restrictions are made in\norder to avoid ambiguities and to ensure user/group names and unit files remain portable among Linux\nsystems. For further details on the names accepted and the names warned about see\nUser/Group Name Syntax\n.\nWhen used in conjunction with\nDynamicUser=\nthe user/group name specified is\ndynamically allocated at the time the service is started, and released at the time the service is\nstopped â unless it is already allocated statically (see below). If\nDynamicUser=\nis not used the specified user and group must have been created statically in the user database no\nlater than the moment the service is started, for example using the\nsysusers.d\n(5)\nfacility, which is applied at boot or package install time. If the user does not exist by then\nprogram invocation will fail.\nIf the\nUser=\nsetting is used the supplementary group list is initialized\nfrom the specified user's default group list, as defined in the system's user and group\ndatabase. Additional groups may be configured through the\nSupplementaryGroups=\nsetting (see below).\nDynamicUser=\nÂ¶\nTakes a boolean parameter. If set, a UNIX user and group pair is allocated\ndynamically when the unit is started, and released as soon as it is stopped. The user and group will\nnot be added to\n/etc/passwd\nor\n/etc/group\n, but are managed\ntransiently during runtime. The\nnss-systemd\n(8)\nglibc\nNSS module provides integration of these dynamic users/groups into the system's user and group\ndatabases. The user and group name to use may be configured via\nUser=\nand\nGroup=\n(see above). If these options are not used and dynamic user/group\nallocation is enabled for a unit, the name of the dynamic user/group is implicitly derived from the\nunit name. If the unit name without the type suffix qualifies as valid user name it is used directly,\notherwise a name incorporating a hash of it is used. If a statically allocated user or group of the\nconfigured name already exists, it is used and no dynamic user/group is allocated. Note that if\nUser=\nis specified and the static group with the name exists, then it is required\nthat the static user with the name already exists. Similarly, if\nGroup=\nis\nspecified and the static user with the name exists, then it is required that the static group with\nthe name already exists. Dynamic users/groups are allocated from the UID/GID range 61184â¦65519. It is\nrecommended to avoid this range for regular system or login users. At any point in time each UID/GID\nfrom this range is only assigned to zero or one dynamically allocated users/groups in use. However,\nUID/GIDs are recycled after a unit is terminated. Care should be taken that any processes running as\npart of a unit for which dynamic users/groups are enabled do not leave files or directories owned by\nthese users/groups around, as a different unit might get the same UID/GID assigned later on, and thus\ngain access to these files or directories. If\nDynamicUser=\nis enabled,\nRemoveIPC=\nis implied (and cannot be turned off). This ensures that the lifetime\nof IPC objects and temporary files created by the executed processes is bound to the runtime of the\nservice, and hence the lifetime of the dynamic user/group. Since\n/tmp/\nand\n/var/tmp/\nare usually the only world-writable directories on a system, unless\nPrivateTmp=\nis manually set to \"\ntrue\n\", \"\ndisconnected\n\"\nwould be implied. This ensures that a unit making use of dynamic user/group allocation cannot\nleave files around after unit termination. Furthermore\nNoNewPrivileges=\nand\nRestrictSUIDSGID=\nare implicitly enabled\n(and cannot be disabled), to ensure that processes invoked cannot take benefit or create SUID/SGID\nfiles or directories. Moreover,\nProtectSystem=strict\nand\nProtectHome=read-only\nare implied, thus prohibiting the service to write to\narbitrary file system locations. In order to allow the service to write to certain directories, they\nhave to be allow-listed using\nReadWritePaths=\n, but care must be taken so that\nUID/GID recycling does not create security issues involving files created by the service. Use\nRuntimeDirectory=\n(see below) in order to assign a writable runtime directory to a\nservice, owned by the dynamic user/group and removed automatically when the unit is terminated. Use\nStateDirectory=\n,\nCacheDirectory=\nand\nLogsDirectory=\nin order to assign a set of writable directories for specific\npurposes to the service in a way that they are protected from vulnerabilities due to UID reuse (see\nbelow). If this option is enabled, care should be taken that the unit's processes do not get access\nto directories outside of these explicitly configured and managed ones. Specifically, do not use\nBindPaths=\nand be careful with\nAF_UNIX\nfile descriptor\npassing for directory file descriptors, as this would permit processes to create files or directories\nowned by the dynamic user/group that are not subject to the lifecycle and access guarantees of the\nservice. Note that this option is currently incompatible with D-Bus policies, thus a service using\nthis option may currently not allocate a D-Bus service name (note that this does not affect calling\ninto other D-Bus services). Defaults to off.\nAdded in version 232.\nSupplementaryGroups=\nÂ¶\nSets the supplementary Unix groups the processes are executed as. This takes a space-separated\nlist of group names or IDs. This option may be specified more than once, in which case all listed groups are\nset as supplementary groups. When the empty string is assigned, the list of supplementary groups is reset, and\nall assignments prior to this one will have no effect. In any way, this option does not override, but extends\nthe list of supplementary groups configured in the system group database for the user. This does not affect\ncommands prefixed with \"\n+\n\".\nSetLoginEnvironment=\nÂ¶\nTakes a boolean parameter that controls whether to set the\n$HOME\n,\n$LOGNAME\n, and\n$SHELL\nenvironment variables. If not set, this\ndefaults to true if\nUser=\n,\nDynamicUser=\nor\nPAMName=\nare set, false otherwise. If set to true, the variables will always be\nset for system services, i.e. even when the default user \"\nroot\n\" is used. If set to\nfalse, the mentioned variables are not set by the service manager, no matter whether\nUser=\n,\nDynamicUser=\n, or\nPAMName=\nare used or\nnot. This option normally has no effect on services of the per-user service manager, since in that\ncase these variables are typically inherited from user manager's own environment anyway.\nAdded in version 255.\nPAMName=\nÂ¶\nSets the PAM service name to set up a session as. If set, the executed process will be\nregistered as a PAM session under the specified service name. This is only useful in conjunction with the\nUser=\nsetting, and is otherwise ignored. If not set, no PAM session will be opened for the\nexecuted processes. See\npam\n(8)\nfor\ndetails.\nNote that for each unit making use of this option a PAM session handler process will be maintained as\npart of the unit and stays around as long as the unit is active, to ensure that appropriate actions can be\ntaken when the unit and hence the PAM session terminates. This process is named \"\n(sd-pam)\n\" and\nis an immediate child process of the unit's main process.\nNote that when this option is used for a unit it is very likely (depending on PAM configuration) that the\nmain unit process will be migrated to its own session scope unit when it is activated. This process will hence\nbe associated with two units: the unit it was originally started from (and for which\nPAMName=\nwas configured), and the session scope unit. Any child processes of that process\nwill however be associated with the session scope unit only. This has implications when used in combination\nwith\nNotifyAccess=\nall\n, as these child processes will not be able to affect\nchanges in the original unit through notification messages. These messages will be considered belonging to the\nsession scope unit and not the original unit. It is hence not recommended to use\nPAMName=\nin\ncombination with\nNotifyAccess=\nall\n.\nIf a PAM module interactively requests input (a password or suchlike) it will be attempted to\nbe read from a service credential (as configured via\nSetCredential=\n,\nImportCredential=\nand related calls) under the name\npam.authtok.\npamservice\n, where\npamservice\nis replaced by the PAM service name as configured with\nPAMName=\n. (Note that the credential remains accessible for the runtime of the\nservice!) If no matching credential is set, the user is prompted for it interactively via the\nPassword Agent\nlogic.\nCapabilities\nÂ¶\nThese options are only available for system services, or for services running in per-user\ninstances of the service manager in which case\nPrivateUsers=\nis implicitly enabled\n(requires unprivileged user namespaces support to be enabled in the kernel via the\n\"\nkernel.unprivileged_userns_clone=\n\" sysctl).\nCapabilityBoundingSet=\nÂ¶\nControls which capabilities to include in the capability bounding set for the\nexecuted process. See\ncapabilities\n(7)\nfor details. Takes a whitespace-separated list of capability names,\ne.g.\nCAP_SYS_ADMIN\n,\nCAP_DAC_OVERRIDE\n,\nCAP_SYS_PTRACE\n. Capabilities listed will be included in the bounding set, all\nothers are removed. If the list of capabilities is prefixed with \"\n~\n\", all but the\nlisted capabilities will be included, the effect of the assignment inverted. Note that this option\nalso affects the respective capabilities in the effective, permitted and inheritable capability\nsets. If this option is not used, the capability bounding set is not modified on process execution,\nhence no limits on the capabilities of the process are enforced. This option may appear more than\nonce, in which case the bounding sets are merged by\nOR\n, or by\nAND\nif the lines are prefixed with \"\n~\n\" (see below). If the\nempty string is assigned to this option, the bounding set is reset to the empty capability set, and\nall prior settings have no effect. If set to \"\n~\n\" (without any further argument),\nthe bounding set is reset to the full set of available capabilities, also undoing any previous\nsettings. This does not affect commands prefixed with \"\n+\n\".\nUse\nsystemd-analyze\n(1)\n's\ncapability\ncommand to retrieve a list of capabilities defined on the local\nsystem.\nExample: if a unit has the following,\nCapabilityBoundingSet=CAP_A CAP_B\nCapabilityBoundingSet=CAP_B CAP_C\nthen\nCAP_A\n,\nCAP_B\n, and\nCAP_C\nare set. If the second line is prefixed with\n\"\n~\n\", e.g.,\nCapabilityBoundingSet=CAP_A CAP_B\nCapabilityBoundingSet=~CAP_B CAP_C\nthen, only\nCAP_A\nis set.\nAmbientCapabilities=\nÂ¶\nControls which capabilities to include in the ambient capability set for the executed\nprocess. Takes a whitespace-separated list of capability names, e.g.\nCAP_SYS_ADMIN\n,\nCAP_DAC_OVERRIDE\n,\nCAP_SYS_PTRACE\n. This option may appear more than\nonce, in which case the ambient capability sets are merged (see the above examples in\nCapabilityBoundingSet=\n). If the list of capabilities is prefixed with \"\n~\n\",\nall but the listed capabilities will be included, the effect of the assignment inverted. If the empty string is\nassigned to this option, the ambient capability set is reset to the empty capability set, and all prior\nsettings have no effect. If set to \"\n~\n\" (without any further argument), the ambient capability\nset is reset to the full set of available capabilities, also undoing any previous settings. Note that adding\ncapabilities to the ambient capability set adds them to the process's inherited capability set.\nAmbient capability sets are useful if you want to execute a process as a non-privileged user but\nstill want to give it some capabilities. Note that, in this case, option\nkeep-caps\nis automatically added to\nSecureBits=\nto retain the capabilities over the user\nchange.\nAmbientCapabilities=\ndoes not affect commands prefixed with\n\"\n+\n\".\nAdded in version 229.\nSecurity\nÂ¶\nNoNewPrivileges=\nÂ¶\nTakes a boolean argument. If true, ensures that the service process and all its\nchildren can never gain new privileges through\nexecve()\n(e.g. via setuid or\nsetgid bits, or filesystem capabilities). This is the simplest and most effective way to ensure that\na process and its children can never elevate privileges again. Defaults to false. In case the service\nwill be run in a new mount namespace anyway and SELinux is disabled, all file systems are mounted with\nMS_NOSUID\nflag. Also see\nNo New Privileges Flag\n.\nNote that this setting only has an effect on the unit's processes themselves (or any processes\ndirectly or indirectly forked off them). It has no effect on processes potentially invoked on request\nof them through tools such as\nat\n(1)\n,\ncrontab\n(1)\n,\nsystemd-run\n(1)\n, or\narbitrary IPC services.\nAdded in version 187.\nSecureBits=\nÂ¶\nControls the secure bits set for the executed process. Takes a space-separated combination of\noptions from the following list:\nkeep-caps\n,\nkeep-caps-locked\n,\nno-setuid-fixup\n,\nno-setuid-fixup-locked\n,\nnoroot\n, and\nnoroot-locked\n. This option may appear more than once, in which case the secure bits are\nORed. If the empty string is assigned to this option, the bits are reset to 0. This does not affect commands\nprefixed with \"\n+\n\". See\ncapabilities\n(7)\nfor\ndetails.\nMandatory Access Control\nÂ¶\nSELinuxContext=\nÂ¶\nSet the SELinux security context of the executed process. If set, this will override the\nautomated domain transition. However, the policy still needs to authorize the transition. This directive is\nignored if SELinux is disabled. If prefixed by \"\n-\n\", failing to set the SELinux\nsecurity context will be ignored, but it is still possible that the subsequent\nexecve()\nmay fail if the policy does not allow the transition for the\nnon-overridden context. This does not affect commands prefixed with \"\n+\n\". See\nsetexeccon\n(3)\nfor details.\nAdded in version 209.\nAppArmorProfile=\nÂ¶\nTakes a profile name as argument. The process executed by the unit will switch to\nthis profile when started. Profiles must already be loaded in the kernel, or the unit will fail. If\nprefixed by \"\n-\n\", all errors will be ignored. This setting has no effect if AppArmor\nis not enabled. This setting does not affect commands prefixed with \"\n+\n\".\nThis option is only available for system services and is not supported for services\nrunning in per-user instances of the service manager.\nAdded in version 210.\nSmackProcessLabel=\nÂ¶\nTakes a\nSMACK64\nsecurity label as argument. The process executed by the unit\nwill be started under this label and SMACK will decide whether the process is allowed to run or not, based on\nit. The process will continue to run under the label specified here unless the executable has its own\nSMACK64EXEC\nlabel, in which case the process will transition to run under that label. When not\nspecified, the label that systemd is running under is used. This directive is ignored if SMACK is\ndisabled.\nThe value may be prefixed by \"\n-\n\", in which case all errors will be ignored. An empty\nvalue may be specified to unset previous assignments. This does not affect commands prefixed with\n\"\n+\n\".\nThis option is only available for system services and is not supported for services\nrunning in per-user instances of the service manager.\nAdded in version 218.\nProcess Properties\nÂ¶\nLimitCPU=\n,\nLimitFSIZE=\n,\nLimitDATA=\n,\nLimitSTACK=\n,\nLimitCORE=\n,\nLimitRSS=\n,\nLimitNOFILE=\n,\nLimitAS=\n,\nLimitNPROC=\n,\nLimitMEMLOCK=\n,\nLimitLOCKS=\n,\nLimitSIGPENDING=\n,\nLimitMSGQUEUE=\n,\nLimitNICE=\n,\nLimitRTPRIO=\n,\nLimitRTTIME=\nÂ¶\nSet soft and hard limits on various resources for executed processes. See\nsetrlimit\n(2)\nfor\ndetails on the process resource limit concept. Process resource limits may be specified in two formats:\neither as single value to set a specific soft and hard limit to the same value, or as colon-separated\npair\nsoft:hard\nto set both limits individually\n(e.g. \"\nLimitAS=4G:16G\n\").  Use the string\ninfinity\nto configure no\nlimit on a specific resource. The multiplicative suffixes K, M, G, T, P and E (to the base 1024) may\nbe used for resource limits measured in bytes (e.g. \"\nLimitAS=16G\n\"). For the limits\nreferring to time values, the usual time units ms, s, min, h and so on may be used (see\nsystemd.time\n(7)\nfor\ndetails). Note that if no time unit is specified for\nLimitCPU=\nthe default unit of\nseconds is implied, while for\nLimitRTTIME=\nthe default unit of microseconds is\nimplied. Also, note that the effective granularity of the limits might influence their\nenforcement. For example, time limits specified for\nLimitCPU=\nwill be rounded up\nimplicitly to multiples of 1s. For\nLimitNICE=\nthe value may be specified in two\nsyntaxes: if prefixed with \"\n+\n\" or \"\n-\n\", the value is understood as\nregular Linux nice value in the range -20â¦19. If not prefixed like this the value is understood as\nraw resource limit parameter in the range 0â¦40 (with 0 being equivalent to 1).\nNote that most process resource limits configured with these options are per-process, and\nprocesses may fork in order to acquire a new set of resources that are accounted independently of the\noriginal process, and may thus escape limits set. Also note that\nLimitRSS=\nis not\nimplemented on Linux, and setting it has no effect. Often it is advisable to prefer the resource\ncontrols listed in\nsystemd.resource-control\n(5)\nover these per-process limits, as they apply to services as a whole, may be altered dynamically at\nruntime, and are generally more expressive. For example,\nMemoryMax=\nis a more\npowerful (and working) replacement for\nLimitRSS=\n.\nNote that\nLimitNPROC=\nwill limit the number of processes from one (real) UID and\nnot the number of processes started (forked) by the service. Therefore the limit is cumulative for all\nprocesses running under the same UID. Please also note that the\nLimitNPROC=\nwill not be\nenforced if the service is running as root (and not dropping privileges). Due to these limitations,\nTasksMax=\n(see\nsystemd.resource-control\n(5)\n) is typically a better choice than\nLimitNPROC=\n.\nResource limits not configured explicitly for a unit default to the value configured in the various\nDefaultLimitCPU=\n,\nDefaultLimitFSIZE=\n, â¦ options available in\nsystemd-system.conf\n(5)\n, and â\nif not configured there â the kernel or per-user defaults, as defined by the OS (the latter only for user\nservices, see below).\nFor system units these resource limits may be chosen freely. When these settings are configured\nin a user service (i.e. a service run by the per-user instance of the service manager) they cannot be\nused to raise the limits above those set for the user manager itself when it was first invoked, as\nthe user's service manager generally lacks the privileges to do so. In user context these\nconfiguration options are hence only useful to lower the limits passed in or to raise the soft limit\nto the maximum of the hard limit as configured for the user. To raise the user's limits further, the\navailable configuration mechanisms differ between operating systems, but typically require\nprivileges. In most cases it is possible to configure higher per-user resource limits via PAM or by\nsetting limits on the system service encapsulating the user's service manager, i.e. the user's\ninstance of\nuser@.service\n. After making such changes, make sure to restart the\nuser's service manager.\nTableÂ 1.Â Resource limit directives, their equivalent\nulimit\nshell commands and the unit used\nDirective\nulimit\nequivalent\nUnit\nNotes\nLimitCPU=\nulimit -t\nSeconds\n-\nLimitFSIZE=\nulimit -f\nBytes\n-\nLimitDATA=\nulimit -d\nBytes\nDo not use. This limits the allowed address range, not memory use! Defaults to unlimited and should not be lowered. To limit memory use, see\nMemoryMax=\nin\nsystemd.resource-control\n(5)\n.\nLimitSTACK=\nulimit -s\nBytes\n-\nLimitCORE=\nulimit -c\nBytes\n-\nLimitRSS=\nulimit -m\nBytes\nDo not use. No effect on Linux.\nLimitNOFILE=\nulimit -n\nNumber of File Descriptors\nDo not use. Be careful when raising the soft limit above 1024, since\nselect\n(2)\ncannot function with file descriptors above 1023 on Linux. Nowadays, the hard limit defaults to 524288, a very high value compared to historical defaults. Typically applications should increase their soft limit to the hard limit on their own, if they are OK with working with file descriptors above 1023, i.e. do not use\nselect\n(2)\n. Note that file descriptors are nowadays accounted like any other form of memory, thus there should not be any need to lower the hard limit. Use\nMemoryMax=\nto control overall service memory use, including file descriptor memory.\nLimitAS=\nulimit -v\nBytes\nDo not use. This limits the allowed address range, not memory use! Defaults to unlimited and should not be lowered. To limit memory use, see\nMemoryMax=\nin\nsystemd.resource-control\n(5)\n.\nLimitNPROC=\nulimit -u\nNumber of Processes\nThis limit is enforced based on the number of processes belonging to the user. Typically it is better to track processes per service, i.e. use\nTasksMax=\n, see\nsystemd.resource-control\n(5)\n.\nLimitMEMLOCK=\nulimit -l\nBytes\n-\nLimitLOCKS=\nulimit -x\nNumber of Locks\n-\nLimitSIGPENDING=\nulimit -i\nNumber of Queued Signals\n-\nLimitMSGQUEUE=\nulimit -q\nBytes\n-\nLimitNICE=\nulimit -e\nNice Level\n-\nLimitRTPRIO=\nulimit -r\nRealtime Priority\n-\nLimitRTTIME=\nulimit -R\nMicroseconds\n-\nUMask=\nÂ¶\nControls the file mode creation mask. Takes an access mode in octal notation. See\numask\n(2)\nfor\ndetails. Defaults to 0022 for system units. For user units the default value is inherited from the\nper-user service manager (whose default is in turn inherited from the system service manager, and\nthus typically also is 0022 â unless overridden by a PAM module). In order to change the per-user mask\nfor all user services, consider setting the\nUMask=\nsetting of the user's\nuser@.service\nsystem service instance. The per-user umask may also be set via\nthe\numask\nfield of a user's\nJSON User\nRecord\n(for users managed by\nsystemd-homed.service\n(8)\nthis field may be controlled via\nhomectl --umask=\n). It may also be set via a PAM\nmodule, such as\npam_umask\n(8)\n.\nCoredumpFilter=\nÂ¶\nControls which types of memory mappings will be saved if the process dumps core\n(using the\n/proc/\npid\n/coredump_filter\nfile). Takes a\nwhitespace-separated combination of mapping type names or numbers (with the default base 16). Mapping\ntype names are\nprivate-anonymous\n,\nshared-anonymous\n,\nprivate-file-backed\n,\nshared-file-backed\n,\nelf-headers\n,\nprivate-huge\n,\nshared-huge\n,\nprivate-dax\n,\nshared-dax\n,\nand the special values\nall\n(all types) and\ndefault\n(the\nkernel default of \"\nprivate-anonymous\nshared-anonymous\nelf-headers\nprivate-huge\n\"). See\ncore\n(5)\nfor the meaning of the mapping types. When specified multiple times, all specified masks are\nORed. When not set, or if the empty value is assigned, the inherited value is not changed.\nExampleÂ 2.Â Add DAX pages to the dump filter\nCoredumpFilter=default private-dax shared-dax\nAdded in version 246.\nKeyringMode=\nÂ¶\nControls how the kernel session keyring is set up for the service (see\nsession-keyring\n(7)\nfor\ndetails on the session keyring). Takes one of\ninherit\n,\nprivate\n,\nshared\n. If set to\ninherit\nno special keyring setup is done, and the kernel's\ndefault behaviour is applied. If\nprivate\nis used a new session keyring is allocated when a\nservice process is invoked, and it is not linked up with any user keyring. This is the recommended setting for\nsystem services, as this ensures that multiple services running under the same system user ID (in particular\nthe root user) do not share their key material among each other. If\nshared\nis used a new\nsession keyring is allocated as for\nprivate\n, but the user keyring of the user configured with\nUser=\nis linked into it, so that keys assigned to the user may be requested by the unit's\nprocesses. In this mode multiple units running processes under the same user ID may share key material. Unless\ninherit\nis selected the unique invocation ID for the unit (see below) is added as a protected\nkey by the name \"\ninvocation_id\n\" to the newly created session keyring. Defaults to\nprivate\nfor services of the system service manager and to\ninherit\nfor\nnon-service units and for services of the user service manager.\nAdded in version 235.\nOOMScoreAdjust=\nÂ¶\nSets the adjustment value for the Linux kernel's Out-Of-Memory (OOM) killer score for\nexecuted processes. Takes an integer between -1000 (to disable OOM killing of processes of this unit)\nand 1000 (to make killing of processes of this unit under memory pressure very likely). See\nThe /proc Filesystem\nfor\ndetails. If not specified, defaults to the OOM score adjustment level of the service manager itself,\nwhich is normally at 0.\nUse the\nOOMPolicy=\nsetting of service units to configure how the service\nmanager shall react to the kernel OOM killer or\nsystemd-oomd\nterminating a process of the service. See\nsystemd.service\n(5)\nfor details.\nTimerSlackNSec=\nÂ¶\nSets the timer slack in nanoseconds for the executed processes. The timer slack controls the\naccuracy of wake-ups triggered by timers. See\nprctl\n(2)\nfor more\ninformation. Note that in contrast to most other time span definitions this parameter takes an integer value in\nnano-seconds if no unit is specified. The usual time units are understood too.\nPersonality=\nÂ¶\nControls which kernel architecture\nuname\n(2)\nshall\nreport, when invoked by unit processes. Takes one of the architecture identifiers\narm64\n,\narm64-be\n,\narm\n,\narm-be\n,\nx86\n,\nx86-64\n,\nppc\n,\nppc-le\n,\nppc64\n,\nppc64-le\n,\ns390\nor\ns390x\n. Which\npersonality architectures are supported depends on the kernel's native architecture. Usually the\n64-bit versions of the various system architectures support their immediate 32-bit personality\narchitecture counterpart, but no others. For example,\nx86-64\nsystems support the\nx86-64\nand\nx86\npersonalities but no others. The personality\nfeature is useful when running 32-bit services on a 64-bit host system. If not specified, the\npersonality is left unmodified and thus reflects the personality of the host system's kernel. This\noption is not useful on architectures for which only one native word width was ever available, such\nas\nm68k\n(32-bit only) or\nalpha\n(64-bit only).\nAdded in version 209.\nIgnoreSIGPIPE=\nÂ¶\nTakes a boolean argument. If true,\nSIGPIPE\nis ignored in the\nexecuted process. Defaults to true since\nSIGPIPE\nis generally only useful in\nshell pipelines.\nScheduling\nÂ¶\nNice=\nÂ¶\nSets the default nice level (scheduling priority) for executed processes. Takes an\ninteger between -20 (highest priority) and 19 (lowest priority). In case of resource contention,\nsmaller values mean more resources will be made available to the unit's processes, larger values mean\nless resources will be made available. See\nsetpriority\n(2)\nfor\ndetails.\nCPUSchedulingPolicy=\nÂ¶\nSets the CPU scheduling policy for executed processes. Takes one of\nother\n,\nbatch\n,\nidle\n,\nfifo\nor\nrr\n. See\nsched_setscheduler\n(2)\nfor\ndetails.\nCPUSchedulingPriority=\nÂ¶\nSets the CPU scheduling priority for executed processes. The available priority range\ndepends on the selected CPU scheduling policy (see above). For real-time scheduling policies an\ninteger between 1 (lowest priority) and 99 (highest priority) can be used. In case of CPU resource\ncontention, smaller values mean less CPU time is made available to the service, larger values mean\nmore. See\nsched_setscheduler\n(2)\nfor details.\nCPUSchedulingResetOnFork=\nÂ¶\nTakes a boolean argument. If true, elevated CPU scheduling priorities and policies\nwill be reset when the executed processes call\nfork\n(2)\n,\nand can hence not leak into child processes. See\nsched_setscheduler\n(2)\nfor details. Defaults to false.\nCPUAffinity=\nÂ¶\nControls the CPU affinity of the executed processes. Takes a list of CPU indices or ranges\nseparated by either whitespace or commas. Alternatively, takes a special \"numa\" value in which case systemd\nautomatically derives allowed CPU range based on the value of\nNUMAMask=\noption. CPU ranges\nare specified by the lower and upper CPU indices separated by a dash. This option may be specified more than\nonce, in which case the specified CPU affinity masks are merged. If the empty string is assigned, the mask\nis reset, all assignments prior to this will have no effect. See\nsched_setaffinity\n(2)\nfor\ndetails.\nNUMAPolicy=\nÂ¶\nControls the NUMA memory policy of the executed processes. Takes a policy type, one of:\ndefault\n,\npreferred\n,\nbind\n,\ninterleave\nand\nlocal\n. A list of NUMA nodes that should be associated with the policy must be specified\nin\nNUMAMask=\n. For more details on each policy please see,\nset_mempolicy\n(2)\n. For overall\noverview of NUMA support in Linux see,\nnuma\n(7)\n.\nAdded in version 243.\nNUMAMask=\nÂ¶\nControls the NUMA node list which will be applied alongside with selected NUMA policy.\nTakes a list of NUMA nodes and has the same syntax as a list of CPUs for\nCPUAffinity=\noption or special \"all\" value which will include all available NUMA nodes in the mask. Note that the list\nof NUMA nodes is not required for\ndefault\nand\nlocal\npolicies and for\npreferred\npolicy we expect a single NUMA node.\nAdded in version 243.\nIOSchedulingClass=\nÂ¶\nSets the I/O scheduling class for executed processes. Takes one of the strings\nrealtime\n,\nbest-effort\nor\nidle\n. The kernel's\ndefault scheduling class is\nbest-effort\nat a priority of 4. If the empty string is\nassigned to this option, all prior assignments to both\nIOSchedulingClass=\nand\nIOSchedulingPriority=\nhave no effect. See\nioprio_set\n(2)\nfor\ndetails.\nIOSchedulingPriority=\nÂ¶\nSets the I/O scheduling priority for executed processes. Takes an integer between 0\n(highest priority) and 7 (lowest priority). In case of I/O contention, smaller values mean more I/O\nbandwidth is made available to the unit's processes, larger values mean less bandwidth. The available\npriorities depend on the selected I/O scheduling class (see above). If the empty string is assigned\nto this option, all prior assignments to both\nIOSchedulingClass=\nand\nIOSchedulingPriority=\nhave no effect. For the kernel's default scheduling class\n(\nbest-effort\n) this defaults to 4. See\nioprio_set\n(2)\nfor\ndetails.\nSandboxing\nÂ¶\nThe following sandboxing options are an effective way to limit the exposure of the system towards the unit's\nprocesses. It is recommended to turn on as many of these options for each unit as is possible without negatively\naffecting the process' ability to operate. Note that many of these sandboxing features are gracefully turned off on\nsystems where the underlying security mechanism is not available. For example,\nProtectSystem=\nhas no effect if the kernel is built without file system namespacing or if the service manager runs in a container\nmanager that makes file system namespacing unavailable to its payload. Similarly,\nRestrictRealtime=\nhas no effect on systems that lack support for SECCOMP system call filtering,\nor in containers where support for this is turned off.\nAlso note that some sandboxing functionality is generally not available in user services (i.e. services run\nby the per-user service manager). Specifically, the various settings requiring file system namespacing support\n(such as\nProtectSystem=\n) are not available, as the underlying kernel functionality is only\naccessible to privileged processes. However, most namespacing settings, that will not work on their own in user\nservices, will work when used in conjunction with\nPrivateUsers=\ntrue\n.\nNote that the various options that turn directories read-only (such as\nProtectSystem=\n,\nReadOnlyPaths=\n, â¦) do not affect the ability for\nprograms to connect to and communicate with\nAF_UNIX\nsockets in these\ndirectories. These options cannot be used to lock down access to IPC services hence.\nProtectSystem=\nÂ¶\nTakes a boolean argument or the special values \"\nfull\n\" or\n\"\nstrict\n\". If true, mounts the\n/usr/\nand the boot loader\ndirectories (\n/boot\nand\n/efi\n) read-only for processes\ninvoked by this unit. If set to \"\nfull\n\", the\n/etc/\ndirectory is\nmounted read-only, too. If set to \"\nstrict\n\" the entire file system hierarchy is\nmounted read-only, except for the API file system subtrees\n/dev/\n,\n/proc/\nand\n/sys/\n(protect these directories using\nPrivateDevices=\n,\nProtectKernelTunables=\n,\nProtectControlGroups=\n). This setting ensures that any modification of the\nvendor-supplied operating system (and optionally its configuration, and local mounts) is prohibited\nfor the service. It is recommended to enable this setting for all long-running services, unless they\nare involved with system updates or need to modify the operating system in other ways. If this option\nis used,\nReadWritePaths=\nmay be used to exclude specific directories from being\nmade read-only. Similar,\nStateDirectory=\n,\nLogsDirectory=\n, â¦ and\nrelated directory settings (see below) also exclude the specific directories from the effect of\nProtectSystem=\n. This setting is implied if\nDynamicUser=\nis\nset. This setting cannot ensure protection in all cases. In general it has the same limitations as\nReadOnlyPaths=\n, see below. Defaults to off.\nNote that if\nProtectSystem=\nis set to \"\nstrict\n\" and\nPrivateTmp=\nis enabled, then\n/tmp/\nand\n/var/tmp/\nwill be writable.\nAdded in version 214.\nProtectHome=\nÂ¶\nTakes a boolean argument or the special values \"\nread-only\n\" or\n\"\ntmpfs\n\". If true, the directories\n/home/\n,\n/root\n, and\n/run/user\nare made inaccessible and empty for\nprocesses invoked by this unit. If set to \"\nread-only\n\", the three directories are\nmade read-only instead. If set to \"\ntmpfs\n\", temporary file systems are mounted on the\nthree directories in read-only mode. The value \"\ntmpfs\n\" is useful to hide home\ndirectories not relevant to the processes invoked by the unit, while still allowing necessary\ndirectories to be made visible when listed in\nBindPaths=\nor\nBindReadOnlyPaths=\n.\nSetting this to \"\nyes\n\" is mostly equivalent to setting the three directories in\nInaccessiblePaths=\n. Similarly, \"\nread-only\n\" is mostly equivalent to\nReadOnlyPaths=\n, and \"\ntmpfs\n\" is mostly equivalent to\nTemporaryFileSystem=\nwith \"\n:ro\n\".\nIt is recommended to enable this setting for all long-running services (in particular\nnetwork-facing ones), to ensure they cannot get access to private user data, unless the services\nactually require access to the user's private data. This setting is implied if\nDynamicUser=\nis set. This setting cannot ensure protection in all cases. In\ngeneral it has the same limitations as\nReadOnlyPaths=\n, see below.\nThis option is only available for system services, or for services running in per-user\ninstances of the service manager in which case\nPrivateUsers=\nis implicitly enabled\n(requires unprivileged user namespaces support to be enabled in the kernel via the\n\"\nkernel.unprivileged_userns_clone=\n\" sysctl).\nAdded in version 214.\nRuntimeDirectory=\n,\nStateDirectory=\n,\nCacheDirectory=\n,\nLogsDirectory=\n,\nConfigurationDirectory=\nÂ¶\nThese options take a whitespace-separated list of directory names. The specified\ndirectory names must be relative, and may not include \"\n..\n\". If set, when the unit is\nstarted, one or more directories by the specified names will be created (including their parents)\nbelow the locations defined in the following table. Also, the corresponding environment variable will\nbe defined with the full paths of the directories. If multiple directories are set, then in the\nenvironment variable the paths are concatenated with colon (\"\n:\n\").\nIf\nDynamicUser=\nis used, and if the kernel version supports\nid-mapped mounts\n, the specified directories will\nbe owned by \"nobody\" in the host namespace and will be mapped to (and will be owned by) the service's\nUID/GID in its own namespace. For backward compatibility, existing directories created without id-mapped\nmounts will be kept untouched.\nTableÂ 2.Â Automatic directory creation and environment variables\nDirectory\nBelow path for system units\nBelow path for user units\nEnvironment variable set\nRuntimeDirectory=\n/run/\n$XDG_RUNTIME_DIR\n$RUNTIME_DIRECTORY\nStateDirectory=\n/var/lib/\n$XDG_STATE_HOME\n$STATE_DIRECTORY\nCacheDirectory=\n/var/cache/\n$XDG_CACHE_HOME\n$CACHE_DIRECTORY\nLogsDirectory=\n/var/log/\n$XDG_STATE_HOME\n/log/\n$LOGS_DIRECTORY\nConfigurationDirectory=\n/etc/\n$XDG_CONFIG_HOME\n$CONFIGURATION_DIRECTORY\nIn case of\nRuntimeDirectory=\nthe innermost subdirectories are removed when\nthe unit is stopped. It is possible to preserve the specified directories in this case if\nRuntimeDirectoryPreserve=\nis configured to\nrestart\nor\nyes\n(see below). The directories specified with\nStateDirectory=\n,\nCacheDirectory=\n,\nLogsDirectory=\n,\nConfigurationDirectory=\nare not removed when the unit is stopped.\nExcept in case of\nConfigurationDirectory=\n, the innermost specified directories will be\nowned by the user and group specified in\nUser=\nand\nGroup=\n. If the\nspecified directories already exist and their owning user or group do not match the configured ones, all files\nand directories below the specified directories as well as the directories themselves will have their file\nownership recursively changed to match what is configured. As an optimization, if the specified directories are\nalready owned by the right user and group, files and directories below of them are left as-is, even if they do\nnot match what is requested. The innermost specified directories will have their access mode adjusted to the\nwhat is specified in\nRuntimeDirectoryMode=\n,\nStateDirectoryMode=\n,\nCacheDirectoryMode=\n,\nLogsDirectoryMode=\nand\nConfigurationDirectoryMode=\n.\nThese options imply\nBindPaths=\nfor the specified paths. When combined with\nRootDirectory=\nor\nRootImage=\nthese paths always reside on the host and\nare mounted from there into the unit's file system namespace.\nIf\nDynamicUser=\nis used, the logic for\nCacheDirectory=\n,\nLogsDirectory=\nand\nStateDirectory=\nis slightly altered: the directories are created below\n/var/cache/private\n,\n/var/log/private\nand\n/var/lib/private\n,\nrespectively, which are host directories made inaccessible to\nunprivileged users, which ensures that access to these directories cannot be gained through dynamic\nuser ID recycling. Symbolic links are created to hide this difference in behaviour. Both from\nperspective of the host and from inside the unit, the relevant directories hence always appear\ndirectly below\n/var/cache\n,\n/var/log\nand\n/var/lib\n.\nUse\nRuntimeDirectory=\nto manage one or more runtime directories for the unit and bind\ntheir lifetime to the daemon runtime. This is particularly useful for unprivileged daemons that cannot create\nruntime directories in\n/run/\ndue to lack of privileges, and to make sure the runtime\ndirectory is cleaned up automatically after use. For runtime directories that require more complex or different\nconfiguration or lifetime guarantees, please consider using\ntmpfiles.d\n(5)\n.\nRuntimeDirectory=\n,\nStateDirectory=\n,\nCacheDirectory=\nand\nLogsDirectory=\noptionally support two\nmore parameters, separated by \"\n:\n\". The second parameter will be interpreted as a\ndestination path that will be created as a symlink to the directory. The symlinks will be created\nafter any\nBindPaths=\nor\nTemporaryFileSystem=\noptions have been\nset up, to make ephemeral symlinking possible. The same source can have multiple symlinks, by using\nthe same first parameter, but a different second parameter. The third parameter is a flags field,\nand since v257 can take a value of\nro\nto make the directory read only for the\nservice. This is also supported for\nConfigurationDirectory=\n. If multiple symlinks\nare set up, the directory will be read only if at least one is configured to be read only. To pass a\nflag without a destination symlink, the second parameter can be empty, for example:\nConfigurationDirectory=foo::ro\nThe directories defined by these options are always created under the standard paths used by systemd\n(\n/var/\n,\n/run/\n,\n/etc/\n, â¦). If the service needs\ndirectories in a different location, a different mechanism has to be used to create them.\ntmpfiles.d\n(5)\nprovides\nfunctionality that overlaps with these options. Using these options is recommended, because the lifetime of\nthe directories is tied directly to the lifetime of the unit, and it is not necessary to ensure that the\ntmpfiles.d\nconfiguration is executed before the unit is started.\nTo remove any of the directories created by these settings, use the\nsystemctl clean\nâ¦\ncommand on the relevant units, see\nsystemctl\n(1)\nfor\ndetails.\nExample: if a system service unit has the following,\nRuntimeDirectory=foo/bar baz\nthe service manager creates\n/run/foo\n(if it does not exist),\n/run/foo/bar\n, and\n/run/baz\n. The\ndirectories\n/run/foo/bar\nand\n/run/baz\nexcept\n/run/foo\nare\nowned by the user and group specified in\nUser=\nand\nGroup=\n, and removed\nwhen the service is stopped.\nExample: if a system service unit has the following,\nRuntimeDirectory=foo/bar\nStateDirectory=aaa/bbb ccc\nthen the environment variable \"\nRUNTIME_DIRECTORY\n\" is set with \"\n/run/foo/bar\n\", and\n\"\nSTATE_DIRECTORY\n\" is set with \"\n/var/lib/aaa/bbb:/var/lib/ccc\n\".\nExample: if a system service unit has the following,\nRuntimeDirectory=foo:bar foo:baz\nthe service manager creates\n/run/foo\n(if it does not exist), and\n/run/bar\nplus\n/run/baz\nas symlinks to\n/run/foo\n.\nAdded in version 211.\nRuntimeDirectoryMode=\n,\nStateDirectoryMode=\n,\nCacheDirectoryMode=\n,\nLogsDirectoryMode=\n,\nConfigurationDirectoryMode=\nÂ¶\nSpecifies the access mode of the directories specified in\nRuntimeDirectory=\n,\nStateDirectory=\n,\nCacheDirectory=\n,\nLogsDirectory=\n, or\nConfigurationDirectory=\n, respectively, as an octal number. Defaults to\n0755\n. See \"Permissions\" in\npath_resolution\n(7)\nfor a\ndiscussion of the meaning of permission bits.\nAdded in version 234.\nStateDirectoryQuota=\n,\nCacheDirectoryQuota=\n,\nLogsDirectoryQuota=\nÂ¶\nSpecifies the storage limits for the directories specified in\nStateDirectory=\n,\nCacheDirectory=\n, or\nLogsDirectory=\nrespectively.\nThe storage quota is defined in terms of disk blocks and inodes, as per\nquotactl\n. Takes an absolute size limit\nin bytes. If the value is suffixed with K, M, G or T, the specified size is parsed as Kilobytes, Megabytes, Gigabytes,\nor Terabytes (with the base 1024), respectively. If an absolute size limit is specified, only the block quota is set\n(rounded up to the nearest block). Alternatively, a percentage value may be specified, which applies the same percent\nquota to both blocks and inodes. Defaults to\noff\n, in which case no storage limits will be set.\nOnly hard limits are set, not soft limits. If the underlying filesystem for the specified directories does not\nsupport project quotas, the specified storage limits will not be set. In addition to enabling per-unit quotas with\nthese settings, it is necessary to enable\nprjquota\non the file system level as well\n(i.e.\ntune2fs -Q prjquota\n). Quotas must also be turned on with\nquotaon.\nAdded in version 258.\nStateDirectoryAccounting=\n,\nCacheDirectoryAccounting=\n,\nLogsDirectoryAccounting=\nÂ¶\nTakes a boolean argument. If true, a project ID is assigned to the directories specified in\nStateDirectory=\n,\nCacheDirectory=\n, or\nLogsDirectory=\nrespectively, which is used for tracking disk usage when disk quotas are turned on\n(see\nrepquota\n). Defaults to false.\nTo set and enforce disk quotas,\nStateDirectoryQuota=\n,\nCacheDirectoryQuota=\n,\nor\nLogsDirectoryQuota=\nmust be specified.\nAdded in version 258.\nRuntimeDirectoryPreserve=\nÂ¶\nTakes a boolean argument or\nrestart\n. If set to\nno\n(the\ndefault), the directories specified in\nRuntimeDirectory=\nare always removed when the service\nstops. If set to\nrestart\nthe directories are preserved when the service is both automatically\nand manually restarted. Here, the automatic restart means the operation specified in\nRestart=\n, and manual restart means the one triggered by\nsystemctl restart\nfoo.service\n. If set to\nyes\n, then the directories are not removed when the service is\nstopped. Note that since the runtime directory\n/run/\nis a mount point of\n\"\ntmpfs\n\", then for system services the directories specified in\nRuntimeDirectory=\nare removed when the system is rebooted.\nAdded in version 235.\nTimeoutCleanSec=\nÂ¶\nConfigures a timeout on the clean-up operation requested through\nsystemctl\nclean â¦\n, see\nsystemctl\n(1)\nfor\ndetails. Takes the usual time values and defaults to\ninfinity\n, i.e. by default\nno timeout is applied. If a timeout is configured the clean operation will be aborted forcibly when\nthe timeout is reached, potentially leaving resources on disk.\nAdded in version 244.\nReadWritePaths=\n,\nReadOnlyPaths=\n,\nInaccessiblePaths=\n,\nExecPaths=\n,\nNoExecPaths=\nÂ¶\nSets up a new file system namespace for executed processes. These options may be used\nto limit access a process has to the file system. Each setting takes a space-separated list of paths\nrelative to the host's root directory (i.e. the system running the service manager). Note that if\npaths contain symlinks, they are resolved relative to the root directory set with\nRootDirectory=\n/\nRootImage=\n.\nPaths listed in\nReadWritePaths=\nare accessible from within the namespace\nwith the same access modes as from outside of it. Paths listed in\nReadOnlyPaths=\nare accessible for reading only, writing will be refused even if the usual file access controls would\npermit this. Nest\nReadWritePaths=\ninside of\nReadOnlyPaths=\nin\norder to provide writable subdirectories within read-only directories. Use\nReadWritePaths=\nin order to allow-list specific paths for write access if\nProtectSystem=strict\nis used. Note that\nReadWritePaths=\ncannot\nbe used to gain write access to a file system whose superblock is mounted read-only. On Linux, for\neach mount point write access is granted only if the mount point itself\nand\nthe\nfile system superblock backing it are not marked read-only.\nReadWritePaths=\nonly\ncontrols the former, not the latter, hence a read-only file system superblock remains\nprotected.\nPaths listed in\nInaccessiblePaths=\nwill be made inaccessible for processes inside\nthe namespace along with everything below them in the file system hierarchy. This may be more restrictive than\ndesired, because it is not possible to nest\nReadWritePaths=\n,\nReadOnlyPaths=\n,\nBindPaths=\n, or\nBindReadOnlyPaths=\ninside it. For a more flexible option,\nsee\nTemporaryFileSystem=\n.\nContent in paths listed in\nNoExecPaths=\nare not executable even if the usual\nfile access controls would permit this. Nest\nExecPaths=\ninside of\nNoExecPaths=\nin order to provide executable content within non-executable\ndirectories.\nNon-directory paths may be specified as well. These options may be specified more than once,\nin which case all paths listed will have limited access from within the namespace. If the empty string is\nassigned to this option, the specific list is reset, and all prior assignments have no effect.\nPaths in\nReadWritePaths=\n,\nReadOnlyPaths=\n,\nInaccessiblePaths=\n,\nExecPaths=\nand\nNoExecPaths=\nmay be prefixed with \"\n-\n\", in which case they will be\nignored when they do not exist. If prefixed with \"\n+\n\" the paths are taken relative to the root\ndirectory of the unit, as configured with\nRootDirectory=\n/\nRootImage=\n,\ninstead of relative to the root directory of the host (see above). When combining \"\n-\n\" and\n\"\n+\n\" on the same path make sure to specify \"\n-\n\" first, and \"\n+\n\"\nsecond.\nNote that these settings will disconnect propagation of mounts from the unit's processes to the\nhost. This means that this setting may not be used for services which shall be able to install mount points in\nthe main mount namespace. For\nReadWritePaths=\nand\nReadOnlyPaths=\n,\npropagation in the other direction is not affected, i.e. mounts created on the host generally appear in the\nunit processes' namespace, and mounts removed on the host also disappear there too. In particular, note that\nmount propagation from host to unit will result in unmodified mounts to be created in the unit's namespace,\ni.e. writable mounts appearing on the host will be writable in the unit's namespace too, even when propagated\nbelow a path marked with\nReadOnlyPaths=\n! Restricting access with these options hence does\nnot extend to submounts of a directory that are created later on. This means the lock-down offered by that\nsetting is not complete, and does not offer full protection.\nNote that the effect of these settings may be undone by privileged processes. In order to set up an\neffective sandboxed environment for a unit it is thus recommended to combine these settings with either\nCapabilityBoundingSet=~CAP_SYS_ADMIN\nor\nSystemCallFilter=~@mount\n.\nPlease be extra careful when applying these options to API file systems (a list of them could be\nfound in\nMountAPIVPS=\n), since they may be required for basic system functionalities.\nMoreover,\n/run/\nneeds to be writable for setting up mount namespace and propagation.\nSimple allow-list example using these directives:\n[Service]\nReadOnlyPaths=/\nReadWritePaths=/var /run\nInaccessiblePaths=-/lost+found\nNoExecPaths=/\nExecPaths=/usr/sbin/my_daemon /usr/lib /usr/lib64\nThese options are only available for system services, or for services running in per-user\ninstances of the service manager in which case\nPrivateUsers=\nis implicitly enabled\n(requires unprivileged user namespaces support to be enabled in the kernel via the\n\"\nkernel.unprivileged_userns_clone=\n\" sysctl).\nAdded in version 231.\nTemporaryFileSystem=\nÂ¶\nTakes a space-separated list of mount points for temporary file systems (tmpfs). If set, a new file\nsystem namespace is set up for executed processes, and a temporary file system is mounted on each mount point.\nThis option may be specified more than once, in which case temporary file systems are mounted on all listed mount\npoints. If the empty string is assigned to this option, the list is reset, and all prior assignments have no effect.\nEach mount point may optionally be suffixed with a colon (\"\n:\n\") and mount options such as\n\"\nsize=10%\n\" or \"\nro\n\". By default, each temporary file system is mounted\nwith \"\nnodev,strictatime,mode=0755\n\". These can be disabled by explicitly specifying the corresponding\nmount options, e.g., \"\ndev\n\" or \"\nnostrictatime\n\".\nThis is useful to hide files or directories not relevant to the processes invoked by the unit, while necessary\nfiles or directories can be still accessed by combining with\nBindPaths=\nor\nBindReadOnlyPaths=\n:\nExample: if a unit has the following,\nTemporaryFileSystem=/var:ro\nBindReadOnlyPaths=/var/lib/systemd\nthen the invoked processes by the unit cannot see any files or directories under\n/var/\nexcept for\n/var/lib/systemd\nor its contents.\nThis option is only available for system services, or for services running in per-user\ninstances of the service manager in which case\nPrivateUsers=\nis implicitly enabled\n(requires unprivileged user namespaces support to be enabled in the kernel via the\n\"\nkernel.unprivileged_userns_clone=\n\" sysctl).\nAdded in version 238.\nPrivateTmp=\nÂ¶\nTakes a boolean argument, or \"\ndisconnected\n\". If enabled, a new\nfile system namespace will be set up for the executed processes, and\n/tmp/\nand\n/var/tmp/\ndirectories inside it are not shared with processes outside of\nthe namespace, plus all temporary files created by a service in these directories will be removed\nafter the service is stopped. For this setting, the same restrictions regarding mount propagation\nand privileges apply as for\nReadOnlyPaths=\nand related calls, see above. This\nsetting is useful to secure access to temporary files of the process, but makes sharing between\nprocesses via\n/tmp/\nor\n/var/tmp/\nimpossible. If\nDynamicUser=\nis enabled, \"\ndisconnected\n\" is implied. Otherwise,\ndefaults to false.\nIf \"\ntrue\n\", the backing storage of the private temporary directories will\nremain on the host's\n/tmp/\nand\n/var/tmp/\ndirectories. It is\npossible to run two or more units within the same private\n/tmp/\nand\n/var/tmp/\nnamespace by using the\nJoinsNamespaceOf=\ndirective,\nsee\nsystemd.unit\n(5)\nfor details. This has the side effect of adding\nWants=\nand\nAfter=\ndependencies on all mount units necessary to access\n/tmp/\nand\n/var/tmp/\non the host. Moreover, an implicit\nAfter=\nordering on\nsystemd-tmpfiles-setup.service\n(8)\nis added.\nIf \"\ndisconnected\n\", the directories will be backed by a completely new tmpfs\ninstance, meaning that the storage is fully disconnected from the host namespace. The tmpfs instance\ndoes not shared with other units even if the\nJoinsNamespaceOf=\ndirective is used.\nIf\nDefaultDependencies=no\nis specified,\nRequiresMountsFor=/WantsMountsFor=\nfor\n/var/\nis not\nspecified, and\nRootDirectory=/RootImage=\nis not specified, then a new tmpfs is\nmounted\nonly\non\n/tmp/\n, hence the host's\n/var/tmp\nis still accessible from the unit. In that case,\n$TMPDIR\nenvironment variable is set to \"\n/tmp\n\" to suggest the\nprocesses in the unit to use\n/tmp/\n. This automatically adds\nWantsMountsFor=/var/\ndependency, unless\nDefaultDependencies=no\nand/or\nRootDirectory=/RootImage=\nare specified.\nTableÂ 3.Â Summary for\nPrivateTmp=disconnected\nOther Settings\ntmpfs on /var/tmp/\n$TMPVAR\nimplied dependencies\n(none)\nyes\n(unset)\nWantsMountsFor=/var/\nRootDirectory=/RootImage=\nyes\n(unset)\n(none)\nDefaultDependency=no\n,\nRequiresMountsFor=/var/\nyes\n(unset)\n(none)\nDefaultDependency=no\n,\nWantsMountsFor=/var/\nyes\n(unset)\n(none)\nDefaultDependency=no\nno\n$TMPDIR=/tmp\n(none)\nNote that the implementation of this setting might be impossible (for example if mount namespaces are not\navailable), and the unit should be written in a way that does not solely rely on this setting for\nsecurity.\nThis option is only available for system services, or for services running in per-user\ninstances of the service manager in which case\nPrivateUsers=\nis implicitly enabled\n(requires unprivileged user namespaces support to be enabled in the kernel via the\n\"\nkernel.unprivileged_userns_clone=\n\" sysctl).\nPrivateDevices=\nÂ¶\nTakes a boolean argument. If true, sets up a new\n/dev/\nmount for\nthe executed processes and only adds API pseudo devices such as\n/dev/null\n,\n/dev/zero\nor\n/dev/random\n(as well as the pseudo TTY\nsubsystem) to it, but no physical devices such as\n/dev/sda\n, system memory\n/dev/mem\n, system ports\n/dev/port\nand others. This is useful\nto turn off physical device access by the executed process. Defaults to false.\nEnabling this option will install a system call filter to block low-level I/O system calls that\nare grouped in the\n@raw-io\nset, remove\nCAP_MKNOD\nand\nCAP_SYS_RAWIO\nfrom the capability bounding set for the unit, and set\nDevicePolicy=closed\n(see\nsystemd.resource-control\n(5)\nfor details). Note that using this setting will disconnect propagation of mounts from the service to\nthe host (propagation in the opposite direction continues to work). This means that this setting may\nnot be used for services which shall be able to install mount points in the main mount namespace. The\nnew\n/dev/\nwill be mounted read-only and 'noexec'. The latter may break old\nprograms which try to set up executable memory by using\nmmap\n(2)\nof\n/dev/zero\ninstead of using\nMAP_ANON\n. For this setting the\nsame restrictions regarding mount propagation and privileges apply as for\nReadOnlyPaths=\nand related calls, see above.\nNote that the implementation of this setting might be impossible (for example if mount\nnamespaces are not available), and the unit should be written in a way that does not solely rely on\nthis setting for security.\nThis option is only available for system services, or for services running in per-user\ninstances of the service manager in which case\nPrivateUsers=\nis implicitly enabled\n(requires unprivileged user namespaces support to be enabled in the kernel via the\n\"\nkernel.unprivileged_userns_clone=\n\" sysctl).\nWhen access to some but not all devices must be possible, the\nDeviceAllow=\nsetting might be used instead. See\nsystemd.resource-control\n(5)\n.\nAdded in version 209.\nPrivateNetwork=\nÂ¶\nTakes a boolean argument. If true, sets up a new network namespace for the executed processes\nand configures only the loopback network device \"\nlo\n\" inside it. No other network devices will\nbe available to the executed process. This is useful to turn off network access by the executed process.\nDefaults to false. It is possible to run two or more units within the same private network namespace by using\nthe\nJoinsNamespaceOf=\ndirective, see\nsystemd.unit\n(5)\nfor\ndetails. Note that this option will disconnect all socket families from the host, including\nAF_NETLINK\nand\nAF_UNIX\n. Effectively, for\nAF_NETLINK\nthis means that device configuration events received from\nsystemd-udevd.service\n(8)\nare\nnot delivered to the unit's processes. And for\nAF_UNIX\nthis has the effect that\nAF_UNIX\nsockets in the abstract socket namespace of the host will become unavailable to\nthe unit's processes (however, those located in the file system will continue to be accessible).\nNote that the implementation of this setting might be impossible (for example if network namespaces are\nnot available), and the unit should be written in a way that does not solely rely on this setting for\nsecurity.\nWhen this option is enabled,\nPrivateMounts=\nis implied unless it is\nexplicitly disabled, and\n/sys\nwill be remounted to associate it with the new\nnetwork namespace.\nWhen this option is used on a socket unit any sockets bound on behalf of this unit will be\nbound within a private network namespace. This may be combined with\nJoinsNamespaceOf=\nto listen on sockets inside of network namespaces of other\nservices.\nThis option is only available for system services, or for services running in per-user\ninstances of the service manager in which case\nPrivateUsers=\nis implicitly enabled\n(requires unprivileged user namespaces support to be enabled in the kernel via the\n\"\nkernel.unprivileged_userns_clone=\n\" sysctl).\nNetworkNamespacePath=\nÂ¶\nTakes an absolute file system path referring to a Linux network namespace\npseudo-file (i.e. a file like\n/proc/$PID/ns/net\nor a bind mount or symlink to\none). When set the invoked processes are added to the network namespace referenced by that path. The\npath has to point to a valid namespace file at the moment the processes are forked off. If this\noption is used\nPrivateNetwork=\nhas no effect. If this option is used together with\nJoinsNamespaceOf=\nthen it only has an effect if this unit is started before any of\nthe listed units that have\nPrivateNetwork=\nor\nNetworkNamespacePath=\nconfigured, as otherwise the network namespace of those\nunits is reused.\nWhen this option is enabled,\nPrivateMounts=\nis implied unless it is\nexplicitly disabled, and\n/sys\nwill be remounted to associate it with the new\nnetwork namespace.\nWhen this option is used on a socket unit any sockets bound on behalf of this unit will be\nbound within the specified network namespace.\nThis option is only available for system services, or for services running in per-user\ninstances of the service manager in which case\nPrivateUsers=\nis implicitly enabled\n(requires unprivileged user namespaces support to be enabled in the kernel via the\n\"\nkernel.unprivileged_userns_clone=\n\" sysctl).\nAdded in version 242.\nPrivateIPC=\nÂ¶\nTakes a boolean argument. If true, sets up a new IPC namespace for the executed processes.\nEach IPC namespace has its own set of System V IPC identifiers and its own POSIX message queue file system.\nThis is useful to avoid name clash of IPC identifiers. Defaults to false. It is possible to run two or\nmore units within the same private IPC namespace by using the\nJoinsNamespaceOf=\ndirective,\nsee\nsystemd.unit\n(5)\nfor\ndetails.\nNote that IPC namespacing does not have an effect on\nAF_UNIX\nsockets, which are the most common\nform of IPC used on Linux. Instead,\nAF_UNIX\nsockets in the file system are subject to mount namespacing, and\nthose in the abstract namespace are subject to network namespacing.\nIPC namespacing only has an effect on SysV IPC (which is mostly\nlegacy) as well as POSIX message queues (for which\nAF_UNIX\n/\nSOCK_SEQPACKET\nsockets are typically a better replacement). IPC namespacing also\nhas no effect on POSIX shared memory (which is subject to mount\nnamespacing) either. See\nipc_namespaces\n(7)\nfor\nthe details.\nNote that the implementation of this setting might be impossible (for example if IPC namespaces are\nnot available), and the unit should be written in a way that does not solely rely on this setting for\nsecurity.\nThis option is only available for system services, or for services running in per-user\ninstances of the service manager in which case\nPrivateUsers=\nis implicitly enabled\n(requires unprivileged user namespaces support to be enabled in the kernel via the\n\"\nkernel.unprivileged_userns_clone=\n\" sysctl).\nAdded in version 248.\nIPCNamespacePath=\nÂ¶\nTakes an absolute file system path referring to a Linux IPC namespace\npseudo-file (i.e. a file like\n/proc/$PID/ns/ipc\nor a bind mount or symlink to\none). When set the invoked processes are added to the network namespace referenced by that path. The\npath has to point to a valid namespace file at the moment the processes are forked off. If this\noption is used\nPrivateIPC=\nhas no effect. If this option is used together with\nJoinsNamespaceOf=\nthen it only has an effect if this unit is started before any of\nthe listed units that have\nPrivateIPC=\nor\nIPCNamespacePath=\nconfigured, as otherwise the network namespace of those\nunits is reused.\nThis option is only available for system services, or for services running in per-user\ninstances of the service manager in which case\nPrivateUsers=\nis implicitly enabled\n(requires unprivileged user namespaces support to be enabled in the kernel via the\n\"\nkernel.unprivileged_userns_clone=\n\" sysctl).\nAdded in version 248.\nMemoryKSM=\nÂ¶\nTakes a boolean argument. When set, it enables KSM (kernel samepage merging) for\nthe processes. KSM is a memory-saving de-duplication feature. Anonymous memory pages with identical\ncontent can be replaced by a single write-protected page. This feature should only be enabled for\njobs that share the same security domain. For details, see\nKernel Samepage Merging\nin the\nkernel documentation.\nNote that this functionality might not be available, for example if KSM is disabled in the\nkernel, or the kernel does not support controlling KSM at the process level through\nprctl\n(2)\n.\nAdded in version 254.\nPrivatePIDs=\nÂ¶\nTakes a boolean argument. Defaults to false. If enabled, sets up a new PID namespace\nfor the executed processes. Each executed process is now PID 1 - the init process - in the new namespace.\n/proc/\nis mounted such that only processes in the PID namespace are visible.\nIf\nPrivatePIDs=\nis set,\nMountAPIVFS=yes\nis implied.\nPrivatePIDs=\nis only supported for service units. This setting is not supported\nwith\nType=forking\nsince the kernel will kill all processes in the PID namespace if\nthe init process terminates.\nThis setting will be ignored if the kernel does not support PID namespaces.\nNote unprivileged user services (i.e. a service run by the per-user instance of the service manager)\nwill fail with\nPrivatePIDs=yes\nif\n/proc/\nis masked\n(i.e.\n/proc/kmsg\nis over-mounted with\ntmpfs\nlike\nsystemd-nspawn\n(1)\ndoes).\nThis is due to a kernel restriction not allowing unprivileged user namespaces to mount a less restrictive\ninstance of\n/proc/\n.\nAdded in version 257.\nPrivateUsers=\nÂ¶\nTakes a boolean argument or one of \"\nself\n\", \"\nidentity\n\",\nor \"\nfull\n\". Defaults to false. If enabled, sets up a new user namespace for the\nexecuted processes and configures a user and group mapping. If set to a true value or\n\"\nself\n\", a minimal user and group mapping is configured that maps the\n\"\nroot\n\" user and group as well as the unit's own user and group to themselves and\neverything else to the \"\nnobody\n\" user and group. This is useful to securely detach\nthe user and group databases used by the unit from the rest of the system, and thus to create an\neffective sandbox environment. All files, directories, processes, IPC objects and other resources\nowned by users/groups not equaling \"\nroot\n\" or the unit's own will stay visible from\nwithin the unit but appear owned by the \"\nnobody\n\" user and group.\nIf the parameter is \"\nidentity\n\", user namespacing is set up with an identity\nmapping for the first 65536 UIDs/GIDs. Any UIDs/GIDs above 65536 will be mapped to the\n\"\nnobody\n\" user and group, respectively. While this does not provide UID/GID isolation,\nsince all UIDs/GIDs are chosen identically it does provide process capability isolation, and hence is\noften a good choice if proper user namespacing with distinct UID maps is not appropriate.\nIf the parameter is \"\nfull\n\", user namespacing is set up with an identity\nmapping for all UIDs/GIDs. In addition, for system services, \"\nfull\n\" allows the unit\nto call\nsetgroups()\nsystem calls (by setting\n/proc/\npid\n/setgroups\nto \"\nallow\n\").\nSimilar to \"\nidentity\n\", this does not provide UID/GID isolation, but it does provide\nprocess capability isolation.\nIf this mode is enabled, all unit processes are run without privileges in the host user\nnamespace (regardless of whether the unit's own user/group is \"\nroot\n\" or not). Specifically\nthis means that the process will have zero process capabilities on the host's user namespace, but\nfull capabilities within the service's user namespace. Settings such as\nCapabilityBoundingSet=\nwill affect only the latter, and there's no way to acquire\nadditional capabilities in the host's user namespace.\nWhen this setting is set up by a per-user instance of the service manager, the mapping of the\n\"\nroot\n\" user and group to itself is omitted (unless the user manager is root).\nAdditionally, in the per-user instance manager case, the\nuser namespace will be set up before most other namespaces. This means that combining\nPrivateUsers=\ntrue\nwith other namespaces will enable use of features not\nnormally supported by the per-user instances of the service manager.\nThis setting is particularly useful in conjunction with\nRootDirectory=\n/\nRootImage=\n, as the need to synchronize the user and group\ndatabases in the root directory and on the host is reduced, as the only users and groups who need to be matched\nare \"\nroot\n\", \"\nnobody\n\" and the unit's own user and group.\nAdded in version 232.\nProtectHostname=\nÂ¶\nTakes a boolean argument or \"\nprivate\n\". If enabled, sets up a new UTS\nnamespace for the executed processes. If enabled, a hostname can be optionally specified following a\ncolon (e.g. \"\nyes:foo\n\" or \"\nprivate:host.example.com\n\"), and the\nhostname is set in the new UTS namespace for the unit. If set to a true value, changing hostname or\ndomainname via\nsethostname()\nand\nsetdomainname()\nsystem\ncalls is prevented. If set to \"\nprivate\n\", changing hostname or domainname is allowed\nbut only affects the unit's UTS namespace. Defaults to off.\nNote that the implementation of this setting might be impossible (for example if UTS namespaces\nare not available), and the unit should be written in a way that does not solely rely on this setting\nfor security.\nNote that when this option is enabled for a service hostname changes no longer propagate from\nthe system into the service, it is hence not suitable for services that need to take notice of system\nhostname changes dynamically.\nNote that this option does not prevent changing system hostname via\nhostnamectl\n.\nHowever,\nUser=\nand\nGroup=\nmay be used to run as an unprivileged user\nto disallow changing system hostname. See\nSetHostname()\nin\norg.freedesktop.hostname1\n(5)\nfor more details.\nThis option is only available for system services, or for services running in per-user\ninstances of the service manager in which case\nPrivateUsers=\nis implicitly enabled\n(requires unprivileged user namespaces support to be enabled in the kernel via the\n\"\nkernel.unprivileged_userns_clone=\n\" sysctl).\nAdded in version 242.\nProtectClock=\nÂ¶\nTakes a boolean argument. If set, writes to the hardware clock or system clock will\nbe denied. Defaults to off. Enabling this option removes\nCAP_SYS_TIME\nand\nCAP_WAKE_ALARM\nfrom the capability bounding set for this unit, installs a system\ncall filter to block calls that can set the clock, and\nDeviceAllow=char-rtc r\nis\nimplied. Note that the system calls are blocked altogether, the filter does not take into account\nthat some of the calls can be used to read the clock state with some parameter combinations.\nEffectively,\n/dev/rtc0\n,\n/dev/rtc1\n, etc. are made read-only\nto the service. See\nsystemd.resource-control\n(5)\nfor the details about\nDeviceAllow=\n.\nIt is recommended to turn this on for most services that do not need modify the clock or check\nits state.\nThis option is only available for system services, or for services running in per-user\ninstances of the service manager in which case\nPrivateUsers=\nis implicitly enabled\n(requires unprivileged user namespaces support to be enabled in the kernel via the\n\"\nkernel.unprivileged_userns_clone=\n\" sysctl).\nAdded in version 245.\nProtectKernelTunables=\nÂ¶\nTakes a boolean argument. If true, kernel variables accessible through\n/proc/sys/\n,\n/sys/\n,\n/proc/sysrq-trigger\n,\n/proc/latency_stats\n,\n/proc/acpi\n,\n/proc/timer_stats\n,\n/proc/fs\nand\n/proc/irq\nwill\nbe made read-only and\n/proc/kallsyms\nas well as\n/proc/kcore\nwill be\ninaccessible to all processes of the unit.\nUsually, tunable kernel variables should be initialized only at boot-time, for example with the\nsysctl.d\n(5)\nmechanism. Few\nservices need to write to these at runtime; it is hence recommended to turn this on for most services. For this\nsetting the same restrictions regarding mount propagation and privileges apply as for\nReadOnlyPaths=\nand related calls, see above. Defaults to off.\nNote that this option does not prevent indirect changes to kernel tunables affected by IPC calls to\nother processes. However,\nInaccessiblePaths=\nmay be used to make relevant IPC file system\nobjects inaccessible. If\nProtectKernelTunables=\nis set,\nMountAPIVFS=yes\nis implied.\nThis option is only available for system services, or for services running in per-user\ninstances of the service manager in which case\nPrivateUsers=\nis implicitly enabled\n(requires unprivileged user namespaces support to be enabled in the kernel via the\n\"\nkernel.unprivileged_userns_clone=\n\" sysctl).\nAdded in version 232.\nProtectKernelModules=\nÂ¶\nTakes a boolean argument. If true, explicit module loading will be denied. This allows\nmodule load and unload operations to be turned off on modular kernels. It is recommended to turn this on for most services\nthat do not need special file systems or extra kernel modules to work. Defaults to off. Enabling this option\nremoves\nCAP_SYS_MODULE\nfrom the capability bounding set for the unit, and installs a\nsystem call filter to block module system calls, also\n/usr/lib/modules\nis made\ninaccessible. For this setting the same restrictions regarding mount propagation and privileges apply as for\nReadOnlyPaths=\nand related calls, see above. Note that limited automatic module loading due\nto user configuration or kernel mapping tables might still happen as side effect of requested user operations,\nboth privileged and unprivileged. To disable module auto-load feature please see\nsysctl.d\n(5)\nkernel.modules_disabled\nmechanism and\n/proc/sys/kernel/modules_disabled\ndocumentation.\nThis option is only available for system services, or for services running in per-user\ninstances of the service manager in which case\nPrivateUsers=\nis implicitly enabled\n(requires unprivileged user namespaces support to be enabled in the kernel via the\n\"\nkernel.unprivileged_userns_clone=\n\" sysctl).\nAdded in version 232.\nProtectKernelLogs=\nÂ¶\nTakes a boolean argument. If true, access to the kernel log ring buffer will be denied. It is\nrecommended to turn this on for most services that do not need to read from or write to the kernel log ring\nbuffer. Enabling this option removes\nCAP_SYSLOG\nfrom the capability bounding set for this\nunit, and installs a system call filter to block the\nsyslog\n(2)\nsystem call (not to be confused with the libc API\nsyslog\n(3)\nfor userspace logging). The kernel exposes its log buffer to userspace via\n/dev/kmsg\nand\n/proc/kmsg\n. If enabled, these are made inaccessible to all the processes in the unit.\nThis option is only available for system services, or for services running in per-user\ninstances of the service manager in which case\nPrivateUsers=\nis implicitly enabled\n(requires unprivileged user namespaces support to be enabled in the kernel via the\n\"\nkernel.unprivileged_userns_clone=\n\" sysctl).\nAdded in version 244.\nProtectControlGroups=\nÂ¶\nTakes a boolean argument or the special values \"\nprivate\n\" or\n\"\nstrict\n\". If true, the Linux Control Groups (\ncgroups\n(7)\n) hierarchies\naccessible through\n/sys/fs/cgroup/\nwill be made read-only to all processes of the\nunit. If set to \"\nprivate\n\", the unit will run in a cgroup namespace with a private\nwritable mount of\n/sys/fs/cgroup/\n. If set to \"\nstrict\n\", the unit\nwill run in a cgroup namespace with a private read-only mount of\n/sys/fs/cgroup/\n.\nDefaults to off. If\nProtectControlGroups=\nis set,\nMountAPIVFS=yes\nis implied. Note \"\nprivate\n\" and \"\nstrict\n\" are downgraded to false and\ntrue respectively unless the system is using the unified control group hierarchy and the kernel supports\ncgroup namespaces.\nExcept for container managers no services should require write access to the control groups hierarchies;\nit is hence recommended to set\nProtectControlGroups=\nto true or \"\nstrict\n\"\nfor most services. For this setting the same restrictions regarding mount propagation and privileges apply\nas for\nReadOnlyPaths=\nand related settings, see above.\nThis option is only available for system services and is not supported for services\nrunning in per-user instances of the service manager.\nAdded in version 232.\nRestrictAddressFamilies=\nÂ¶\nRestricts the set of socket address families accessible to the processes of this\nunit. Takes \"\nnone\n\", or a space-separated list of address family names to\nallow-list, such as\nAF_UNIX\n,\nAF_INET\nor\nAF_INET6\n, see\naddress_families\n(7)\nfor all possible options. When \"\nnone\n\" is specified, then all address\nfamilies will be denied. When prefixed with \"\n~\n\" the listed address\nfamilies will be applied as deny list, otherwise as allow list.\nBy default, no restrictions apply, all address families are accessible to processes. If\nassigned the empty string, any previous address family restriction changes are undone. This setting\ndoes not affect commands prefixed with \"\n+\n\".\nUse this option to limit exposure of processes to remote access, in particular via exotic and\nsensitive network protocols, such as\nAF_PACKET\n. Note that in most cases, the\nlocal\nAF_UNIX\naddress family should be included in the configured allow list as\nit is frequently used for local communication, including for\nsyslog\n(2)\nlogging.\nNote that this restricts access to the\nsocket\n(2)\nsystem call only. Sockets passed into the process by other means (for example, by using socket\nactivation with socket units, see\nsystemd.socket\n(5)\n)\nare unaffected. Also, sockets created with\nsocketpair()\n(which creates connected\nAF_UNIX sockets) or the\nio_uring\n(7)\nfunctions, are not affected. Thus, it is recommended to combined this setting with\nSystemCallFilter=@service\n, to only allow a limited subset of system calls.\nNote that this option is limited to some ABIs, in particular x86-64, but currently has no\neffect on 32-bit x86, s390, s390x, mips, mips-le, ppc, ppc-le, ppc64, or ppc64-le, and is ignored. On\nsystems supporting multiple ABIs (such as x86/x86-64) it is recommended to turn off alternative ABIs\nfor services, so that they cannot be used to circumvent the restrictions of this option.\nSpecifically, it is recommended to combine this option with\nSystemCallArchitectures=native\nor similar.\nAdded in version 211.\nRestrictFileSystems=\nÂ¶\nRestricts the set of filesystems processes of this unit can open files on. Takes a space-separated\nlist of filesystem names. Any filesystem listed is made accessible to the unit's processes, access to filesystem\ntypes not listed is prohibited (allow-listing). If the first character of the list is \"\n~\n\", the\neffect is inverted: access to the filesystems listed is prohibited (deny-listing). If the empty string is assigned,\naccess to filesystems is not restricted.\nIf you specify both types of this option (i.e. allow-listing and deny-listing), the first encountered will take\nprecedence and will dictate the default action (allow access to the filesystem or deny it). Then the next occurrences\nof this option will add or delete the listed filesystems from the set of the restricted filesystems, depending on its\ntype and the default action.\nExample: if a unit has the following,\nRestrictFileSystems=ext4 tmpfs\nRestrictFileSystems=ext2 ext4\nthen access to\next4\n,\ntmpfs\n, and\next2\nis allowed\nand access to other filesystems is denied.\nExample: if a unit has the following,\nRestrictFileSystems=ext4 tmpfs\nRestrictFileSystems=~ext4\nthen only access\ntmpfs\nis allowed.\nExample: if a unit has the following,\nRestrictFileSystems=~ext4 tmpfs\nRestrictFileSystems=ext4\nthen only access to\ntmpfs\nis denied.\nAs the number of possible filesystems is large, predefined sets of filesystems are provided. A set\nstarts with \"\n@\n\" character, followed by name of the set.\nTableÂ 4.Â Currently predefined filesystem sets\nSet\nDescription\n@basic-api\nBasic filesystem API.\n@auxiliary-api\nAuxiliary filesystem API.\n@common-block\nCommon block device filesystems.\n@historical-block\nHistorical block device filesystems.\n@network\nWell-known network filesystems.\n@privileged-api\nPrivileged filesystem API.\n@temporary\nTemporary filesystems: tmpfs, ramfs.\n@known\nAll known filesystems defined by the kernel. This list is defined statically in systemd based on a kernel version that was available when this systemd version was released. It will become progressively more out-of-date as the kernel is updated.\nUse\nsystemd-analyze\n(1)\n's\nfilesystems\ncommand to retrieve a list of filesystems defined on the local\nsystem.\nNote that this setting might not be supported on some systems (for example if the LSM eBPF hook is\nnot enabled in the underlying kernel or if not using the unified control group hierarchy). In that case this setting\nhas no effect.\nThis option cannot be bypassed by prefixing \"\n+\n\" to the executable path\nin the service unit, as it applies to the whole control group.\nAdded in version 250.\nRestrictNamespaces=\nÂ¶\nRestricts access to Linux namespace functionality for the processes of this unit. For details\nabout Linux namespaces, see\nnamespaces\n(7)\n. Either\ntakes a boolean argument, or a space-separated list of namespace type identifiers. If false (the default), no\nrestrictions on namespace creation and switching are made. If true, access to any kind of namespacing is\nprohibited. Otherwise, a space-separated list of namespace type identifiers must be specified, consisting of\nany combination of:\ncgroup\n,\nipc\n,\nnet\n,\nmnt\n,\npid\n,\nuser\n,\nuts\n, and\ntime\n. Any namespace type listed is made accessible to the unit's processes, access to\nnamespace types not listed is prohibited (allow-listing). By prepending the list with a single tilde\ncharacter (\"\n~\n\") the effect may be inverted: only the listed namespace types will be made\ninaccessible, all unlisted ones are permitted (deny-listing). If the empty string is assigned, the default\nnamespace restrictions are applied, which is equivalent to false. This option may appear more than once, in\nwhich case the namespace types are merged by\nOR\n, or by\nAND\nif the\nlines are prefixed with \"\n~\n\" (see examples below). Internally, this setting limits access to\nthe\nunshare\n(2)\n,\nclone\n(2)\nand\nsetns\n(2)\nsystem calls, taking\nthe specified flags parameters into account. Note that â if this option is used â in addition to restricting\ncreation and switching of the specified types of namespaces (or all of them, if true) access to the\nsetns()\nsystem call with a zero flags parameter is prohibited. This setting is only\nsupported on x86, x86-64, mips, mips-le, mips64, mips64-le, mips64-n32, mips64-le-n32, ppc64, ppc64-le, s390\nand s390x, and enforces no restrictions on other architectures.\nExample: if a unit has the following,\nRestrictNamespaces=cgroup ipc\nRestrictNamespaces=cgroup net\nthen\ncgroup\n,\nipc\n, and\nnet\nare set.\nIf the second line is prefixed with \"\n~\n\", e.g.,\nRestrictNamespaces=cgroup ipc\nRestrictNamespaces=~cgroup net\nthen, only\nipc\nis set.\nAdded in version 233.\nDelegateNamespaces=\nÂ¶\nDelegates ownership of the given namespace types to the user namespace of the\nprocesses of this unit. For details about Linux namespaces, see\nnamespaces\n(7)\n.\nEither takes a boolean argument, or a space-separated list of namespace type identifiers. If false\n(the default), the unit's processes' user namespace will not have ownership over any namespaces\ncreated during setup of the unit's sandboxed environment. If true, ownership of all namespace types\n(except for user namespaces, where the concept doesn't apply) created during setup of the unit's\nsandboxed environment is delegated to the unit's processes' user namespace. Otherwise, a\nspace-separated list of namespace type identifiers must be specified, consisting of any combination\nof:\ncgroup\n,\nipc\n,\nnet\n,\nmnt\n,\npid\n, and\nuts\n. All namespaces of\nthe listed types will be owned by the unit's processes' user namespace if they are created during\nsetup of the unit's sandboxed environment (allow-listing). By prepending the list with a single tilde\ncharacter (\"\n~\n\") the effect may be inverted: all namespaces of types not listed and\ncreated during setup of the unit's sandboxed environment will be owned by the unit's processes' user\nnamespace (deny-listing). If the empty string is assigned, the default namespace ownership is\napplied, which is equivalent to false. This option may appear more than once, in which case the\nnamespace types are merged by\nOR\n, or by\nAND\nif the lines\nare prefixed with \"\n~\n\" (see examples below). Internally, this setting controls the\norder in which namespaces are unshared by systemd. Namespace types that should be owned by the unit's\nprocesses' user namespace will be unshared after unsharing the user namespace. Internally, this\nsetting controls the order in which namespaces are unshared. Delegated namespaces will be unshared\nafter the user namespace is unshared. Other namespaces will be unshared before the user namespace is\nunshared.\nDelegating any namespace with\nDelegateNamespaces=\nimplies\nPrivateUsers=self\nunless\nPrivateUsers=\nis explicitly enabled\nalready by the unit. Delegating a namespace does not imply that the namespace is unshared, that is\ndone with the namespace specific unit setting such as\nPrivateNetwork=\nor\nPrivateMounts=\n.\nNote that some namespace sandboxing options might entail mount namespace for private API VFS instances,\nsuch as\nPrivatePIDs=\n,\nProtectControlGroups=private/strict\n, or\nPrivateNetwork=\n. If any of the mentioned options are enabled, mount namespace\nis implicitly delegated.\nAdded in version 258.\nPrivateBPF=\nÂ¶\nTakes a boolean argument. If set, mount a private instance of the BPF filesystem\non\n/sys/fs/bpf/\n, effectively hiding the host bpffs which contains information\nabout loaded programs and maps. Otherwise, if\nProtectKernelTunables=\nis set, the\ninstance from the host is inherited but mounted read-only. Defaults to false.\nThis can be used together with the bpffs delegate feature to choose what BPF functions are\navailable to the unit's processes. When mounting the BPF filesystem with the fsopen() API, four mount\noptions can be specified to set a list of BPF commands, maps, programs and attachment types that are\nallowed to be used. Processes needs to get a file descriptor for the bpffs mountpoint and use that to\nget a token which will enable for that user namespace the BPF functionalities chosen upon bpffs mount.\nA more detailed explanation of the feature can be found in this\nLWN post\n.\nAdded in version 258.\nBPFDelegateCommands=\nÂ¶\nAccepts a list of BPF commands to allow or \"\nany\n\" to allow everything.\nDefaults to none. The accepted values are:\nBPFMapCreate\nBPFMapLookupElem\nBPFMapUpdateElem\nBPFMapDeleteElem\nBPFMapGetNextKey\nBPFProgLoad\nBPFObjPin\nBPFObjGet\nBPFProgAttach\nBPFProgDetach\nBPFProgTestRun\nBPFProgGetNextId\nBPFMapGetNextId\nBPFProgGetFdById\nBPFMapGetFdById\nBPFObjGetInfoByFd\nBPFProgQuery\nBPFRawTracepointOpen\nBPFBtfLoad\nBPFBtfGetFdById\nBPFTaskFdQuery\nBPFMapLookupAndDeleteElem\nBPFMapFreeze\nBPFBtfGetNextId\nBPFMapLookupBatch\nBPFMapLookupAndDeleteBatch\nBPFMapUpdateBatch\nBPFMapDeleteBatch\nBPFLinkCreate\nBPFLinkUpdate\nBPFLinkGetFdById\nBPFLinkGetNextId\nBPFEnableStats\nBPFIterCreate\nBPFLinkDetach\nBPFProgBindMap\nBPFTokenCreate\nBPFProgStreamReadByFd\nThis will set the\ndelegate_cmds\nbpffs mount option.\nRequires\nPrivateBPF=yes\nto be effective,\nsee\nPrivateBPF=\nmore details.\nAdded in version 258.\nBPFDelegateMaps=\nÂ¶\nAccepts a list of BPF maps to allow or \"\nany\n\" to allow everything.\nDefaults to none. The accepted values are:\nBPFMapTypeUnspec\nBPFMapTypeHash\nBPFMapTypeArray\nBPFMapTypeProgArray\nBPFMapTypePerfEventArray\nBPFMapTypePercpuHash\nBPFMapTypePercpuArray\nBPFMapTypeStackTrace\nBPFMapTypeCgroupArray\nBPFMapTypeLruHash\nBPFMapTypeLruPercpuHash\nBPFMapTypeLpmTrie\nBPFMapTypeArrayOfMaps\nBPFMapTypeHashOfMaps\nBPFMapTypeDevmap\nBPFMapTypeSockmap\nBPFMapTypeCpumap\nBPFMapTypeXskmap\nBPFMapTypeSockhash\nBPFMapTypeCgroupStorageDeprecated\nBPFMapTypeReuseportSockarray\nBPFMapTypePercpuCgroupStorageDeprecated\nBPFMapTypeQueue\nBPFMapTypeStack\nBPFMapTypeSkStorage\nBPFMapTypeDevmapHash\nBPFMapTypeStructOps\nBPFMapTypeRingbuf\nBPFMapTypeInodeStorage\nBPFMapTypeTaskStorage\nBPFMapTypeBloomFilter\nBPFMapTypeUserRingbuf\nBPFMapTypeCgrpStorage\nBPFMapTypeArena\nThis will set the\ndelegate_maps\nbpffs mount option.\nRequires\nPrivateBPF=yes\nto be effective,\nsee\nPrivateBPF=\nmore details.\nAdded in version 258.\nBPFDelegatePrograms=\nÂ¶\nAccepts a list of BPF programs to allow or \"\nany\n\" to allow everything.\nDefaults to none. The accepted values are:\nBPFProgTypeUnspec\nBPFProgTypeSocketFilter\nBPFProgTypeKprobe\nBPFProgTypeSchedCls\nBPFProgTypeSchedAct\nBPFProgTypeTracepoint\nBPFProgTypeXdp\nBPFProgTypePerfEvent\nBPFProgTypeCgroupSkb\nBPFProgTypeCgroupSock\nBPFProgTypeLwtIn\nBPFProgTypeLwtOut\nBPFProgTypeLwtXmit\nBPFProgTypeSockOps\nBPFProgTypeSkSkb\nBPFProgTypeCgroupDevice\nBPFProgTypeSkMsg\nBPFProgTypeRawTracepoint\nBPFProgTypeCgroupSockAddr\nBPFProgTypeLwtSeg6local\nBPFProgTypeLircMode2\nBPFProgTypeSkReuseport\nBPFProgTypeFlowDissector\nBPFProgTypeCgroupSysctl\nBPFProgTypeRawTracepointWritable\nBPFProgTypeCgroupSockopt\nBPFProgTypeTracing\nBPFProgTypeStructOps\nBPFProgTypeExt\nBPFProgTypeLsm\nBPFProgTypeSkLookup\nBPFProgTypeNetfilter\nThis will set the\ndelegate_progs\nbpffs mount option.\nRequires\nPrivateBPF=yes\nto be effective,\nsee\nPrivateBPF=\nmore details.\nAdded in version 258.\nBPFDelegateAttachments=\nÂ¶\nAccepts a list of BPF attach points to allow or \"\nany\n\" to allow everything.\nDefaults to none. The accepted values are:\nBPFCgroupInetIngress\nBPFCgroupInetEgress\nBPFCgroupInetSockCreate\nBPFCgroupSockOps\nBPFSkSkbStreamParser\nBPFSkSkbStreamVerdict\nBPFCgroupDevice\nBPFSkMsgVerdict\nBPFCgroupInet4Bind\nBPFCgroupInet6Bind\nBPFCgroupInet4Connect\nBPFCgroupInet6Connect\nBPFCgroupInet4PostBind\nBPFCgroupInet6PostBind\nBPFCgroupUdp4Sendmsg\nBPFCgroupUdp6Sendmsg\nBPFLircMode2\nBPFFlowDissector\nBPFCgroupSysctl\nBPFCgroupUdp4Recvmsg\nBPFCgroupUdp6Recvmsg\nBPFCgroupGetsockopt\nBPFCgroupSetsockopt\nBPFTraceRawTp\nBPFTraceFentry\nBPFTraceFexit\nBPFModifyReturn\nBPFLsmMac\nBPFTraceIter\nBPFCgroupInet4Getpeername\nBPFCgroupInet6Getpeername\nBPFCgroupInet4Getsockname\nBPFCgroupInet6Getsockname\nBPFXdpDevmap\nBPFCgroupInetSockRelease\nBPFXdpCpumap\nBPFSkLookup\nBPFXdp\nBPFSkSkbVerdict\nBPFSkReuseportSelect\nBPFSkReuseportSelectOrMigrate\nBPFPerfEvent\nBPFTraceKprobeMulti\nBPFLsmCgroup\nBPFStructOps\nBPFNetfilter\nBPFTcxIngress\nBPFTcxEgress\nBPFTraceUprobeMulti\nBPFCgroupUnixConnect\nBPFCgroupUnixSendmsg\nBPFCgroupUnixRecvmsg\nBPFCgroupUnixGetpeername\nBPFCgroupUnixGetsockname\nBPFNetkitPrimary\nBPFNetkitPeer\nBPFTraceKprobeSession\nBPFTraceUprobeSession\nThis will set the\ndelegate_attachs\nbpffs mount option.\nRequires\nPrivateBPF=yes\nto be effective,\nsee\nPrivateBPF=\nmore details.\nAdded in version 258.\nLockPersonality=\nÂ¶\nTakes a boolean argument. If set, locks down the\npersonality\n(2)\nsystem\ncall so that the kernel execution domain may not be changed from the default or the personality selected with\nPersonality=\ndirective. This may be useful to improve security, because odd personality\nemulations may be poorly tested and source of vulnerabilities.\nAdded in version 235.\nMemoryDenyWriteExecute=\nÂ¶\nTakes a boolean argument. If set, attempts to create memory mappings that are writable and\nexecutable at the same time, or to change existing memory mappings to become executable, or mapping shared\nmemory segments as executable, are prohibited. Specifically, a system call filter is added (or\npreferably, an equivalent kernel check is enabled with\nprctl\n(2)\n) that\nrejects\nmmap\n(2)\nsystem calls with both\nPROT_EXEC\nand\nPROT_WRITE\nset,\nmprotect\n(2)\nor\npkey_mprotect\n(2)\nsystem calls\nwith\nPROT_EXEC\nset and\nshmat\n(2)\nsystem calls with\nSHM_EXEC\nset. Note that this option is incompatible with programs and libraries that\ngenerate program code dynamically at runtime, including JIT execution engines, executable stacks, and code\n\"trampoline\" feature of various C compilers. This option improves service security, as it makes harder for\nsoftware exploits to change running code dynamically. However, the protection can be circumvented, if\nthe service can write to a filesystem, which is not mounted with\nnoexec\n(such as\n/dev/shm\n), or it can use\nmemfd_create()\n. This can be\nprevented by making such file systems inaccessible to the service\n(e.g.\nInaccessiblePaths=/dev/shm\n) and installing further system call filters\n(\nSystemCallFilter=~memfd_create\n). Note that this feature is fully available on\nx86-64, and partially on x86. Specifically, the\nshmat()\nprotection is not\navailable on x86. Note that on systems supporting multiple ABIs (such as x86/x86-64) it is\nrecommended to turn off alternative ABIs for services, so that they cannot be used to circumvent the\nrestrictions of this option. Specifically, it is recommended to combine this option with\nSystemCallArchitectures=native\nor similar.\nAdded in version 231.\nRestrictRealtime=\nÂ¶\nTakes a boolean argument. If set, any attempts to enable realtime scheduling in a process of\nthe unit are refused. This restricts access to realtime task scheduling policies such as\nSCHED_FIFO\n,\nSCHED_RR\nor\nSCHED_DEADLINE\n. See\nsched\n(7)\nfor details about these scheduling policies. Realtime scheduling policies may be used to monopolize CPU\ntime for longer periods of time, and may hence be used to lock up or otherwise trigger Denial-of-Service\nsituations on the system. It is hence recommended to restrict access to realtime scheduling to the few programs\nthat actually require them. Defaults to off.\nAdded in version 231.\nRestrictSUIDSGID=\nÂ¶\nTakes a boolean argument. If set, any attempts to set the set-user-ID (SUID) or\nset-group-ID (SGID) bits on files or directories will be denied (for details on these bits see\ninode\n(7)\n).\nAs the SUID/SGID bits are mechanisms to elevate privileges, and allow users to acquire the\nidentity of other users, it is recommended to restrict creation of SUID/SGID files to the few\nprograms that actually require them. Note that this restricts marking of any type of file system\nobject with these bits, including both regular files and directories (where the SGID is a different\nmeaning than for files, see documentation). This option is implied if\nDynamicUser=\nis enabled.\nIn other cases, this setting defaults to the value set with\nDefaultRestrictSUIDSGID=\nin\nsystemd-system.conf\n(5)\n, which\ndefaults to off.\nAdded in version 242.\nRemoveIPC=\nÂ¶\nTakes a boolean parameter. If set, all System V and POSIX IPC objects owned by the user and\ngroup the processes of this unit are run as are removed when the unit is stopped. This setting only has an\neffect if at least one of\nUser=\n,\nGroup=\nand\nDynamicUser=\nare used. It has no effect on IPC objects owned by the root user. Specifically,\nthis removes System V semaphores, as well as System V and POSIX shared memory segments and message queues. If\nmultiple units use the same user or group the IPC objects are removed when the last of these units is\nstopped. This setting is implied if\nDynamicUser=\nis set.\nThis option is only available for system services and is not supported for services\nrunning in per-user instances of the service manager.\nAdded in version 232.\nPrivateMounts=\nÂ¶\nTakes a boolean parameter. If set, the processes of this unit will be run in their own private\nfile system (mount) namespace with all mount propagation from the processes towards the host's main file system\nnamespace turned off. This means any file system mount points established or removed by the unit's processes\nwill be private to them and not be visible to the host. However, file system mount points established or\nremoved on the host will be propagated to the unit's processes. See\nmount_namespaces\n(7)\nfor\ndetails on file system namespaces. Defaults to off.\nWhen turned on, this executes three operations for each invoked process: a new\nCLONE_NEWNS\nnamespace is created, after which all existing mounts are remounted to\nMS_SLAVE\nto disable propagation from the unit's processes to the host (but leaving\npropagation in the opposite direction in effect). Finally, the mounts are remounted again to the propagation\nmode configured with\nMountFlags=\n, see below.\nFile system namespaces are set up individually for each process forked off by the service manager. Mounts\nestablished in the namespace of the process created by\nExecStartPre=\nwill hence be cleaned\nup automatically as soon as that process exits and will not be available to subsequent processes forked off for\nExecStart=\n(and similar applies to the various other commands configured for\nunits). Similarly,\nJoinsNamespaceOf=\ndoes not permit sharing kernel mount namespaces between\nunits, it only enables sharing of the\n/tmp/\nand\n/var/tmp/\ndirectories.\nOther file system namespace unit settings â\nPrivateTmp=\n,\nPrivateDevices=\n,\nProtectSystem=\n,\nProtectHome=\n,\nReadOnlyPaths=\n,\nInaccessiblePaths=\n,\nReadWritePaths=\n,\nBindPaths=\n,\nBindReadOnlyPaths=\n, â¦ â also enable file system\nnamespacing in a fashion equivalent to this option. Hence it is primarily useful to explicitly\nrequest this behaviour if none of the other settings are used.\nThis option is only available for system services, or for services running in per-user\ninstances of the service manager in which case\nPrivateUsers=\nis implicitly enabled\n(requires unprivileged user namespaces support to be enabled in the kernel via the\n\"\nkernel.unprivileged_userns_clone=\n\" sysctl).\nAdded in version 239.\nMountFlags=\nÂ¶\nTakes a mount propagation setting:\nshared\n,\nslave\nor\nprivate\n, which controls whether file system mount points in the file system namespaces set up\nfor this unit's processes will receive or propagate mounts and unmounts from other file system namespaces. See\nmount\n(2)\nfor details on mount propagation, and the three propagation flags in particular.\nThis setting only controls the\nfinal\npropagation setting in effect on all mount\npoints of the file system namespace created for each process of this unit. Other file system namespacing unit\nsettings (see the discussion in\nPrivateMounts=\nabove) will implicitly disable mount and\nunmount propagation from the unit's processes towards the host by changing the propagation setting of all mount\npoints in the unit's file system namespace to\nslave\nfirst. Setting this option to\nshared\ndoes not reestablish propagation in that case.\nIf not set â but file system namespaces are enabled through another file system namespace unit setting â\nshared\nmount propagation is used, but â as mentioned â as\nslave\nis applied\nfirst, propagation from the unit's processes to the host is still turned off.\nIt is not recommended to use\nprivate\nmount propagation for units, as this means\ntemporary mounts (such as removable media) of the host will stay mounted and thus indefinitely busy in forked\noff processes, as unmount propagation events will not be received by the file system namespace of the unit.\nUsually, it is best to leave this setting unmodified, and use higher level file system namespacing\noptions instead, in particular\nPrivateMounts=\n, see above.\nThis option is only available for system services, or for services running in per-user\ninstances of the service manager in which case\nPrivateUsers=\nis implicitly enabled\n(requires unprivileged user namespaces support to be enabled in the kernel via the\n\"\nkernel.unprivileged_userns_clone=\n\" sysctl).\nSystem Call Filtering\nÂ¶\nSystemCallFilter=\nÂ¶\nTakes a space-separated list of system call names or system call groups. If this\nsetting is used, system calls executed by the unit processes except for the listed ones will result\nin the system call being denied (allow-listing). If the first character of the list is\n\"\n~\n\", the effect is inverted: only the listed system calls will be denied\n(deny-listing). This option may be specified more than once, in which case the filter masks are\nmerged. If the empty string is assigned, the filter is reset, all prior assignments will have no\neffect.\nCommands prefixed with \"\n+\n\" are not subject to filtering. The\nexecve()\n,\nexit()\n,\nexit_group()\n,\ngetrlimit()\n,\nrt_sigreturn()\n,\nsigreturn()\nsystem calls and the system calls for querying time and sleeping are\nimplicitly allow-listed and do not need to be listed explicitly.\nThe default action when a system call is denied is to terminate the processes with a\nSIGSYS\nsignal. This can changed using\nSystemCallErrorNumber=\n,\nsee below. In addition, deny-listed system calls and system call groups may optionally be suffixed\nwith a colon (\"\n:\n\") and an argument in the same format as\nSystemCallErrorNumber=\n, to take this action when the matching system call is made.\nThis takes precedence over the action specified in\nSystemCallErrorNumber=\n.\nThis feature makes use of the Secure Computing Mode 2 interfaces of the kernel ('seccomp\nfiltering') and is useful for enforcing a minimal sandboxing environment.\nNote that on systems supporting multiple ABIs (such as x86/x86-64) it is recommended to turn\noff alternative ABIs for services, so that they cannot be used to circumvent the restrictions of this\noption. Specifically, it is recommended to combine this option with\nSystemCallArchitectures=native\nor similar.\nNote that strict system call filters may impact execution and error handling code paths of the\nservice invocation. Specifically, access to the\nexecve()\nsystem call is required\nfor the execution of the service binary â if it is blocked service invocation will necessarily fail.\nAlso, if execution of the service binary fails for some reason (for example: missing service\nexecutable), the error handling logic might require access to an additional set of system calls in\norder to process and log this failure correctly. It might be necessary to temporarily disable system\ncall filters in order to allow debugging of such failures.\nIf you specify both types of this option (i.e. allow-listing and deny-listing), the first\nencountered will take precedence and will dictate the default action (termination or approval of a\nsystem call). Then the next occurrences of this option will add or delete the listed system calls\nfrom the set of the filtered system calls, depending of its type and the default action. (For\nexample, if you have started with an allow list rule for\nread()\nand\nwrite()\n, and right after it add a deny list rule for\nwrite()\n,\nthen\nwrite()\nwill be removed from the set.)\nAs the number of possible system calls is large, predefined groups of system calls are\nprovided. A group starts with \"\n@\n\" character, followed by name of the set.\nTableÂ 5.Â Currently predefined system call sets\nSet\nDescription\n@aio\nAsynchronous I/O (\nio_setup\n(2)\n,\nio_submit\n(2)\n, and related calls)\n@basic-io\nSystem calls for basic I/O: reading, writing, seeking, file descriptor duplication and closing (\nread\n(2)\n,\nwrite\n(2)\n, and related calls)\n@chown\nChanging file ownership (\nchown\n(2)\n,\nfchownat\n(2)\n, and related calls)\n@clock\nSystem calls for changing the system clock (\nadjtimex\n(2)\n,\nsettimeofday\n(2)\n, and related calls)\n@cpu-emulation\nSystem calls for CPU emulation functionality (\nvm86\n(2)\nand related calls)\n@debug\nDebugging, performance monitoring and tracing functionality (\nptrace\n(2)\n,\nperf_event_open\n(2)\nand related calls)\n@file-system\nFile system operations: opening, creating files and directories for read and write, renaming and removing them, reading file properties, or creating hard and symbolic links\n@io-event\nEvent loop system calls (\npoll\n(2)\n,\nselect\n(2)\n,\nepoll\n(7)\n,\neventfd\n(2)\nand related calls)\n@ipc\nPipes, SysV IPC, POSIX Message Queues and other IPC (\nmq_overview\n(7)\n,\nsvipc\n(7)\n)\n@keyring\nKernel keyring access (\nkeyctl\n(2)\nand related calls)\n@memlock\nLocking of memory in RAM (\nmlock\n(2)\n,\nmlockall\n(2)\nand related calls)\n@module\nLoading and unloading of kernel modules (\ninit_module\n(2)\n,\ndelete_module\n(2)\nand related calls)\n@mount\nMounting and unmounting of file systems (\nmount\n(2)\n,\nchroot\n(2)\n, and related calls)\n@network-io\nSocket I/O (including local AF_UNIX):\nsocket\n(7)\n,\nunix\n(7)\n@obsolete\nUnusual, obsolete or unimplemented (\ncreate_module\n(2)\n,\ngtty\n(2)\n, â¦)\n@pkey\nSystem calls that deal with memory protection keys (\npkeys\n(7)\n)\n@privileged\nAll system calls which need super-user capabilities (\ncapabilities\n(7)\n)\n@process\nProcess control, execution, namespacing operations (\nclone\n(2)\n,\nkill\n(2)\n,\nnamespaces\n(7)\n, â¦)\n@raw-io\nRaw I/O port access (\nioperm\n(2)\n,\niopl\n(2)\n,\npciconfig_read()\n, â¦)\n@reboot\nSystem calls for rebooting and reboot preparation (\nreboot\n(2)\n,\nkexec()\n, â¦)\n@resources\nSystem calls for changing resource limits, memory and scheduling parameters (\nsetrlimit\n(2)\n,\nsetpriority\n(2)\n, â¦)\n@sandbox\nSystem calls for sandboxing programs (\nseccomp\n(2)\n, Landlock system calls, â¦)\n@setuid\nSystem calls for changing user ID and group ID credentials, (\nsetuid\n(2)\n,\nsetgid\n(2)\n,\nsetresuid\n(2)\n, â¦)\n@signal\nSystem calls for manipulating and handling process signals (\nsignal\n(2)\n,\nsigprocmask\n(2)\n, â¦)\n@swap\nSystem calls for enabling/disabling swap devices (\nswapon\n(2)\n,\nswapoff\n(2)\n)\n@sync\nSynchronizing files and memory to disk (\nfsync\n(2)\n,\nmsync\n(2)\n, and related calls)\n@system-service\nA reasonable set of system calls used by common system services, excluding any special purpose calls. This is the recommended starting point for allow-listing system calls for system services, as it contains what is typically needed by system services, but excludes overly specific interfaces. For example, the following APIs are excluded: \"\n@clock\n\", \"\n@mount\n\", \"\n@swap\n\", \"\n@reboot\n\".\n@timer\nSystem calls for scheduling operations by time (\nalarm\n(2)\n,\ntimer_create\n(2)\n, â¦)\n@known\nAll system calls defined by the kernel. This list is defined statically in systemd based on a kernel version that was available when this systemd version was released. It will become progressively more out-of-date as the kernel is updated.\nNote, that as new system calls are added to the kernel, additional system calls might be added to the groups\nabove. Contents of the sets may also change between systemd versions. In addition, the list of system calls\ndepends on the kernel version and architecture for which systemd was compiled. Use\nsystemd-analyzeÂ syscall-filter\nto list the actual list of system calls in each\nfilter.\nGenerally, allow-listing system calls (rather than deny-listing) is the safer mode of\noperation. It is recommended to enforce system call allow lists for all long-running system\nservices. Specifically, the following lines are a relatively safe basic choice for the majority of\nsystem services:\n[Service]\nSystemCallFilter=@system-service\nSystemCallErrorNumber=EPERM\nNote that various kernel system calls are defined redundantly: there are multiple system calls\nfor executing the same operation. For example, the\npidfd_send_signal()\nsystem\ncall may be used to execute operations similar to what can be done with the older\nkill()\nsystem call, hence blocking the latter without the former only provides\nweak protection. Since new system calls are added regularly to the kernel as development progresses,\nkeeping system call deny lists comprehensive requires constant work. It is thus recommended to use\nallow-listing instead, which offers the benefit that new system calls are by default implicitly\nblocked until the allow list is updated.\nAlso note that a number of system calls are required to be accessible for the dynamic linker to\nwork. The dynamic linker is required for running most regular programs (specifically: all dynamic ELF\nbinaries, which is how most distributions build packaged programs). This means that blocking these\nsystem calls (which include\nopen()\n,\nopenat()\nor\nmmap()\n) will make most programs typically shipped with generic distributions\nunusable.\nIt is recommended to combine the file system namespacing related options with\nSystemCallFilter=~@mount\n, in order to prohibit the unit's processes to undo the\nmappings. Specifically these are the options\nPrivateTmp=\n,\nPrivateDevices=\n,\nProtectSystem=\n,\nProtectHome=\n,\nProtectKernelTunables=\n,\nProtectControlGroups=\n,\nProtectKernelLogs=\n,\nProtectClock=\n,\nReadOnlyPaths=\n,\nInaccessiblePaths=\nand\nReadWritePaths=\n.\nAdded in version 187.\nSystemCallErrorNumber=\nÂ¶\nTakes an \"\nerrno\n\" error number (between 1 and 4095) or errno name\nsuch as\nEPERM\n,\nEACCES\nor\nEUCLEAN\n, to\nreturn when the system call filter configured with\nSystemCallFilter=\nis triggered,\ninstead of terminating the process immediately. See\nerrno\n(3)\nfor a\nfull list of error codes. When this setting is not used, or when the empty string or the special\nsetting \"\nkill\n\" is assigned, the process will be terminated immediately when the\nfilter is triggered.\nAdded in version 209.\nSystemCallArchitectures=\nÂ¶\nTakes a space-separated list of architecture identifiers to include in the system call\nfilter. The known architecture identifiers are the same as for\nConditionArchitecture=\ndescribed in\nsystemd.unit\n(5)\n,\nas well as\nx32\n,\nmips64-n32\n,\nmips64-le-n32\n, and\nthe special identifier\nnative\n. The special identifier\nnative\nimplicitly maps to the native architecture of the system (or more precisely: to the architecture the system\nmanager is compiled for). By default, this option is set to the empty list, i.e. no filtering is applied.\nIf this setting is used, processes of this unit will only be permitted to call native system calls, and\nsystem calls of the specified architectures. For the purposes of this option, the x32 architecture is treated\nas including x86-64 system calls. However, this setting still fulfills its purpose, as explained below, on\nx32.\nSystem call filtering is not equally effective on all architectures. For example, on x86\nfiltering of network socket-related calls is not possible, due to ABI limitations â a limitation that x86-64\ndoes not have, however. On systems supporting multiple ABIs at the same time â such as x86/x86-64 â it is hence\nrecommended to limit the set of permitted system call architectures so that secondary ABIs may not be used to\ncircumvent the restrictions applied to the native ABI of the system. In particular, setting\nSystemCallArchitectures=native\nis a good choice for disabling non-native ABIs.\nSystem call architectures may also be restricted system-wide via the\nSystemCallArchitectures=\noption in the global configuration. See\nsystemd-system.conf\n(5)\nfor\ndetails.\nAdded in version 209.\nSystemCallLog=\nÂ¶\nTakes a space-separated list of system call names. If this setting is used, all\nsystem calls executed by the unit processes for the listed ones will be logged. If the first\ncharacter of the list is \"\n~\n\", the effect is inverted: all system calls except the\nlisted system calls will be logged. This feature makes use of the Secure Computing Mode 2 interfaces\nof the kernel ('seccomp filtering') and is useful for auditing or setting up a minimal sandboxing\nenvironment. This option may be specified more than once, in which case the filter masks are merged.\nIf the empty string is assigned, the filter is reset, all prior assignments will have no effect.\nThis does not affect commands prefixed with \"\n+\n\".\nAdded in version 247.\nEnvironment\nÂ¶\nEnvironment=\nÂ¶\nSets environment variables for executed processes. Each line is unquoted using the\nrules described in \"Quoting\" section in\nsystemd.syntax\n(7)\nand becomes a list of variable assignments. If you need to assign a value containing spaces or the\nequals sign to a variable, put quotes around the whole assignment. Variable expansion is not\nperformed inside the strings and the \"\n$\n\" character has no special meaning. Specifier\nexpansion is performed, see the \"Specifiers\" section in\nsystemd.unit\n(5)\n.\nThis option may be specified more than once, in which case all listed variables will be set. If\nthe same variable is listed twice, the later setting will override the earlier setting. If the empty\nstring is assigned to this option, the list of environment variables is reset, all prior assignments\nhave no effect.\nThe names of the variables can contain ASCII letters, digits, and the underscore character.\nVariable names cannot be empty or start with a digit. In variable values, most characters are\nallowed, but non-printable characters are currently rejected.\nExample:\nEnvironment=\"VAR1=word1 word2\" VAR2=word3 \"VAR3=$word 5 6\"\ngives three variables \"\nVAR1\n\",\n\"\nVAR2\n\", \"\nVAR3\n\"\nwith the values \"\nword1 word2\n\",\n\"\nword3\n\", \"\n$word 5 6\n\".\nSee\nenviron\n(7)\nfor\ndetails about environment variables.\nNote that environment variables are not suitable for passing secrets (such as passwords, key\nmaterial, â¦)  to service processes. Environment variables set for a unit are exposed to unprivileged\nclients via D-Bus IPC, and generally not understood as being data that requires protection. Moreover,\nenvironment variables are propagated down the process tree, including across security boundaries\n(such as setuid/setgid executables), and hence might leak to processes that should not have access to\nthe secret data. Use\nLoadCredential=\n,\nLoadCredentialEncrypted=\nor\nSetCredentialEncrypted=\n(see below) to pass data to unit processes\nsecurely.\nEnvironmentFile=\nÂ¶\nSimilar to\nEnvironment=\n, but reads the environment variables from\na text file. The text file should contain newline-separated variable assignments. Empty lines, lines\nwithout an \"\n=\n\" separator, or lines starting with \"\n;\n\" or\n\"\n#\n\" will be ignored, which may be used for commenting. The file must be encoded with\nUTF-8. Valid characters are\nunicode scalar values\nother than\nunicode noncharacters\n,\nU+0000\nNUL\n, and\nU+FEFF\nunicode byte order mark\n.\nControl codes other than\nNUL\nare allowed.\nIn the file, an unquoted value after the \"\n=\n\" is parsed with the same backslash-escape\nrules as\nPOSIX shell unquoted\ntext\n, but unlike in a shell, interior whitespace is preserved and quotes after the\nfirst non-whitespace character are preserved. Leading and trailing whitespace (space, tab, carriage return) is\ndiscarded, but interior whitespace within the line is preserved verbatim. A line ending with a backslash will be\ncontinued to the following one, with the newline itself discarded. A backslash\n\"\n\\\n\" followed by any character other than newline will preserve the following character, so that\n\"\n\\\\\n\" will become the value \"\n\\\n\".\nIn the file, a \"\n'\n\"-quoted value after the \"\n=\n\" can span\nmultiple lines and contain any character verbatim other than single quote, like\nPOSIX\nshell single-quoted text\n. No backslash-escape sequences are recognized. Leading and trailing\nwhitespace outside of the single quotes is discarded.\nIn the file, a \"\n\"\n\"-quoted value after the \"\n=\n\" can span\nmultiple lines, and the same escape sequences are recognized as in\nPOSIX\nshell double-quoted text\n. Backslash (\"\n\\\n\") followed by any of\n\"\n\"\\`$\n\" will preserve that character. A backslash followed by newline is a line\ncontinuation, and the newline itself is discarded. A backslash followed by any other character is\nignored; both the backslash and the following character are preserved verbatim. Leading and trailing\nwhitespace outside of the double quotes is discarded.\nThe argument passed should be an absolute filename or wildcard expression, optionally prefixed with\n\"\n-\n\", which indicates that if the file does not exist, it will not be read and no error or\nwarning message is logged. This option may be specified more than once in which case all specified files are\nread. If the empty string is assigned to this option, the list of file to read is reset, all prior assignments\nhave no effect.\nThe files listed with this directive will be read shortly before the process is executed (more\nspecifically, after all processes from a previous unit state terminated. This means you can generate these\nfiles in one unit state, and read it with this option in the next. The files are read from the file\nsystem of the service manager, before any file system changes like bind mounts take place).\nSettings from these files override settings made with\nEnvironment=\n. If the same\nvariable is set twice from these files, the files will be read in the order they are specified and the later\nsetting will override the earlier setting.\nPassEnvironment=\nÂ¶\nPass environment variables set for the system service manager to executed processes. Takes a\nspace-separated list of variable names. This option may be specified more than once, in which case all listed\nvariables will be passed. If the empty string is assigned to this option, the list of environment variables to\npass is reset, all prior assignments have no effect. Variables specified that are not set for the system\nmanager will not be passed and will be silently ignored. Note that this option is only relevant for the system\nservice manager, as system services by default do not automatically inherit any environment variables set for\nthe service manager itself. However, in case of the user service manager all environment variables are passed\nto the executed processes anyway, hence this option is without effect for the user service manager.\nVariables set for invoked processes due to this setting are subject to being overridden by those\nconfigured with\nEnvironment=\nor\nEnvironmentFile=\n.\nExample:\nPassEnvironment=VAR1 VAR2 VAR3\npasses three variables \"\nVAR1\n\",\n\"\nVAR2\n\", \"\nVAR3\n\"\nwith the values set for those variables in PID1.\nSee\nenviron\n(7)\nfor details\nabout environment variables.\nAdded in version 228.\nUnsetEnvironment=\nÂ¶\nExplicitly unset environment variable assignments that would normally be passed from the\nservice manager to invoked processes of this unit. Takes a space-separated list of variable names or variable\nassignments. This option may be specified more than once, in which case all listed variables/assignments will\nbe unset. If the empty string is assigned to this option, the list of environment variables/assignments to\nunset is reset. If a variable assignment is specified (that is: a variable name, followed by\n\"\n=\n\", followed by its value), then any environment variable matching this precise assignment is\nremoved. If a variable name is specified (that is a variable name without any following \"\n=\n\" or\nvalue), then any assignment matching the variable name, regardless of its value is removed. Note that the\neffect of\nUnsetEnvironment=\nis applied as final step when the environment list passed to\nexecuted processes is compiled. That means it may undo assignments from any configuration source, including\nassignments made through\nEnvironment=\nor\nEnvironmentFile=\n, inherited from\nthe system manager's global set of environment variables, inherited via\nPassEnvironment=\n,\nset by the service manager itself (such as\n$NOTIFY_SOCKET\nand such), or set by a PAM module\n(in case\nPAMName=\nis used).\nSee \"Environment Variables in Spawned Processes\" below for a description of how those\nsettings combine to form the inherited environment. See\nenviron\n(7)\nfor general\ninformation about environment variables.\nAdded in version 235.\nLogging and Standard Input/Output\nÂ¶\nStandardInput=\nÂ¶\nControls where file descriptor 0 (STDIN) of the executed processes is connected to. Takes one\nof\nnull\n,\ntty\n,\ntty-force\n,\ntty-fail\n,\ndata\n,\nfile:\npath\n,\nsocket\nor\nfd:\nname\n.\nIf\nnull\nis selected, standard input will be connected to\n/dev/null\n,\ni.e. all read attempts by the process will result in immediate EOF.\nIf\ntty\nis selected, standard input is connected to a TTY (as configured by\nTTYPath=\n, see below) and the executed process becomes the controlling process of the\nterminal. If the terminal is already being controlled by another process, the executed process waits until the\ncurrent controlling process releases the terminal.\ntty-force\nis similar to\ntty\n, but the executed process is forcefully and\nimmediately made the controlling process of the terminal, potentially removing previous controlling processes\nfrom the terminal.\ntty-fail\nis similar to\ntty\n, but if the terminal already has a\ncontrolling process start-up of the executed process fails.\nThe\ndata\noption may be used to configure arbitrary textual or binary data to pass via\nstandard input to the executed process. The data to pass is configured via\nStandardInputText=\n/\nStandardInputData=\n(see below). Note that the actual\nfile descriptor type passed (memory file, regular file, UNIX pipe, â¦) might depend on the kernel and available\nprivileges. In any case, the file descriptor is read-only, and when read returns the specified data followed by\nEOF.\nThe\nfile:\npath\noption may be used to connect a specific file\nsystem object to standard input. An absolute path following the \"\n:\n\" character is expected,\nwhich may refer to a regular file, a FIFO or special file. If an\nAF_UNIX\nsocket in the\nfile system is specified, a stream socket is connected to it. The latter is useful for connecting standard\ninput of processes to arbitrary system services.\nThe\nsocket\noption is valid in socket-activated services only, and requires the relevant\nsocket unit file (see\nsystemd.socket\n(5)\nfor details)\nto have\nAccept=yes\nset, or to specify a single socket only. If this option is set, standard\ninput will be connected to the socket the service was activated from, which is primarily useful for\ncompatibility with daemons designed for use with the traditional\ninetd\n(8)\nsocket activation\ndaemon (\n$LISTEN_FDS\n(and related) environment variables are not passed when\nsocket\nvalue is configured).\nThe\nfd:\nname\noption connects standard input to a specific,\nnamed file descriptor provided by a socket unit. The name may be specified as part of this option, following a\n\"\n:\n\" character (e.g. \"\nfd:foobar\n\"). If no name is specified, the name\n\"\nstdin\n\" is implied (i.e. \"\nfd\n\" is equivalent to \"\nfd:stdin\n\").\nAt least one socket unit defining the specified name must be provided via the\nSockets=\noption, and the file descriptor name may differ from the name of its containing socket unit. If multiple\nmatches are found, the first one will be used. See\nFileDescriptorName=\nin\nsystemd.socket\n(5)\nfor more\ndetails about named file descriptors and their ordering.\nThis setting defaults to\nnull\n, unless\nStandardInputText=\n/\nStandardInputData=\nare set, in which case it\ndefaults to\ndata\n.\nStandardOutput=\nÂ¶\nControls where file descriptor 1 (stdout) of the executed processes is connected\nto. Takes one of\ninherit\n,\nnull\n,\ntty\n,\njournal\n,\nkmsg\n,\njournal+console\n,\nkmsg+console\n,\nfile:\npath\n,\nappend:\npath\n,\ntruncate:\npath\n,\nsocket\nor\nfd:\nname\n.\ninherit\nduplicates the file descriptor of standard input for standard output.\nnull\nconnects standard output to\n/dev/null\n, i.e. everything written\nto it will be lost.\ntty\nconnects standard output to a tty (as configured via\nTTYPath=\n,\nsee below). If the TTY is used for output only, the executed process will not become the controlling process of\nthe terminal, and will not fail or wait for other processes to release the terminal. Note: if a unit\ntries to print multiple lines to a TTY during bootup or shutdown, then there's a chance that those\nlines will be broken up by status messages.\nSetShowStatus()\ncan be used to\nprevent this problem. See\norg.freedesktop.systemd1\n(5)\nfor details.\njournal\nconnects standard output with the journal, which is accessible via\njournalctl\n(1)\n. Note\nthat everything that is written to kmsg (see below) is implicitly stored in the journal as well, the\nspecific option listed below is hence a superset of this one. (Also note that any external,\nadditional syslog daemons receive their log data from the journal, too, hence this is the option to\nuse when logging shall be processed with such a daemon.)\nkmsg\nconnects standard output with the kernel log buffer which is accessible via\ndmesg\n(1)\n,\nin addition to the journal. The journal daemon might be configured to send all logs to kmsg anyway, in which\ncase this option is no different from\njournal\n.\njournal+console\nand\nkmsg+console\nwork in a similar way as the\ntwo options above but copy the output to the system console as well.\nThe\nfile:\npath\noption may be used to connect a specific file\nsystem object to standard output. The semantics are similar to the same option of\nStandardInput=\n, see above. If\npath\nrefers to a regular file\non the filesystem, it is opened (created if it does not exist yet using privileges of the user executing the\nsystemd process) for writing at the beginning of the file, but without truncating it.\nIf standard input and output are directed to the same file path, it is opened only once â for reading as well\nas writing â and duplicated. This is particularly useful when the specified path refers to an\nAF_UNIX\nsocket in the file system, as in that case only a\nsingle stream connection is created for both input and output.\nappend:\npath\nis similar to\nfile:\npath\nabove, but it opens the file in append mode.\ntruncate:\npath\nis similar to\nfile:\npath\nabove, but it truncates the file when opening\nit. For units with multiple command lines, e.g.\nType=oneshot\nservices with\nmultiple\nExecStart=\n, or services with\nExecCondition=\n,\nExecStartPre=\nor\nExecStartPost=\n, the output file is reopened\nand therefore re-truncated for each command line. If the output file is truncated while another\nprocess still has the file open, e.g. by an\nExecReload=\nrunning concurrently with\nan\nExecStart=\n, and the other process continues writing to the file without\nadjusting its offset, then the space between the file pointers of the two processes may be filled\nwith\nNUL\nbytes, producing a sparse file. Thus,\ntruncate:\npath\nis typically only useful for units where\nonly one process runs at a time, such as services with a single\nExecStart=\nand no\nExecStartPost=\n,\nExecReload=\n,\nExecStop=\nor\nsimilar.\nsocket\nconnects standard output to a socket acquired via socket activation. The\nsemantics are similar to the same option of\nStandardInput=\n, see above.\nThe\nfd:\nname\noption connects standard output to a\nspecific, named file descriptor provided by a socket unit. A name may be specified as part of this\noption, following a \"\n:\n\" character\n(e.g. \"\nfd:\nfoobar\n\"). If no name is specified, the name\n\"\nstdout\n\" is implied (i.e. \"\nfd\n\" is equivalent to\n\"\nfd:stdout\n\"). At least one socket unit defining the specified name must be provided\nvia the\nSockets=\noption, and the file descriptor name may differ from the name of\nits containing socket unit. If multiple matches are found, the first one will be used. See\nFileDescriptorName=\nin\nsystemd.socket\n(5)\nfor more details about named descriptors and their ordering.\nIf the standard output (or error output, see below) of a unit is connected to the journal or\nthe kernel log buffer, the unit will implicitly gain a dependency of type\nAfter=\non\nsystemd-journald.socket\n(also see the \"Implicit Dependencies\" section\nabove). Also note that, in this case, stdout (or stderr, see below) will be an\nAF_UNIX\nstream socket, and not a pipe or FIFO that can be reopened. This means\nwhen executing shell scripts the construct\necho \"hello\" > /dev/stderr\nfor\nwriting text to stderr will not work. To mitigate this use the construct\necho \"hello\"\n>&2\ninstead, which is mostly equivalent and avoids this pitfall.\nIf\nStandardInput=\nis set to one of\ntty\n,\ntty-force\n,\ntty-fail\n,\nsocket\n, or\nfd:\nname\n, this\nsetting defaults to\ninherit\n.\nIn other cases, this setting defaults to the value set with\nDefaultStandardOutput=\nin\nsystemd-system.conf\n(5)\n, which\ndefaults to\njournal\n. Note that setting this parameter might result in additional dependencies\nto be added to the unit (see above).\nStandardError=\nÂ¶\nControls where file descriptor 2 (stderr) of the executed processes is connected to. The\navailable options are identical to those of\nStandardOutput=\n, with some exceptions: if set to\ninherit\nthe file descriptor used for standard output is duplicated for standard error, while\nfd:\nname\nwill use a default file descriptor name of\n\"\nstderr\n\".\nThis setting defaults to the value set with\nDefaultStandardError=\nin\nsystemd-system.conf\n(5)\n, which\ndefaults to\ninherit\n. Note that setting this parameter might result in additional dependencies\nto be added to the unit (see above).\nStandardInputText=\n,\nStandardInputData=\nÂ¶\nConfigures arbitrary textual or binary data to pass via file descriptor 0 (STDIN) to\nthe executed processes. These settings have no effect unless\nStandardInput=\nis set\nto\ndata\n(which is the default if\nStandardInput=\nis not set\notherwise, but\nStandardInputText=\n/\nStandardInputData=\nis). Use\nthis option to embed process input data directly in the unit file.\nStandardInputText=\naccepts arbitrary textual data. C-style escapes for special\ncharacters as well as the usual \"\n%\n\"-specifiers are resolved. Each time this setting is used\nthe specified text is appended to the per-unit data buffer, followed by a newline character (thus every use\nappends a new line to the end of the buffer). Note that leading and trailing whitespace of lines configured\nwith this option is removed. If an empty line is specified the buffer is cleared (hence, in order to insert an\nempty line, add an additional \"\n\\n\n\" to the end or beginning of a line).\nStandardInputData=\naccepts arbitrary binary data, encoded in\nBase64\n. No escape sequences or specifiers are\nresolved. Any whitespace in the encoded version is ignored during decoding.\nNote that\nStandardInputText=\nand\nStandardInputData=\noperate on the\nsame data buffer, and may be mixed in order to configure both binary and textual data for the same input\nstream. The textual or binary data is joined strictly in the order the settings appear in the unit\nfile. Assigning an empty string to either will reset the data buffer.\nPlease keep in mind that in order to maintain readability long unit file settings may be split into\nmultiple lines, by suffixing each line (except for the last) with a \"\n\\\n\" character (see\nsystemd.unit\n(5)\nfor\ndetails). This is particularly useful for large data configured with these two options. Example:\nâ¦\nStandardInput=data\nStandardInputData=V2XigLJyZSBubyBzdHJhbmdlcnMgdG8gbG92ZQpZb3Uga25vdyB0aGUgcnVsZXMgYW5kIHNvIGRv \\\nIEkKQSBmdWxsIGNvbW1pdG1lbnQncyB3aGF0IEnigLJtIHRoaW5raW5nIG9mCllvdSB3b3VsZG4n \\\ndCBnZXQgdGhpcyBmcm9tIGFueSBvdGhlciBndXkKSSBqdXN0IHdhbm5hIHRlbGwgeW91IGhvdyBJ \\\nJ20gZmVlbGluZwpHb3R0YSBtYWtlIHlvdSB1bmRlcnN0YW5kCgpOZXZlciBnb25uYSBnaXZlIHlv \\\ndSB1cApOZXZlciBnb25uYSBsZXQgeW91IGRvd24KTmV2ZXIgZ29ubmEgcnVuIGFyb3VuZCBhbmQg \\\nZGVzZXJ0IHlvdQpOZXZlciBnb25uYSBtYWtlIHlvdSBjcnkKTmV2ZXIgZ29ubmEgc2F5IGdvb2Ri \\\neWUKTmV2ZXIgZ29ubmEgdGVsbCBhIGxpZSBhbmQgaHVydCB5b3UK\nâ¦\nAdded in version 236.\nLogLevelMax=\nÂ¶\nSets the maximum log level for log messages generated by this unit. Takes a\nsyslog\nlog level, one of\nemerg\n(lowest log level, only highest\npriority messages),\nalert\n,\ncrit\n,\nerr\n,\nwarning\n,\nnotice\n,\ninfo\n,\ndebug\n(highest log level, also lowest priority messages). See\nsyslog\n(3)\nfor\ndetails. By default, the maximum log level is not overridden.\nThis option can be used to configure the logging system to drop log messages of a specific\nservice above the specified level. For example, set\nLogLevelMax=\ninfo\nin order to turn off debug logging of a\nparticularly chatty unit. Alternatively, this option can be used to enable extra logging about a\nspecific unit by the system or user manager processes without changing the global log level for the\nsystem or user manager processes by setting\nLogLevelMax=\ndebug\n.\nNote that the configured level is applied to any log messages written by any of the processes\nbelonging to this unit, as well as any log messages written by the system or user manager processes\nin reference to this unit, sent via any supported logging protocol. The override is applied early in\nthe logging pipeline, before any kind of further processing is done. Moreover, messages which pass\nthrough this filter successfully might still be dropped by filters applied at a later stage in the\nlogging subsystem. For example,\nMaxLevelStore=\nconfigured in\njournald.conf\n(5)\nmight prohibit messages of higher log levels to be stored on disk, even though the per-unit\nLogLevelMax=\npermitted it to be processed.\nAdded in version 236.\nLogExtraFields=\nÂ¶\nConfigures additional log metadata fields to include in all log records generated by\nprocesses associated with this unit, including systemd. This setting takes one or more journal field\nassignments in the format \"\nFIELD=VALUE\n\" separated by whitespace. See\nsystemd.journal-fields\n(7)\nfor details on the journal field concept. Even though the underlying journal implementation permits\nbinary field values, this setting accepts only valid UTF-8 values. To include space characters in a\njournal field value, enclose the assignment in double quotes (\").\nThe usual specifiers are expanded in all assignments (see below). Note that this setting is not only\nuseful for attaching additional metadata to log records of a unit, but given that all fields and\nvalues are indexed may also be used to implement cross-unit log record matching. Assign an empty\nstring to reset the list.\nNote that this functionality is currently only available in system services, not in per-user\nservices.\nAdded in version 236.\nLogRateLimitIntervalSec=\n,\nLogRateLimitBurst=\nÂ¶\nConfigures the rate limiting that is applied to log messages generated by this unit.\nIf, in the time interval defined by\nLogRateLimitIntervalSec=\n, more messages than\nspecified in\nLogRateLimitBurst=\nare logged by a service, all further messages\nwithin the interval are dropped until the interval is over. A message about the number of dropped\nmessages is generated. The time specification for\nLogRateLimitIntervalSec=\nmay be\nspecified in the following units: \"s\", \"min\", \"h\", \"ms\", \"us\". See\nsystemd.time\n(7)\nfor\ndetails. The default settings are set by\nRateLimitIntervalSec=\nand\nRateLimitBurst=\nconfigured in\njournald.conf\n(5)\n.\nNote that this only applies to log messages that are processed by the logging subsystem, i.e. by\nsystemd-journald.service\n(8)\n.\nThis means that if you connect a service's stderr directly to a file via\nStandardOutput=file:â¦\nor a similar setting, the rate limiting will not be applied\nto messages written that way (but it will be enforced for messages generated via\nsyslog\n(3)\nand similar functions).\nAdded in version 240.\nLogFilterPatterns=\nÂ¶\nDefine an extended regular expression to filter log messages based on the\nMESSAGE=\nfield of the structured message. If the first character of the pattern is\n\"\n~\n\", log entries matching the pattern should be discarded. This option takes a single\npattern as an argument but can be used multiple times to create a list of allowed and denied patterns.\nIf the empty string is assigned, the filter is reset, and all prior assignments will have no effect.\nBecause the \"\n~\n\" character is used to define denied patterns, it must be replaced\nwith \"\n\\x7e\n\" to allow a message starting with \"\n~\n\". For example,\n\"\n~foobar\n\" would add a pattern matching \"\nfoobar\n\" to the deny list, while\n\"\n\\x7efoobar\n\" would add a pattern matching \"\n~foobar\n\" to the allow list.\nLog messages are tested against denied patterns (if any), then against allowed patterns\n(if any). If a log message matches any of the denied patterns, it is discarded immediately without considering\nallowed patterns. Remaining log messages are tested against allowed patterns. Messages matching\nagainst none of the allowed pattern are discarded. If no allowed patterns are defined, then all\nmessages are processed directly after going through denied filters.\nFiltering is based on the unit for which\nLogFilterPatterns=\nis defined, meaning log\nmessages coming from\nsystemd\n(1)\nabout the\nunit are not taken into account. Filtered log messages will not be forwarded to traditional syslog daemons,\nthe kernel log buffer (kmsg), the systemd console, or sent as wall messages to all logged-in\nusers.\nNote that this functionality is currently only available in system services, not in per-user\nservices.\nAdded in version 253.\nLogNamespace=\nÂ¶\nRun the unit's processes in the specified journal namespace. Expects a short\nuser-defined string identifying the namespace. If not used the processes of the service are run in\nthe default journal namespace, i.e. their log stream is collected and processed by\nsystemd-journald.service\n. If this option is used any log data generated by\nprocesses of this unit (regardless of whether via the\nsyslog()\n, journal native logging\nor stdout/stderr logging) is collected and processed by an instance of the\nsystemd-journald@.service\ntemplate unit, which manages the specified\nnamespace. The log data is stored in a data store independent from the default log namespace's data\nstore. See\nsystemd-journald.service\n(8)\nfor details about journal namespaces.\nInternally, journal namespaces are implemented through Linux mount namespacing and\nover-mounting the directory that contains the relevant\nAF_UNIX\nsockets used for\nlogging in the unit's mount namespace. Since mount namespaces are used this setting disconnects\npropagation of mounts from the unit's processes to the host, similarly to how\nReadOnlyPaths=\nand similar settings describe above work. Journal namespaces may hence\nnot be used for services that need to establish mount points on the host.\nWhen this option is used the unit will automatically gain ordering and requirement dependencies\non the two socket units associated with the\nsystemd-journald@.service\ninstance\nso that they are automatically established prior to the unit starting up. Note that when this option\nis used log output of this service does not appear in the regular\njournalctl\n(1)\noutput, unless the\n--namespace=\noption is used.\nThis option is only available for system services and is not supported for services\nrunning in per-user instances of the service manager.\nAdded in version 245.\nSyslogIdentifier=\nÂ¶\nSets the process name (\"\nsyslog\ntag\") to prefix log lines sent to\nthe logging system or the kernel log buffer with. If not set, defaults to the process name of the\nexecuted process. This option is only useful when\nStandardOutput=\nor\nStandardError=\nare set to\njournal\nor\nkmsg\n(or to\nthe same settings in combination with\n+console\n) and only applies to log messages\nwritten to stdout or stderr.\nSyslogFacility=\nÂ¶\nSets the\nsyslog\nfacility identifier to use when logging. One of\nkern\n,\nuser\n,\nmail\n,\ndaemon\n,\nauth\n,\nsyslog\n,\nlpr\n,\nnews\n,\nuucp\n,\ncron\n,\nauthpriv\n,\nftp\n,\nlocal0\n,\nlocal1\n,\nlocal2\n,\nlocal3\n,\nlocal4\n,\nlocal5\n,\nlocal6\nor\nlocal7\n. See\nsyslog\n(3)\nfor\ndetails. This option is only useful when\nStandardOutput=\nor\nStandardError=\nare set to\njournal\nor\nkmsg\n(or to\nthe same settings in combination with\n+console\n), and only applies to log messages\nwritten to stdout or stderr. Defaults to\ndaemon\n.\nSyslogLevel=\nÂ¶\nThe default\nsyslog\nlog level to use when logging to the logging system or\nthe kernel log buffer. One of\nemerg\n,\nalert\n,\ncrit\n,\nerr\n,\nwarning\n,\nnotice\n,\ninfo\n,\ndebug\n. See\nsyslog\n(3)\nfor\ndetails. This option is only useful when\nStandardOutput=\nor\nStandardError=\nare set to\njournal\nor\nkmsg\n(or to the same settings in combination with\n+console\n), and only applies\nto log messages written to stdout or stderr. Note that individual lines output by executed processes may be\nprefixed with a different log level which can be used to override the default log level specified here. The\ninterpretation of these prefixes may be disabled with\nSyslogLevelPrefix=\n, see below. For\ndetails, see\nsd-daemon\n(3)\n.\nDefaults to\ninfo\n.\nSyslogLevelPrefix=\nÂ¶\nTakes a boolean argument. If true and\nStandardOutput=\nor\nStandardError=\nare set to\njournal\nor\nkmsg\n(or to\nthe same settings in combination with\n+console\n), log lines written by the executed\nprocess that are prefixed with a log level will be processed with this log level set but the prefix\nremoved. If set to false, the interpretation of these prefixes is disabled and the logged lines are\npassed on as-is. This only applies to log messages written to stdout or stderr. For details about\nthis prefixing see\nsd-daemon\n(3)\n.\nDefaults to true.\nTTYPath=\nÂ¶\nSets the terminal device node to use if standard input, output, or error are connected to a TTY\n(see above). Defaults to\n/dev/console\n.\nTTYReset=\nÂ¶\nReset the terminal device specified with\nTTYPath=\nbefore and after\nexecution. This does not erase the screen (see\nTTYVTDisallocate=\nbelow for\nthat). Defaults to \"\nno\n\".\nTTYVHangup=\nÂ¶\nDisconnect all clients which have opened the terminal device specified with\nTTYPath=\nbefore and after execution. Defaults to \"\nno\n\".\nTTYColumns=\n,\nTTYRows=\nÂ¶\nConfigure the size of the TTY specified with\nTTYPath=\n. If unset or\nset to the empty string, it is attempted to retrieve the dimensions of the terminal screen via ANSI\nsequences, and if that fails the kernel defaults (typically 80x24) are used.\nAdded in version 250.\nTTYVTDisallocate=\nÂ¶\nIf the terminal device specified with\nTTYPath=\nis a virtual\nconsole terminal, try to deallocate the TTY before and after execution. This ensures that the screen\nand scrollback buffer is cleared. If the terminal device is of any other type of TTY an attempt is\nmade to clear the screen via ANSI sequences. Defaults to \"\nno\n\".\nCredentials\nÂ¶\nLoadCredential=\nID\n[\n:\nPATH\n],\nLoadCredentialEncrypted=\nID\n[\n:\nPATH\n]\nÂ¶\nPass a credential to the unit. Credentials are limited-size binary or textual objects\nthat may be passed to unit processes. They are primarily intended for passing cryptographic keys\n(both public and private) or certificates, user account information or identity information from host\nto services, but can be freely used to pass any kind of limited-size information to a service. The\ndata is accessible from the unit's processes via the file system, at a read-only location that (if\npossible and permitted) is backed by non-swappable memory. The data is only accessible to the user\nassociated with the unit, via the\nUser=\n/\nDynamicUser=\nsettings\n(as well as the superuser). When available, the location of credentials is exported as the\n$CREDENTIALS_DIRECTORY\nenvironment variable to the unit's processes.\nThe\nLoadCredential=\nsetting takes a textual ID to use as name for a\ncredential plus a file system path, separated by a colon. The ID must be a short ASCII string\nsuitable as filename in the filesystem, and may be chosen freely by the user. If the specified path\nis absolute it is opened as regular file and the credential data is read from it. If the absolute\npath refers to an\nAF_UNIX\nstream socket in the file system a connection is made\nto it (once at process invocation) and the credential data read from the connection, providing an\neasy IPC integration point for dynamically transferring credentials from other services.\nIf the specified path is not absolute and itself qualifies as valid credential identifier it is\nattempted to find a credential that the service manager itself received under the specified name â\nwhich may be used to propagate credentials from an invoking environment (e.g. a container manager\nthat invoked the service manager) into a service. If no matching passed credential is found, the\nsystem service manager will search the directories\n/etc/credstore/\n,\n/run/credstore/\nand\n/usr/lib/credstore/\nfor files under the\ncredential's name â which hence are recommended locations for credential data on disk. If\nLoadCredentialEncrypted=\nis used\n/run/credstore.encrypted/\n,\n/etc/credstore.encrypted/\n, and\n/usr/lib/credstore.encrypted/\nare searched as well. The per-user service manager\nwill search\n$XDG_CONFIG_HOME/credstore/\n,\n$XDG_RUNTIME_DIR/credstore/\n,\n$HOME/.local/lib/credstore/\n(and the counterparts ending with\nâ¦/credstore.encrypted/\n) instead. The\nsystemd-path\n(1)\ntool\nmay be used to query the precise credential store search path.\nIf the file system path is omitted it is chosen identical to the credential name, i.e. this is\na terse way to declare credentials to inherit from the service manager or credstore directories into\na service. This option may be used multiple times, each time defining an additional credential to\npass to the unit.\nNote that if the path is not specified or a valid credential identifier is given, i.e.\nin the above two cases, a missing credential is not considered fatal.\nIf an absolute path referring to a directory is specified, every file in that directory\n(recursively) will be loaded as a separate credential. The ID for each credential will be the\nprovided ID suffixed with \"\n_$FILENAME\n\" (e.g., \"\nKey_file1\n\"). When\nloading from a directory, symlinks will be ignored.\nThe contents of the file/socket may be arbitrary binary or textual data, including newline\ncharacters and\nNUL\nbytes.\nThe\nLoadCredentialEncrypted=\nsetting is identical to\nLoadCredential=\n, except that the credential data is decrypted and authenticated\nbefore being passed on to the executed processes. Specifically, the referenced path should refer to a\nfile or socket with an encrypted credential, as implemented by\nsystemd-creds\n(1)\n. This\ncredential is loaded, decrypted, authenticated and then passed to the application in plaintext form,\nin the same way a regular credential specified via\nLoadCredential=\nwould be. A\ncredential configured this way may be symmetrically encrypted/authenticated with a secret key derived\nfrom the system's TPM2 security chip, or with a secret key stored in\n/var/lib/systemd/credential.secret\n, or with both. Using encrypted and\nauthenticated credentials improves security as credentials are not stored in plaintext and only\nauthenticated and decrypted into plaintext the moment a service requiring them is started. Moreover,\ncredentials may be bound to the local hardware and installations, so that they cannot easily be\nanalyzed offline, or be generated externally. See\nsystemd.resource-control\n(5)\nfor the details about\nDevicePolicy=\nor\nDeviceAllow=\n.\nNote that encrypted credentials targeted for services of the per-user service manager must be\nencrypted with\nsystemd-creds encrypt --user\n, and those for the system service\nmanager without the\n--user\nswitch. Encrypted credentials are always targeted to a\nspecific user or the system as a whole, and it is ensured that per-user service managers cannot\ndecrypt secrets intended for the system or for other users.\nThe credential files/IPC sockets must be accessible to the service manager, but do not have to\nbe directly accessible to the unit's processes: the credential data is read and copied into separate,\nread-only copies for the unit that are accessible to appropriately privileged processes. This is\nparticularly useful in combination with\nDynamicUser=\nas this way privileged data\ncan be made available to processes running under a dynamic UID (i.e. not a previously known one)\nwithout having to open up access to all users.\nIn order to reference the path a credential may be read from within a\nExecStart=\ncommand line use \"\n${CREDENTIALS_DIRECTORY}/mycred\n\",\ne.g. \"\nExecStart=cat ${CREDENTIALS_DIRECTORY}/mycred\n\". In order to reference the path\na credential may be read from within a\nEnvironment=\nline use\n\"\n%d/mycred\n\", e.g. \"\nEnvironment=MYCREDPATH=%d/mycred\n\". For system\nservices the path may also be referenced as\n\"\n/run/credentials/\nUNITNAME\n\" in cases where no\ninterpolation is possible, e.g. configuration files of software that does not yet support credentials\nnatively.\n$CREDENTIALS_DIRECTORY\nis considered the primary interface to look for\ncredentials, though, since it also works for user services.\nCurrently, an accumulated credential size limit of 1 MB per unit is enforced.\nThe service manager itself may receive system credentials that can be propagated to services\nfrom a hosting container manager or VM hypervisor. See the\nContainer Interface\ndocumentation for details\nabout the former. For the latter, pass\nDMI/SMBIOS\nOEM string table entries (field type\n11) with a prefix of \"\nio.systemd.credential:\n\" or\n\"\nio.systemd.credential.binary:\n\". In both cases a key/value pair separated by\n\"\n=\n\" is expected. In the latter case, the right-hand side is Base64 decoded when\nparsed (thus permitting binary data to be passed in). Example\nqemu\nswitch: \"\n-smbios\ntype=11,value=io.systemd.credential:xx=yy\n\", or \"\n-smbios\ntype=11,value=io.systemd.credential.binary:rick=TmV2ZXIgR29ubmEgR2l2ZSBZb3UgVXA=\n\". Alternatively,\nuse the\nqemu\n\"\nfw_cfg\n\" node\n\"\nopt/io.systemd.credentials/\n\". Example\nqemu\nswitch:\n\"\n-fw_cfg name=opt/io.systemd.credentials/mycred,string=supersecret\n\". They may also\nbe passed from the UEFI firmware environment via\nsystemd-stub\n(7)\n,\nfrom the initrd (see\nsystemd\n(1)\n), or be\nspecified on the kernel command line using the \"\nsystemd.set_credential=\n\" and\n\"\nsystemd.set_credential_binary=\n\" switches (see\nsystemd\n(1)\nâ this is\nnot recommended since unprivileged userspace can read the kernel command line).\nIf referencing an\nAF_UNIX\nstream socket to connect to, the connection will\noriginate from an abstract namespace socket, that includes information about the unit and the\ncredential ID in its socket name. Use\ngetpeername\n(2)\nto query this information. The returned socket name is formatted as\nNUL\nRANDOM\n\"\n/unit/\n\"\nUNIT\n\"\n/\n\"\nID\n, i.e. a\nNUL\nbyte (as required\nfor abstract namespace socket names), followed by a random string (consisting of alphadecimal\ncharacters), followed by the literal string \"\n/unit/\n\", followed by the requesting\nunit name, followed by the literal character \"\n/\n\", followed by the textual credential\nID requested. Example: \"\n\\0adf9d86b6eda275e/unit/foobar.service/credx\n\" in case the\ncredential \"\ncredx\n\" is requested for a unit \"\nfoobar.service\n\". This\nfunctionality is useful for using a single listening socket to serve credentials to multiple\nconsumers.\nFor further information see\nSystem and Service\nCredentials\ndocumentation.\nAdded in version 247.\nImportCredential=\nGLOB\nÂ¶\nPass one or more credentials to the unit. Takes a credential name for which we will\nattempt to find a credential that the service manager itself received under the specified name â\nwhich may be used to propagate credentials from an invoking environment (e.g. a container manager\nthat invoked the service manager) into a service. If the credential name is a glob, all credentials\nmatching the glob are passed to the unit. Matching credentials are searched for in the system\ncredentials, the encrypted system credentials, and under\n/etc/credstore/\n,\n/run/credstore/\n,\n/usr/lib/credstore/\n,\n/run/credstore.encrypted/\n,\n/etc/credstore.encrypted/\n, and\n/usr/lib/credstore.encrypted/\nin that order. When multiple credentials of the\nsame name are found, the first one found is used.\nThe globbing expression implements a restrictive subset of\nglob\n(7)\n: only\na single trailing \"\n*\n\" wildcard may be specified. Both \"\n?\n\" and\n\"\n[]\n\" wildcards are not permitted, nor are \"\n*\n\" wildcards anywhere\nexcept at the end of the glob expression.\nOptionally, the credential name or glob may be followed by a colon followed by a rename pattern.\nIf specified, all credentials matching the credential name or glob are renamed according to the given\npattern. For example, if \"\nImportCredential=my.original.cred:my.renamed.cred\n\" is\nspecified, the service manager will read the \"\nmy.original.cred\n\" credential and make\nit available as the \"\nmy.renamed.cred\n\" credential to the service. Similarly, if\n\"\nImportCredential=my.original.*:my.renamed.\n\" is specified, the service manager will\nread all credentials starting with \"\nmy.original.\n\" and make them available as\n\"\nmy.renamed.xxx\n\" to the service.\nIf\nImportCredential=\nis specified multiple times and multiple credentials\nend up with the same name after renaming, the first one is kept and later ones are dropped.\nWhen multiple credentials of the same name are found, credentials found by\nLoadCredential=\nand\nLoadCredentialEncrypted=\ntake priority over\ncredentials found by\nImportCredential=\n.\nAdded in version 254.\nSetCredential=\nID\n:\nVALUE\n,\nSetCredentialEncrypted=\nID\n:\nVALUE\nÂ¶\nThe\nSetCredential=\nsetting is similar to\nLoadCredential=\nbut accepts a literal value to use as data for the credential,\ninstead of a file system path to read the data from. Do not use this option for data that is supposed\nto be secret, as it is accessible to unprivileged processes via IPC. It's only safe to use this for\nuser IDs, public key material and similar non-sensitive data. For everything else use\nLoadCredential=\n. In order to embed binary data into the credential data use\nC-style escaping (i.e. \"\n\\n\n\" to embed a newline, or \"\n\\x00\n\" to embed\na\nNUL\nbyte).\nThe\nSetCredentialEncrypted=\nsetting is identical to\nSetCredential=\nbut expects an encrypted credential in literal form as value. This\nallows embedding confidential credentials securely directly in unit files. Use\nsystemd-creds\n(1)\n'\n-p\nswitch to generate suitable\nSetCredentialEncrypted=\nlines\ndirectly from plaintext credentials. For further details see\nLoadCredentialEncrypted=\nabove.\nWhen multiple credentials of the same name are found, credentials found by\nLoadCredential=\n,\nLoadCredentialEncrypted=\nand\nImportCredential=\ntake priority over credentials found by\nSetCredential=\n. As such,\nSetCredential=\nwill act as default if\nno credentials are found by any of the former. In this case, not being able to retrieve the credential\nfrom the path specified in\nLoadCredential=\nor\nLoadCredentialEncrypted=\nis not considered fatal.\nAdded in version 247.\nSystem V Compatibility\nÂ¶\nUtmpIdentifier=\nÂ¶\nTakes a four character identifier string for an\nutmp\n(5)\nand wtmp entry\nfor this service. This should only be set for services such as\ngetty\nimplementations (such\nas\nagetty\n(8)\n) where utmp/wtmp\nentries must be created and cleared before and after execution, or for services that shall be executed as if\nthey were run by a\ngetty\nprocess (see below). If the configured string is longer than four\ncharacters, it is truncated and the terminal four characters are used. This setting interprets %I style string\nreplacements. This setting is unset by default, i.e. no utmp/wtmp entries are created or cleaned up for this\nservice.\nUtmpMode=\nÂ¶\nTakes one of \"\ninit\n\", \"\nlogin\n\" or \"\nuser\n\". If\nUtmpIdentifier=\nis set, controls which type of\nutmp\n(5)\n/wtmp entries\nfor this service are generated. This setting has no effect unless\nUtmpIdentifier=\nis set\ntoo. If \"\ninit\n\" is set, only an\nINIT_PROCESS\nentry is generated and the\ninvoked process must implement a\ngetty\n-compatible utmp/wtmp logic. If\n\"\nlogin\n\" is set, first an\nINIT_PROCESS\nentry, followed by a\nLOGIN_PROCESS\nentry is generated. In this case, the invoked process must implement a\nlogin\n(1)\n-compatible\nutmp/wtmp logic. If \"\nuser\n\" is set, first an\nINIT_PROCESS\nentry, then a\nLOGIN_PROCESS\nentry and finally a\nUSER_PROCESS\nentry is\ngenerated. In this case, the invoked process may be any process that is suitable to be run as session\nleader. Defaults to \"\ninit\n\".\nAdded in version 225.\nEnvironment Variables in Spawned Processes\nÂ¶\nProcesses started by the service manager are executed with an environment variable block assembled from\nmultiple sources. Processes started by the system service manager generally do not inherit environment variables\nset for the service manager itself (but this may be altered via\nPassEnvironment=\n), but processes\nstarted by the user service manager instances generally do inherit all environment variables set for the service\nmanager itself.\nFor each invoked process the list of environment variables set is compiled from the following sources:\nVariables globally configured for the service manager, using the\nDefaultEnvironment=\nsetting in\nsystemd-system.conf\n(5)\n,\nthe kernel command line option\nsystemd.setenv=\nunderstood by\nsystemd\n(1)\n, or via\nsystemctl\n(1)\nset-environment\nverb.\nVariables defined by the service manager itself (see the list below).\nVariables set in the service manager's own environment variable block (subject to\nPassEnvironment=\nfor the system service manager).\nVariables set via\nEnvironment=\nin the unit file.\nVariables read from files specified via\nEnvironmentFile=\nin the unit\nfile.\nVariables set by any PAM modules in case\nPAMName=\nis in effect,\ncf.Â\npam_env\n(8)\n.\nIf the same environment variable is set by multiple of these sources, the later source â according\nto the order of the list above â wins. Note that as the final step all variables listed in\nUnsetEnvironment=\nare removed from the compiled environment variable list, immediately\nbefore it is passed to the executed process.\nThe general philosophy is to expose a small curated list of environment variables to processes.\nServices started by the system manager (PID 1) will be started, without additional service-specific\nconfiguration, with just a few environment variables. The user manager inherits environment variables as\nany other system service, but in addition may receive additional environment variables from PAM, and,\ntypically, additional imported variables when the user starts a graphical session. It is recommended to\nkeep the environment blocks in both the system and user managers lean. Importing all variables\ninherited by the graphical session or by one of the user shells is strongly discouraged.\nHint:\nsystemd-run -P env\nand\nsystemd-run --user -P env\nprint\nthe effective system and user service environment blocks.\nEnvironment Variables Set or Propagated by the Service Manager\nÂ¶\nThe following environment variables are propagated by the service manager or generated internally\nfor each invoked process:\n$PATH\nÂ¶\nColon-separated list of directories to use when launching\nexecutables.\nsystemd\nuses a fixed value of\n\"\n/usr/local/sbin\n:\n/usr/local/bin\n:\n/usr/sbin\n:\n/usr/bin\n\"\nin the system manager. In case of the user manager, a different path may be configured by the\ndistribution. It is recommended to not rely on the order of entries, and have only one program\nwith a given name in\n$PATH\n.\nAdded in version 208.\n$LANG\nÂ¶\nLocale. Can be set in\nlocale.conf\n(5)\nor on the kernel command line (see\nsystemd\n(1)\nand\nkernel-command-line\n(7)\n).\nAdded in version 208.\n$USER\n,\n$LOGNAME\n,\n$HOME\n,\n$SHELL\nÂ¶\nUser name (twice), home directory, and the login shell.\n$USER\nis\nset unconditionally, while\n$HOME\n,\n$LOGNAME\n, and\n$SHELL\nare only set for the units that have\nUser=\nset and\nSetLoginEnvironment=\nunset or set to true. For user services, these variables are typically inherited from the user manager itself. See\npasswd\n(5)\n.\nAdded in version 208.\n$INVOCATION_ID\nÂ¶\nContains a randomized, unique 128-bit ID identifying each runtime cycle of the unit, formatted\nas 32 character hexadecimal string. A new ID is assigned each time the unit changes from an inactive state into\nan activating or active state, and may be used to identify this specific runtime cycle, in particular in data\nstored offline, such as the journal. The same ID is passed to all processes run as part of the\nunit.\nAdded in version 232.\n$XDG_RUNTIME_DIR\nÂ¶\nThe directory to use for runtime objects (such as IPC objects) and volatile state. Set for all\nservices run by the user\nsystemd\ninstance, as well as any system services that use\nPAMName=\nwith a PAM stack that includes\npam_systemd\n. See below and\npam_systemd\n(8)\nfor more\ninformation.\nAdded in version 208.\n$RUNTIME_DIRECTORY\n,\n$STATE_DIRECTORY\n,\n$CACHE_DIRECTORY\n,\n$LOGS_DIRECTORY\n,\n$CONFIGURATION_DIRECTORY\nÂ¶\nAbsolute paths to the directories defined with\nRuntimeDirectory=\n,\nStateDirectory=\n,\nCacheDirectory=\n,\nLogsDirectory=\n, and\nConfigurationDirectory=\nwhen those settings are used.\nAdded in version 244.\n$CREDENTIALS_DIRECTORY\nÂ¶\nAn absolute path to the per-unit directory with credentials configured via\nImportCredential=\n/\nLoadCredential=\n/\nSetCredential=\n.\nThe directory is marked read-only and is placed in unswappable memory (if supported and permitted),\nand is only accessible to the UID associated with the unit via\nUser=\nor\nDynamicUser=\n(and the superuser).\nAdded in version 247.\n$TMPDIR\nÂ¶\nThe environment variable is set to \"\n/tmp\n\" when\nPrivateTmp=disconnected\nspecified with\nDefaultDependencies=no\nand without\nRootDirectory=/RootImage=\nand\nRequiresMountsFor=/WantsMountsFor=\nfor\n/var/\n.\nSee explanation for\nPrivateTmp=\nabove.\nAdded in version 258.\n$MAINPID\nÂ¶\nThe UNIX process ID (PID) of the unit's main process if it is known. This is only\nset for control processes as invoked by\nExecReload=\nand similar.\nAdded in version 209.\n$MAINPIDFDID\nÂ¶\nThe 64bit inode ID of the file descriptor returned by\npidfd_open\n(3)\nfor the main process (if supported). This is only set for control processes as invoked by\nExecReload=\nand similar.\nAdded in version 258.\n$MANAGERPID\nÂ¶\nThe PID of the per-user\nsystemd\nservice manager instance, set\nfor processes spawned by it.\nAdded in version 208.\n$MANAGERPIDFDID\nÂ¶\nThe\npidfd_open()\ninode ID (see above) of the per-user\nsystemd\nservice manager instance, set for processes spawned by it.\nAdded in version 258.\n$LISTEN_FDS\n,\n$LISTEN_PID\n,\n$LISTEN_FDNAMES\nÂ¶\nInformation about file descriptors passed to a\nservice for socket activation. See\nsd_listen_fds\n(3)\n.\nAdded in version 208.\n$NOTIFY_SOCKET\nÂ¶\nThe socket\nsd_notify()\ntalks to. See\nsd_notify\n(3)\n.\nAdded in version 229.\n$WATCHDOG_PID\n,\n$WATCHDOG_USEC\nÂ¶\nInformation about watchdog keep-alive notifications. See\nsd_watchdog_enabled\n(3)\n.\nAdded in version 229.\n$SYSTEMD_EXEC_PID\nÂ¶\nThe PID of the unit process (e.g. process invoked by\nExecStart=\n). The child process can use this information to determine\nwhether the process is directly invoked by the service manager or indirectly as a child of\nanother process by comparing this value with the current PID (similarly to the scheme used in\nsd_listen_fds\n(3)\nwith\n$LISTEN_PID\nand\n$LISTEN_FDS\n).\nAdded in version 248.\n$TERM\nÂ¶\nTerminal type, set only for units connected to\na terminal (\nStandardInput=tty\n,\nStandardOutput=tty\n, or\nStandardError=tty\n). See\ntermcap\n(5)\n.\nAdded in version 209.\n$LOG_NAMESPACE\nÂ¶\nContains the name of the selected logging namespace when the\nLogNamespace=\nservice setting is used.\nAdded in version 246.\n$JOURNAL_STREAM\nÂ¶\nIf the standard output or standard error output of the executed processes are connected to the\njournal (for example, by setting\nStandardError=journal\n)\n$JOURNAL_STREAM\ncontains the device and inode numbers of the connection file descriptor, formatted in decimal, separated by a\ncolon (\"\n:\n\"). This permits invoked processes to safely detect whether their standard output or\nstandard error output are connected to the journal. The device and inode numbers of the file descriptors should\nbe compared with the values set in the environment variable to determine whether the process output is still\nconnected to the journal. Note that it is generally not sufficient to only check whether\n$JOURNAL_STREAM\nis set at all as services might invoke external processes replacing their\nstandard output or standard error output, without unsetting the environment variable.\nIf both standard output and standard error of the executed processes are connected to the journal via a\nstream socket, this environment variable will contain information about the standard error stream, as that's\nusually the preferred destination for log data. (Note that typically the same stream is used for both standard\noutput and standard error, hence very likely the environment variable contains device and inode information\nmatching both stream file descriptors.)\nThis environment variable is primarily useful to allow services to optionally upgrade their used log\nprotocol to the native journal protocol (using\nsd_journal_print\n(3)\nand other\nfunctions) if their standard output or standard error output is connected to the journal anyway, thus enabling\ndelivery of structured metadata along with logged messages.\nAdded in version 231.\n$SERVICE_RESULT\nÂ¶\nOnly used for the service unit type. This environment variable is passed to all\nExecStop=\nand\nExecStopPost=\nprocesses, and encodes the service\n\"result\". Currently, the following values are defined:\nTableÂ 6.Â Defined\n$SERVICE_RESULT\nvalues\nValue\nMeaning\n\"\nsuccess\n\"\nThe service ran successfully and exited cleanly.\n\"\nprotocol\n\"\nA protocol violation occurred: the service did not take the steps required by its unit configuration (specifically what is configured in its\nType=\nsetting).\n\"\ntimeout\n\"\nOne of the steps timed out.\n\"\nexit-code\n\"\nService process exited with a non-zero exit code; see\n$EXIT_CODE\nbelow for the actual exit code returned.\n\"\nsignal\n\"\nA service process was terminated abnormally by a signal, without dumping core. See\n$EXIT_CODE\nbelow for the actual signal causing the termination.\n\"\ncore-dump\n\"\nA service process terminated abnormally with a signal and dumped core. See\n$EXIT_CODE\nbelow for the signal causing the termination.\n\"\nwatchdog\n\"\nWatchdog keep-alive ping was enabled for the service, but the deadline was missed.\n\"\nexec-condition\n\"\nService did not run because\nExecCondition=\nfailed.\n\"\noom-kill\n\"\nA service process was terminated by the Out-Of-Memory (OOM) killer.\n\"\nstart-limit-hit\n\"\nA start limit was defined for the unit and it was hit, causing the unit to fail to start. See\nsystemd.unit\n(5)\n's\nStartLimitIntervalSec=\nand\nStartLimitBurst=\nfor details.\n\"\nresources\n\"\nA catch-all condition in case a system operation failed.\nThis environment variable is useful to monitor failure or successful termination of a service. Even\nthough this variable is available in both\nExecStop=\nand\nExecStopPost=\n, it\nis usually a better choice to place monitoring tools in the latter, as the former is only invoked for services\nthat managed to start up correctly, and the latter covers both services that failed during their start-up and\nthose which failed during their runtime.\nAdded in version 232.\n$EXIT_CODE\n,\n$EXIT_STATUS\nÂ¶\nOnly defined for the service unit type. These environment variables are passed to all\nExecStop=\n,\nExecStopPost=\nprocesses and contain exit status/code\ninformation of the main process of the service. For the precise definition of the exit code and status, see\nwait\n(2)\n.\n$EXIT_CODE\nis one of \"\nexited\n\", \"\nkilled\n\",\n\"\ndumped\n\".\n$EXIT_STATUS\ncontains the numeric exit code formatted as string\nif\n$EXIT_CODE\nis \"\nexited\n\", and the signal name in all other cases. Note\nthat these environment variables are only set if the service manager succeeded to start and identify the main\nprocess of the service.\nTableÂ 7.Â Summary of possible service result variable values\n$SERVICE_RESULT\n$EXIT_CODE\n$EXIT_STATUS\n\"\nsuccess\n\"\n\"\nkilled\n\"\n\"\nHUP\n\", \"\nINT\n\", \"\nTERM\n\", \"\nPIPE\n\"\n\"\nexited\n\"\n\"\n0\n\"\n\"\nprotocol\n\"\nnot set\nnot set\n\"\nexited\n\"\n\"\n0\n\"\n\"\ntimeout\n\"\n\"\nkilled\n\"\n\"\nTERM\n\", \"\nKILL\n\"\n\"\nexited\n\"\n\"\n0\n\", \"\n1\n\", \"\n2\n\", \"\n3\n\", â¦, \"\n255\n\"\n\"\nexit-code\n\"\n\"\nexited\n\"\n\"\n1\n\", \"\n2\n\", \"\n3\n\", â¦, \"\n255\n\"\n\"\nsignal\n\"\n\"\nkilled\n\"\n\"\nHUP\n\", \"\nINT\n\", \"\nKILL\n\", â¦\n\"\ncore-dump\n\"\n\"\ndumped\n\"\n\"\nABRT\n\", \"\nSEGV\n\", \"\nQUIT\n\", â¦\n\"\nwatchdog\n\"\n\"\ndumped\n\"\n\"\nABRT\n\"\n\"\nkilled\n\"\n\"\nTERM\n\", \"\nKILL\n\"\n\"\nexited\n\"\n\"\n0\n\", \"\n1\n\", \"\n2\n\", \"\n3\n\", â¦, \"\n255\n\"\n\"\nexec-condition\n\"\n\"\nexited\n\"\n\"\n1\n\", \"\n2\n\", \"\n3\n\", \"\n4\n\", â¦, \"\n254\n\"\n\"\noom-kill\n\"\n\"\nkilled\n\"\n\"\nTERM\n\", \"\nKILL\n\"\n\"\nstart-limit-hit\n\"\nnot set\nnot set\n\"\nresources\n\"\nany of the above\nany of the above\nNote: the process may be also terminated by a signal not sent by systemd. In particular the process may send an arbitrary signal to itself in a handler for any of the non-maskable signals. Nevertheless, in the \"\ntimeout\n\" and \"\nwatchdog\n\" rows above only the signals that systemd sends have been included. Moreover, using\nSuccessExitStatus=\nadditional exit statuses may be declared to indicate clean termination, which is not reflected by this table.\nAdded in version 232.\n$MONITOR_SERVICE_RESULT\n,\n$MONITOR_EXIT_CODE\n,\n$MONITOR_EXIT_STATUS\n,\n$MONITOR_INVOCATION_ID\n,\n$MONITOR_UNIT\nÂ¶\nOnly defined for the service unit type. Those environment variables are passed to\nall\nExecStart=\nand\nExecStartPre=\nprocesses which run in\nservices triggered by\nOnFailure=\nor\nOnSuccess=\ndependencies.\nVariables\n$MONITOR_SERVICE_RESULT\n,\n$MONITOR_EXIT_CODE\nand\n$MONITOR_EXIT_STATUS\ntake the same values as for\nExecStop=\nand\nExecStopPost=\nprocesses. Variables\n$MONITOR_INVOCATION_ID\nand\n$MONITOR_UNIT\nare set to the\ninvocation id and unit name of the service which triggered the dependency.\nNote that when multiple services specify the same unit as their\nOnFailure=\nor\nOnSuccess=\nhandler, those variables will\nnot\nbe passed. Consider using a template handler unit for that case instead:\n\"\nOnFailure=\nhandler\n@%n.service\n\" for non-templated units,\nor \"\nOnFailure=\nhandler\n@%p-%i.service\n\" for templated\nunits.\nAdded in version 251.\n$PIDFILE\nÂ¶\nThe path to the configured PID file, in case the process is forked off on behalf of\na service that uses the\nPIDFile=\nsetting, see\nsystemd.service\n(5)\nfor details. Service code may use this environment variable to automatically generate a PID file at\nthe location configured in the unit file. This field is set to an absolute path in the file\nsystem.\nAdded in version 242.\n$REMOTE_ADDR\n,\n$REMOTE_PORT\nÂ¶\nIf this is a unit started via per-connection socket activation (i.e. via a socket\nunit with\nAccept=yes\n), these environment variables contain information about the\nremote peer of the socket connection.\nFor IPv4 and IPv6 connections,\n$REMOTE_ADDR\ncontains the IP address, and\n$REMOTE_PORT\ncontains the port number of the remote peer.\nFor\nAF_UNIX\nsocket connections,\n$REMOTE_ADDR\ncontains\neither the remote socket's file system path starting with a slash (\"\n/\n\"), its\naddress in the abstract namespace starting with an at symbol (\"\n@\n\"), or is unset\nin case of an unnamed socket.\n$REMOTE_PORT\nis not set for\nAF_UNIX\nsockets.\nAdded in version 220.\n$SO_COOKIE\nÂ¶\nIf this is a unit started via per-connection socket activation (i.e. via a socket\nunit with\nAccept=yes\n), this environment variable contains the Linux socket\ncookie, formatted as decimal integer. The socket cookie can otherwise be acquired via\ngetsockopt\n(7)\n.\nAdded in version 258.\n$TRIGGER_UNIT\n,\n$TRIGGER_PATH\n,\n$TRIGGER_TIMER_REALTIME_USEC\n,\n$TRIGGER_TIMER_MONOTONIC_USEC\nÂ¶\nIf the unit was activated dynamically (e.g.: a corresponding path unit or timer unit), the\nunit that triggered it and other type-dependent information will be passed via these variables. Note that\nthis information is provided in a best-effort way. For example, multiple triggers happening one after\nanother will be coalesced and only one will be reported, with no guarantee as to which one it will be.\nBecause of this, in most cases this variable will be primarily informational, i.e. useful for debugging\npurposes, is lossy, and should not be relied upon to propagate a comprehensive reason for activation.\nAdded in version 252.\n$MEMORY_PRESSURE_WATCH\n,\n$MEMORY_PRESSURE_WRITE\nÂ¶\nIf memory pressure monitoring is enabled for this service unit, the path to watch\nand the data to write into it. See\nMemory Pressure\nHandling\nfor details about these variables and the service protocol data they\nconvey.\nAdded in version 254.\n$FDSTORE\nÂ¶\nThe maximum number of file descriptors that may be stored in the manager for the\nservice. This variable is set when the file descriptor store is enabled for the service, i.e.\nFileDescriptorStoreMax=\nis set to a non-zero value (see\nsystemd.service\n(5)\nfor details). Applications may check this environment variable before sending file descriptors to\nthe service manager via\nsd_pid_notify_with_fds\n(3)\n.\nAdded in version 254.\n$DEBUG_INVOCATION\nÂ¶\nIf\nRestartMode=debug\nis set, and a previous attempt at starting\nthe unit failed, this variable will be passed to the service to indicate that additional logging\nshould be enabled at startup. See\nsystemd.service\n(5)\nfor more details.\nAdded in version 257.\nFor system services, when\nPAMName=\nis enabled and\npam_systemd\nis part\nof the selected PAM stack, additional environment variables defined by systemd may be set for\nservices. Specifically, these are\n$XDG_SEAT\n,\n$XDG_VTNR\n, see\npam_systemd\n(8)\nfor details.\nProcess Exit Codes\nÂ¶\nWhen invoking a unit process the service manager possibly fails to apply the execution parameters configured\nwith the settings above. In that case the already created service process will exit with a non-zero exit code\nbefore the configured command line is executed. (Or in other words, the child process possibly exits with these\nerror codes, after having been created by the\nfork\n(2)\nsystem call, but\nbefore the matching\nexecve\n(2)\nsystem call is\ncalled.) Specifically, exit codes defined by the C library, by the LSB specification and by the systemd service\nmanager itself are used.\nThe following basic service exit codes are defined by the C library.\nTableÂ 8.Â Basic C library exit codes\nExit Code\nSymbolic Name\nDescription\n0\nEXIT_SUCCESS\nGeneric success code.\n1\nEXIT_FAILURE\nGeneric failure or unspecified error.\nThe following service exit codes are defined by the\nLSB specification\n.\nTableÂ 9.Â LSB service exit codes\nExit Code\nSymbolic Name\nDescription\n2\nEXIT_INVALIDARGUMENT\nInvalid or excess arguments.\n3\nEXIT_NOTIMPLEMENTED\nUnimplemented feature.\n4\nEXIT_NOPERMISSION\nThe user has insufficient privileges.\n5\nEXIT_NOTINSTALLED\nThe program is not installed.\n6\nEXIT_NOTCONFIGURED\nThe program is not configured.\n7\nEXIT_NOTRUNNING\nThe program is not running.\nThe LSB specification suggests that error codes 200 and above are reserved for implementations. Some of them are\nused by the service manager to indicate problems during process invocation:\nTableÂ 10.Â systemd-specific exit codes\nExit Code\nSymbolic Name\nDescription\n200\nEXIT_CHDIR\nChanging to the requested working directory failed. See\nWorkingDirectory=\nabove.\n201\nEXIT_NICE\nFailed to set up process scheduling priority (nice level). See\nNice=\nabove.\n202\nEXIT_FDS\nFailed to close unwanted file descriptors, or to adjust passed file descriptors.\n203\nEXIT_EXEC\nThe actual process execution failed (specifically, the\nexecve\n(2)\nsystem call). Most likely this is caused by a missing or non-accessible executable file.\n204\nEXIT_MEMORY\nFailed to perform an action due to memory shortage.\n205\nEXIT_LIMITS\nFailed to adjust resource limits. See\nLimitCPU=\nand related settings above.\n206\nEXIT_OOM_ADJUST\nFailed to adjust the OOM setting. See\nOOMScoreAdjust=\nabove.\n207\nEXIT_SIGNAL_MASK\nFailed to set process signal mask.\n208\nEXIT_STDIN\nFailed to set up standard input. See\nStandardInput=\nabove.\n209\nEXIT_STDOUT\nFailed to set up standard output. See\nStandardOutput=\nabove.\n210\nEXIT_CHROOT\nFailed to change root directory (\nchroot\n(2)\n). See\nRootDirectory=\n/\nRootImage=\nabove.\n211\nEXIT_IOPRIO\nFailed to set up IO scheduling priority. See\nIOSchedulingClass=\n/\nIOSchedulingPriority=\nabove.\n212\nEXIT_TIMERSLACK\nFailed to set up timer slack. See\nTimerSlackNSec=\nabove.\n213\nEXIT_SECUREBITS\nFailed to set process secure bits. See\nSecureBits=\nabove.\n214\nEXIT_SETSCHEDULER\nFailed to set up CPU scheduling. See\nCPUSchedulingPolicy=\n/\nCPUSchedulingPriority=\nabove.\n215\nEXIT_CPUAFFINITY\nFailed to set up CPU affinity. See\nCPUAffinity=\nabove.\n216\nEXIT_GROUP\nFailed to determine or change group credentials. See\nGroup=\n/\nSupplementaryGroups=\nabove.\n217\nEXIT_USER\nFailed to determine or change user credentials, or to set up user namespacing. See\nUser=\n/\nPrivateUsers=\nabove.\n218\nEXIT_CAPABILITIES\nFailed to drop capabilities, or apply ambient capabilities. See\nCapabilityBoundingSet=\n/\nAmbientCapabilities=\nabove.\n219\nEXIT_CGROUP\nSetting up the service control group failed.\n220\nEXIT_SETSID\nFailed to create new process session.\n221\nEXIT_CONFIRM\nExecution has been cancelled by the user. See the\nsystemd.confirm_spawn=\nkernel command line setting on\nkernel-command-line\n(7)\nfor details.\n222\nEXIT_STDERR\nFailed to set up standard error output. See\nStandardError=\nabove.\n224\nEXIT_PAM\nFailed to set up PAM session. See\nPAMName=\nabove.\n225\nEXIT_NETWORK\nFailed to set up network namespacing. See\nPrivateNetwork=\nabove.\n226\nEXIT_NAMESPACE\nFailed to set up mount, UTS, or IPC namespacing. See\nReadOnlyPaths=\n,\nProtectHostname=\n,\nPrivateIPC=\n, and related settings above.\n227\nEXIT_NO_NEW_PRIVILEGES\nFailed to disable new privileges. See\nNoNewPrivileges=yes\nabove.\n228\nEXIT_SECCOMP\nFailed to apply system call filters. See\nSystemCallFilter=\nand related settings above.\n229\nEXIT_SELINUX_CONTEXT\nDetermining or changing SELinux context failed. See\nSELinuxContext=\nabove.\n230\nEXIT_PERSONALITY\nFailed to set up an execution domain (personality). See\nPersonality=\nabove.\n231\nEXIT_APPARMOR_PROFILE\nFailed to prepare changing AppArmor profile. See\nAppArmorProfile=\nabove.\n232\nEXIT_ADDRESS_FAMILIES\nFailed to restrict address families. See\nRestrictAddressFamilies=\nabove.\n233\nEXIT_RUNTIME_DIRECTORY\nSetting up runtime directory failed. See\nRuntimeDirectory=\nand related settings above.\n235\nEXIT_CHOWN\nFailed to adjust socket ownership. Used for socket units only.\n236\nEXIT_SMACK_PROCESS_LABEL\nFailed to set SMACK label. See\nSmackProcessLabel=\nabove.\n237\nEXIT_KEYRING\nFailed to set up kernel keyring.\n238\nEXIT_STATE_DIRECTORY\nFailed to set up unit's state directory. See\nStateDirectory=\nabove.\n239\nEXIT_CACHE_DIRECTORY\nFailed to set up unit's cache directory. See\nCacheDirectory=\nabove.\n240\nEXIT_LOGS_DIRECTORY\nFailed to set up unit's logging directory. See\nLogsDirectory=\nabove.\n241\nEXIT_CONFIGURATION_DIRECTORY\nFailed to set up unit's configuration directory. See\nConfigurationDirectory=\nabove.\n242\nEXIT_NUMA_POLICY\nFailed to set up unit's NUMA memory policy. See\nNUMAPolicy=\nand\nNUMAMask=\nabove.\n243\nEXIT_CREDENTIALS\nFailed to set up unit's credentials. See\nImportCredential=\n,\nLoadCredential=\nand\nSetCredential=\nabove.\n245\nEXIT_BPF\nFailed to apply BPF restrictions. See\nRestrictFileSystems=\nabove.\nFinally, the BSD operating systems define a set of exit codes, typically defined on Linux systems too:\nTableÂ 11.Â BSD exit codes\nExit Code\nSymbolic Name\nDescription\n64\nEX_USAGE\nCommand line usage error\n65\nEX_DATAERR\nData format error\n66\nEX_NOINPUT\nCannot open input\n67\nEX_NOUSER\nAddressee unknown\n68\nEX_NOHOST\nHost name unknown\n69\nEX_UNAVAILABLE\nService unavailable\n70\nEX_SOFTWARE\ninternal software error\n71\nEX_OSERR\nSystem error (e.g., cannot fork)\n72\nEX_OSFILE\nCritical OS file missing\n73\nEX_CANTCREAT\nCannot create (user) output file\n74\nEX_IOERR\nInput/output error\n75\nEX_TEMPFAIL\nTemporary failure; user is invited to retry\n76\nEX_PROTOCOL\nRemote error in protocol\n77\nEX_NOPERM\nPermission denied\n78\nEX_CONFIG\nConfiguration error\nExamples\nÂ¶\nExampleÂ 3.Â\n$MONITOR_\n*\nusage\nA service\nmyfailer.service\nwhich can trigger an\nOnFailure=\ndependency.\n[Unit]\nDescription=Service which can trigger an OnFailure= dependency\nOnFailure=myhandler.service\n[Service]\nExecStart=/bin/myprogram\nA service\nmysuccess.service\nwhich can trigger an\nOnSuccess=\ndependency.\n[Unit]\nDescription=Service which can trigger an OnSuccess= dependency\nOnSuccess=myhandler.service\n[Service]\nExecStart=/bin/mysecondprogram\nA service\nmyhandler.service\nwhich can be triggered\nby any of the above services.\n[Unit]\nDescription=Acts on service failing or succeeding\n[Service]\nExecStart=/bin/bash -c \"echo $MONITOR_SERVICE_RESULT $MONITOR_EXIT_CODE $MONITOR_EXIT_STATUS $MONITOR_INVOCATION_ID $MONITOR_UNIT\"\nIf\nmyfailer.service\nwere to run and exit in failure,\nthen\nmyhandler.service\nwould be triggered and the\nmonitor variables would be set as follows:\nMONITOR_SERVICE_RESULT=exit-code\nMONITOR_EXIT_CODE=exited\nMONITOR_EXIT_STATUS=1\nMONITOR_INVOCATION_ID=cc8fdc149b2b4ca698d4f259f4054236\nMONITOR_UNIT=myfailer.service\nIf\nmysuccess.service\nwere to run and exit in success,\nthen\nmyhandler.service\nwould be triggered and the\nmonitor variables would be set as follows:\nMONITOR_SERVICE_RESULT=success\nMONITOR_EXIT_CODE=exited\nMONITOR_EXIT_STATUS=0\nMONITOR_INVOCATION_ID=6ab9af147b8c4a3ebe36e7a5f8611697\nMONITOR_UNIT=mysuccess.service\nSee Also\nÂ¶\nsystemd\n(1)\n,\nsystemctl\n(1)\n,\nsystemd-analyze\n(1)\n,\njournalctl\n(1)\n,\nsystemd-system.conf\n(5)\n,\nsystemd.unit\n(5)\n,\nsystemd.service\n(5)\n,\nsystemd.socket\n(5)\n,\nsystemd.swap\n(5)\n,\nsystemd.mount\n(5)\n,\nsystemd.kill\n(5)\n,\nsystemd.resource-control\n(5)\n,\nsystemd.time\n(7)\n,\nsystemd.directives\n(7)\n,\ntmpfiles.d\n(5)\n,\nexec\n(3)\n,\nfork\n(2)", "metadata": {"source_type": "vendor_docs", "trust": "vendor_docs", "os": "linux", "distro": "ubuntu-22.04", "license": "CC BY-SA (assumed; verify per site)", "attribution_url": "https://www.freedesktop.org/software/systemd/man/latest/systemd.exec.html"}}
{"text": "systemd.resource-control\nIndex\nÂ·\nDirectives\nsystemd 258\nName\nsystemd.resource-control â Resource control unit settings\nSynopsis\nslice\n.slice\n,\nscope\n.scope\n,\nservice\n.service\n,\nsocket\n.socket\n,\nmount\n.mount\n,\nswap\n.swap\nDescription\nÂ¶\nUnit configuration files for services, slices, scopes, sockets, mount points, and swap devices share a subset\nof configuration options for resource control of spawned processes. Internally, this relies on the Linux Control\nGroups (cgroups) kernel concept for organizing processes in a hierarchical tree of named groups for the purpose of\nresource management.\nThis man page lists the configuration options shared by\nthose six unit types. See\nsystemd.unit\n(5)\nfor the common options of all unit configuration files, and\nsystemd.slice\n(5)\n,\nsystemd.scope\n(5)\n,\nsystemd.service\n(5)\n,\nsystemd.socket\n(5)\n,\nsystemd.mount\n(5)\n,\nand\nsystemd.swap\n(5)\nfor more information on the specific unit configuration files. The\nresource control configuration options are configured in the\n[Slice], [Scope], [Service], [Socket], [Mount], or [Swap]\nsections, depending on the unit type.\nIn addition, options which control resources available to programs\nexecuted\nby systemd are listed in\nsystemd.exec\n(5)\n.\nThose options complement options listed here.\nEnabling and disabling controllers\nÂ¶\nControllers in the cgroup hierarchy are hierarchical, and resource control is realized by\ndistributing resource assignments between siblings in branches of the cgroup hierarchy. There is no\nneed to explicitly\nenable\na cgroup controller for a unit.\nsystemd\nwill instruct the kernel to enable a controller for a given unit when this\nunit has configuration for a given controller. For example, when\nCPUWeight=\nis set,\nthe\ncpu\ncontroller will be enabled, and when\nTasksMax=\nare set, the\npids\ncontroller will be enabled. In addition, various controllers may be also be\nenabled explicitly via the\nMemoryAccounting=\n/\nTasksAccounting=\n/\nIOAccounting=\nsettings. Because of how the cgroup hierarchy works, controllers will be automatically enabled for all\nparent units and for any sibling units starting with the lowest level at which a controller is enabled.\nUnits for which a controller is enabled may be subject to resource control even if they do not have any\nexplicit configuration.\nSetting\nDelegate=\nenables any delegated controllers for that unit (see below).\nThe delegatee may then enable controllers for its children as appropriate. In particular, if the\ndelegatee is\nsystemd\n(in the\nuser@.service\nunit), it will\nrepeat the same logic as the system instance and enable controllers for user units which have resource\nlimits configured, and their siblings and parents and parents' siblings.\nControllers may be\ndisabled\nfor parts of the cgroup hierarchy with\nDisableControllers=\n(see below).\nExampleÂ 1.Â Enabling and disabling controllers\n-.slice\n/       \\\n/-----/         \\--------------\\\n/                                \\\nsystem.slice                       user.slice\n/       \\                          /      \\\n/         \\                        /        \\\n/           \\              user@42.service  user@1000.service\n/             \\             Delegate=        Delegate=yes\na.service       b.slice                             /        \\\nCPUWeight=20   DisableControllers=cpu              /          \\\n/  \\                      app.slice      session.slice\n/    \\                     CPUWeight=100  CPUWeight=100\n/      \\\nb1.service   b2.service\nCPUWeight=1000\nIn this hierarchy, the\ncpu\ncontroller is enabled for all units shown except\nb1.service\nand\nb2.service\n. Because there is no explicit\nconfiguration for\nsystem.slice\nand\nuser.slice\n, CPU\nresources will be split equally between them. Similarly, resources are allocated equally between\nchildren of\nuser.slice\nand between the child slices beneath\nuser@1000.service\n. Assuming that there is no further configuration of resources\nor delegation below slices\napp.slice\nor\nsession.slice\n, the\ncpu\ncontroller would not be enabled for units in those slices and CPU resources\nwould be further allocated using other mechanisms, e.g. based on nice levels. The manager for user\n42 has delegation enabled without any controllers, i.e. it can manipulate its subtree of the cgroup\nhierarchy, but without resource control.\nIn the slice\nsystem.slice\n, CPU resources are split 1:6 for service\na.service\n, and 5:6 for slice\nb.slice\n, because slice\nb.slice\ngets the default value of 100 for\ncpu.weight\nwhen\nCPUWeight=\nis not set.\nCPUWeight=\nsetting in service\nb2.service\nis neutralized\nby\nDisableControllers=\nin slice\nb.slice\n, so the\ncpu\ncontroller would not be enabled for services\nb1.service\nand\nb2.service\n, and CPU resources would be further allocated using other mechanisms,\ne.g. based on nice levels.\nSetting resource controls for a group of related units\nÂ¶\nAs described in\nsystemd.unit\n(5)\n, the\nsettings listed here may be set through the main file of a unit and drop-in snippets in\n*.d/\ndirectories. The list of directories searched for drop-ins\nincludes names formed by repeatedly truncating the unit name after all dashes. This is particularly\nconvenient to set resource limits for a group of units with similar names.\nFor example, every user gets their own slice\nuser-\nnnn\n.slice\n. Drop-ins with local configuration that\naffect user 1000 may be placed in\n/etc/systemd/system/user-1000.slice\n,\n/etc/systemd/system/user-1000.slice.d/*.conf\n, but also\n/etc/systemd/system/user-.slice.d/*.conf\n. This last directory\napplies to all user slices.\nÂ¶\nSee the\nNew\nControl Group Interfaces\nfor an introduction on how to make\nuse of resource control APIs from programs.\nImplicit Dependencies\nÂ¶\nThe following dependencies are implicitly added:\nUnits with the\nSlice=\nsetting set automatically acquire\nRequires=\nand\nAfter=\ndependencies on the specified\nslice unit.\nOptions\nÂ¶\nUnits of the types listed above can have settings for resource control configuration:\nCPU Control\nÂ¶\nCPUWeight=\nweight\n,\nStartupCPUWeight=\nweight\nÂ¶\nThese settings control the\ncpu\ncontroller in the unified hierarchy.\nThese options accept an integer value or the special string \"idle\":\nIf set to an integer value, assign the specified CPU time weight to the processes\nexecuted, if the unified control group hierarchy is used on the system. These options control\nthe \"\ncpu.weight\n\" control group attribute. The allowed range is 1 to 10000.\nDefaults to unset, but the kernel default is 100. For details about this control group\nattribute, see\nControl Groups\nv2\nand\nCFS\nScheduler\n. The available CPU time is split up among all units within one slice\nrelative to their CPU time weight. A higher weight means more CPU time, a lower weight means\nless.\nIf set to the special string \"idle\", mark the cgroup for \"idle scheduling\", which means\nthat it will get CPU resources only when there are no processes not marked in this way to execute in this\ncgroup or its siblings. This setting corresponds to the \"\ncpu.idle\n\" cgroup attribute.\nNote that this value only has an effect on cgroup-v2, for cgroup-v1 it is equivalent to the minimum weight.\nWhile\nStartupCPUWeight=\napplies to the startup and shutdown phases of the system,\nCPUWeight=\napplies to normal runtime of the system, and if the former is not set also to\nthe startup and shutdown phases. Using\nStartupCPUWeight=\nallows prioritizing specific services at\nboot-up and shutdown differently than during normal runtime.\nIn addition to the resource allocation performed by the\ncpu\ncontroller, the\nkernel may automatically divide resources based on session-id grouping, see \"The autogroup feature\"\nin\nsched\n(7)\n.\nThe effect of this feature is similar to the\ncpu\ncontroller with no explicit\nconfiguration, so users should be careful to not mistake one for the other.\nAdded in version 232.\nCPUQuota=\nÂ¶\nThis setting controls the\ncpu\ncontroller in the unified hierarchy.\nAssign the specified CPU time quota to the processes executed. Takes a percentage value, suffixed with\n\"%\". The percentage specifies how much CPU time the unit shall get at maximum, relative to the total CPU time\navailable on one CPU. Use values > 100% for allotting CPU time on more than one CPU. This controls the\n\"\ncpu.max\n\" attribute on the unified control group hierarchy and\n\"\ncpu.cfs_quota_us\n\" on legacy. For details about these control group attributes, see\nControl Groups v2\nand\nCFS Bandwidth Control\n.\nSetting\nCPUQuota=\nto an empty value unsets the quota.\nExample:\nCPUQuota=20%\nensures that the executed processes will never get more than\n20% CPU time on one CPU.\nAdded in version 213.\nCPUQuotaPeriodSec=\nÂ¶\nThis setting controls the\ncpu\ncontroller in the unified hierarchy.\nAssign the duration over which the CPU time quota specified by\nCPUQuota=\nis measured.\nTakes a time duration value in seconds, with an optional suffix such as \"ms\" for milliseconds (or \"s\" for seconds.)\nThe default setting is 100ms. The period is clamped to the range supported by the kernel, which is [1ms, 1000ms].\nAdditionally, the period is adjusted up so that the quota interval is also at least 1ms.\nSetting\nCPUQuotaPeriodSec=\nto an empty value resets it to the default.\nThis controls the second field of \"\ncpu.max\n\" attribute on the unified control group hierarchy\nand \"\ncpu.cfs_period_us\n\" on legacy. For details about these control group attributes, see\nControl Groups v2\nand\nCFS Scheduler\n.\nExample:\nCPUQuotaPeriodSec=10ms\nto request that the CPU quota is measured in periods of 10ms.\nAdded in version 242.\nAllowedCPUs=\n,\nStartupAllowedCPUs=\nÂ¶\nThis setting controls the\ncpuset\ncontroller in the unified hierarchy.\nRestrict processes to be executed on specific CPUs. Takes a list of CPU indices or ranges separated by either\nwhitespace or commas. CPU ranges are specified by the lower and upper CPU indices separated by a dash.\nSetting\nAllowedCPUs=\nor\nStartupAllowedCPUs=\ndoes not guarantee that all\nof the CPUs will be used by the processes as it may be limited by parent units. The effective configuration is\nreported as\nEffectiveCPUs=\n.\nWhile\nStartupAllowedCPUs=\napplies to the startup and shutdown phases of the system,\nAllowedCPUs=\napplies to normal runtime of the system, and if the former is not set also to\nthe startup and shutdown phases. Using\nStartupAllowedCPUs=\nallows prioritizing specific services at\nboot-up and shutdown differently than during normal runtime.\nThis setting is supported only with the unified control group hierarchy.\nAdded in version 244.\nMemory Accounting and Control\nÂ¶\nMemoryAccounting=\nÂ¶\nThis setting controls the\nmemory\ncontroller in the unified hierarchy.\nTurn on process and kernel memory accounting for this\nunit. Takes a boolean argument. Note that turning on memory\naccounting for one unit will also implicitly turn it on for\nall units contained in the same slice and for all its parent\nslices and the units contained therein. The system default\nfor this setting may be controlled with\nDefaultMemoryAccounting=\nin\nsystemd-system.conf\n(5)\n.\nAdded in version 208.\nMemoryMin=\nbytes\n,\nMemoryLow=\nbytes\n,\nStartupMemoryLow=\nbytes\n,\nDefaultStartupMemoryLow=\nbytes\nÂ¶\nThese settings control the\nmemory\ncontroller in the unified hierarchy.\nSpecify the memory usage protection of the executed processes in this unit.\nWhen reclaiming memory, the unit is treated as if it was using less memory resulting in memory\nto be preferentially reclaimed from unprotected units.\nUsing\nMemoryLow=\nresults in a weaker protection where memory may still\nbe reclaimed to avoid invoking the OOM killer in case there is no other reclaimable memory.\nFor a protection to be effective, it is generally required to set a corresponding\nallocation on all ancestors, which is then distributed between children\n(with the exception of the root slice).\nAny\nMemoryMin=\nor\nMemoryLow=\nallocation that is not\nexplicitly distributed to specific children is used to create a shared protection for all children.\nAs this is a shared protection, the children will freely compete for the memory.\nTakes a memory size in bytes. If the value is suffixed with K, M, G or T, the specified memory size is\nparsed as Kilobytes, Megabytes, Gigabytes, or Terabytes (with the base 1024), respectively. Alternatively, a\npercentage value may be specified, which is taken relative to the installed physical memory on the\nsystem. If assigned the special value \"\ninfinity\n\", all available memory is protected, which may be\nuseful in order to always inherit all of the protection afforded by ancestors.\nThis controls the \"\nmemory.min\n\" or \"\nmemory.low\n\" control group attribute.\nFor details about this control group attribute, see\nMemory Interface Files\n.\nUnits may have their children use a default \"\nmemory.min\n\" or\n\"\nmemory.low\n\" value by specifying\nDefaultMemoryMin=\nor\nDefaultMemoryLow=\n, which has the same semantics as\nMemoryMin=\nand\nMemoryLow=\n, or\nDefaultStartupMemoryLow=\nwhich has the same semantics as\nStartupMemoryLow=\n.\nThis setting does not affect \"\nmemory.min\n\" or \"\nmemory.low\n\"\nin the unit itself.\nUsing it to set a default child allocation is only useful on kernels older than 5.7,\nwhich do not support the \"\nmemory_recursiveprot\n\" cgroup2 mount option.\nWhile\nStartupMemoryLow=\napplies to the startup and shutdown phases of the system,\nMemoryMin=\napplies to normal runtime of the system, and if the former is not set also to\nthe startup and shutdown phases. Using\nStartupMemoryLow=\nallows prioritizing specific services at\nboot-up and shutdown differently than during normal runtime.\nAdded in version 240.\nMemoryHigh=\nbytes\n,\nStartupMemoryHigh=\nbytes\nÂ¶\nThese settings control the\nmemory\ncontroller in the unified hierarchy.\nSpecify the throttling limit on memory usage of the executed processes in this unit. Memory usage may go\nabove the limit if unavoidable, but the processes are heavily slowed down and memory is taken away\naggressively in such cases. This is the main mechanism to control memory usage of a unit.\nTakes a memory size in bytes. If the value is suffixed with K, M, G or T, the specified memory size is\nparsed as Kilobytes, Megabytes, Gigabytes, or Terabytes (with the base 1024), respectively. Alternatively, a\npercentage value may be specified, which is taken relative to the installed physical memory on the\nsystem. If assigned the\nspecial value \"\ninfinity\n\", no memory throttling is applied. This controls the\n\"\nmemory.high\n\" control group attribute. For details about this control group attribute, see\nMemory Interface Files\n.\nThe effective configuration is reported as\nEffectiveMemoryHigh=\n(see also\nEffectiveMemoryMax=\n).\nWhile\nStartupMemoryHigh=\napplies to the startup and shutdown phases of the system,\nMemoryHigh=\napplies to normal runtime of the system, and if the former is not set also to\nthe startup and shutdown phases. Using\nStartupMemoryHigh=\nallows prioritizing specific services at\nboot-up and shutdown differently than during normal runtime.\nAdded in version 231.\nMemoryMax=\nbytes\n,\nStartupMemoryMax=\nbytes\nÂ¶\nThese settings control the\nmemory\ncontroller in the unified hierarchy.\nSpecify the absolute limit on memory usage of the executed processes in this unit. If memory usage\ncannot be contained under the limit, out-of-memory killer is invoked inside the unit. It is recommended to\nuse\nMemoryHigh=\nas the main control mechanism and use\nMemoryMax=\nas the\nlast line of defense.\nTakes a memory size in bytes. If the value is suffixed with K, M, G or T, the specified memory size is\nparsed as Kilobytes, Megabytes, Gigabytes, or Terabytes (with the base 1024), respectively. Alternatively, a\npercentage value may be specified, which is taken relative to the installed physical memory on the system. If\nassigned the special value \"\ninfinity\n\", no memory limit is applied. This controls the\n\"\nmemory.max\n\" control group attribute. For details about this control group attribute, see\nMemory Interface Files\n.\nThe effective configuration is reported as\nEffectiveMemoryMax=\n(the value is\nthe most stringent limit of the unit and parent slices and it is capped by physical memory).\nWhile\nStartupMemoryMax=\napplies to the startup and shutdown phases of the system,\nMemoryMax=\napplies to normal runtime of the system, and if the former is not set also to\nthe startup and shutdown phases. Using\nStartupMemoryMax=\nallows prioritizing specific services at\nboot-up and shutdown differently than during normal runtime.\nAdded in version 231.\nMemorySwapMax=\nbytes\n,\nStartupMemorySwapMax=\nbytes\nÂ¶\nThese settings control the\nmemory\ncontroller in the unified hierarchy.\nSpecify the absolute limit on swap usage of the executed processes in this unit.\nTakes a swap size in bytes. If the value is suffixed with K, M, G or T, the specified swap size is\nparsed as Kilobytes, Megabytes, Gigabytes, or Terabytes (with the base 1024), respectively. Alternatively, a\npercentage value may be specified, which is taken relative to the specified swap size on the system. If assigned the\nspecial value \"\ninfinity\n\", no swap limit is applied. These settings control the\n\"\nmemory.swap.max\n\" control group attribute. For details about this control group attribute,\nsee\nMemory Interface Files\n.\nWhile\nStartupMemorySwapMax=\napplies to the startup and shutdown phases of the system,\nMemorySwapMax=\napplies to normal runtime of the system, and if the former is not set also to\nthe startup and shutdown phases. Using\nStartupMemorySwapMax=\nallows prioritizing specific services at\nboot-up and shutdown differently than during normal runtime.\nAdded in version 232.\nMemoryZSwapMax=\nbytes\n,\nStartupMemoryZSwapMax=\nbytes\nÂ¶\nThese settings control the\nmemory\ncontroller in the unified hierarchy.\nSpecify the absolute limit on zswap usage of the processes in this unit. Zswap is a lightweight compressed\ncache for swap pages. It takes pages that are in the process of being swapped out and attempts to compress them into a\ndynamically allocated RAM-based memory pool. If the limit specified is hit, no entries from this unit will be\nstored in the pool until existing entries are faulted back or written out to disk. See the kernel's\nZswap\ndocumentation for more details.\nTakes a size in bytes. If the value is suffixed with K, M, G or T, the specified size is\nparsed as Kilobytes, Megabytes, Gigabytes, or Terabytes (with the base 1024), respectively. If assigned the\nspecial value \"\ninfinity\n\", no limit is applied. These settings control the\n\"\nmemory.zswap.max\n\" control group attribute. For details about this control group attribute,\nsee\nMemory Interface Files\n.\nWhile\nStartupMemoryZSwapMax=\napplies to the startup and shutdown phases of the system,\nMemoryZSwapMax=\napplies to normal runtime of the system, and if the former is not set also to\nthe startup and shutdown phases. Using\nStartupMemoryZSwapMax=\nallows prioritizing specific services at\nboot-up and shutdown differently than during normal runtime.\nAdded in version 253.\nMemoryZSwapWriteback=\nÂ¶\nThis setting controls the\nmemory\ncontroller in the unified hierarchy.\nTakes a boolean argument. When true, pages stored in the Zswap cache are permitted to be\nwritten to the backing storage, false otherwise. Defaults to true. This allows disabling\nwriteback of swap pages for IO-intensive applications, while retaining the ability to store\ncompressed pages in Zswap. See the kernel's\nZswap\ndocumentation\nfor more details.\nAdded in version 256.\nAllowedMemoryNodes=\n,\nStartupAllowedMemoryNodes=\nÂ¶\nThese settings control the\ncpuset\ncontroller in the unified hierarchy.\nRestrict processes to be executed on specific memory NUMA nodes. Takes a list of memory NUMA nodes indices\nor ranges separated by either whitespace or commas. Memory NUMA nodes ranges are specified by the lower and upper\nNUMA nodes indices separated by a dash.\nSetting\nAllowedMemoryNodes=\nor\nStartupAllowedMemoryNodes=\ndoes not\nguarantee that all of the memory NUMA nodes will be used by the processes as it may be limited by parent units.\nThe effective configuration is reported as\nEffectiveMemoryNodes=\n.\nWhile\nStartupAllowedMemoryNodes=\napplies to the startup and shutdown phases of the system,\nAllowedMemoryNodes=\napplies to normal runtime of the system, and if the former is not set also to\nthe startup and shutdown phases. Using\nStartupAllowedMemoryNodes=\nallows prioritizing specific services at\nboot-up and shutdown differently than during normal runtime.\nThis setting is supported only with the unified control group hierarchy.\nAdded in version 244.\nProcess Accounting and Control\nÂ¶\nTasksAccounting=\nÂ¶\nThis setting controls the\npids\ncontroller in the unified hierarchy.\nTurn on task accounting for this unit. Takes a boolean argument. If enabled, the kernel will\nkeep track of the total number of tasks in the unit and its children. This number includes both\nkernel threads and userspace processes, with each thread counted individually. Note that turning on\ntasks accounting for one unit will also implicitly turn it on for all units contained in the same\nslice and for all its parent slices and the units contained therein. The system default for this\nsetting may be controlled with\nDefaultTasksAccounting=\nin\nsystemd-system.conf\n(5)\n.\nAdded in version 227.\nTasksMax=\nN\nÂ¶\nThis setting controls the\npids\ncontroller in the unified hierarchy.\nSpecify the maximum number of tasks that may be created in the unit. This ensures that the\nnumber of tasks accounted for the unit (see above) stays below a specific limit. This either takes\nan absolute number of tasks or a percentage value that is taken relative to the configured maximum\nnumber of tasks on the system. If assigned the special value \"\ninfinity\n\", no tasks\nlimit is applied. This controls the \"\npids.max\n\" control group attribute. For\ndetails about this control group attribute, the\npids controller\n.\nThe effective configuration is reported as\nEffectiveTasksMax=\n.\nThe system default for this setting may be controlled with\nDefaultTasksMax=\nin\nsystemd-system.conf\n(5)\n.\nAdded in version 227.\nIO Accounting and Control\nÂ¶\nIOAccounting=\nÂ¶\nThis setting controls the\nio\ncontroller in the unified hierarchy.\nTurn on Block I/O accounting for this unit, if the unified control group hierarchy is used on the\nsystem. Takes a boolean argument. Note that turning on block I/O accounting for one unit will also implicitly\nturn it on for all units contained in the same slice and all for its parent slices and the units contained\ntherein. The system default for this setting may be controlled with\nDefaultIOAccounting=\nin\nsystemd-system.conf\n(5)\n.\nAdded in version 230.\nIOWeight=\nweight\n,\nStartupIOWeight=\nweight\nÂ¶\nThese settings control the\nio\ncontroller in the unified hierarchy.\nSet the default overall block I/O weight for the executed processes, if the unified control\ngroup hierarchy is used on the system. Takes a single weight value (between 1 and 10000) to set the\ndefault block I/O weight. This controls the \"\nio.weight\n\" control group attribute,\nwhich defaults to 100. For details about this control group attribute, see\nIO\nInterface Files\n.  The available I/O bandwidth is split up among all units within one slice\nrelative to their block I/O weight. A higher weight means more I/O bandwidth, a lower weight means\nless.\nWhile\nStartupIOWeight=\napplies\nto the startup and shutdown phases of the system,\nIOWeight=\napplies to the later runtime of\nthe system, and if the former is not set also to the startup\nand shutdown phases. This allows prioritizing specific services at boot-up\nand shutdown differently than during runtime.\nAdded in version 230.\nIODeviceWeight=\ndevice\nweight\nÂ¶\nThis setting controls the\nio\ncontroller in the unified hierarchy.\nSet the per-device overall block I/O weight for the executed processes, if the unified control group\nhierarchy is used on the system. Takes a space-separated pair of a file path and a weight value to specify\nthe device specific weight value, between 1 and 10000. (Example: \"\n/dev/sda 1000\n\"). The file\npath may be specified as path to a block device node or as any other file, in which case the backing block\ndevice of the file system of the file is determined. This controls the \"\nio.weight\n\" control\ngroup attribute, which defaults to 100. Use this option multiple times to set weights for multiple devices.\nFor details about this control group attribute, see\nIO Interface Files\n.\nThe specified device node should reference a block device that has an I/O scheduler\nassociated, i.e. should not refer to partition or loopback block devices, but to the originating,\nphysical device. When a path to a regular file or directory is specified it is attempted to\ndiscover the correct originating device backing the file system of the specified path. This works\ncorrectly only for simpler cases, where the file system is directly placed on a partition or\nphysical block device, or where simple 1:1 encryption using dm-crypt/LUKS is used. This discovery\ndoes not cover complex storage and in particular RAID and volume management storage devices.\nAdded in version 230.\nIOReadBandwidthMax=\ndevice\nbytes\n,\nIOWriteBandwidthMax=\ndevice\nbytes\nÂ¶\nThese settings control the\nio\ncontroller in the unified hierarchy.\nSet the per-device overall block I/O bandwidth maximum limit for the executed processes, if the unified\ncontrol group hierarchy is used on the system. This limit is not work-conserving and the executed processes\nare not allowed to use more even if the device has idle capacity.  Takes a space-separated pair of a file\npath and a bandwidth value (in bytes per second) to specify the device specific bandwidth. The file path may\nbe a path to a block device node, or as any other file in which case the backing block device of the file\nsystem of the file is used. If the bandwidth is suffixed with K, M, G, or T, the specified bandwidth is\nparsed as Kilobytes, Megabytes, Gigabytes, or Terabytes, respectively, to the base of 1000. (Example:\n\"/dev/disk/by-path/pci-0000:00:1f.2-scsi-0:0:0:0 5M\"). This controls the \"\nio.max\n\" control\ngroup attributes. Use this option multiple times to set bandwidth limits for multiple devices. For details\nabout this control group attribute, see\nIO Interface Files\n.\nSimilar restrictions on block device discovery as for\nIODeviceWeight=\napply, see above.\nAdded in version 230.\nIOReadIOPSMax=\ndevice\nIOPS\n,\nIOWriteIOPSMax=\ndevice\nIOPS\nÂ¶\nThese settings control the\nio\ncontroller in the unified hierarchy.\nSet the per-device overall block I/O IOs-Per-Second maximum limit for the executed processes, if the\nunified control group hierarchy is used on the system. This limit is not work-conserving and the executed\nprocesses are not allowed to use more even if the device has idle capacity.  Takes a space-separated pair of\na file path and an IOPS value to specify the device specific IOPS. The file path may be a path to a block\ndevice node, or as any other file in which case the backing block device of the file system of the file is\nused. If the IOPS is suffixed with K, M, G, or T, the specified IOPS is parsed as KiloIOPS, MegaIOPS,\nGigaIOPS, or TeraIOPS, respectively, to the base of 1000. (Example:\n\"/dev/disk/by-path/pci-0000:00:1f.2-scsi-0:0:0:0 1K\"). This controls the \"\nio.max\n\" control\ngroup attributes. Use this option multiple times to set IOPS limits for multiple devices. For details about\nthis control group attribute, see\nIO Interface Files\n.\nSimilar restrictions on block device discovery as for\nIODeviceWeight=\napply, see above.\nAdded in version 230.\nIODeviceLatencyTargetSec=\ndevice\ntarget\nÂ¶\nThis setting controls the\nio\ncontroller in the unified hierarchy.\nSet the per-device average target I/O latency for the executed processes, if the unified control group\nhierarchy is used on the system. Takes a file path and a timespan separated by a space to specify\nthe device specific latency target. (Example: \"/dev/sda 25ms\"). The file path may be specified\nas path to a block device node or as any other file, in which case the backing block device of the file\nsystem of the file is determined. This controls the \"\nio.latency\n\" control group\nattribute. Use this option multiple times to set latency target for multiple devices. For details about this\ncontrol group attribute, see\nIO Interface Files\n.\nImplies \"\nIOAccounting=yes\n\".\nThese settings are supported only if the unified control group hierarchy is used.\nSimilar restrictions on block device discovery as for\nIODeviceWeight=\napply, see above.\nAdded in version 240.\nNetwork Accounting and Control\nÂ¶\nIPAccounting=\nÂ¶\nTakes a boolean argument. If true, turns on IPv4 and IPv6 network traffic accounting for packets sent\nor received by the unit. When this option is turned on, all IPv4 and IPv6 sockets created by any process of\nthe unit are accounted for.\nWhen this option is used in socket units, it applies to all IPv4 and IPv6 sockets\nassociated with it (including both listening and connection sockets where this applies). Note that for\nsocket-activated services, this configuration setting and the accounting data of the service unit and the\nsocket unit are kept separate, and displayed separately. No propagation of the setting and the collected\nstatistics is done, in either direction. Moreover, any traffic sent or received on any of the socket unit's\nsockets is accounted to the socket unit â and never to the service unit it might have activated, even if the\nsocket is used by it.\nThe system default for this setting may be controlled with\nDefaultIPAccounting=\nin\nsystemd-system.conf\n(5)\n.\nNote that this functionality is currently only available for system services, not for\nper-user services.\nAdded in version 235.\nIPAddressAllow=\nADDRESS[/PREFIXLENGTH]â¦\n,\nIPAddressDeny=\nADDRESS[/PREFIXLENGTH]â¦\nÂ¶\nTurn on network traffic filtering for IP packets sent and received over\nAF_INET\nand\nAF_INET6\nsockets. Both directives take a\nspace separated list of IPv4 or IPv6 addresses, each optionally suffixed with an address prefix\nlength in bits after a \"\n/\n\" character. If the suffix is omitted, the address is\nconsidered a host address, i.e. the filter covers the whole address (32 bits for IPv4, 128 bits for\nIPv6).\nThe access lists configured with this option are applied to all sockets created by processes\nof this unit (or in the case of socket units, associated with it). The lists are implicitly\ncombined with any lists configured for any of the parent slice units this unit might be a member\nof. By default, both access lists are empty. Both ingress and egress traffic is filtered by these\nsettings. In case of ingress traffic the source IP address is checked against these access lists,\nin case of egress traffic the destination IP address is checked. The following rules are applied in\nturn:\nAccess is granted when the checked IP address matches an entry in the\nIPAddressAllow=\nlist.\nOtherwise, access is denied when the checked IP address matches an entry in the\nIPAddressDeny=\nlist.\nOtherwise, access is granted.\nIn order to implement an allow-listing IP firewall, it is recommended to use a\nIPAddressDeny=\nany\nsetting on an upper-level slice unit\n(such as the root slice\n-.slice\nor the slice containing all system services\nsystem.slice\nâ see\nsystemd.special\n(7)\nfor details on these slice units), plus individual per-service\nIPAddressAllow=\nlines permitting network access to relevant services, and only them.\nNote that for socket-activated services, the IP access list configured on the socket unit\napplies to all sockets associated with it directly, but not to any sockets created by the\nultimately activated services for it. Conversely, the IP access list configured for the service is\nnot applied to any sockets passed into the service via socket activation. Thus, it is usually a\ngood idea to replicate the IP access lists on both the socket and the service unit. Nevertheless,\nit may make sense to maintain one list more open and the other one more restricted, depending on\nthe use case.\nIf these settings are used multiple times in the same unit the specified lists are combined. If an\nempty string is assigned to these settings the specific access list is reset and all previous settings undone.\nIn place of explicit IPv4 or IPv6 address and prefix length specifications a small set of symbolic\nnames may be used. The following names are defined:\nTableÂ 1.Â Special address/network names\nSymbolic Name\nDefinition\nMeaning\nany\n0.0.0.0/0 ::/0\nAny host\nlocalhost\n127.0.0.0/8 ::1/128\nAll addresses on the local loopback\nlink-local\n169.254.0.0/16 fe80::/64\nAll link-local IP addresses\nmulticast\n224.0.0.0/4 ff00::/8\nAll IP multicasting addresses\nNote that these settings might not be supported on some systems (for example if eBPF control group\nsupport is not enabled in the underlying kernel or container manager). These settings will have no effect in\nthat case. If compatibility with such systems is desired it is hence recommended to not exclusively rely on\nthem for IP security.\nThis option cannot be bypassed by prefixing \"\n+\n\" to the executable path\nin the service unit, as it applies to the whole control group.\nAdded in version 235.\nSocketBindAllow=\nbind-rule\n,\nSocketBindDeny=\nbind-rule\nÂ¶\nConfigures restrictions on the ability of unit processes to invoke\nbind\n(2)\non a\nsocket. Both allow and deny rules to be defined that restrict which addresses a socket may be bound\nto.\nbind-rule\ndescribes socket properties such as\naddress-family\n,\ntransport-protocol\nand\nip-ports\n.\nbind-rule\n:=\n{ [\naddress-family\n:\n][\ntransport-protocol\n:\n][\nip-ports\n] |\nany\n}\naddress-family\n:= {\nipv4\n|\nipv6\n}\ntransport-protocol\n:= {\ntcp\n|\nudp\n}\nip-ports\n:= {\nip-port\n|\nip-port-range\n}\nAn optional\naddress-family\nexpects\nipv4\nor\nipv6\nvalues.\nIf not specified, a rule will be matched for both IPv4 and IPv6 addresses and applied depending on other socket fields, e.g.\ntransport-protocol\n,\nip-port\n.\nAn optional\ntransport-protocol\nexpects\ntcp\nor\nudp\ntransport protocol names.\nIf not specified, a rule will be matched for any transport protocol.\nAn optional\nip-port\nvalue must lie within 1â¦65535 interval inclusively, i.e.\ndynamic port\n0\nis not allowed. A range of sequential ports is described by\nip-port-range\n:=\nip-port-low\n-\nip-port-high\n,\nwhere\nip-port-low\nis smaller than or equal to\nip-port-high\nand both are within 1â¦65535 inclusively.\nA special value\nany\ncan be used to apply a rule to any address family, transport protocol and any port with a positive value.\nTo allow multiple rules assign\nSocketBindAllow=\nor\nSocketBindDeny=\nmultiple times.\nTo clear the existing assignments pass an empty\nSocketBindAllow=\nor\nSocketBindDeny=\nassignment.\nFor each of\nSocketBindAllow=\nand\nSocketBindDeny=\n, maximum allowed number of assignments is\n128\n.\nBinding to a socket is allowed when a socket address matches an entry in the\nSocketBindAllow=\nlist.\nOtherwise, binding is denied when the socket address matches an entry in the\nSocketBindDeny=\nlist.\nOtherwise, binding is allowed.\nThe feature is implemented with\ncgroup/bind4\nand\ncgroup/bind6\ncgroup-bpf hooks.\nNote that these settings apply to any\nbind\n(2)\nsystem call invocation by the unit processes, regardless in which network namespace they are\nplaced. Or in other words: changing the network namespace is not a suitable mechanism for escaping\nthese restrictions on\nbind()\n.\nExamples:\nâ¦\n# Allow binding IPv6 socket addresses with a port greater than or equal to 10000.\n[Service]\nSocketBindAllow=ipv6:10000-65535\nSocketBindDeny=any\nâ¦\n# Allow binding IPv4 and IPv6 socket addresses with 1234 and 4321 ports.\n[Service]\nSocketBindAllow=1234\nSocketBindAllow=4321\nSocketBindDeny=any\nâ¦\n# Deny binding IPv6 socket addresses.\n[Service]\nSocketBindDeny=ipv6\nâ¦\n# Deny binding IPv4 and IPv6 socket addresses.\n[Service]\nSocketBindDeny=any\nâ¦\n# Allow binding only over TCP\n[Service]\nSocketBindAllow=tcp\nSocketBindDeny=any\nâ¦\n# Allow binding only over IPv6/TCP\n[Service]\nSocketBindAllow=ipv6:tcp\nSocketBindDeny=any\nâ¦\n# Allow binding ports within 10000-65535 range over IPv4/UDP.\n[Service]\nSocketBindAllow=ipv4:udp:10000-65535\nSocketBindDeny=any\nâ¦\nThis option cannot be bypassed by prefixing \"\n+\n\" to the executable path\nin the service unit, as it applies to the whole control group.\nAdded in version 249.\nRestrictNetworkInterfaces=\nÂ¶\nTakes a list of space-separated network interface names. This option restricts the network\ninterfaces that processes of this unit can use. By default, processes can only use the network interfaces\nlisted (allow-list). If the first character of the rule is \"\n~\n\", the effect is inverted:\nthe processes can only use network interfaces not listed (deny-list).\nThis option can appear multiple times, in which case the network interface names are merged. If the\nempty string is assigned the set is reset, all prior assignments will have not effect.\nIf you specify both types of this option (i.e. allow-listing and deny-listing), the first encountered\nwill take precedence and will dictate the default action (allow vs deny). Then the next occurrences of this\noption will add or delete the listed network interface names from the set, depending of its type and the\ndefault action.\nThe loopback interface (\"lo\") is not treated in any special way, you have to configure it explicitly\nin the unit file.\nExample 1: allow-list\nRestrictNetworkInterfaces=eth1\nRestrictNetworkInterfaces=eth2\nPrograms in the unit will be only able to use the eth1 and eth2 network\ninterfaces.\nExample 2: deny-list\nRestrictNetworkInterfaces=~eth1 eth2\nPrograms in the unit will be able to use any network interface but eth1 and eth2.\nExample 3: mixed\nRestrictNetworkInterfaces=eth1 eth2\nRestrictNetworkInterfaces=~eth1\nPrograms in the unit will be only able to use the eth2 network interface.\nThis option cannot be bypassed by prefixing \"\n+\n\" to the executable path\nin the service unit, as it applies to the whole control group.\nAdded in version 250.\nNFTSet=\nfamily\n:\ntable\n:\nset\nÂ¶\nThis setting provides a method for integrating dynamic cgroup, user and group IDs into\nfirewall rules with\nNFT\nsets. The benefit of using this setting is to be able to use the IDs as selectors in firewall rules\neasily and this in turn allows more fine grained filtering. NFT rules for cgroup matching use\nnumeric cgroup IDs, which change every time a service is restarted, making them hard to use in\nsystemd environment otherwise. Dynamic and random IDs used by\nDynamicUser=\ncan\nbe also integrated with this setting.\nThis option expects a whitespace separated list of NFT set definitions. Each definition\nconsists of a colon-separated tuple of source type (one of \"\ncgroup\n\",\n\"\nuser\n\" or \"\ngroup\n\"), NFT address family (one of\n\"\narp\n\", \"\nbridge\n\", \"\ninet\n\", \"\nip\n\",\n\"\nip6\n\", or \"\nnetdev\n\"), table name and set name. The names of tables\nand sets must conform to lexical restrictions of NFT table names. The type of the element used in\nthe NFT filter must match the type implied by the directive (\"\ncgroup\n\",\n\"\nuser\n\" or \"\ngroup\n\") as shown in the table below. When a control\ngroup or a unit is realized, the corresponding ID will be appended to the NFT sets and it will be\nbe removed when the control group or unit is removed.\nsystemd\nonly inserts\nelements to (or removes from) the sets, so the related NFT rules, tables and sets must be prepared\nelsewhere in advance. Failures to manage the sets will be ignored.\nTableÂ 2.Â Defined\nsource type\nvalues\nSource type\nDescription\nCorresponding NFT type name\n\"\ncgroup\n\"\ncontrol group ID\n\"\ncgroupsv2\n\"\n\"\nuser\n\"\nuser ID\n\"\nmeta skuid\n\"\n\"\ngroup\n\"\ngroup ID\n\"\nmeta skgid\n\"\nIf the firewall rules are reinstalled so that the contents of NFT sets are destroyed, command\nsystemctl daemon-reload\ncan be used to refill the sets.\nExample:\n[Unit]\nNFTSet=cgroup:inet:filter:my_service user:inet:filter:serviceuser\nCorresponding NFT rules:\ntable inet filter {\nset my_service {\ntype cgroupsv2\n}\nset serviceuser {\ntypeof meta skuid\n}\nchain x {\nsocket cgroupv2 level 2 @my_service accept\ndrop\n}\nchain y {\nmeta skuid @serviceuser accept\ndrop\n}\n}\nThis option is only available for system services and is not supported for services\nrunning in per-user instances of the service manager.\nAdded in version 255.\nBPF Programs\nÂ¶\nIPIngressFilterPath=\nBPF_FS_PROGRAM_PATH\n,\nIPEgressFilterPath=\nBPF_FS_PROGRAM_PATH\nÂ¶\nAdd custom network traffic filters implemented as BPF programs, applying to all IP packets\nsent and received over\nAF_INET\nand\nAF_INET6\nsockets.\nTakes an absolute path to a pinned BPF program in the BPF virtual filesystem (\n/sys/fs/bpf/\n).\nThe filters configured with this option are applied to all sockets created by processes\nof this unit (or in the case of socket units, associated with it). The filters are loaded in addition\nto filters any of the parent slice units this unit might be a member of as well as any\nIPAddressAllow=\nand\nIPAddressDeny=\nfilters in any of these units.\nBy default, there are no filters specified.\nIf these settings are used multiple times in the same unit all the specified programs are attached. If an\nempty string is assigned to these settings the program list is reset and all previous specified programs ignored.\nIf the path\nBPF_FS_PROGRAM_PATH\nin\nIPIngressFilterPath=\nassignment\nis already being handled by\nBPFProgram=\ningress hook, e.g.\nBPFProgram=\ningress\n:\nBPF_FS_PROGRAM_PATH\n,\nthe assignment will be still considered valid and the program will be attached to a cgroup. Same for\nIPEgressFilterPath=\npath and\negress\nhook.\nNote that for socket-activated services, the IP filter programs configured on the socket unit apply to\nall sockets associated with it directly, but not to any sockets created by the ultimately activated services\nfor it. Conversely, the IP filter programs configured for the service are not applied to any sockets passed into\nthe service via socket activation. Thus, it is usually a good idea, to replicate the IP filter programs on both\nthe socket and the service unit, however it often makes sense to maintain one configuration more open and the other\none more restricted, depending on the use case.\nNote that these settings might not be supported on some systems (for example if eBPF control group\nsupport is not enabled in the underlying kernel or container manager). These settings will fail the service in\nthat case. If compatibility with such systems is desired it is hence recommended to attach your filter manually\n(requires\nDelegate=\nyes\n) instead of using this setting.\nAdded in version 243.\nBPFProgram=\ntype\n:\nprogram-path\nÂ¶\nBPFProgram=\nallows attaching custom BPF programs to the cgroup of a\nunit. (This generalizes the functionality exposed via\nIPEgressFilterPath=\nand\nIPIngressFilterPath=\nfor other hooks.)  Cgroup-bpf hooks in the form of BPF\nprograms loaded to the BPF filesystem are attached with cgroup-bpf attach flags determined by the\nunit. For details about attachment types and flags see\nbpf.h\n. Also\nrefer to the general\nBPF documentation\n.\nThe specification of BPF program consists of a pair of BPF program type and program path in\nthe file system, with \"\n:\n\" as the separator:\ntype\n:\nprogram-path\n.\nThe BPF program type is equivalent to the BPF attach type used in\nbpftool\n(8)\nIt may be one of\negress\n,\ningress\n,\nsock_create\n,\nsock_ops\n,\ndevice\n,\nbind4\n,\nbind6\n,\nconnect4\n,\nconnect6\n,\npost_bind4\n,\npost_bind6\n,\nsendmsg4\n,\nsendmsg6\n,\nsysctl\n,\nrecvmsg4\n,\nrecvmsg6\n,\ngetsockopt\n,\nor\nsetsockopt\n.\nThe specified program path must be an absolute path referencing a BPF program inode in the\nbpffs file system (which generally means it must begin with\n/sys/fs/bpf/\n). If\na specified program does not exist (i.e. has not been uploaded to the BPF subsystem of the kernel\nyet), it will not be installed but unit activation will continue (a warning will be printed to the\nlogs).\nSetting\nBPFProgram=\nto an empty value makes previous assignments\nineffective.\nMultiple assignments of the same program type/path pair have the same effect as a single\nassignment: the program will be attached just once.\nIf BPF\negress\npinned to\nprogram-path\npath is already being\nhandled by\nIPEgressFilterPath=\n,\nBPFProgram=\nassignment will be considered valid and\nBPFProgram=\nwill be attached to a cgroup.\nSimilarly for\ningress\nhook and\nIPIngressFilterPath=\nassignment.\nBPF programs passed with\nBPFProgram=\nare attached to the cgroup of a unit\nwith BPF attach flag\nmulti\n, that allows further attachments of the same\ntype\nwithin cgroup hierarchy topped by the unit cgroup.\nExamples:\nBPFProgram=egress:/sys/fs/bpf/egress-hook\nBPFProgram=bind6:/sys/fs/bpf/sock-addr-hook\nAdded in version 249.\nDevice Access\nÂ¶\nDeviceAllow=\nÂ¶\nControl access to specific device nodes by the executed processes. Takes two space-separated\nstrings: a device node specifier followed by a combination of\nr\n,\nw\n,\nm\nto control\nr\neading,\nw\nriting, or creation of the specific device nodes by the unit\n(\nm\nknod), respectively. This functionality is implemented using eBPF\nfiltering.\nWhen access to\nall\nphysical devices should be disallowed,\nPrivateDevices=\nmay be used instead. See\nsystemd.exec\n(5)\n.\nThe device node specifier is either a path to a device node in the file system, starting with\n/dev/\n, or a string starting with either \"\nchar-\n\" or\n\"\nblock-\n\" followed by a device group name, as listed in\n/proc/devices\n. The latter is useful to allow-list all current and future\ndevices belonging to a specific device group at once. The device group is matched according to\nfilename globbing rules, you may hence use the \"\n*\n\" and \"\n?\n\"\nwildcards. (Note that such globbing wildcards are not available for device node path\nspecifications!) In order to match device nodes by numeric major/minor, use device node paths in\nthe\n/dev/char/\nand\n/dev/block/\ndirectories. However,\nmatching devices by major/minor is generally not recommended as assignments are neither stable nor\nportable between systems or different kernel versions.\nExamples:\n/dev/sda5\nis a path to a device node, referring to an ATA or\nSCSI block device. \"\nchar-pts\n\" and \"\nchar-alsa\n\" are specifiers for\nall pseudo TTYs and all ALSA sound devices, respectively. \"\nchar-cpu/*\n\" is a\nspecifier matching all CPU related device groups.\nNote that allow lists defined this way should only reference device groups which are\nresolvable at the time the unit is started. Any device groups not resolvable then are not added to\nthe device allow list. In order to work around this limitation, consider extending service units\nwith a pair of\nAfter=modprobe@xyz.service\nand\nWants=modprobe@xyz.service\nlines that load the necessary kernel module\nimplementing the device group if missing.\nExample:\nâ¦\n[Unit]\nWants=modprobe@loop.service\nAfter=modprobe@loop.service\n[Service]\nDeviceAllow=block-loop\nDeviceAllow=/dev/loop-control\nâ¦\nThis option cannot be bypassed by prefixing \"\n+\n\" to the executable path\nin the service unit, as it applies to the whole control group.\nAdded in version 208.\nDevicePolicy=auto|closed|strict\nÂ¶\nControl the policy for allowing device access:\nstrict\nÂ¶\nmeans to only allow types of access that are\nexplicitly specified.\nAdded in version 208.\nclosed\nÂ¶\nin addition, allows access to standard pseudo\ndevices including\n/dev/null\n,\n/dev/zero\n,\n/dev/full\n,\n/dev/random\n, and\n/dev/urandom\n.\nAdded in version 208.\nauto\nÂ¶\nin addition, allows access to all devices if no\nexplicit\nDeviceAllow=\nis present.\nThis is the default.\nAdded in version 208.\nThis option cannot be bypassed by prefixing \"\n+\n\" to the executable path\nin the service unit, as it applies to the whole control group.\nAdded in version 208.\nControl Group Management\nÂ¶\nSlice=\nÂ¶\nThe name of the slice unit to place the unit\nin. Defaults to\nsystem.slice\nfor all\nnon-instantiated units of all unit types (except for slice\nunits themselves see below). Instance units are by default\nplaced in a subslice of\nsystem.slice\nthat is named after the template name.\nThis option may be used to arrange systemd units in a\nhierarchy of slices each of which might have resource\nsettings applied.\nFor units of type slice, the only accepted value for\nthis setting is the parent slice. Since the name of a slice\nunit implies the parent slice, it is hence redundant to ever\nset this parameter directly for slice units.\nSpecial care should be taken when relying on the default slice assignment in templated service units\nthat have\nDefaultDependencies=no\nset, see\nsystemd.service\n(5)\n, section\n\"Default Dependencies\" for details.\nAdded in version 208.\nDelegate=\nÂ¶\nTurns on delegation of further resource control partitioning to processes of the unit. Units\nwhere this is enabled may create and manage their own private subhierarchy of control groups below\nthe control group of the unit itself. For unprivileged services (i.e. those using the\nUser=\nsetting) the unit's control group will be made accessible to the relevant\nuser.\nWhen enabled the service manager will refrain from manipulating control groups or moving\nprocesses below the unit's control group, so that a clear concept of ownership is established: the\ncontrol group tree at the level of the unit's control group and above (i.e. towards the root\ncontrol group) is owned and managed by the service manager of the host, while the control group\ntree below the unit's control group is owned and managed by the unit itself.\nTakes either a boolean argument or a (possibly empty) list of control group controller names.\nIf true, delegation is turned on, and all supported controllers are enabled for the unit, making\nthem available to the unit's processes for management. If false, delegation is turned off entirely\n(and no additional controllers are enabled). If set to a list of controllers, delegation is turned\non, and the specified controllers are enabled for the unit. Assigning the empty string will enable\ndelegation, but reset the list of controllers, and all assignments prior to this will have no\neffect. Note that additional controllers other than the ones specified might be made available as\nwell, depending on configuration of the containing slice unit or other units contained in it.\nDefaults to false.\nNote that controller delegation to less privileged code is only safe on the unified control\ngroup hierarchy. Accordingly, access to the specified controllers will not be granted to\nunprivileged services on the legacy hierarchy, even when requested.\nThe following controller names may be specified:\ncpu\n,\ncpuset\n,\nio\n,\nmemory\n,\npids\n,\nbpf-firewall\n,\nbpf-devices\n,\nbpf-foreign\n,\nbpf-socket-bind\n, and\nbpf-restrict-network-interfaces\n.\nNot all of these controllers are available on all kernels however, and some are specific to\nthe unified hierarchy while others are specific to the legacy hierarchy. Also note that the kernel\nmight support further controllers, which are not covered here yet, as delegation is either not\nsupported at all for them or not defined cleanly.\nNote that because of the hierarchical nature of cgroup hierarchy, any controllers that are\ndelegated will be enabled for the parent and sibling units of the unit with delegation.\nFor further details on the delegation model consult\nControl Group APIs and Delegation\n.\nAdded in version 218.\nDelegateSubgroup=\nÂ¶\nPlace unit processes in the specified subgroup of the unit's control group. Takes a valid\ncontrol group name (not a path!) as parameter, or an empty string to turn this feature\noff. Defaults to off. The control group name must be usable as filename and avoid conflicts with\nthe kernel's control group attribute files (i.e.\ncgroup.procs\nis not an\nacceptable name, since the kernel exposes a native control group attribute file by that name). This\noption has no effect unless control group delegation is turned on via\nDelegate=\n,\nsee above. Note that this setting only applies to \"main\" processes of a unit, i.e. for services to\nExecStart=\n, but not for\nExecReload=\nand similar. If\ndelegation is enabled, the latter are always placed inside a subgroup named\n.control\n. The specified subgroup is automatically created (and potentially\nownership is passed to the unit's configured user/group) when a process is started in it.\nThis option is useful to avoid manually moving the invoked process into a subgroup after it\nhas been started. Since no processes should live in inner nodes of the control group tree it is\nalmost always necessary to run the main (\"supervising\") process of a unit that has delegation\nturned on in a subgroup.\nAdded in version 254.\nDisableControllers=\nÂ¶\nDisables controllers from being enabled for a unit's children. If a controller listed is\nalready in use in its subtree, the controller will be removed from the subtree. This can be used to\navoid configuration in child units from being able to implicitly or explicitly enable a controller.\nDefaults to empty.\nMultiple controllers may be specified, separated by spaces. You may also pass\nDisableControllers=\nmultiple times, in which case each new instance adds another controller\nto disable. Passing\nDisableControllers=\nby itself with no controller name present resets\nthe disabled controller list.\nIt may not be possible to disable a controller after units have been started, if the unit or\nany child of the unit in question delegates controllers to its children, as any delegated subtree\nof the cgroup hierarchy is unmanaged by systemd.\nThe following controller names may be specified:\ncpu\n,\ncpuset\n,\nio\n,\nmemory\n,\npids\n,\nbpf-firewall\n,\nbpf-devices\n,\nbpf-foreign\n,\nbpf-socket-bind\n, and\nbpf-restrict-network-interfaces\n.\nAdded in version 240.\nMemory Pressure Control\nÂ¶\nManagedOOMSwap=auto|kill\n,\nManagedOOMMemoryPressure=auto|kill\nÂ¶\nSpecifies how\nsystemd-oomd.service\n(8)\nwill act on this unit's cgroups. Defaults to\nauto\n.\nWhen set to\nkill\n, the unit becomes a candidate for monitoring by\nsystemd-oomd\n. If the cgroup passes the limits set by\noomd.conf\n(5)\nor\nthe unit configuration,\nsystemd-oomd\nwill select a descendant cgroup and send\nSIGKILL\nto all of the processes under it. You can find more details on\ncandidates and kill behavior at\nsystemd-oomd.service\n(8)\nand\noomd.conf\n(5)\n.\nSetting either of these properties to\nkill\nwill also result in\nAfter=\nand\nWants=\ndependencies on\nsystemd-oomd.service\nunless\nDefaultDependencies=no\n.\nWhen set to\nauto\n,\nsystemd-oomd\nwill not actively use this\ncgroup's data for monitoring and detection. However, if an ancestor cgroup has one of these\nproperties set to\nkill\n, a unit with\nauto\ncan still be a candidate\nfor\nsystemd-oomd\nto terminate.\nAdded in version 247.\nManagedOOMMemoryPressureLimit=\nÂ¶\nOverrides the default memory pressure limit set by\noomd.conf\n(5)\nfor\nthe cgroup of this unit. Takes a percentage value between 0% and 100%, inclusive. Defaults to 0%,\nwhich means to use the default set by\noomd.conf\n(5)\n.\nThis property is ignored unless\nManagedOOMMemoryPressure=\nkill\n.\nAdded in version 247.\nManagedOOMMemoryPressureDurationSec=\nÂ¶\nOverrides the default memory pressure duration set by\noomd.conf\n(5)\nfor\nthe cgroup of this unit. The specified value supports a time unit such as \"\nms\n\" or\n\"\nÎ¼s\n\", see\nsystemd.time\n(7)\nfor details on the permitted syntax. Must be set to either empty or a value of at least 1s. Defaults\nto empty, which means to use the default set by\noomd.conf\n(5)\n.\nThis property is ignored unless\nManagedOOMMemoryPressure=\nkill\n.\nAdded in version 257.\nManagedOOMPreference=none|avoid|omit\nÂ¶\nAllows deprioritizing or omitting this unit's cgroup as a candidate when\nsystemd-oomd\nneeds to act. Requires support for extended attributes (see\nxattr\n(7)\n)\nin order to use\navoid\nor\nomit\n.\nWhen calculating candidates to relieve swap usage,\nsystemd-oomd\nwill\nonly respect these extended attributes if the unit's cgroup is owned by root.\nWhen calculating candidates to relieve memory pressure,\nsystemd-oomd\nwill only respect these extended attributes if the unit's cgroup is owned by root, or if the\nunit's cgroup owner, and the owner of the monitored ancestor cgroup are the same. For example,\nif\nsystemd-oomd\nis calculating candidates for\n-.slice\n,\nthen extended attributes set on descendants of\n/user.slice/user-1000.slice/user@1000.service/\nwill be ignored because the descendants are owned by UID 1000, and\n-.slice\nis owned by UID 0. But, if calculating candidates for\n/user.slice/user-1000.slice/user@1000.service/\n, then extended attributes set\non the descendants would be respected.\nIf this property is set to\navoid\n, the service manager will convey this to\nsystemd-oomd\n, which will only select this cgroup if there are no other viable\ncandidates.\nIf this property is set to\nomit\n, the service manager will convey this to\nsystemd-oomd\n, which will ignore this cgroup as a candidate and will not perform\nany actions on it.\nIt is recommended to use\navoid\nand\nomit\nsparingly, as it\ncan adversely affect\nsystemd-oomd\n's kill behavior. Also note that these extended\nattributes are not applied recursively to cgroups under this unit's cgroup.\nDefaults to\nnone\nwhich means\nsystemd-oomd\nwill rank this\nunit's cgroup as defined in\nsystemd-oomd.service\n(8)\nand\noomd.conf\n(5)\n.\nAdded in version 248.\nMemoryPressureWatch=\nÂ¶\nControls memory pressure monitoring for invoked processes. Takes a boolean or one of\n\"\nauto\n\" and \"\nskip\n\". If \"\nno\n\", tells the service not\nto watch for memory pressure events, by setting the\n$MEMORY_PRESSURE_WATCH\nenvironment variable to the literal string\n/dev/null\n. If \"\nyes\n\",\ntells the service to watch for memory pressure events. This enables memory accounting for the\nservice, and ensures the\nmemory.pressure\ncgroup attribute file is accessible for\nreading and writing by the service's user. It then sets the\n$MEMORY_PRESSURE_WATCH\nenvironment variable for processes invoked by the unit to the file system path to this file. The\nthreshold information configured with\nMemoryPressureThresholdSec=\nis encoded in\nthe\n$MEMORY_PRESSURE_WRITE\nenvironment variable. If the \"\nauto\n\"\nvalue is set the protocol is enabled if memory accounting is anyway enabled for the unit, and\ndisabled otherwise. If set to \"\nskip\n\" the logic is neither enabled, nor disabled and\nthe two environment variables are not set.\nNote that services are free to use the two environment variables, but it is unproblematic if\nthey ignore them. Memory pressure handling must be implemented individually in each service, and\nusually means different things for different software. For further details on memory pressure\nhandling see\nMemory Pressure Handling in\nsystemd\n.\nServices implemented using\nsd-event\n(3)\nmay use\nsd_event_add_memory_pressure\n(3)\nto watch for and handle memory pressure events.\nIf not explicit set, defaults to the\nDefaultMemoryPressureWatch=\nsetting in\nsystemd-system.conf\n(5)\n.\nAdded in version 254.\nMemoryPressureThresholdSec=\nÂ¶\nSets the memory pressure threshold time for memory pressure monitor as configured via\nMemoryPressureWatch=\n. Specifies the maximum allocation latency before a memory\npressure event is signalled to the service, per 2s window. If not specified, defaults to the\nDefaultMemoryPressureThresholdSec=\nsetting in\nsystemd-system.conf\n(5)\n(which in turn defaults to 200ms). The specified value expects a time unit such as\n\"\nms\n\" or \"\nÎ¼s\n\", see\nsystemd.time\n(7)\nfor\ndetails on the permitted syntax.\nAdded in version 254.\nCoredump Control\nÂ¶\nCoredumpReceive=\nÂ¶\nTakes a boolean argument. This setting is used to enable coredump forwarding for containers\nthat belong to this unit's cgroup. Units with\nCoredumpReceive=yes\nmust also be configured\nwith\nDelegate=yes\n. Defaults to false.\nWhen\nsystemd-coredump\nis handling a coredump for a process from a container,\nif the container's leader process is a descendant of a cgroup with\nCoredumpReceive=yes\nand\nDelegate=yes\n, then\nsystemd-coredump\nwill attempt to forward\nthe coredump to\nsystemd-coredump\nwithin the container. See also\nsystemd-coredump\n(8)\n.\nAdded in version 255.\nHistory\nÂ¶\nsystemd 252\nÂ¶\nOptions for controlling the Legacy Control Group Hierarchy (\nControl Groups version 1\n)\nare now fully deprecated:\nCPUShares=\nweight\n,\nStartupCPUShares=\nweight\n,\nMemoryLimit=\nbytes\n,\nBlockIOAccounting=\n,\nBlockIOWeight=\nweight\n,\nStartupBlockIOWeight=\nweight\n,\nBlockIODeviceWeight=\ndevice\nweight\n,\nBlockIOReadBandwidth=\ndevice\nbytes\n,\nBlockIOWriteBandwidth=\ndevice\nbytes\n.\nPlease switch to the unified cgroup hierarchy.\nsystemd 258\nÂ¶\nCPUAccounting=\nsetting is deprecated, because it is always available\non the unified cgroup hierarchy and such setting has no effect.\nSee Also\nÂ¶\nsystemd\n(1)\n,\nsystemd-system.conf\n(5)\n,\nsystemd.unit\n(5)\n,\nsystemd.service\n(5)\n,\nsystemd.slice\n(5)\n,\nsystemd.scope\n(5)\n,\nsystemd.socket\n(5)\n,\nsystemd.mount\n(5)\n,\nsystemd.swap\n(5)\n,\nsystemd.exec\n(5)\n,\nsystemd.directives\n(7)\n,\nsystemd.special\n(7)\n,\nsystemd-oomd.service\n(8)\n, The documentation for control groups and specific controllers in the Linux kernel:\nControl Groups v2", "metadata": {"source_type": "vendor_docs", "trust": "vendor_docs", "os": "linux", "distro": "ubuntu-22.04", "license": "CC BY-SA (assumed; verify per site)", "attribution_url": "https://www.freedesktop.org/software/systemd/man/latest/systemd.resource-control.html"}}
{"text": "systemd.mount\nIndex\nÂ·\nDirectives\nsystemd 258\nName\nsystemd.mount â Mount unit configuration\nSynopsis\nmount\n.mount\nDescription\nÂ¶\nA unit configuration file whose name ends in\n\"\n.mount\n\" encodes information about a file system\nmount point controlled and supervised by systemd.\nThis man page lists the configuration options specific to\nthis unit type. See\nsystemd.unit\n(5)\nfor the common options of all unit configuration files. The common\nconfiguration items are configured in the generic [Unit] and\n[Install] sections. The mount specific configuration options are\nconfigured in the [Mount] section.\nAdditional options are listed in\nsystemd.exec\n(5)\n,\nwhich define the execution environment the\nmount\n(8)\nprogram is executed in, and in\nsystemd.kill\n(5)\n,\nwhich define the way the processes are terminated, and in\nsystemd.resource-control\n(5)\n,\nwhich configure resource control settings for the processes of the\nservice.\nNote that the options\nUser=\nand\nGroup=\nare not useful for mount units.\nsystemd passes two parameters to\nmount\n(8)\n;\nthe values of\nWhat=\nand\nWhere=\n.\nWhen invoked in this way,\nmount\n(8)\ndoes not read any options from\n/etc/fstab\n, and\nmust be run as UID 0.\nMount units must be named after the mount point directories they control. Example: the mount point\n/home/lennart\nmust be configured in a unit file\nhome-lennart.mount\n.  For details about the escaping logic used to convert a file\nsystem path to a unit name, see\nsystemd.unit\n(5)\n. Note\nthat mount units cannot be templated, nor is possible to add multiple names to a mount unit by creating\nsymlinks to its unit file.\nOptionally, a mount unit may be accompanied by an automount\nunit, to allow on-demand or parallelized mounting. See\nsystemd.automount\n(5)\n.\nMount points created at runtime (independently of unit files\nor\n/etc/fstab\n) will be monitored by systemd\nand appear like any other mount unit in systemd. See\n/proc/self/mountinfo\ndescription in\nproc\n(5)\n.\nSome file systems have special semantics as API file systems\nfor kernel-to-userspace and userspace-to-userspace interfaces. Some\nof them may not be changed via mount units, and cannot be\ndisabled. For a longer discussion see\nAPI\nFile Systems\n.\nThe\nsystemd-mount\n(1)\ncommand\nallows creating\n.mount\nand\n.automount\nunits dynamically and\ntransiently from the command line.\nAutomatic Dependencies\nÂ¶\nImplicit Dependencies\nÂ¶\nThe following dependencies are implicitly added:\nIf a mount unit is beneath another mount unit in the file\nsystem hierarchy, both a requirement dependency and an ordering\ndependency between both units are created automatically.\nBlock device backed file systems automatically gain\nRequires=\n,\nStopPropagatedFrom=\n, and\nAfter=\ntype dependencies on the\ndevice unit encapsulating the block device (see\nx-systemd.device-bound=\nfor details).\nIf traditional file system quota is enabled for a mount unit, automatic\nWants=\nand\nBefore=\ndependencies on\nsystemd-quotacheck@.service\nand\nquotaon@.service\nare added.\nAdditional implicit dependencies may be added as result of execution and\nresource control parameters as documented in\nsystemd.exec\n(5)\nand\nsystemd.resource-control\n(5)\n.\nDefault Dependencies\nÂ¶\nThe following dependencies are added unless\nDefaultDependencies=no\nis set:\nAll mount units acquire automatic\nBefore=\nand\nConflicts=\non\numount.target\nin order to be stopped during shutdown.\nMount units referring to local file systems automatically gain\nan\nAfter=\ndependency on\nlocal-fs-pre.target\n, and a\nBefore=\ndependency on\nlocal-fs.target\nunless one or more\nmount options among\nnofail\n,\nx-systemd.wanted-by=\n,\nand\nx-systemd.required-by=\nis set. See below for detailed information.\nAdditionally, an\nAfter=\ndependency on\nswap.target\nis added when the file system type is \"\ntmpfs\n\".\nNetwork mount units automatically acquire\nAfter=\ndependencies on\nremote-fs-pre.target\n,\nnetwork.target\n,\nplus\nAfter=\nand\nWants=\ndependencies on\nnetwork-online.target\n,\nand a\nBefore=\ndependency on\nremote-fs.target\n, unless\none or more mount options among\nnofail\n,\nx-systemd.wanted-by=\n,\nand\nx-systemd.required-by=\nis set.\nMount units referring to local and network file systems are distinguished by their file system type\nspecification. In some cases this is not sufficient (for example network block device based mounts, such as\niSCSI), in which case\n_netdev\nmay be added to the mount option string of the unit, which forces\nsystemd to consider the mount unit a network mount.\nfstab\nÂ¶\nMount units may either be configured via unit files, or via\n/etc/fstab\n(see\nfstab\n(5)\nfor details). Mounts listed in\n/etc/fstab\nwill be converted into native units\ndynamically at boot and when the configuration of the system manager is reloaded. In general, configuring\nmount points through\n/etc/fstab\nis the preferred approach to manage mounts for\nhumans. For tooling, writing mount units should be preferred over editing\n/etc/fstab\n.\nSee\nsystemd-fstab-generator\n(8)\nfor details about the conversion from\n/etc/fstab\nto mount units.\nThe NFS mount option\nbg\nfor NFS background mounts\nas documented in\nnfs\n(5)\nis detected by\nsystemd-fstab-generator\nand the options\nare transformed so that systemd fulfills the job-control implications of\nthat option.  Specifically\nsystemd-fstab-generator\nacts\nas though \"\nx-systemd.mount-timeout=infinity,retry=10000\n\" was\nprepended to the option list, and \"\nfg,nofail\n\" was appended.\nDepending on specific requirements, it may be appropriate to provide some of\nthese options explicitly, or to make use of the\n\"\nx-systemd.automount\n\" option described below instead\nof using \"\nbg\n\".\nWhen reading\n/etc/fstab\na few special\nmount options are understood by systemd which influence how\ndependencies are created for mount points. systemd will create a\ndependency of type\nWants=\nor\nRequires=\n(see option\nnofail\nbelow), from either\nlocal-fs.target\nor\nremote-fs.target\n, depending whether the file\nsystem is local or remote.\nx-systemd.requires=\nÂ¶\nConfigures a\nRequires=\nand\nan\nAfter=\ndependency between the created\nmount unit and another systemd unit, such as a device or mount\nunit. The argument should be a unit name, or an absolute path\nto a device node or mount point.  This option may be specified\nmore than once. This option is particularly useful for mount\npoint declarations that need an additional device to be around\n(such as an external journal device for journal file systems)\nor an additional mount to be in place (such as an overlay file\nsystem that merges multiple mount points). See\nAfter=\nand\nRequires=\nin\nsystemd.unit\n(5)\nfor details.\nNote that this option always applies to the created mount unit\nonly regardless whether\nx-systemd.automount\nhas been\nspecified.\nAdded in version 220.\nx-systemd.wants=\nÂ¶\nConfigures a\nWants=\nand\nan\nAfter=\ndependency between the created\nmount unit and another systemd unit, similar to the\nx-systemd.requires=\noption.\nAdded in version 257.\nx-systemd.before=\n,\nx-systemd.after=\nÂ¶\nIn the created mount unit, configures a\nBefore=\nor\nAfter=\ndependency on another systemd unit, such as a mount unit.\nThe argument should be a unit name or an absolute path\nto a mount point. This option may be specified more than once.\nThis option is particularly useful for mount point declarations\nwith\nnofail\noption that are mounted\nasynchronously but need to be mounted before or after some unit\nstart, for example, before\nlocal-fs.target\nunit.\nSee\nBefore=\nand\nAfter=\nin\nsystemd.unit\n(5)\nfor details.\nNote that these options always apply to the created mount unit\nonly regardless whether\nx-systemd.automount\nhas been\nspecified.\nAdded in version 233.\nx-systemd.wanted-by=\n,\nx-systemd.required-by=\nÂ¶\nIn the created mount unit, configures a\nWantedBy=\nor\nRequiredBy=\ndependency on another unit. This option may be specified more than once.\nIf this is specified, the default dependencies (see above) other than\numount.target\non the created mount unit, e.g.\nlocal-fs.target\n, are not automatically created.\nHence it is likely that some ordering dependencies need to be set up manually through\nx-systemd.before=\nand\nx-systemd.after=\n. See\nWantedBy=\nand\nRequiredBy=\nin\nsystemd.unit\n(5)\nfor details.\nAdded in version 245.\nx-systemd.wants-mounts-for=\n,\nx-systemd.requires-mounts-for=\nÂ¶\nConfigures a\nRequiresMountsFor=\nor\nWantsMountsFor=\ndependency between the created mount unit and other mount units. The\nargument must be an absolute path. This option may be specified more than\nonce. See\nRequiresMountsFor=\nor\nWantsMountsFor=\nin\nsystemd.unit\n(5)\nfor details.\nAdded in version 220.\nx-systemd.graceful-option=\nÂ¶\nAdditional mount option that shall be appended if supported by the kernel.\nThis may be used to configure mount options that are optional and only enabled on kernels that\nsupport them. Note that this is supported only for native kernel mount options (i.e. explicitly not\nfor mount options implemented in userspace, such as those processed by\n/usr/bin/mount\nitself, by FUSE or by mount helpers such as\nmount.nfs\n). This option may be specified more than once.\nAdded in version 258.\nx-systemd.device-bound=\nÂ¶\nTakes a boolean argument. If true or no argument, a\nBindsTo=\ndependency\non the backing device is set. If false, the mount unit is not stopped no matter whether the backing device\nis still present. This is useful when the file system is backed by volume managers. If not set, and the mount\ncomes from unit fragments, i.e. generated from\n/etc/fstab\nby\nsystemd-fstab-generator\n(8)\nor loaded from\na manually configured mount unit, a combination of\nRequires=\nand\nStopPropagatedFrom=\ndependencies is set on the backing device, otherwise only\nRequires=\nis used.\nAdded in version 233.\nx-systemd.automount\nÂ¶\nAn automount unit will be created for the file\nsystem. See\nsystemd.automount\n(5)\nfor details.\nAdded in version 215.\nx-systemd.idle-timeout=\nÂ¶\nConfigures the idle timeout of the\nautomount unit. See\nTimeoutIdleSec=\nin\nsystemd.automount\n(5)\nfor details.\nAdded in version 220.\nx-systemd.device-timeout=\nÂ¶\nConfigure how long systemd should wait for a\ndevice to show up before giving up on an entry from\n/etc/fstab\n. Specify a time in seconds or\nexplicitly append a unit such as \"\ns\n\",\n\"\nmin\n\", \"\nh\n\",\n\"\nms\n\".\nNote that this option can only be used in\n/etc/fstab\n, and will be\nignored when part of the\nOptions=\nsetting in a unit file.\nAdded in version 215.\nx-systemd.mount-timeout=\nÂ¶\nConfigure how long systemd should wait for the\nmount command to finish before giving up on an entry from\n/etc/fstab\n. Specify a time in seconds or\nexplicitly append a unit such as \"\ns\n\",\n\"\nmin\n\", \"\nh\n\",\n\"\nms\n\".\nNote that this option can only be used in\n/etc/fstab\n, and will be\nignored when part of the\nOptions=\nsetting in a unit file.\nSee\nTimeoutSec=\nbelow for\ndetails.\nAdded in version 233.\nx-systemd.makefs\nÂ¶\nThe file system will be initialized\non the device. If the device is not \"empty\", i.e. it contains any signature,\nthe operation will be skipped. It is hence expected that this option\nremains set even after the device has been initialized.\nNote that this option can only be used in\n/etc/fstab\n, and will be ignored when part of the\nOptions=\nsetting in a unit file.\nSee\nsystemd-makefs@.service\n(8)\n.\nwipefs\n(8)\nmay be used to remove any signatures from a block device to force\nx-systemd.makefs\nto reinitialize the device.\nAdded in version 236.\nx-systemd.growfs\nÂ¶\nThe file system will be grown to occupy the full block\ndevice. If the file system is already at maximum size, no action will\nbe performed. It is hence expected that this option remains set even after\nthe file system has been grown. Only certain file system types are supported,\nsee\nsystemd-makefs@.service\n(8)\nfor details.\nNote that this option can only be used in\n/etc/fstab\n, and will be ignored when part of the\nOptions=\nsetting in a unit file.\nAdded in version 236.\nx-systemd.pcrfs\nÂ¶\nMeasures file system identity information (mount point, type, label, UUID, partition\nlabel, partition UUID) into PCR 15 after the file system has been mounted. This ensures the\nsystemd-pcrfs@.service\n(8)\nor\nsystemd-pcrfs-root.service\nservices are pulled in by the mount unit.\nNote that this option can only be used in\n/etc/fstab\n, and will be ignored\nwhen part of the\nOptions=\nsetting in a unit file. It is also implied for the root\nand\n/usr/\npartitions discovered by\nsystemd-gpt-auto-generator\n(8)\n.\nAdded in version 253.\nx-systemd.validatefs\nÂ¶\nValidates mount constraint metadata of the mounted file system after mounting\nit. This ensures the\nsystemd-validatefs@.service\n(8)\nservice is pulled in by the mount unit.\nNote that this option can only be used in\n/etc/fstab\n, and will be ignored\nwhen part of the\nOptions=\nsetting in a unit file. It is also implied for all\npartitions discovered by\nsystemd-gpt-auto-generator\n(8)\n.\nAdded in version 258.\nx-systemd.rw-only\nÂ¶\nIf a mount operation fails to mount the file system\nread-write, it normally tries mounting the file system read-only instead.\nThis option disables that behaviour, and causes the mount to fail\nimmediately instead. This option is translated into the\nReadWriteOnly=\nsetting in a unit file.\nAdded in version 246.\n_netdev\nÂ¶\nNormally the file system type is used to determine if a\nmount is a \"network mount\", i.e. if it should only be started after the\nnetwork is available. Using this option overrides this detection and\nspecifies that the mount requires network.\nNetwork mount units are ordered between\nremote-fs-pre.target\nand\nremote-fs.target\n, instead of\nlocal-fs-pre.target\nand\nlocal-fs.target\n.\nThey also pull in\nnetwork-online.target\nand are ordered after\nit and\nnetwork.target\n.\nAdded in version 235.\nnoauto\n,\nauto\nÂ¶\nWith\nnoauto\n, the mount unit will not be added as a dependency for\nlocal-fs.target\nor\nremote-fs.target\n. This means that it\nwill not be mounted automatically during boot, unless it is pulled in by some other unit. The\nauto\noption has the opposite meaning and is the default.\nNote that if\nx-systemd.automount\n(see above) is used, neither\nauto\nnor\nnoauto\nhave any effect. The matching automount unit will\nbe added as a dependency to the appropriate target.\nAdded in version 215.\nnofail\nÂ¶\nWith\nnofail\n, this mount will be only wanted, not required, by\nlocal-fs.target\nor\nremote-fs.target\n. Moreover, the mount unit is not\nordered before these target units. This means that the boot will continue without waiting for the mount unit\nand regardless whether the mount point can be mounted successfully.\nAdded in version 215.\nx-initrd.mount\nÂ¶\nAn additional filesystem to be mounted in the initrd. See\ninitrd-fs.target\ndescription in\nsystemd.special\n(7)\n. This\nis both an indicator to the initrd to mount this partition early and an indicator to the host to\nleave the partition mounted until final shutdown. Or in other words, if this flag is set it is\nassumed the mount shall be active during the entire regular runtime of the system, i.e. established\nbefore the initrd transitions into the host all the way until the host transitions to the final\nshutdown phase.\nAdded in version 215.\nIf a mount point is configured in both\n/etc/fstab\nand a unit file that is stored\nbelow\n/usr/\n, the former will take precedence.\nIf the unit file is stored below\n/etc/\n, it\nwill take precedence. This means: native unit files take\nprecedence over traditional configuration files, but this is\nsuperseded by the rule that configuration in\n/etc/\nwill always take precedence over\nconfiguration in\n/usr/\n.\nOptions\nÂ¶\nMount unit files may include [Unit] and [Install] sections, which are described in\nsystemd.unit\n(5)\n.\nMount unit files must include a [Mount] section, which carries\ninformation about the file system mount points it supervises. A\nnumber of options that may be used in this section are shared with\nother unit types. These options are documented in\nsystemd.exec\n(5)\n,\nsystemd.kill\n(5)\nand\nsystemd.resource-control\n(5)\n.\nThe options specific to the [Mount] section of mount units are the\nfollowing:\nWhat=\nÂ¶\nTakes an absolute path or a fstab-style identifier of a device node, file or\nother resource to mount. See\nmount\n(8)\nfor\ndetails. If this refers to a device node, a dependency on the respective device unit is automatically\ncreated. (See\nsystemd.device\n(5)\nfor more information.) This option is mandatory. Note that the usual specifier expansion is applied\nto this setting, literal percent characters should hence be written as \"\n%%\n\". If this mount is a bind mount and the specified path does not exist\nyet it is created as directory.\nWhere=\nÂ¶\nTakes an absolute path of a file or directory for the mount point; in particular, the\ndestination cannot be a symbolic link.  If the mount point does not exist at the time of mounting, it\nis created as either a directory or a file. The former is the usual case; the latter is done only if this mount\nis a bind mount and the source (\nWhat=\n) is not a directory.\nThis string must be reflected in the unit filename. (See above.) This option\nis mandatory.\nType=\nÂ¶\nTakes a string for the file system type. See\nmount\n(8)\nfor details. This setting is optional.\nIf the type is \"\noverlay\n\", and \"\nupperdir=\n\" or\n\"\nworkdir=\n\" are specified as options and the directories do not exist, they will be created.\nOptions=\nÂ¶\nMount options to use when mounting. This takes a comma-separated list of options. This setting\nis optional. Note that the usual specifier expansion is applied to this setting, literal percent characters\nshould hence be written as \"\n%%\n\".\nSloppyOptions=\nÂ¶\nTakes a boolean argument. If true, parsing of\nthe options specified in\nOptions=\nis\nrelaxed, and unknown mount options are tolerated. This\ncorresponds with\nmount\n(8)\n's\n-s\nswitch. Defaults to\noff.\nAdded in version 215.\nLazyUnmount=\nÂ¶\nTakes a boolean argument. If true, detach the\nfilesystem from the filesystem hierarchy at time of the unmount\noperation, and clean up all references to the filesystem as\nsoon as they are not busy anymore.\nThis corresponds with\numount\n(8)\n's\n-l\nswitch. Defaults to\noff.\nAdded in version 232.\nReadWriteOnly=\nÂ¶\nTakes a boolean argument. If false, a mount\npoint that shall be mounted read-write but cannot be mounted\nso is retried to be mounted read-only. If true the operation\nwill fail immediately after the read-write mount attempt did\nnot succeed. This corresponds with\nmount\n(8)\n's\n-w\nswitch. Defaults to\noff.\nAdded in version 246.\nForceUnmount=\nÂ¶\nTakes a boolean argument. If true, force an\nunmount (in case of an unreachable NFS system).\nThis corresponds with\numount\n(8)\n's\n-f\nswitch. Defaults to\noff.\nAdded in version 232.\nDirectoryMode=\nÂ¶\nDirectories of mount points (and any parent\ndirectories) are automatically created if needed. This option\nspecifies the file system access mode used when creating these\ndirectories. Takes an access mode in octal notation. Defaults\nto 0755.\nTimeoutSec=\nÂ¶\nConfigures the time to wait for the mount\ncommand to finish. If a command does not exit within the\nconfigured time, the mount will be considered failed and be\nshut down again. All commands still running will be terminated\nforcibly via\nSIGTERM\n, and after another\ndelay of this time with\nSIGKILL\n. (See\nKillMode=\nin\nsystemd.kill\n(5)\n.)\nTakes a unit-less value in seconds, or a time span value such\nas \"5min 20s\". Pass 0 to disable the timeout logic. The\ndefault value is set from\nDefaultTimeoutStartSec=\noption in\nsystemd-system.conf\n(5)\n.\nCheck\nsystemd.unit\n(5)\n,\nsystemd.exec\n(5)\n, and\nsystemd.kill\n(5)\nfor more\nsettings.\nSee Also\nÂ¶\nsystemd\n(1)\n,\nsystemctl\n(1)\n,\nsystemd-system.conf\n(5)\n,\nsystemd.unit\n(5)\n,\nsystemd.exec\n(5)\n,\nsystemd.kill\n(5)\n,\nsystemd.resource-control\n(5)\n,\nsystemd.service\n(5)\n,\nsystemd.device\n(5)\n,\nproc\n(5)\n,\nmount\n(8)\n,\nsystemd-fstab-generator\n(8)\n,\nsystemd.directives\n(7)\n,\nsystemd-mount\n(1)", "metadata": {"source_type": "vendor_docs", "trust": "vendor_docs", "os": "linux", "distro": "ubuntu-22.04", "license": "CC BY-SA (assumed; verify per site)", "attribution_url": "https://www.freedesktop.org/software/systemd/man/latest/systemd.mount.html"}}
{"text": "systemd.socket\nIndex\nÂ·\nDirectives\nsystemd 258\nName\nsystemd.socket â Socket unit configuration\nSynopsis\nsocket\n.socket\nDescription\nÂ¶\nA unit configuration file whose name ends in\n\"\n.socket\n\" encodes information about an IPC or\nnetwork socket or a file system FIFO controlled and supervised by\nsystemd, for socket-based activation.\nThis man page lists the configuration options specific to\nthis unit type. See\nsystemd.unit\n(5)\nfor the common options of all unit configuration files. The common\nconfiguration items are configured in the generic [Unit] and\n[Install] sections. The socket specific configuration options are\nconfigured in the [Socket] section.\nAdditional options are listed in\nsystemd.exec\n(5)\n,\nwhich define the execution environment the\nExecStartPre=\n,\nExecStartPost=\n,\nExecStopPre=\nand\nExecStopPost=\ncommands are executed in, and in\nsystemd.kill\n(5)\n,\nwhich define the way the processes are terminated, and in\nsystemd.resource-control\n(5)\n,\nwhich configure resource control settings for the processes of the\nsocket.\nFor each socket unit, a matching service unit must exist,\ndescribing the service to start on incoming traffic on the socket\n(see\nsystemd.service\n(5)\nfor more information about .service units). The name of the\n.service unit is by default the same as the name of the .socket\nunit, but can be altered with the\nService=\noption\ndescribed below. Depending on the setting of the\nAccept=\noption described below, this .service\nunit must either be named like the .socket unit, but with the\nsuffix replaced, unless overridden with\nService=\n;\nor it must be a template unit named the same way. Example: a\nsocket file\nfoo.socket\nneeds a matching\nservice\nfoo.service\nif\nAccept=no\nis set. If\nAccept=yes\nis set, a service template\nfoo@.service\nmust exist from which services\nare instantiated for each incoming connection.\nNo implicit\nWantedBy=\nor\nRequiredBy=\ndependency from the socket to the\nservice is added. This means that the service may be started\nwithout the socket, in which case it must be able to open sockets\nby itself. To prevent this, an explicit\nRequires=\ndependency may be added.\nSocket units may be used to implement on-demand starting of\nservices, as well as parallelized starting of services. See the\nblog stories linked at the end for an introduction.\nNote that the daemon software configured for socket activation with socket units needs to be able\nto accept sockets from systemd, either via systemd's native socket passing interface (see\nsd_listen_fds\n(3)\nfor\ndetails about the precise protocol used and the order in which the file descriptors are passed) or via\ntraditional\ninetd\n(8)\n-style\nsocket passing (i.e. sockets passed in via standard input and output, using\nStandardInput=socket\nin the service file).\nAll network sockets allocated through\n.socket\nunits are allocated in the host's network\nnamespace (see\nnetwork_namespaces\n(7)\n). This\ndoes not mean however that the service activated by a configured socket unit has to be part of the host's network\nnamespace as well.  It is supported and even good practice to run services in their own network namespace (for\nexample through\nPrivateNetwork=\n, see\nsystemd.exec\n(5)\n), receiving only\nthe sockets configured through socket-activation from the host's namespace. In such a set-up communication within\nthe host's network namespace is only permitted through the activation sockets passed in while all sockets allocated\nfrom the service code itself will be associated with the service's own namespace, and thus possibly subject to a\nrestrictive configuration.\nAutomatic Dependencies\nÂ¶\nImplicit Dependencies\nÂ¶\nThe following dependencies are implicitly added:\nSocket units automatically gain a\nBefore=\ndependency on the service units they activate.\nSocket units referring to file system paths (such as\nAF_UNIX\nsockets or FIFOs) implicitly gain\nRequires=\nand\nAfter=\ndependencies on all mount units necessary to access those paths.\nSocket units using the\nBindToDevice=\nsetting automatically gain a\nBindsTo=\nand\nAfter=\ndependency on the device unit\nencapsulating the specified network interface.\nAdditional implicit dependencies may be added as result of\nexecution and resource control parameters as documented in\nsystemd.exec\n(5)\nand\nsystemd.resource-control\n(5)\n.\nDefault Dependencies\nÂ¶\nThe following dependencies are added unless\nDefaultDependencies=no\nis set:\nSocket units automatically gain a\nBefore=\ndependency on\nsockets.target\n.\nSocket units automatically gain a pair of\nAfter=\nand\nRequires=\ndependency on\nsysinit.target\n, and a pair of\nBefore=\nand\nConflicts=\ndependencies on\nshutdown.target\n. These\ndependencies ensure that the socket unit is started before normal\nservices at boot, and is stopped on shutdown. Only sockets\ninvolved with early boot or late system shutdown should disable\nDefaultDependencies=\noption.\nOptions\nÂ¶\nSocket unit files may include [Unit] and [Install] sections, which are described in\nsystemd.unit\n(5)\n.\nSocket unit files must include a [Socket] section, which carries\ninformation about the socket or FIFO it supervises. A number of\noptions that may be used in this section are shared with other\nunit types. These options are documented in\nsystemd.exec\n(5)\n,\nsystemd.kill\n(5)\nand\nsystemd.resource-control\n(5)\n.\nThe options specific to the [Socket] section of socket units are\nthe following:\nListenStream=\n,\nListenDatagram=\n,\nListenSequentialPacket=\nÂ¶\nSpecifies an address to listen on for a stream\n(\nSOCK_STREAM\n), datagram\n(\nSOCK_DGRAM\n), or sequential packet\n(\nSOCK_SEQPACKET\n) socket, respectively.\nThe address can be written in various formats:\nIf the address starts with a slash\n(\"\n/\n\"), it is read as file system socket in\nthe\nAF_UNIX\nsocket family.\nIf the address starts with an at symbol\n(\"\n@\n\"), it is read as abstract namespace\nsocket in the\nAF_UNIX\nfamily. The\n\"\n@\n\" is replaced with a\nNUL\ncharacter before binding. For\ndetails, see\nunix\n(7)\n.\nIf the address string is a single number, it is read as\nport number to listen on via IPv6. Depending on the value of\nBindIPv6Only=\n(see below) this might result\nin the service being available via both IPv6 and IPv4\n(default) or just via IPv6.\nIf the address string is a string in the format\n\"\nv.w.x.y\n:\nz\n\", it is interpreted\nas IPv4 address\nv.w.x.y\nand port\nz\n.\nIf the address string is a string in the format\n\"\n[\nx\n]:\ny\n\", it is interpreted as\nIPv6 address\nx\nand port\ny\n. An optional\ninterface scope (interface name or number) may be specified after a \"\n%\n\" symbol:\n\"\n[\nx\n]:\ny\n%\ndev\n\".\nInterface scopes are only useful with link-local addresses, because the kernel ignores them in other\ncases. Note that if an address is specified as IPv6, it might still make the service available via\nIPv4 too, depending on the\nBindIPv6Only=\nsetting (see below).\nIf the address string is a string in the format\n\"\nvsock:\nx\n:\ny\n\", it is read as CID\nx\non a port\ny\naddress in the\nAF_VSOCK\nfamily.  The CID is a unique 32-bit integer identifier in\nAF_VSOCK\nanalogous to an IP address.  Specifying the CID is optional, and may be\nset to the empty string. \"\nvsock\n\" may be replaced with\n\"\nvsock-stream\n\", \"\nvsock-dgram\n\" or \"\nvsock-seqpacket\n\"\nto force usage of the corresponding socket type.\nNote that\nSOCK_SEQPACKET\n(i.e.\nListenSequentialPacket=\n) is only available\nfor\nAF_UNIX\nsockets.\nSOCK_STREAM\n(i.e.\nListenStream=\n) when used for IP sockets\nrefers to TCP sockets,\nSOCK_DGRAM\n(i.e.\nListenDatagram=\n) to UDP.\nThese options may be specified more than once, in which\ncase incoming traffic on any of the sockets will trigger\nservice activation, and all listed sockets will be passed to\nthe service, regardless of whether there is incoming traffic\non them or not. If the empty string is assigned to any of\nthese options, the list of addresses to listen on is reset,\nall prior uses of any of these options will have no\neffect.\nIt is also possible to have more than one socket unit\nfor the same service when using\nService=\n,\nand the service will receive all the sockets configured in all\nthe socket units. Sockets configured in one unit are passed in\nthe order of configuration, but no ordering between socket\nunits is specified.\nIf an IP address is used here, it is often desirable to\nlisten on it before the interface it is configured on is up\nand running, and even regardless of whether it will be up and\nrunning at any point. To deal with this, it is recommended to\nset the\nFreeBind=\noption described\nbelow.\nListenFIFO=\nÂ¶\nSpecifies a file system FIFO (see\nfifo\n(7)\nfor\ndetails) to listen on.  This expects an absolute file system path as argument.  Behavior otherwise is\nvery similar to the\nListenDatagram=\ndirective above.\nListenSpecial=\nÂ¶\nSpecifies a special file in the file system to\nlisten on. This expects an absolute file system path as\nargument. Behavior otherwise is very similar to the\nListenFIFO=\ndirective above. Use this to\nopen character device nodes as well as special files in\n/proc/\nand\n/sys/\n.\nListenNetlink=\nÂ¶\nSpecifies a Netlink family to create a socket\nfor to listen on. This expects a short string referring to the\nAF_NETLINK\nfamily name (such as\naudit\nor\nkobject-uevent\n)\nas argument, optionally suffixed by a whitespace followed by a\nmulticast group integer. Behavior otherwise is very similar to\nthe\nListenDatagram=\ndirective\nabove.\nListenMessageQueue=\nÂ¶\nSpecifies a POSIX message queue name to listen on (see\nmq_overview\n(7)\nfor details). This expects a valid message queue name (i.e. beginning with\n\"\n/\n\"). Behavior otherwise is very similar to the\nListenFIFO=\ndirective above. On Linux message queue descriptors are actually file descriptors and can be\ninherited between processes.\nListenUSBFunction=\nÂ¶\nSpecifies a\nUSB\nFunctionFS\nendpoints location to listen on, for\nimplementation of USB gadget functions. This expects an\nabsolute file system path of a FunctionFS mount point as the argument.\nBehavior otherwise is very similar to the\nListenFIFO=\ndirective above. Use this to open the FunctionFS endpoint\nep0\n. When using this option, the\nactivated service has to have the\nUSBFunctionDescriptors=\nand\nUSBFunctionStrings=\noptions set.\nAdded in version 227.\nSocketProtocol=\nÂ¶\nTakes one of\nudplite\n,\nsctp\nor\nmptcp\n. The socket will use\nthe UDP-Lite (\nIPPROTO_UDPLITE\n), SCTP\n(\nIPPROTO_SCTP\n) or MPTCP\n(\nIPPROTO_MPTCP\n) protocol, respectively.\nAdded in version 229.\nBindIPv6Only=\nÂ¶\nTakes one of\ndefault\n,\nboth\nor\nipv6-only\n. Controls\nthe IPV6_V6ONLY socket option (see\nipv6\n(7)\nfor details). If\nboth\n, IPv6 sockets bound\nwill be accessible via both IPv4 and IPv6. If\nipv6-only\n, they will be accessible via IPv6\nonly. If\ndefault\n(which is the default,\nsurprise!), the system wide default setting is used, as\ncontrolled by\n/proc/sys/net/ipv6/bindv6only\n, which in\nturn defaults to the equivalent of\nboth\n.\nBacklog=\nÂ¶\nTakes an unsigned 32-bit integer argument. Specifies the number of connections to\nqueue that have not been accepted yet. This setting matters only for stream and sequential packet\nsockets. See\nlisten\n(2)\nfor\ndetails. Defaults to 4294967295. Note that this value is silently capped by the\n\"\nnet.core.somaxconn\n\" sysctl, which typically defaults to 4096, so typically\nthe sysctl is the setting that actually matters.\nBindToDevice=\nÂ¶\nSpecifies a network interface name to bind this socket to. If set, traffic will only\nbe accepted from the specified network interfaces. This controls the\nSO_BINDTODEVICE\nsocket option (see\nsocket\n(7)\nfor\ndetails). If this option is used, an implicit dependency from this socket unit on the network\ninterface device unit is created\n(see\nsystemd.device\n(5)\n).\nNote that setting this parameter might result in additional dependencies to be added to the unit (see\nabove).\nSocketUser=\n,\nSocketGroup=\nÂ¶\nTakes a UNIX user/group name. When specified, all\nAF_UNIX\nsockets, FIFO nodes, and message queues are owned by the specified user and group. If unset (the\ndefault), the nodes are owned by the root user/group (if run in system context) or the invoking\nuser/group (if run in user context).  If only a user is specified but no group, then the group is\nderived from the user's default group.\nAdded in version 214.\nSocketMode=\nÂ¶\nIf listening on a file system socket, FIFO, or message queue, this option specifies\nthe file system access mode used when creating the file node. Takes an access mode in octal notation.\nDefaults to 0666.\nDirectoryMode=\nÂ¶\nIf listening on a file system socket or FIFO,\nthe parent directories are automatically created if needed.\nThis option specifies the file system access mode used when\ncreating these directories. Takes an access mode in octal\nnotation. Defaults to 0755.\nAccept=\nÂ¶\nTakes a boolean argument. If yes, a service instance is spawned for each incoming\nconnection and only the connection socket is passed to it. If no, all listening sockets themselves\nare passed to the started service unit, and only one service unit is spawned for all connections\n(also see above). This value is ignored for datagram sockets and FIFOs where a single service unit\nunconditionally handles all incoming traffic. Defaults to\nno\n.\nTypically, for performance sensitive services, a choice of\nAccept=no\nis\npreferable, since that way only the first connection will have to pay the activation resource\ncost. On the other hand, for sporadically used services\nAccept=yes\ncan be preferable\nas it simplifies the implementation (as the service program code only has to process a single\nconnection instead of handling multiple) and enables stronger security (since the various sandboxing\noptions can be used to isolate parallel connections from each other, as each is serviced by a\nseparate service instance and process).\nA service listening on an\nAF_UNIX\nsocket may, but does not need to, call\nclose\n(2)\non the\nreceived socket before exiting. However, it must not unlink the socket from a file system. It should\nnot invoke\nshutdown\n(2)\non\nsockets it got with\nAccept=no\n, but it may do so for sockets it got with\nAccept=yes\nset.\nSetting\nAccept=yes\nis in particular useful for allowing daemons designed for\nusage with\ninetd\n(8)\nto work\nunmodified with systemd socket activation.\nNote that depending on this setting the services activated by units of this type are either\nregular services (in case of\nAccept=\nno\n) or instances of templated\nservices (in case of\nAccept=\nyes\n). See the Description section\nabove for a more detailed discussion of the naming rules of triggered services.\nFor IPv4 and IPv6 connections, the\n$REMOTE_ADDR\nenvironment variable will\ncontain the remote IP address, and\n$REMOTE_PORT\nwill contain the remote port\nnumber. These two variables correspond to those defined by the CGI interface for web services (see\nRFC 3875\n).\nFor\nAF_UNIX\nsocket connections, the\n$REMOTE_ADDR\nenvironment variable will contain either the remote socket's file system path starting with a slash\n(\"\n/\n\") or its address in the abstract namespace starting with an at symbol\n(\"\n@\n\"). If the socket is unnamed,\n$REMOTE_ADDR\nwill not be\nset.\nIf\nAccept=yes\nis used, the activated service process will have set the\n$SO_COOKIE\nenvironment variable to the Linux socket cookie, formatted as decimal\ninteger. The socket cookie can otherwise be acquired via\ngetsockopt\n(7)\n.\nIt is recommended to set\nCollectMode=inactive-or-failed\nfor service\ninstances activated via\nAccept=yes\n, to ensure that failed connection services are\ncleaned up and released from memory, and do not accumulate.\nWritable=\nÂ¶\nTakes a boolean argument. May only be used in\nconjunction with\nListenSpecial=\n. If true,\nthe specified special file is opened in read-write mode, if\nfalse, in read-only mode. Defaults to false.\nAdded in version 227.\nFlushPending=\nÂ¶\nTakes a boolean argument. May only be used when\nAccept=no\n. If yes, the socket's buffers are cleared after the\ntriggered service exited. This causes any pending data to be\nflushed and any pending incoming connections to be rejected. If no, the\nsocket's buffers will not be cleared, permitting the service to handle any\npending connections after restart, which is the usually expected behaviour.\nDefaults to\nno\n.\nAdded in version 247.\nMaxConnections=\nÂ¶\nThe maximum number of connections to simultaneously run services instances for, when\nAccept=yes\nis set. If more concurrent connections are coming in, they will be refused\nuntil at least one existing connection is terminated. This setting has no effect on sockets configured\nwith\nAccept=no\nor datagram sockets. Defaults to 64.\nMaxConnectionsPerSource=\nÂ¶\nThe maximum number of connections for a service per source IP address (in case of\nIPv4/IPv6), per source CID (in case of\nAF_VSOCK\n), or source UID (in case of\nAF_UNIX\n). This is very similar to the\nMaxConnections=\ndirective above. Defaults to 0, i.e. disabled.\nAdded in version 232.\nKeepAlive=\nÂ¶\nTakes a boolean argument. If true, the TCP/IP stack will send a keep alive message\nafter 2h (depending on the configuration of\n/proc/sys/net/ipv4/tcp_keepalive_time\n) for all TCP streams accepted on this\nsocket. This controls the\nSO_KEEPALIVE\nsocket option (see\nsocket\n(7)\nand\nthe\nTCP Keepalive\nHOWTO\nfor details.) Defaults to\nfalse\n.\nKeepAliveTimeSec=\nÂ¶\nTakes time (in seconds) as argument. The connection needs to remain\nidle before TCP starts sending keepalive probes. This controls the TCP_KEEPIDLE\nsocket option (see\nsocket\n(7)\nand the\nTCP\nKeepalive HOWTO\nfor details.)\nDefault value is 7200 seconds (2 hours).\nAdded in version 216.\nKeepAliveIntervalSec=\nÂ¶\nTakes time (in seconds) as argument between individual keepalive probes, if the\nsocket option\nSO_KEEPALIVE\nhas been set on this socket. This controls the\nTCP_KEEPINTVL\nsocket option (see\nsocket\n(7)\nand\nthe\nTCP Keepalive\nHOWTO\nfor details.) Default value is 75 seconds.\nAdded in version 216.\nKeepAliveProbes=\nÂ¶\nTakes an integer as argument. It is the number of\nunacknowledged probes to send before considering the\nconnection dead and notifying the application layer. This\ncontrols the TCP_KEEPCNT socket option (see\nsocket\n(7)\nand the\nTCP\nKeepalive HOWTO\nfor details.) Default value is\n9.\nAdded in version 216.\nNoDelay=\nÂ¶\nTakes a boolean argument. TCP Nagle's\nalgorithm works by combining a number of small outgoing\nmessages, and sending them all at once. This controls the\nTCP_NODELAY socket option (see\ntcp\n(7)\n).\nDefaults to\nfalse\n.\nAdded in version 216.\nPriority=\nÂ¶\nTakes an integer argument controlling the priority for all traffic sent from this\nsocket. This controls the\nSO_PRIORITY\nsocket option (see\nsocket\n(7)\nfor\ndetails.).\nDeferAcceptSec=\nÂ¶\nTakes time (in seconds) as argument. If set,\nthe listening process will be awakened only when data arrives\non the socket, and not immediately when connection is\nestablished. When this option is set, the\nTCP_DEFER_ACCEPT\nsocket option will be\nused (see\ntcp\n(7)\n),\nand the kernel will ignore initial ACK packets without any\ndata. The argument specifies the approximate amount of time\nthe kernel should wait for incoming data before falling back\nto the normal behavior of honoring empty ACK packets. This\noption is beneficial for protocols where the client sends the\ndata first (e.g. HTTP, in contrast to SMTP), because the\nserver process will not be woken up unnecessarily before it\ncan take any action.\nIf the client also uses the\nTCP_DEFER_ACCEPT\noption, the latency of\nthe initial connection may be reduced, because the kernel will\nsend data in the final packet establishing the connection (the\nthird packet in the \"three-way handshake\").\nDisabled by default.\nAdded in version 216.\nReceiveBuffer=\n,\nSendBuffer=\nÂ¶\nTakes an integer argument controlling the receive or send buffer sizes of this\nsocket, respectively.  This controls the\nSO_RCVBUF\nand\nSO_SNDBUF\nsocket options (see\nsocket\n(7)\nfor\ndetails.). The usual suffixes K, M, G are supported and are understood to the base of\n1024.\nIPTOS=\nÂ¶\nTakes an integer argument controlling the IP Type-Of-Service field for packets\ngenerated from this socket.  This controls the\nIP_TOS\nsocket option (see\nip\n(7)\nfor\ndetails.). Either a numeric string or one of\nlow-delay\n,\nthroughput\n,\nreliability\nor\nlow-cost\nmay be specified.\nIPTTL=\nÂ¶\nTakes an integer argument controlling the IPv4 Time-To-Live/IPv6 Hop-Count field for\npackets generated from this socket. This sets the\nIP_TTL\n/\nIPV6_UNICAST_HOPS\nsocket options (see\nip\n(7)\nand\nipv6\n(7)\nfor\ndetails.)\nMark=\nÂ¶\nTakes an integer value. Controls the firewall mark of packets generated by this\nsocket. This can be used in the firewall logic to filter packets from this socket. This sets the\nSO_MARK\nsocket option. See\niptables\n(8)\nfor\ndetails.\nReusePort=\nÂ¶\nTakes a boolean value. If true, allows multiple\nbind\n(2)\ns to this TCP\nor UDP port. This controls the\nSO_REUSEPORT\nsocket option. See\nsocket\n(7)\nfor\ndetails.\nAdded in version 206.\nSmackLabel=\n,\nSmackLabelIPIn=\n,\nSmackLabelIPOut=\nÂ¶\nTakes a string value. Controls the extended\nattributes \"\nsecurity.SMACK64\n\",\n\"\nsecurity.SMACK64IPIN\n\" and\n\"\nsecurity.SMACK64IPOUT\n\", respectively, i.e.\nthe security label of the FIFO, or the security label for the\nincoming or outgoing connections of the socket, respectively.\nSee\nSmack\nfor details.\nAdded in version 196.\nSELinuxContextFromNet=\nÂ¶\nTakes a boolean argument. When true, systemd\nwill attempt to figure out the SELinux label used for the\ninstantiated service from the information handed by the peer\nover the network. Note that only the security level is used\nfrom the information provided by the peer. Other parts of the\nresulting SELinux context originate from either the target\nbinary that is effectively triggered by socket unit or from\nthe value of the\nSELinuxContext=\noption.\nThis configuration option applies only when activated service\nis passed in single socket file descriptor, i.e. service\ninstances that have standard input connected to a socket or\nservices triggered by exactly one socket unit. Also note\nthat this option is useful only when MLS/MCS SELinux policy\nis deployed. Defaults to\n\"\nfalse\n\".\nAdded in version 217.\nPipeSize=\nÂ¶\nTakes a size in bytes. Controls the pipe\nbuffer size of FIFOs configured in this socket unit. See\nfcntl\n(2)\nfor details. The usual suffixes K, M, G are supported and are\nunderstood to the base of 1024.\nMessageQueueMaxMessages=\n,\nMessageQueueMessageSize=\nÂ¶\nThese two settings take integer values and\ncontrol the mq_maxmsg field or the mq_msgsize field,\nrespectively, when creating the message queue. Note that\neither none or both of these variables need to be set. See\nmq_setattr\n(3)\nfor details.\nFreeBind=\nÂ¶\nTakes a boolean value. Controls whether the socket can be bound to non-local IP\naddresses. This is useful to configure sockets listening on specific IP addresses before those IP\naddresses are successfully configured on a network interface. This sets the\nIP_FREEBIND\n/\nIPV6_FREEBIND\nsocket option. For robustness\nreasons it is recommended to use this option whenever you bind a socket to a specific IP\naddress. Defaults to\nfalse\n.\nTransparent=\nÂ¶\nTakes a boolean value. Controls the\nIP_TRANSPARENT\n/\nIPV6_TRANSPARENT\nsocket option. Defaults to\nfalse\n.\nBroadcast=\nÂ¶\nTakes a boolean value. This controls the\nSO_BROADCAST\nsocket\noption, which allows broadcast datagrams to be sent from this socket. Defaults to\nfalse\n.\nPassCredentials=\nÂ¶\nTakes a boolean value. This controls the\nSO_PASSCRED\nsocket\noption, which allows\nAF_UNIX\nsockets to receive the credentials of the sending\nprocess in an ancillary message. Defaults to\nfalse\n.\nPassPIDFD=\nÂ¶\nTakes a boolean value. This controls the\nSO_PASSPIDFD\nsocket\noption, which allows\nAF_UNIX\nsockets to receive the pidfd of the sending\nprocess in an ancillary message. Defaults to\nfalse\n.\nAdded in version 258.\nPassSecurity=\nÂ¶\nTakes a boolean value. This controls the\nSO_PASSSEC\nsocket\noption, which allows\nAF_UNIX\nsockets to receive the security context of the\nsending process in an ancillary message.  Defaults to\nfalse\n.\nPassPacketInfo=\nÂ¶\nTakes a boolean value. This controls the\nIP_PKTINFO\n,\nIPV6_RECVPKTINFO\n,\nNETLINK_PKTINFO\nor\nPACKET_AUXDATA\nsocket options, which enable reception of additional per-packet\nmetadata as ancillary message, on\nAF_INET\n,\nAF_INET6\n,\nAF_UNIX\nand\nAF_PACKET\nsockets.  Defaults to\nfalse\n.\nAdded in version 246.\nAcceptFileDescriptors=\nÂ¶\nTakes a boolean value. This controls the\nSO_PASSRIGHTS\nsocket\noption, which when disabled prohibits the peer from sending\nSCM_RIGHTS\nancillary messages (aka file descriptors) via\nAF_UNIX\nsockets. Defaults to\ntrue\n.\nAdded in version 258.\nTimestamping=\nÂ¶\nTakes one of \"\noff\n\", \"\nus\n\" (alias:\n\"\nusec\n\", \"\nÎ¼s\n\") or \"\nns\n\" (alias:\n\"\nnsec\n\"). This controls the\nSO_TIMESTAMP\nor\nSO_TIMESTAMPNS\nsocket options, and enables whether ingress network traffic shall\ncarry timestamping metadata. Defaults to\noff\n.\nAdded in version 247.\nTCPCongestion=\nÂ¶\nTakes a string value. Controls the TCP congestion algorithm used by this\nsocket. Should be one of \"\nwestwood\n\", \"\nreno\n\",\n\"\ncubic\n\", \"\nlp\n\" or any other available algorithm supported by the IP\nstack. This setting applies only to stream sockets.\nExecStartPre=\n,\nExecStartPost=\nÂ¶\nTakes one or more command lines, which are\nexecuted before or after the listening sockets/FIFOs are\ncreated and bound, respectively. The first token of the\ncommand line must be an absolute filename, then followed by\narguments for the process. Multiple command lines may be\nspecified following the same scheme as used for\nExecStartPre=\nof service unit\nfiles.\nExecStopPre=\n,\nExecStopPost=\nÂ¶\nAdditional commands that are executed before\nor after the listening sockets/FIFOs are closed and removed,\nrespectively. Multiple command lines may be specified\nfollowing the same scheme as used for\nExecStartPre=\nof service unit\nfiles.\nTimeoutSec=\nÂ¶\nConfigures the time to wait for the commands\nspecified in\nExecStartPre=\n,\nExecStartPost=\n,\nExecStopPre=\nand\nExecStopPost=\nto finish. If a command does\nnot exit within the configured time, the socket will be\nconsidered failed and be shut down again. All commands still\nrunning will be terminated forcibly via\nSIGTERM\n, and after another delay of this\ntime with\nSIGKILL\n. (See\nKillMode=\nin\nsystemd.kill\n(5)\n.)\nTakes a unit-less value in seconds, or a time span value such\nas \"5min 20s\". Pass \"\n0\n\" to disable the\ntimeout logic. Defaults to\nDefaultTimeoutStartSec=\nfrom the manager\nconfiguration file (see\nsystemd-system.conf\n(5)\n).\nService=\nÂ¶\nSpecifies the service unit name to activate on\nincoming traffic. This setting is only allowed for sockets\nwith\nAccept=no\n. It defaults to the service\nthat bears the same name as the socket (with the suffix\nreplaced). In most cases, it should not be necessary to use\nthis option. Note that setting this parameter might result in\nadditional dependencies to be added to the unit (see\nabove).\nRemoveOnStop=\nÂ¶\nTakes a boolean argument. If enabled, any file nodes created by this socket unit are\nremoved when it is stopped. This applies to\nAF_UNIX\nsockets in the file system,\nPOSIX message queues, FIFOs, as well as any symlinks to them configured with\nSymlinks=\n. Normally, it should not be necessary to use this option, and is not\nrecommended as services might continue to run after the socket unit has been terminated and it should\nstill be possible to communicate with them via their file system node. Defaults to\noff.\nAdded in version 214.\nSymlinks=\nÂ¶\nTakes a list of file system paths. The specified paths will be created as symlinks to the\nAF_UNIX\nsocket path or FIFO path of this socket unit. If this setting is used, only one\nAF_UNIX\nsocket in the file system or one FIFO may be configured for the socket unit. Use\nthis option to manage one or more symlinked alias names for a socket, binding their lifecycle together. Note\nthat if creation of a symlink fails this is not considered fatal for the socket unit, and the socket unit may\nstill start. If an empty string is assigned, the list of paths is reset. Defaults to an empty\nlist.\nAdded in version 214.\nFileDescriptorName=\nÂ¶\nAssigns a name to all file descriptors this socket unit encapsulates.\nThis is useful to help activated services identify specific file descriptors, if multiple fds are passed.\nServices may use the\nsd_listen_fds_with_names\n(3)\ncall to acquire the names configured for the received file descriptors. Names may contain any ASCII character,\nbut must exclude control characters and \"\n:\n\", and must be at most 255 characters in length.\nIf this setting is not used, the file descriptor name defaults to the name of the socket unit\n(including its\n.socket\nsuffix) when\nAccept=no\n,\n\"\nconnection\n\" otherwise.\nAdded in version 227.\nTriggerLimitIntervalSec=\n,\nTriggerLimitBurst=\nÂ¶\nConfigures a limit on how often this socket unit may be activated within a specific\ntime interval. The\nTriggerLimitIntervalSec=\nsetting may be used to configure the\nlength of the time interval in the usual time units \"\nus\n\", \"\nms\n\",\n\"\ns\n\", \"\nmin\n\", \"\nh\n\", â¦ and defaults to 2s (See\nsystemd.time\n(7)\nfor\ndetails on the various time units understood). The\nTriggerLimitBurst=\nsetting\ntakes a positive integer value and specifies the number of permitted activations per time interval,\nand defaults to 200 for\nAccept=yes\nsockets (thus by default permitting 200\nactivations per 2s), and 20 otherwise (20 activations per 2s). Set either to 0 to disable any form of\ntrigger rate limiting.\nIf the limit is hit, the socket unit is placed into a failure mode, and will not be connectible\nanymore until restarted. Note that this limit is enforced before the service activation is\nenqueued.\nCompare with\nPollLimitIntervalSec=\n/\nPollLimitBurst=\ndescribed below, which implements a temporary slowdown if a socket unit is flooded with incoming\ntraffic, as opposed to the permanent failure state\nTriggerLimitIntervalSec=\n/\nTriggerLimitBurst=\nresults in.\nAdded in version 230.\nPollLimitIntervalSec=\n,\nPollLimitBurst=\nÂ¶\nConfigures a limit on how often polling events on the file descriptors backing this\nsocket unit will be considered. This pair of settings is similar to\nTriggerLimitIntervalSec=\n/\nTriggerLimitBurst=\nbut instead of\nputting a (fatal) limit on the activation frequency puts a (transient) limit on the polling\nfrequency. The expected parameter syntax and range are identical to that of the aforementioned\noptions, and can be disabled the same way.\nIf the polling limit is hit polling is temporarily disabled on it until the specified time\nwindow passes. The polling limit hence slows down connection attempts if hit, but unlike the trigger\nlimit will not cause permanent failures. It's the recommended mechanism to deal with DoS attempts\nthrough packet flooding.\nThe polling limit is enforced per file descriptor to listen on, as opposed to the trigger limit\nwhich is enforced for the entire socket unit. This distinction matters for socket units that listen\non multiple file descriptors (i.e. have multiple\nListenXYZ=\nstanzas).\nThese setting defaults to 150 (in case of\nAccept=yes\n) and 15 (otherwise)\npolling events per 2s. This is considerably lower than the default values for the trigger limit (see\nabove) and means that the polling limit should typically ensure the trigger limit is never hit,\nunless one of them is reconfigured or disabled.\nAdded in version 255.\nDeferTrigger=\nÂ¶\nTakes a boolean argument, or \"\npatient\n\". May only be used when\nAccept=no\n.\nIf enabled, job mode \"\nlenient\n\" instead of \"\nreplace\n\" is used when\ntriggering the service, which means currently activating/running units that conflict with the service\nwon't be disturbed/brought down. Furthermore, if a conflict exists, the socket unit will wait for\ncurrent job queue to complete and potentially defer the activation by then. An upper limit of total time\nto wait can be configured via\nDeferTriggerMaxSec=\n. If set to\nyes\n,\nthe socket unit will fail if all jobs have finished or the timeout has been reached but the conflict remains.\nIf\npatient\n, always wait until\nDeferTriggerMaxSec=\nelapses.\nDefaults to no.\nThis setting is particularly useful if the socket unit should stay active across switch-root/soft-reboot\noperations while the triggered service is stopped.\nAdded in version 258.\nDeferTriggerMaxSec=\nÂ¶\nConfigures the maximum time to defer the triggering when\nDeferTrigger=\nis enabled. If the service cannot be activated within the specified time, the socket will be considered\nfailed and get terminated. Takes a unit-less value in seconds, or a time span value such as \"5min 20s\".\nPass \"\n0\n\" or \"\ninfinity\n\" to disable the timeout logic (the default).\nAdded in version 258.\nPassFileDescriptorsToExec=\nÂ¶\nTakes a boolean argument. Defaults to off. If enabled, file descriptors created by\nthe socket unit are passed to\nExecStartPost=\n,\nExecStopPre=\n, and\nExecStopPost=\ncommands from the socket unit. The passed file descriptors can be\naccessed with\nsd_listen_fds\n(3)\nas\nif the commands were invoked from the associated service units.  Note that\nExecStartPre=\ncommand cannot access socket file descriptors.\nAdded in version 256.\nCheck\nsystemd.unit\n(5)\n,\nsystemd.exec\n(5)\n, and\nsystemd.kill\n(5)\nfor more\nsettings.\nSee Also\nÂ¶\nsystemd\n(1)\n,\nsystemctl\n(1)\n,\nsystemd-system.conf\n(5)\n,\nsystemd.unit\n(5)\n,\nsystemd.exec\n(5)\n,\nsystemd.kill\n(5)\n,\nsystemd.resource-control\n(5)\n,\nsystemd.service\n(5)\n,\nsystemd.directives\n(7)\n,\nsd_listen_fds\n(3)\n,\nsd_listen_fds_with_names\n(3)\nFor more extensive descriptions see the \"systemd for Developers\" series:\nSocket Activation\n,\nSocket Activation, part II\n,\nConverting inetd Services\n,\nSocket Activated Internet Services and OS Containers\n.", "metadata": {"source_type": "vendor_docs", "trust": "vendor_docs", "os": "linux", "distro": "ubuntu-22.04", "license": "CC BY-SA (assumed; verify per site)", "attribution_url": "https://www.freedesktop.org/software/systemd/man/latest/systemd.socket.html"}}
{"text": "systemd.path\nIndex\nÂ·\nDirectives\nsystemd 258\nName\nsystemd.path â Path unit configuration\nSynopsis\npath\n.path\nDescription\nÂ¶\nA unit configuration file whose name ends in\n\"\n.path\n\" encodes information about a path\nmonitored by systemd, for path-based activation.\nThis man page lists the configuration options specific to\nthis unit type. See\nsystemd.unit\n(5)\nfor the common options of all unit configuration files. The common\nconfiguration items are configured in the generic [Unit] and\n[Install] sections. The path specific configuration options are\nconfigured in the [Path] section.\nFor each path file, a matching unit file must exist,\ndescribing the unit to activate when the path changes. By default,\na service by the same name as the path (except for the suffix) is\nactivated. Example: a path file\nfoo.path\nactivates a matching service\nfoo.service\n. The\nunit to activate may be controlled by\nUnit=\n(see below).\nInternally, path units use the\ninotify\n(7)\nAPI to monitor file systems. Due to that, it suffers by the same\nlimitations as inotify, and for example cannot be used to monitor\nfiles or directories changed by other machines on remote NFS file\nsystems.\nWhen a service unit triggered by a path unit terminates (regardless whether it exited successfully\nor failed), monitored paths are checked immediately again, and the service accordingly restarted\ninstantly. As protection against busy looping in this trigger/start cycle, a start rate limit is enforced\non the service unit, see\nStartLimitIntervalSec=\nand\nStartLimitBurst=\nin\nsystemd.unit\n(5)\n. Unlike\nother service failures, the error condition that the start rate limit is hit is propagated from the\nservice unit to the path unit and causes the path unit to fail as well, thus ending the loop.\nAutomatic Dependencies\nÂ¶\nImplicit Dependencies\nÂ¶\nThe following dependencies are implicitly added:\nIf a path unit is beneath another mount unit in the file\nsystem hierarchy, both a requirement and an ordering dependency\nbetween both units are created automatically.\nAn implicit\nBefore=\ndependency is added\nbetween a path unit and the unit it is supposed to activate.\nDefault Dependencies\nÂ¶\nThe following dependencies are added unless\nDefaultDependencies=no\nis set:\nPath units will automatically have dependencies of type\nBefore=\non\npaths.target\n,\ndependencies of type\nAfter=\nand\nRequires=\non\nsysinit.target\n, and have dependencies of type\nConflicts=\nand\nBefore=\non\nshutdown.target\n. These ensure that path units are terminated\ncleanly prior to system shutdown. Only path units involved with early boot or late system shutdown should\ndisable\nDefaultDependencies=\noption.\nOptions\nÂ¶\nPath unit files may include [Unit] and [Install] sections, which are described in\nsystemd.unit\n(5)\n.\nPath unit files must include a [Path] section, which carries information about the path or paths it\nmonitors. The options specific to the [Path] section of path units are the following:\nPathExists=\n,\nPathExistsGlob=\n,\nPathChanged=\n,\nPathModified=\n,\nDirectoryNotEmpty=\nÂ¶\nDefines paths to monitor for certain changes:\nPathExists=\nmay be used to watch the mere\nexistence of a file or directory. If the file specified\nexists, the configured unit is activated.\nPathExistsGlob=\nworks similarly, but checks\nfor the existence of at least one file matching the globbing\npattern specified.\nPathChanged=\nmay be used\nto watch a file or directory and activate the configured unit\nwhenever it changes. It is not activated on every write to the\nwatched file but it is activated if the file which was open\nfor writing gets closed.\nPathModified=\nis\nsimilar, but additionally it is activated also on simple\nwrites to the watched file.\nDirectoryNotEmpty=\nmay be used to watch a\ndirectory and activate the configured unit whenever it\ncontains at least one file.\nThe arguments of these directives must be absolute file\nsystem paths.\nMultiple directives may be combined, of the same and of\ndifferent types, to watch multiple paths. If the empty string\nis assigned to any of these options, the list of paths to\nwatch is reset, and any prior assignments of these options\nwill not have any effect.\nIf a path already exists (in case of\nPathExists=\nand\nPathExistsGlob=\n) or a directory already is\nnot empty (in case of\nDirectoryNotEmpty=\n)\nat the time the path unit is activated, then the configured\nunit is immediately activated as well. Something similar does\nnot apply to\nPathChanged=\nand\nPathModified=\n.\nIf the path itself or any of the containing directories are not accessible,\nsystemd\nwill watch for permission changes and notice that conditions are satisfied\nwhen permissions allow that.\nNote that files whose name starts with a dot (i.e. hidden files) are generally ignored when\nmonitoring these paths.\nUnit=\nÂ¶\nThe unit to activate when any of the\nconfigured paths changes. The argument is a unit name, whose\nsuffix is not \"\n.path\n\". If not specified, this\nvalue defaults to a service that has the same name as the path\nunit, except for the suffix. (See above.) It is recommended\nthat the unit name that is activated and the unit name of the\npath unit are named identical, except for the\nsuffix.\nMakeDirectory=\nÂ¶\nTakes a boolean argument. If true, the\ndirectories to watch are created before watching. This option\nis ignored for\nPathExists=\nsettings.\nDefaults to\nfalse\n.\nDirectoryMode=\nÂ¶\nIf\nMakeDirectory=\nis\nenabled, use the mode specified here to create the directories\nin question. Takes an access mode in octal notation. Defaults\nto\n0755\n.\nTriggerLimitIntervalSec=\n,\nTriggerLimitBurst=\nÂ¶\nConfigures a limit on how often this path unit may be activated within a specific\ntime interval. The\nTriggerLimitIntervalSec=\nmay be used to configure the length of\nthe time interval in the usual time units \"\nus\n\", \"\nms\n\",\n\"\ns\n\", \"\nmin\n\", \"\nh\n\", â¦ and defaults to 2s. See\nsystemd.time\n(7)\nfor\ndetails on the various time units understood. The\nTriggerLimitBurst=\nsetting takes\na positive integer value and specifies the number of permitted activations per time interval, and\ndefaults to 200. Set either to 0 to disable any form of trigger rate limiting. If the limit is hit,\nthe unit is placed into a failure mode, and will not watch the paths anymore until restarted. Note\nthat this limit is enforced before the service activation is enqueued.\nAdded in version 250.\nCheck\nsystemd.unit\n(5)\n,\nsystemd.exec\n(5)\n, and\nsystemd.kill\n(5)\nfor more\nsettings.\nSee Also\nÂ¶\nEnvironment variables with details on the trigger will be set for triggered units. See the\nsection \"\nEnvironment Variables Set or Propagated by the Service Manager\n\" in\nsystemd.exec\n(5)\nfor more details.\nsystemd\n(1)\n,\nsystemctl\n(1)\n,\nsystemd.unit\n(5)\n,\nsystemd.service\n(5)\n,\ninotify\n(7)\n,\nsystemd.directives\n(7)", "metadata": {"source_type": "vendor_docs", "trust": "vendor_docs", "os": "linux", "distro": "ubuntu-22.04", "license": "CC BY-SA (assumed; verify per site)", "attribution_url": "https://www.freedesktop.org/software/systemd/man/latest/systemd.path.html"}}
{"text": "systemd.target\nIndex\nÂ·\nDirectives\nsystemd 258\nName\nsystemd.target â Target unit configuration\nSynopsis\ntarget\n.target\nDescription\nÂ¶\nA unit configuration file whose name ends in \"\n.target\n\" encodes information about a\ntarget unit of systemd. Target units are used to group units and to set synchronization points for\nordering dependencies with other unit files.\nThis unit type has no specific options. See\nsystemd.unit\n(5)\nfor the\ncommon options of all unit configuration files. The common configuration items are configured in the\ngeneric [Unit] and [Install] sections. A separate [Target] section does not exist, since no\ntarget-specific options may be configured.\nTarget units do not offer any additional functionality on top of the generic functionality provided\nby units. They merely group units, allowing a single target name to be used in\nWants=\nand\nRequires=\nsettings to establish a dependency on a set of units defined by the\ntarget, and in\nBefore=\nand\nAfter=\nsettings to establish ordering.\nTargets establish standardized names for synchronization points during boot and shutdown. Importantly,\nsee\nsystemd.special\n(7)\nfor examples and descriptions of standard systemd targets.\nTarget units provide a more flexible replacement for SysV runlevels in the classic SysV init\nsystem.\nNote that a target unit file must not be empty, lest it be considered a masked unit. It is\nrecommended to provide a [Unit] section which includes informative\nDescription=\nand\nDocumentation=\noptions.\nAutomatic Dependencies\nÂ¶\nImplicit Dependencies\nÂ¶\nThere are no implicit dependencies for target units.\nDefault Dependencies\nÂ¶\nThe following dependencies are added unless\nDefaultDependencies=no\nis set:\nTarget units will automatically complement all configured dependencies of type\nWants=\nor\nRequires=\nwith dependencies of type\nAfter=\nunless\nDefaultDependencies=no\nis set in the specified\nunits.\nNote that the reverse is not true. For example, defining\nWants=that.target\nin\nsome.service\nwill not automatically add the\nAfter=that.target\nordering dependency for\nsome.service\n.\nInstead,\nsome.service\nshould use the primary synchronization function of target\ntype units, by setting a specific\nAfter=that.target\nor\nBefore=that.target\nordering dependency in its .service unit file.\nTarget units automatically gain\nConflicts=\nand\nBefore=\ndependencies against\nshutdown.target\n.\nOptions\nÂ¶\nTarget unit files may include [Unit] and [Install] sections, which are described in\nsystemd.unit\n(5)\n.\nNo options specific to this file type are supported.\nExample\nÂ¶\nExampleÂ 1.Â Simple standalone target\n# emergency-net.target\n[Unit]\nDescription=Emergency Mode with Networking\nRequires=emergency.target systemd-networkd.service\nAfter=emergency.target systemd-networkd.service\nAllowIsolate=yes\nWhen adding dependencies to other units, it is important to check if they set\nDefaultDependencies=\n. Service units, unless they set\nDefaultDependencies=no\n, automatically get a dependency on\nsysinit.target\n. In this case, both\nemergency.target\nand\nsystemd-networkd.service\nhave\nDefaultDependencies=no\n, so they are suitable for use\nin this target, and do not pull in\nsysinit.target\n.\nYou can now switch into this emergency mode by running\nsystemctl\nisolate emergency-net.target\nor by passing the option\nsystemd.unit=emergency-net.target\non the kernel command\nline.\nOther units can have\nWantedBy=emergency-net.target\nin the\n[Install]\nsection. After they are enabled using\nsystemctl enable\n, they will be started before\nemergency-net.target\nis started. It is also possible to add\narbitrary units as dependencies of\nemergency.target\nwithout\nmodifying them by using\nsystemctl add-wants\n.\nSee Also\nÂ¶\nsystemd\n(1)\n,\nsystemctl\n(1)\n,\nsystemd.unit\n(5)\n,\nsystemd.special\n(7)\n,\nsystemd.directives\n(7)", "metadata": {"source_type": "vendor_docs", "trust": "vendor_docs", "os": "linux", "distro": "ubuntu-22.04", "license": "CC BY-SA (assumed; verify per site)", "attribution_url": "https://www.freedesktop.org/software/systemd/man/latest/systemd.target.html"}}
{"text": "systemd.slice\nIndex\nÂ·\nDirectives\nsystemd 258\nName\nsystemd.slice â Slice unit configuration\nSynopsis\nslice\n.slice\nDescription\nÂ¶\nA unit configuration file whose name ends in \"\n.slice\n\" encodes information about a slice\nunit. A slice unit is a concept for hierarchically managing resources of a group of processes. This management is\nperformed by creating a node in the Linux Control Group (cgroup) tree. Units that manage processes (primarily scope\nand service units) may be assigned to a specific slice. For each slice, certain resource limits may be set that\napply to all processes of all units contained in that slice. Slices are organized hierarchically in a tree. The\nname of the slice encodes the location in the tree. The name consists of a dash-separated series of names, which\ndescribes the path to the slice from the root slice. The root slice is named\n-.slice\n. Example:\nfoo-bar.slice\nis a slice that is located within\nfoo.slice\n, which in turn\nis located in the root slice\n-.slice\n.\nNote that slice units cannot be templated, nor is possible to add multiple names to a slice unit by creating\nadditional symlinks to its unit file.\nBy default, service and scope units are placed in\nsystem.slice\n, virtual machines and containers\nregistered with\nsystemd-machined\n(8)\nare found in\nmachine.slice\n, and user sessions\nhandled by\nsystemd-logind\n(8)\nin\nuser.slice\n. See\nsystemd.special\n(7)\nfor more information.\nSee\nsystemd.unit\n(5)\nfor the common options of all unit configuration\nfiles. The common configuration items are configured\nin the generic [Unit] and [Install] sections. The\nslice specific configuration options are configured in\nthe [Slice] section. Currently, only generic resource control settings\nas described in\nsystemd.resource-control\n(5)\nare allowed.\nSee the\nNew\nControl Group Interfaces\nfor an introduction on how to make\nuse of slice units from programs.\nAutomatic Dependencies\nÂ¶\nImplicit Dependencies\nÂ¶\nThe following dependencies are implicitly added:\nSlice units automatically gain dependencies of type\nAfter=\nand\nRequires=\non\ntheir immediate parent slice unit.\nDefault Dependencies\nÂ¶\nThe following dependencies are added unless\nDefaultDependencies=no\nis set:\nSlice units will automatically have dependencies of type\nConflicts=\nand\nBefore=\non\nshutdown.target\n. These ensure that slice units are removed prior to system shutdown.\nOnly slice units involved with late system shutdown should disable\nDefaultDependencies=\noption.\nOptions\nÂ¶\nSlice unit files may include [Unit] and [Install] sections, which are described in\nsystemd.unit\n(5)\n.\nSlice files may include a [Slice] section. Many options that may be used in this section are shared\nwith other unit types. These options are documented in\nsystemd.resource-control\n(5)\n.\nThe options specific to the [Slice] section of slice units are the following:\nConcurrencyHardMax=\n,\nConcurrencySoftMax=\nÂ¶\nConfigures a hard and a soft limit on the maximum number of units assigned to this\nslice (or any descendent slices) that may be active at the same time. If the hard limit is reached no\nfurther units associated with the slice may be activated, and their activation will fail with an\nerror. If the soft limit is reached any further requested activation of units will be queued, but no\nimmediate error is generated. The queued activation job will remain queued until the number of\nconcurrent active units within the slice is below the limit again.\nIf the special value \"\ninfinity\n\" is specified, no concurrency limit is\nenforced. This is the default.\nNote that if multiple start jobs are queued for units, and all their dependencies are fulfilled\nthey'll be processed in an order that is dependent on the unit type, the CPU weight (for unit types\nthat know the concept, such as services), the nice level (similar), and finally in alphabetical order\nby the unit name. This may be used to influence dispatching order when using\nConcurrencySoftMax=\nto pace concurrency within a slice unit.\nNote that these options have a hierarchial effect: a limit set for a slice unit will apply to\nboth the units immediately within the slice, but also all units further down the slice tree. Also\nnote that each sub-slice unit counts as one unit each too, and thus when choosing a limit for a slice\nhierarchy the limit must provide room for both the payload units (i.e. services, mounts, â¦) and\nstructural units (i.e. slice units), if any are defined.\nAdded in version 258.\nSee Also\nÂ¶\nsystemd\n(1)\n,\nsystemd.unit\n(5)\n,\nsystemd.resource-control\n(5)\n,\nsystemd.service\n(5)\n,\nsystemd.scope\n(5)\n,\nsystemd.special\n(7)\n,\nsystemd.directives\n(7)", "metadata": {"source_type": "vendor_docs", "trust": "vendor_docs", "os": "linux", "distro": "ubuntu-22.04", "license": "CC BY-SA (assumed; verify per site)", "attribution_url": "https://www.freedesktop.org/software/systemd/man/latest/systemd.slice.html"}}
{"text": "systemd.scope\nIndex\nÂ·\nDirectives\nsystemd 258\nName\nsystemd.scope â Scope unit configuration\nSynopsis\nscope\n.scope\nDescription\nÂ¶\nScope units are not configured via unit configuration files,\nbut are only created programmatically using the bus interfaces of\nsystemd. They are named similar to filenames. A unit whose name\nends in \"\n.scope\n\" refers to a scope unit. Scopes\nunits manage a set of system processes. Unlike service units, scope\nunits manage externally created processes, and do not fork off\nprocesses on its own.\nThe main purpose of scope units is grouping worker processes\nof a system service for organization and for managing resources.\nsystemd-run\n--scope\nmay\nbe used to easily launch a command in a new scope unit from the\ncommand line.\nSee the\nNew\nControl Group Interfaces\nfor an introduction on how to make\nuse of scope units from programs.\nNote that, unlike service units, scope units have no \"main\" process: all processes in the scope are\nequivalent. The lifecycle of the scope unit is thus not bound to the lifetime of one specific process,\nbut to the existence of at least one process in the scope. This also means that the exit statuses of\nthese processes are not relevant for the scope unit failure state. Scope units may still enter a failure\nstate, for example due to resource exhaustion or stop timeouts being reached, but not due to programs\ninside of them terminating uncleanly. Since processes managed as scope units generally remain children of\nthe original process that forked them off, it is also the job of that process to collect their exit\nstatuses and act on them as needed.\nAutomatic Dependencies\nÂ¶\nImplicit Dependencies\nÂ¶\nImplicit dependencies may be added as result of\nresource control parameters as documented in\nsystemd.resource-control\n(5)\n.\nDefault Dependencies\nÂ¶\nThe following dependencies are added unless\nDefaultDependencies=no\nis set:\nScope units will automatically have dependencies of\ntype\nConflicts=\nand\nBefore=\non\nshutdown.target\n. These ensure\nthat scope units are removed prior to system\nshutdown. Only scope units involved with early boot or\nlate system shutdown should disable\nDefaultDependencies=\noption.\nOptions\nÂ¶\nScope files may include a [Unit] section, which is described in\nsystemd.unit\n(5)\n.\nScope files may include a [Scope]\nsection, which carries information about the scope and the\nunits it contains. A number of options that may be used in\nthis section are shared with other unit types. These options are\ndocumented in\nsystemd.kill\n(5)\nand\nsystemd.resource-control\n(5)\n.\nThe options specific to the [Scope] section\nof scope units are the following:\nOOMPolicy=\nÂ¶\nConfigure the out-of-memory (OOM) killing policy for the kernel and the userspace OOM\nkiller\nsystemd-oomd.service\n(8)\n.\nOn Linux, when memory becomes scarce to the point that the kernel has trouble allocating memory for\nitself, it might decide to kill a running process in order to free up memory and reduce memory\npressure. Note that\nsystemd-oomd.service\nis a more flexible solution that aims\nto prevent out-of-memory situations for the userspace too, not just the kernel, by attempting to\nterminate services earlier, before the kernel would have to act.\nThis setting takes one of\ncontinue\n,\nstop\nor\nkill\n. If set to\ncontinue\nand a process in the unit is\nkilled by the OOM killer, this is logged but the unit continues running. If set to\nstop\nthe event is logged but the unit is terminated cleanly by the service\nmanager. If set to\nkill\nand one of the unit's processes is killed by the OOM\nkiller the kernel is instructed to kill all remaining processes of the unit too, by setting the\nmemory.oom.group\nattribute to\n1\n; also see kernel\npage\nControl Group v2\n.\nDefaults to the setting\nDefaultOOMPolicy=\nin\nsystemd-system.conf\n(5)\nis set to, except for units where\nDelegate=\nis turned on, where it defaults to\ncontinue\n.\nUse the\nOOMScoreAdjust=\nsetting to configure whether processes of the unit\nshall be considered preferred or less preferred candidates for process termination by the Linux OOM\nkiller logic. See\nsystemd.exec\n(5)\nfor\ndetails.\nThis setting also applies to\nsystemd-oomd.service\n(8)\n.\nSimilarly to the kernel OOM kills performed by the kernel, this setting determines the state of the\nunit after\nsystemd-oomd\nkills a cgroup associated with it.\nAdded in version 253.\nRuntimeMaxSec=\nÂ¶\nConfigures a maximum time for the scope to run. If this is used and the scope has been\nactive for longer than the specified time it is terminated and put into a failure state. Pass\n\"\ninfinity\n\" (the default) to configure no runtime limit.\nAdded in version 244.\nRuntimeRandomizedExtraSec=\nÂ¶\nThis option modifies\nRuntimeMaxSec=\nby increasing the maximum runtime by an\nevenly distributed duration between 0 and the specified value (in seconds). If\nRuntimeMaxSec=\nis\nunspecified, then this feature will be disabled.\nAdded in version 250.\nCheck\nsystemd.unit\n(5)\n,\nsystemd.exec\n(5)\n, and\nsystemd.kill\n(5)\nfor more\nsettings.\nSee Also\nÂ¶\nsystemd\n(1)\n,\nsystemd-run\n(1)\n,\nsystemd.unit\n(5)\n,\nsystemd.resource-control\n(5)\n,\nsystemd.service\n(5)\n,\nsystemd.directives\n(7)\n.", "metadata": {"source_type": "vendor_docs", "trust": "vendor_docs", "os": "linux", "distro": "ubuntu-22.04", "license": "CC BY-SA (assumed; verify per site)", "attribution_url": "https://www.freedesktop.org/software/systemd/man/latest/systemd.scope.html"}}
{"text": "systemd-nspawn\nIndex\nÂ·\nDirectives\nsystemd 258\nName\nsystemd-nspawn â Spawn a command or OS in a lightweight container\nSynopsis\nsystemd-nspawn\n[OPTIONS...] [\nCOMMAND\n[ARGS...]\n]\nsystemd-nspawn\n--boot  [OPTIONS...] [ARGS...]\nDescription\nÂ¶\nsystemd-nspawn\nmay be used to run a command or OS in a lightweight namespace\ncontainer. In many ways it is similar to\nchroot\n(1)\n, but more powerful\nsince it virtualizes the file system hierarchy, as well as the process tree, the various IPC subsystems, and\nthe host and domain names.\nsystemd-nspawn\nmay be invoked on any directory tree containing an operating system tree,\nusing the\n--directory=\ncommand line option. By using the\n--machine=\noption an OS\ntree is automatically searched for in a couple of locations, most importantly in\n/var/lib/machines/\n, the suggested directory to place OS container images installed on the\nsystem.\nIn contrast to\nchroot\n(1)\nÂ\nsystemd-nspawn\nmay be used to boot full Linux-based operating systems in a container.\nsystemd-nspawn\nlimits access to various kernel interfaces in the container to\nread-only, such as\n/sys/\n,\n/proc/sys/\n, or\n/sys/fs/selinux/\n. The host's network interfaces and the system clock may not be\nchanged from within the container. Device nodes may not be created. The host system cannot be rebooted\nand kernel modules may not be loaded from within the container.\nThis sandbox can easily be\ncircumvented from within the container if user namespaces are not used\n. This means that\nuntrusted code must always be run in a user namespace, see the discussion of the\n--private-users=\noption below.\nUse a tool like\ndnf\n(8)\n,\ndebootstrap\n(8)\n, or\npacman\n(8)\nto\nset up an OS directory tree suitable as file system hierarchy for\nsystemd-nspawn\ncontainers. See\nthe Examples section below for details on suitable invocation of these commands.\nAs a safety check\nsystemd-nspawn\nwill verify the existence of\n/usr/lib/os-release\nor\n/etc/os-release\nin the container tree before\nbooting a container (see\nos-release\n(5)\n).  It might be\nnecessary to add this file to the container tree manually if the OS of the container is too old to contain this\nfile out-of-the-box.\nsystemd-nspawn\nmay be invoked directly from the interactive command line or run as system\nservice in the background. In this mode each container instance runs as its own service instance; a default\ntemplate unit file\nsystemd-nspawn@.service\nis provided to make this easy, taking the container\nname as instance identifier. Note that different default options apply when\nsystemd-nspawn\nis\ninvoked by the template unit file than interactively on the command line. Most importantly the template unit file\nmakes use of the\n--boot\noption which is not the default in case\nsystemd-nspawn\nis invoked from the interactive command line. Further differences with the defaults are documented along with the\nvarious supported options below.\nThe\nmachinectl\n(1)\ntool may\nbe used to execute a number of operations on containers. In particular it provides easy-to-use commands to run\ncontainers as system services using the\nsystemd-nspawn@.service\ntemplate unit\nfile.\nAlong with each container a settings file with the\n.nspawn\nsuffix may exist, containing\nadditional settings to apply when running the container. See\nsystemd.nspawn\n(5)\nfor\ndetails. Settings files override the default options used by the\nsystemd-nspawn@.service\ntemplate unit file, making it usually unnecessary to alter this template file directly.\nNote that\nsystemd-nspawn\nwill mount file systems private to the container to\n/dev/\n,\n/run/\n, and similar. These will not be visible outside of\nthe container, and their contents will be lost when the container exits.\nNote that running two\nsystemd-nspawn\ncontainers from the same directory tree will not make\nprocesses in them see each other. The PID namespace separation of the two containers is complete and the containers\nwill share very few runtime objects except for the underlying file system. Rather use\nmachinectl\n(1)\n's\nlogin\nor\nshell\ncommands to request an additional login session in a running\ncontainer.\nsystemd-nspawn\nimplements the\nContainer Interface\nspecification.\nWhile running, containers invoked with\nsystemd-nspawn\nare registered with the\nsystemd-machined\n(8)\nservice that\nkeeps track of running containers, and provides programming interfaces to interact with them.\nUnprivileged Operation\nÂ¶\nsystemd-nspawn\nmay be invoked with or without privileges. The full functionality\nis currently only available when invoked with privileges. When invoked without privileges, various\nlimitations apply, including, but not limited to:\nOnly disk image based containers are supported (i.e.\n--image=\n).\nDirectory based ones (i.e.\n--directory=\n) are not supported.\nMachine registration via\n--machine=\nis not supported.\nOnly\n--private-network\nand\n--network-veth\nnetworking modes are supported.\nWhen running in unprivileged mode, some needed functionality is provided via\nsystemd-mountfsd.service\n(8)\nand\nsystemd-nsresourced.service\n(8)\n.\nOptions\nÂ¶\nIf option\n--boot\nis specified, the arguments\nare used as arguments for the init program. Otherwise,\nCOMMAND\nspecifies the program to launch\nin the container, and the remaining arguments are used as\narguments for this program. If\n--boot\nis not used and\nno arguments are specified, a shell is launched in the\ncontainer.\nThe following options are understood:\n-q\n,\n--quiet\nÂ¶\nTurns off any status output by the tool\nitself. When this switch is used, the only output from nspawn\nwill be the console output of the container OS\nitself.\nAdded in version 209.\n--settings=\nMODE\nÂ¶\nControls whether\nsystemd-nspawn\nshall search for and use\nadditional per-container settings from\n.nspawn\nfiles. Takes a boolean or the\nspecial values\noverride\nor\ntrusted\n.\nIf enabled (the default), a settings file named after the\nmachine (as specified with the\n--machine=\nsetting, or derived from the directory or image file name)\nwith the suffix\n.nspawn\nis searched in\n/etc/systemd/nspawn/\nand\n/run/systemd/nspawn/\n. If it is found\nthere, its settings are read and used. If it is not found\nthere, it is subsequently searched in the same directory as the\nimage file or in the immediate parent of the root directory of\nthe container. In this case, if the file is found, its settings\nwill be also read and used, but potentially unsafe settings\nare ignored. Note that in both these cases, settings on the\ncommand line take precedence over the corresponding settings\nfrom loaded\n.nspawn\nfiles, if both are\nspecified. Unsafe settings are considered all settings that\nelevate the container's privileges or grant access to\nadditional resources such as files or directories of the\nhost. For details about the format and contents of\n.nspawn\nfiles, consult\nsystemd.nspawn\n(5)\n.\nIf this option is set to\noverride\n, the\nfile is searched, read and used the same way, however, the order of\nprecedence is reversed: settings read from the\n.nspawn\nfile will take precedence over\nthe corresponding command line options, if both are\nspecified.\nIf this option is set to\ntrusted\n, the\nfile is searched, read and used the same way, but regardless\nof being found in\n/etc/systemd/nspawn/\n,\n/run/systemd/nspawn/\nor next to the image\nfile or container root directory, all settings will take\neffect, however, command line arguments still take precedence\nover corresponding settings.\nIf disabled, no\n.nspawn\nfile is read\nand no settings except the ones on the command line are in\neffect.\nAdded in version 226.\n--cleanup\nÂ¶\nClean up left-over mounts and underlying mount points used by the container, and exit without\ninvoking any containers. This may be useful when the previous invocation of\nsystemd-nspawn\nwas unexpectedly terminated. This requires at least one of\n-M/--machine=\n,\n-D/--directory=\n, or\n-i/--image=\nto determine the mounts to be cleaned up.\nAdded in version 257.\nImage Options\nÂ¶\n-D\n,\n--directory=\nÂ¶\nDirectory to use as file system root for the container.\nIf neither\n--directory=\n, nor\n--image=\nis specified the\ndirectory is determined by searching for a directory named the same as the machine name specified\nwith\n--machine=\n. See\nmachinectl\n(1)\nsection \"Files and Directories\" for the precise search path.\nIn place of the directory path a \"\n.v/\n\" versioned directory may be specified,\nsee\nsystemd.v\n(7)\nfor\ndetails.\nIf neither\n--directory=\n,\n--image=\n, nor\n--machine=\nare specified, the current directory will be used. May not be specified\ntogether with\n--image=\n.\n--template=\nÂ¶\nDirectory or \"\nbtrfs\n\" subvolume to use as template for the\ncontainer's root directory. If this is specified and the container's root directory (as configured by\n--directory=\n) does not yet exist it is created as \"\nbtrfs\n\" snapshot\n(if supported) or plain directory (otherwise) and populated from this template tree. Ideally, the\nspecified template path refers to the root of a \"\nbtrfs\n\" subvolume, in which case a\nsimple copy-on-write snapshot is taken, and populating the root directory is instant. If the\nspecified template path does not refer to the root of a \"\nbtrfs\n\" subvolume (or not\neven to a \"\nbtrfs\n\" file system at all), the tree is copied (though possibly in a\n'reflink' copy-on-write scheme â if the file system supports that), which can be substantially more\ntime-consuming. Note that the snapshot taken is of the specified directory or subvolume, including\nall subdirectories and subvolumes below it, but excluding any sub-mounts. May not be specified\ntogether with\n--image=\nor\n--ephemeral\n.\nNote that this switch leaves hostname, machine ID and\nall other settings that could identify the instance\nunmodified.\nAdded in version 219.\n-x\n,\n--ephemeral\nÂ¶\nIf specified, the container is run with a temporary snapshot of its file system that is removed\nimmediately when the container terminates. May not be specified together with\n--template=\n.\nNote that this switch leaves hostname, machine ID and all other settings that could identify\nthe instance unmodified. Please note that â as with\n--template=\nâ taking the\ntemporary snapshot is more efficient on file systems that support subvolume snapshots or 'reflinks'\nnatively (\"\nbtrfs\n\" or new \"\nxfs\n\") than on more traditional file\nsystems that do not (\"\next4\n\"). Note that the snapshot taken is of the specified\ndirectory or subvolume, including all subdirectories and subvolumes below it, but excluding any\nsub-mounts.\nWith this option no modifications of the container image are retained. Use\n--volatile=\n(described below) for other mechanisms to restrict persistency of\ncontainer images during runtime.\nAdded in version 219.\n-i\n,\n--image=\nÂ¶\nDisk image to mount the root directory for the\ncontainer from. Takes a path to a regular file or to a block\ndevice node. The file or block device must contain\neither:\nAn MBR partition table with a single\npartition of type 0x83 that is marked\nbootable.\nA GUID partition table (GPT) with a single\npartition of type\n0fc63daf-8483-4772-8e79-3d69d8477de4.\nA GUID partition table (GPT) with a marked\nroot partition which is mounted as the root directory of the\ncontainer. Optionally, GPT images may contain a home and/or\na server data partition which are mounted to the appropriate\nplaces in the container. All these partitions must be\nidentified by the partition types defined by the\nDiscoverable\nPartitions Specification\n.\nNo partition table, and a single file system spanning the whole image.\nOn GPT images, if an EFI System Partition (ESP) is discovered, it is automatically mounted to\n/efi\n(or\n/boot\nas fallback) in case a directory by this name exists\nand is empty.\nPartitions encrypted with LUKS are automatically decrypted. Also, on GPT images dm-verity data integrity\nhash partitions are set up if the root hash for them is specified using the\n--root-hash=\noption.\nSingle file system images (i.e. file systems without a surrounding partition table) can be opened using\ndm-verity if the integrity data is passed using the\n--root-hash=\nand\n--verity-data=\n(and optionally\n--root-hash-sig=\n) options.\nAny other partitions, such as foreign partitions or swap partitions are not mounted. May not be specified\ntogether with\n--directory=\n,\n--template=\n.\nIn place of the image path a \"\n.v/\n\" versioned directory may be specified, see\nsystemd.v\n(7)\nfor\ndetails.\nAdded in version 211.\n--image-policy=\npolicy\nÂ¶\nTakes an image policy string as argument, as per\nsystemd.image-policy\n(7)\n. The\npolicy is enforced when operating on the disk image specified via\n--image=\n, see\nabove. If not specified, defaults to\n\"\nroot=verity+signed+encrypted+unprotected+absent:usr=verity+signed+encrypted+unprotected+absent:home=encrypted+unprotected+absent:srv=encrypted+unprotected+absent:esp=unprotected+absent:xbootldr=unprotected+absent:tmp=encrypted+unprotected+absent:var=encrypted+unprotected+absent\n\",\ni.e. all recognized file systems in the image are used, but not the swap partition.\nAdded in version 254.\n--oci-bundle=\nÂ¶\nTakes the path to an OCI runtime bundle to invoke, as specified in the\nOCI Runtime Specification\n. In\nthis case, no\n.nspawn\nfile is loaded, and the root directory and various settings are read\nfrom the OCI runtime JSON data (but data passed on the command line takes precedence).\nAdded in version 242.\n--read-only\nÂ¶\nMount the container's root file system (and any other file systems contained in the container\nimage) read-only. This has no effect on additional mounts made with\n--bind=\n,\n--tmpfs=\nand similar options. This mode is implied if the container image file or directory is\nmarked read-only itself. It is also implied if\n--volatile=\nis used. In this case, the container\nimage on disk is strictly read-only, while changes are permitted but kept non-persistently in memory only. For\nfurther details, see below.\n--volatile\n,\n--volatile=\nMODE\nÂ¶\nBoots the container in volatile mode. When no mode parameter is passed or when mode is\nspecified as\nyes\n, full volatile mode is enabled. This means the root directory is mounted as a\nmostly unpopulated \"\ntmpfs\n\" instance, and\n/usr/\nfrom the OS tree is\nmounted into it in read-only mode (the system thus starts up with read-only OS image, but pristine state and\nconfiguration, any changes are lost on shutdown). When the mode parameter is specified as\nstate\n, the OS tree is mounted read-only, but\n/var/\nis mounted as a\nwritable \"\ntmpfs\n\" instance into it (the system thus starts up with read-only OS resources and\nconfiguration, but pristine state, and any changes to the latter are lost on shutdown). When the mode parameter\nis specified as\noverlay\nthe read-only root file system is combined with a writable\ntmpfs\ninstance through \"\noverlayfs\n\", so that it appears at it normally\nwould, but any changes are applied to the temporary file system only and lost when the container is\nterminated. When the mode parameter is specified as\nno\n(the default), the whole OS tree is\nmade available writable (unless\n--read-only\nis specified, see above).\nNote that if one of the volatile modes is chosen, its effect is limited to the root file system\n(or\n/var/\nin case of\nstate\n), and any other mounts placed in the\nhierarchy are unaffected â regardless of whether they are established automatically (e.g. the EFI system\npartition that might be mounted to\n/efi/\nor\n/boot/\n) or\nexplicitly (e.g. through an additional command line option such as\n--bind=\n, see\nbelow). This means, even if\n--volatile=overlay\nis used changes to\n/efi/\nor\n/boot/\nare prohibited in case such a partition\nexists in the container image operated on, and even if\n--volatile=state\nis used the\nhypothetical file\n/etc/foobar\nis potentially writable if\n--bind=/etc/foobar\nis used to mount it from outside the read-only container\n/etc/\ndirectory.\nThe\n--ephemeral\noption is closely related to this setting, and provides similar\nbehaviour by making a temporary, ephemeral copy of the whole OS image and executing that. For further details,\nsee above.\nThe\n--tmpfs=\nand\n--overlay=\noptions provide similar functionality, but\nfor specific sub-directories of the OS image only. For details, see below.\nThis option provides similar functionality for containers as the \"\nsystemd.volatile=\n\"\nkernel command line switch provides for host systems. See\nkernel-command-line\n(7)\nfor\ndetails.\nNote that setting this option to\nyes\nor\nstate\nwill only work\ncorrectly with operating systems in the container that can boot up with only\n/usr/\nmounted, and are able to automatically populate\n/var/\n(and\n/etc/\nin case of \"\n--volatile=yes\n\"). Specifically, this\nmeans that operating systems that follow the historic split of\n/bin/\nand\n/lib/\n(and related directories) from\n/usr/\n(i.e. where the\nformer are not symlinks into the latter) are not supported by \"\n--volatile=yes\n\" as\ncontainer payload. The\noverlay\noption does not require any particular preparations\nin the OS, but do note that \"\noverlayfs\n\" behaviour differs from regular file systems\nin a number of ways, and hence compatibility is limited.\nAdded in version 216.\n--root-hash=\nÂ¶\nTakes a data integrity (dm-verity) root hash specified in hexadecimal. This option enables data\nintegrity checks using dm-verity, if the used image contains the appropriate integrity data (see above). The\nspecified hash must match the root hash of integrity data, and is usually at least 256 bits (and hence 64\nformatted hexadecimal characters) long (in case of SHA256 for example). If this option is not specified, but\nthe image file carries the \"\nuser.verity.roothash\n\" extended file attribute (see\nxattr\n(7)\n), then the root\nhash is read from it, also as formatted hexadecimal characters. If the extended file attribute is not found (or\nis not supported by the underlying file system), but a file with the\n.roothash\nsuffix is\nfound next to the image file, bearing otherwise the same name (except if the image has the\n.raw\nsuffix, in which case the root hash file must not have it in its name), the root hash\nis read from it and automatically used, also as formatted hexadecimal characters.\nNote that this configures the root hash for the root file system. Disk images may also contain\nseparate file systems for the\n/usr/\nhierarchy, which may be Verity protected as\nwell. The root hash for this protection may be configured via the\n\"\nuser.verity.usrhash\n\" extended file attribute or via a\n.usrhash\nfile adjacent to the disk image, following the same format and logic as for the root hash for the\nroot file system described here. Note that there's currently no switch to configure the root hash for\nthe\n/usr/\nfrom the command line.\nAlso see the\nRootHash=\noption in\nsystemd.exec\n(5)\n.\nAdded in version 233.\n--root-hash-sig=\nÂ¶\nTakes a PKCS7 signature of the\n--root-hash=\noption.\nThe semantics are the same as for the\nRootHashSignature=\noption, see\nsystemd.exec\n(5)\n.\nAdded in version 246.\n--verity-data=\nÂ¶\nTakes the path to a data integrity (dm-verity) file. This option enables data integrity checks\nusing dm-verity, if a root-hash is passed and if the used image itself does not contain the integrity data.\nThe integrity data must be matched by the root hash. If this option is not specified, but a file with the\n.verity\nsuffix is found next to the image file, bearing otherwise the same name (except if\nthe image has the\n.raw\nsuffix, in which case the verity data file must not have it in its name),\nthe verity data is read from it and automatically used.\nAdded in version 246.\n--pivot-root=\nÂ¶\nPivot the specified directory to\n/\ninside the container, and either unmount the\ncontainer's old root, or pivot it to another specified directory. Takes one of: a path argument â in which case the\nspecified path will be pivoted to\n/\nand the old root will be unmounted; or a colon-separated pair\nof new root path and pivot destination for the old root. The new root path will be pivoted to\n/\n,\nand the old\n/\nwill be pivoted to the other directory. Both paths must be absolute, and are resolved\nin the container's file system namespace.\nThis is for containers which have several bootable directories in them; for example, several\nOSTree\ndeployments. It emulates the\nbehavior of the boot loader and the initrd which normally select which directory to mount as the root\nand start the container's PID 1 in.\nAdded in version 233.\nExecution Options\nÂ¶\n-a\n,\n--as-pid2\nÂ¶\nInvoke the shell or specified program as process ID (PID) 2 instead of PID 1 (init). By\ndefault, if neither this option nor\n--boot\nis used, the selected program is run as the process\nwith PID 1, a mode only suitable for programs that are aware of the special semantics that the process with\nPID 1 has on UNIX. For example, it needs to reap all processes reparented to it, and should implement\nsysvinit\ncompatible signal handling (specifically: it needs to reboot on SIGINT, reexecute\non SIGTERM, reload configuration on SIGHUP, and so on). With\n--as-pid2\na minimal stub init\nprocess is run as PID 1 and the selected program is executed as PID 2 (and hence does not need to implement any\nspecial semantics). The stub init process will reap processes as necessary and react appropriately to\nsignals. It is recommended to use this mode to invoke arbitrary commands in containers, unless they have been\nmodified to run correctly as PID 1. Or in other words: this switch should be used for pretty much all commands,\nexcept when the command refers to an init or shell implementation, as these are generally capable of running\ncorrectly as PID 1. This option may not be combined with\n--boot\n.\nAdded in version 229.\n-b\n,\n--boot\nÂ¶\nAutomatically search for an init program and invoke it as PID 1, instead of a shell or a user\nsupplied program. If this option is used, arguments specified on the command line are used as arguments for the\ninit program. This option may not be combined with\n--as-pid2\n.\nThe following table explains the different modes of invocation and relationship to\n--as-pid2\n(see above):\nTableÂ 1.Â Invocation Mode\nSwitch\nExplanation\nNeither\n--as-pid2\nnor\n--boot\nspecified\nThe passed parameters are interpreted as the command line, which is executed as PID 1 in the container.\n--as-pid2\nspecified\nThe passed parameters are interpreted as the command line, which is executed as PID 2 in the container. A stub init process is run as PID 1.\n--boot\nspecified\nAn init program is automatically searched for and run as PID 1 in the container. The passed parameters are used as invocation parameters for this process.\nNote that\n--boot\nis the default mode of operation if the\nsystemd-nspawn@.service\ntemplate unit file is used.\n--chdir=\nÂ¶\nChange to the specified working directory before invoking the process in the container. Expects\nan absolute path in the container's file system namespace.\nAdded in version 229.\n-E\nNAME\n[=\nVALUE\n]\n,\n--setenv=\nNAME\n[=\nVALUE\n]\nÂ¶\nSpecifies an environment variable to pass to the init process in the container. This\nmay be used to override the default variables or to set additional variables. It may be used more\nthan once to set multiple variables. When \"\n=\n\" and\nVALUE\nare omitted, the value of the variable with the same name in the program environment will be used.\nAdded in version 209.\n-u\n,\n--user=\nÂ¶\nAfter transitioning into the container, change to the specified user defined in the\ncontainer's user database. Like all other systemd-nspawn features, this is not a security feature and\nprovides protection against accidental destructive operations only.\nNote that if credentials are used in combination with a non-root\n--user=\n(e.g.:\n--set-credential=\n,\n--load-credential=\nor\n--import-credential=\n), then\n--no-new-privileges=yes\nmust be used, and\n--boot\nor\n--as-pid2\nmust not be used, as the credentials would\notherwise be unreadable by the container due to missing privileges after switching to the specified\nuser.\n--kill-signal=\nÂ¶\nSpecify the process signal to send to the container's PID 1 when nspawn itself receives\nSIGTERM\n, in order to trigger an orderly shutdown of the container. Defaults to\nSIGRTMIN+3\nif\n--boot\nis used (on systemd-compatible init systems\nSIGRTMIN+3\ntriggers an orderly shutdown). If\n--boot\nis not used and this\noption is not specified, the container's processes are terminated abruptly via\nSIGKILL\n. For\na list of valid signals, see\nsignal\n(7)\n.\nAdded in version 220.\n--notify-ready=\nÂ¶\nConfigures support for notifications from the container's init process.\n--notify-ready=\ntakes a boolean. If false\nsystemd-vmpawn\nnotifies the calling service manager with a \"\nREADY=1\n\" message when the init process is\ncreated. If true it waits for a \"\nREADY=1\n\" message from the init process in the VM\nbefore sending its own to the service manager. For more details about notifications see\nsd_notify\n(3)\n.\nDefaults to false. (Note that this is unlike the option of the same name to\nsystemd-vmspawn\n(1)\nthat defaults to true.)\nAdded in version 231.\n--suppress-sync=\nÂ¶\nExpects a boolean argument. If true, turns off any form of on-disk file system\nsynchronization for the container payload. This means all system calls such as\nsync\n(2)\n,\nfsync()\n,\nsyncfs()\n, â¦ will execute no operation, and the\nO_SYNC\n/\nO_DSYNC\nflags to\nopen\n(2)\nand\nrelated calls will be made unavailable. This is potentially dangerous, as assumed data integrity\nguarantees to the container payload are not actually enforced (i.e. data assumed to have been written\nto disk might be lost if the system is shut down abnormally). However, this can dramatically improve\ncontainer runtime performance â as long as these guarantees are not required or desirable, for\nexample because any data written by the container is of temporary, redundant nature, or just an\nintermediary artifact that will be further processed and finalized by a later step in a\npipeline. Defaults to false.\nAdded in version 250.\nSystem Identity Options\nÂ¶\n-M\n,\n--machine=\nÂ¶\nSets the machine name for this container. This\nname may be used to identify this container during its runtime\n(for example in tools like\nmachinectl\n(1)\nand similar), and is used to initialize the container's\nhostname (which the container can choose to override,\nhowever). If not specified, the last component of the root\ndirectory path of the container is used, possibly suffixed\nwith a random identifier in case\n--ephemeral\nmode is selected. If the root directory selected is the host's\nroot directory the host's hostname is used as default\ninstead.\nAdded in version 202.\n--hostname=\nÂ¶\nControls the hostname to set within the container, if different from the machine name. Expects\na valid hostname as argument. If this option is used, the kernel hostname of the container will be set to this\nvalue, otherwise it will be initialized to the machine name as controlled by the\n--machine=\noption described above. The machine name is used for various aspect of identification of the container from the\noutside, the kernel hostname configurable with this option is useful for the container to identify itself from\nthe inside. It is usually a good idea to keep both forms of identification synchronized, in order to avoid\nconfusion. It is hence recommended to avoid usage of this option, and use\n--machine=\nexclusively. Note that regardless whether the container's hostname is initialized from the name set with\n--hostname=\nor the one set with\n--machine=\n, the container can later override\nits kernel hostname freely on its own as well.\nAdded in version 239.\n--uuid=\nÂ¶\nSet the specified UUID for the container. The\ninit system will initialize\n/etc/machine-id\nfrom this if this file is\nnot set yet. Note that this option takes effect only if\n/etc/machine-id\nin the container is\nunpopulated.\nProperty Options\nÂ¶\n-S\n,\n--slice=\nÂ¶\nMake the container part of the specified slice, instead of the default\nmachine.slice\n. This applies only if the machine is run in its own scope unit, i.e. if\n--keep-unit\nis not used.\nAdded in version 206.\n--property=\nÂ¶\nSet a unit property on the scope unit to register for the machine. This applies only if the\nmachine is run in its own scope unit, i.e. if\n--keep-unit\nis not used. Takes unit property\nassignments in the same format as\nsystemctl set-property\n. This is useful to set memory\nlimits and similar for the container.\nAdded in version 220.\n--register=\nÂ¶\nControls whether the container is registered with\nsystemd-machined\n(8)\n.  Takes a\nboolean argument, which defaults to \"\nyes\n\".  This option should be enabled when the container\nruns a full Operating System (more specifically: a system and service manager as PID 1), and is useful to\nensure that the container is accessible via\nmachinectl\n(1)\nand shown by\ntools such as\nps\n(1)\n.  If the container\ndoes not run a service manager, it is recommended to set this option to\n\"\nno\n\".\nAdded in version 209.\n--keep-unit\nÂ¶\nInstead of creating a transient scope unit to run the container in, simply use the service or\nscope unit\nsystemd-nspawn\nhas been invoked in. If\n--register=yes\nis set\nthis unit is registered with\nsystemd-machined\n(8)\n. This\nswitch should be used if\nsystemd-nspawn\nis invoked from within a service unit, and the\nservice unit's sole purpose is to run a single\nsystemd-nspawn\ncontainer. This option is not\navailable if run from a user session.\nNote that passing\n--keep-unit\ndisables the effect of\n--slice=\nand\n--property=\n. Use\n--keep-unit\nand\n--register=no\nin\ncombination to disable any kind of unit allocation or registration with\nsystemd-machined\n.\nAdded in version 209.\nUser Namespacing Options\nÂ¶\n--private-users=\nÂ¶\nControls user namespacing. If enabled, the container will run with its own private set of UNIX\nuser and group ids (UIDs and GIDs). This involves mapping the private UIDs/GIDs used in the container (starting\nwith the container's root user 0 and up) to a range of UIDs/GIDs on the host that are not used for other\npurposes (usually in the range beyond the host's UID/GID 65536). The parameter may be specified as follows:\nIf one or two colon-separated numbers are specified, user namespacing is turned on. The first\nparameter specifies the first host UID/GID to assign to the container, the second parameter specifies the\nnumber of host UIDs/GIDs to assign to the container. If the second parameter is omitted, 65536 UIDs/GIDs are\nassigned.\nIf the parameter is \"\nyes\n\", user namespacing is turned on. The\nUID/GID range to use is determined automatically from the file ownership of the root directory of\nthe container's directory tree. To use this option, make sure to prepare the directory tree in\nadvance, and ensure that all files and directories in it are owned by UIDs/GIDs in the range you'd\nlike to use. Also, make sure that used file ACLs exclusively reference UIDs/GIDs in the appropriate\nrange. In this mode, the number of UIDs/GIDs assigned to the container is 65536, and the owner\nUID/GID of the root directory must be a multiple of 65536.\nThe special value \"\npick\n\" turns on user namespacing. In this case\nthe UID/GID range is automatically chosen. As first step, the file owner UID/GID of the root\ndirectory of the container's directory tree is read, and it is checked that no other container is\ncurrently using it. If this check is successful, the UID/GID range determined this way is used,\nsimilarly to the behavior if \"\nyes\n\" is specified. If the check is not successful\n(and thus the UID/GID range indicated in the root directory's file owner is already used elsewhere)\na new â currently unused â UID/GID range of 65536 UIDs/GIDs is randomly chosen between the host\nUID/GIDs of 524288 and 1878982656, always starting at a multiple of 65536, and, if possible,\nconsistently hashed from the machine name. This setting implies\n--private-users-ownership=auto\n(see below), which possibly has the effect that the\nfiles and directories in the container's directory tree will be owned by the appropriate users of\nthe range picked. Using this option makes user namespace behavior fully automatic. Note that the\nfirst invocation of a previously unused container image might result in picking a new UID/GID range\nfor it, and thus in the (possibly expensive) file ownership adjustment operation. However,\nsubsequent invocations of the container will be cheap (unless of course the picked UID/GID range is\nassigned to a different use by then).\nIf the parameter is \"\nno\n\", user namespacing is turned off. This is\nthe default when\nsystemd-nspawn\nis invoked directly. (Note that the\nsystemd-nspawn@.service\nunit enables private users.) This option is not\nsecure and must not be used to run untrusted code.\nIf the parameter is \"\nidentity\n\", user namespacing is employed with\nan identity mapping for the first 65536 UIDs/GIDs. This is mostly equivalent to\n--private-users=0:65536\n. While it does not provide UID/GID isolation, since all\nhost and container UIDs/GIDs are chosen identically it does provide process capability isolation,\nbut may be useful if proper user namespacing with distinct UID maps is not possible. This option is\nnot secure and must not be used to run untrusted code.\nIf the parameter is \"\nmanaged\n\", user namespacing is employed with\nin\nmanaged\nmode, i.e. allocation of a UID range is delegated to\nsystemd-nsresourced.service\n(8)\n. This\nmode is selected by default if invoked unprivileged, but can also be requested explicitly when\nprivileged. In this mode a 64K UID range is automatically picked.\nIt is recommended to assign at least 65536 UIDs/GIDs to each container, so that the usable\nUID/GID range in the container covers 16 bits. For best security, do not assign overlapping UID/GID\nranges to multiple containers. It is hence a good idea to use the upper 16 bit of the host 32-bit\nUIDs/GIDs as container identifier, while the lower 16 bits encode the container UID/GID used. This is\nin fact the behavior enforced by the\n--private-users=pick\noption.\nWhen user namespaces are used, the GID range assigned to each container is always chosen\nidentical to the UID range.\nIn most cases,\n--private-users=managed\n(or when privileged\n--private-users=pick\n, too) is the recommended option as user\nnamespacing is advised for security, and this option massively enhances container security while\noperating fully automatically in most cases.\nNote that the picked UID/GID range is not written to\n/etc/passwd\nor\n/etc/group\n. In fact, the allocation of the range is not stored persistently,\nexcept possibly in the file ownership of the files and directories of the container, see\n--private-users-ownership=\n.\nNote that when user namespacing is used without UID mapping (see below) file ownership on disk\nreflects this, and all of the container's files and directories are owned by the container's\neffective user and group IDs. This means that copying files from and to the container image requires\ncorrection of the numeric UID/GID values, according to the UID/GID shift applied.\nNote that for fully unprivileged operation in \"\nmanaged\n\" mode, any directory\nimage should be owned by the foreign UID range.\nAdded in version 220.\n--private-users-ownership=\nÂ¶\nControls how to adjust the container image's UIDs and GIDs to match the UID/GID range\nchosen with\n--private-users=\n, see above. Takes one of \"\noff\n\" (to\nleave the image as is), \"\nchown\n\" (to recursively\nchown()\nthe\ncontainer's directory tree as needed), \"\nmap\n\" (in order to use transparent ID mapping\nmounts from UID 0 to the target UID range), \"\nforeign\n\" (the same, but from the\nforeign UID range base) or \"\nauto\n\" for automatically using \"\nmap\n\" or\n\"\nforeign\n\", where available and applicable and \"\nchown\n\" where\nnot.\nIf \"\nchown\n\" is selected, all files and directories in the container's directory\ntree will be adjusted so that they are owned by the appropriate UIDs/GIDs selected for the container\n(see above).  This operation is potentially expensive, as it involves iterating through the full\ndirectory tree of the container. Besides actual file ownership, file ACLs are adjusted as\nwell.\nTypically \"\nforeign\n\" or \"\nmap\n\" is the best choice, since it\ntransparently maps UIDs/GIDs in memory as needed without modifying the image, and without requiring\nan expensive recursive adjustment operation. However, it is not available for all file systems,\ncurrently.\nThe\n--private-users-ownership=auto\noption is implied if\n--private-users=pick\nis used. This option has no effect if user namespacing is not\nused.\nsystemd-dissect\n(1)\n's\n--shift\nswitch may be used to shift UID/GID ownership from or to the 0, foreign or\nspecific container UID/GID base outside of any\nsystemd-nspawn\ninvocation.\nAdded in version 230.\n-U\nÂ¶\nIf the kernel supports the user namespaces feature, equivalent to\n--private-users=pick --private-users-ownership=auto\n, otherwise equivalent to\n--private-users=no\n.\nNote that\n-U\nis the default if the\nsystemd-nspawn@.service\ntemplate unit file is used.\nNote: it is possible to undo the effect of\n--private-users-ownership=chown\n(or\n-U\n) on the file system by redoing the operation with the first UID of 0:\nsystemd-nspawn â¦ --private-users=0 --private-users-ownership=chown\nAdded in version 230.\nNetworking Options\nÂ¶\n--private-network\nÂ¶\nDisconnect networking of the container from\nthe host. This makes all network interfaces unavailable in the\ncontainer, with the exception of the loopback device and those\nspecified with\n--network-interface=\nand\nconfigured with\n--network-veth\n. If this\noption is specified, the\nCAP_NET_ADMIN\ncapability will be\nadded to the set of capabilities the container retains. The\nlatter may be disabled by using\n--drop-capability=\n.\nIf this option is not specified (or implied by one of the options\nlisted below), the container will have full access to the host network.\n--network-interface=\nÂ¶\nAssign the specified network interface to the container. Either takes a single\ninterface name, referencing the name on the host, or a colon-separated pair of interfaces, in which\ncase the first one references the name on the host, and the second one the name in the container.\nWhen the container terminates, the interface is moved back to the calling namespace and renamed to\nits original name.  Note that\n--network-interface=\nimplies\n--private-network\n. This option may be used more than once to add multiple network\ninterfaces to the container.\nNote that any network interface specified this way must already exist at the time the container\nis started. If the container shall be started automatically at boot via a\nsystemd-nspawn@.service\nunit file instance, it might hence make sense to add a\nunit file drop-in to the service instance\n(e.g.\n/etc/systemd/system/systemd-nspawn@foobar.service.d/50-network.conf\n) with\ncontents like the following:\n[Unit]\nWants=sys-subsystem-net-devices-ens1.device\nAfter=sys-subsystem-net-devices-ens1.device\nThis will make sure that activation of the container service will be delayed until the\n\"\nens1\n\" network interface has shown up. This is required since hardware probing is\nfully asynchronous, and network interfaces might be discovered only later during the boot process,\nafter the container would normally be started without these explicit dependencies.\nAdded in version 209.\n--network-macvlan=\nÂ¶\nCreate a \"\nmacvlan\n\" interface of the specified Ethernet network\ninterface and add it to the container. Either takes a single interface name, referencing the name\non the host, or a colon-separated pair of interfaces, in which case the first one references the name\non the host, and the second one the name in the container. A \"\nmacvlan\n\" interface is\na virtual interface that adds a second MAC address to an existing physical Ethernet link. If the\ncontainer interface name is not defined, the interface in the container will be named after the\ninterface on the host, prefixed with \"\nmv-\n\". Note that\n--network-macvlan=\nimplies\n--private-network\n. This option may be\nused more than once to add multiple network interfaces to the container.\nAs with\n--network-interface=\n, the underlying Ethernet network interface must\nalready exist at the time the container is started, and thus similar unit file drop-ins as described\nabove might be useful.\nAdded in version 211.\n--network-ipvlan=\nÂ¶\nCreate an \"\nipvlan\n\" interface of the specified Ethernet network\ninterface and add it to the container. Either takes a single interface name, referencing the name on\nthe host, or a colon-separated pair of interfaces, in which case the first one references the name\non the host, and the second one the name in the container. An \"\nipvlan\n\" interface is\na virtual interface,\nsimilar to a \"\nmacvlan\n\" interface, which uses the same MAC address as the underlying\ninterface. If the container interface name is not defined, the interface in the container will be\nnamed after the interface on the host, prefixed\nwith \"\niv-\n\".  Note that\n--network-ipvlan=\nimplies\n--private-network\n. This option may be used more than once to add multiple network\ninterfaces to the container.\nAs with\n--network-interface=\n, the underlying Ethernet network interface must\nalready exist at the time the container is started, and thus similar unit file drop-ins as described\nabove might be useful.\nAdded in version 219.\n-n\n,\n--network-veth\nÂ¶\nCreate a virtual Ethernet link (\"\nveth\n\") between host and container. The host\nside of the Ethernet link will be available as a network interface named after the container's name (as\nspecified with\n--machine=\n), prefixed with \"\nve-\n\". The container side of the\nEthernet link will be named \"\nhost0\n\". The\n--network-veth\noption implies\n--private-network\n.\nNote that\nsystemd-networkd.service\n(8)\nincludes by default a network file\n/usr/lib/systemd/network/80-container-ve.network\nmatching the host-side interfaces created this way, which contains settings to enable automatic address\nprovisioning on the created virtual link via DHCP, as well as automatic IP routing onto the host's external\nnetwork interfaces. It also contains\n/usr/lib/systemd/network/80-container-host0.network\nmatching the container-side interface created this way, containing settings to enable client side address\nassignment via DHCP. In case\nsystemd-networkd\nis running on both the host and inside the\ncontainer, automatic IP communication from the container to the host is thus available, with further\nconnectivity to the external network.\nNote that\n--network-veth\nis the default if the\nsystemd-nspawn@.service\ntemplate unit file is used.\nNote that on Linux network interface names may have a length of 15 characters at maximum, while\ncontainer names may have a length up to 64 characters. As this option derives the host-side interface\nname from the container name the name is possibly truncated. Thus, care needs to be taken to ensure\nthat interface names remain unique in this case, or even better container names are generally not\nchosen longer than 12 characters, to avoid the truncation. If the name is truncated,\nsystemd-nspawn\nwill automatically append a 4-digit hash value to the name to\nreduce the chance of collisions. However, the hash algorithm is not collision-free. (See\nsystemd.net-naming-scheme\n(7)\nfor details on older naming algorithms for this interface). Alternatively, the\n--network-veth-extra=\noption may be used, which allows free configuration of the\nhost-side interface name independently of the container name â but might require a bit more\nadditional configuration in case bridging in a fashion similar to\n--network-bridge=\nis desired.\nAdded in version 209.\n--network-veth-extra=\nÂ¶\nAdds an additional virtual Ethernet link\nbetween host and container. Takes a colon-separated pair of\nhost interface name and container interface name. The latter\nmay be omitted in which case the container and host sides will\nbe assigned the same name. This switch is independent of\n--network-veth\n, and â in contrast â may be\nused multiple times, and allows configuration of the network\ninterface names. Note that\n--network-bridge=\nhas no effect on interfaces created with\n--network-veth-extra=\n.\nAdded in version 228.\n--network-bridge=\nÂ¶\nAdds the host side of the Ethernet link created with\n--network-veth\nto the specified Ethernet bridge interface. Expects a valid network interface name of a bridge device\nas argument. Note that\n--network-bridge=\nimplies\n--network-veth\n. If\nthis option is used, the host side of the Ethernet link will use the \"\nvb-\n\" prefix\ninstead of \"\nve-\n\". Regardless of the used naming prefix the same network interface\nname length limits imposed by Linux apply, along with the complications this creates (for details see\nabove).\nAs with\n--network-interface=\n, the underlying bridge network interface must\nalready exist at the time the container is started, and thus similar unit file drop-ins as described\nabove might be useful.\nAdded in version 209.\n--network-zone=\nÂ¶\nCreates a virtual Ethernet link (\"\nveth\n\") to the container and adds it to an\nautomatically managed Ethernet bridge interface. The bridge interface is named after the passed argument,\nprefixed with \"\nvz-\n\". The bridge interface is automatically created when the first container\nconfigured for its name is started, and is automatically removed when the last container configured for its\nname exits. Hence, each bridge interface configured this way exists only as long as there's at least one\ncontainer referencing it running. This option is very similar to\n--network-bridge=\n, besides\nthis automatic creation/removal of the bridge device.\nThis setting makes it easy to place multiple related containers on a common, virtual Ethernet-based\nbroadcast domain, here called a \"zone\". Each container may only be part of one zone, but each zone may contain\nany number of containers. Each zone is referenced by its name. Names may be chosen freely (as long as they form\nvalid network interface names when prefixed with \"\nvz-\n\"), and it is sufficient to pass the same\nname to the\n--network-zone=\nswitch of the various concurrently running containers to join\nthem in one zone.\nNote that\nsystemd-networkd.service\n(8)\nincludes by default a network file\n/usr/lib/systemd/network/80-container-vz.network\nmatching the bridge interfaces created this way, which contains settings to enable automatic address\nprovisioning on the created virtual network via DHCP, as well as automatic IP routing onto the host's external\nnetwork interfaces. Using\n--network-zone=\nis hence in most cases fully automatic and\nsufficient to connect multiple local containers in a joined broadcast domain to the host, with further\nconnectivity to the external network.\nAdded in version 230.\n--network-namespace-path=\nÂ¶\nTakes the path to a file representing a kernel\nnetwork namespace that the container shall run in. The specified path\nshould refer to a (possibly bind-mounted) network namespace file, as\nexposed by the kernel below\n/proc/$PID/ns/net\n.\nThis makes the container enter the given network namespace. One of the\ntypical use cases is to give a network namespace under\n/run/netns\ncreated by\nip-netns\n(8)\n,\nfor example,\n--network-namespace-path=/run/netns/foo\n.\nNote that this option cannot be used together with other\nnetwork-related options, such as\n--private-network\nor\n--network-interface=\n.\nAdded in version 236.\n-p\n,\n--port=\nÂ¶\nIf private networking is enabled, maps an IP\nport on the host onto an IP port on the container. Takes a\nprotocol specifier (either \"\ntcp\n\" or\n\"\nudp\n\"), separated by a colon from a host port\nnumber in the range 1 to 65535, separated by a colon from a\ncontainer port number in the range from 1 to 65535. The\nprotocol specifier and its separating colon may be omitted, in\nwhich case \"\ntcp\n\" is assumed. The container\nport number and its colon may be omitted, in which case the\nsame port as the host port is implied. This option is only\nsupported if private networking is used, such as with\n--network-veth\n,\n--network-zone=\n--network-bridge=\n.\nAdded in version 219.\nSecurity Options\nÂ¶\n--capability=\nÂ¶\nList one or more additional capabilities to grant the container.  Takes a\ncomma-separated list of capability names, see\ncapabilities\n(7)\nfor more information. Note that the following capabilities will be granted in any way:\nCAP_AUDIT_CONTROL\n,\nCAP_AUDIT_WRITE\n,\nCAP_CHOWN\n,\nCAP_DAC_OVERRIDE\n,\nCAP_DAC_READ_SEARCH\n,\nCAP_FOWNER\n,\nCAP_FSETID\n,\nCAP_IPC_OWNER\n,\nCAP_KILL\n,\nCAP_LEASE\n,\nCAP_LINUX_IMMUTABLE\n,\nCAP_MKNOD\n,\nCAP_NET_BIND_SERVICE\n,\nCAP_NET_BROADCAST\n,\nCAP_NET_RAW\n,\nCAP_SETFCAP\n,\nCAP_SETGID\n,\nCAP_SETPCAP\n,\nCAP_SETUID\n,\nCAP_SYS_ADMIN\n,\nCAP_SYS_BOOT\n,\nCAP_SYS_CHROOT\n,\nCAP_SYS_NICE\n,\nCAP_SYS_PTRACE\n,\nCAP_SYS_RESOURCE\n,\nCAP_SYS_TTY_CONFIG\n. Also\nCAP_NET_ADMIN\nis retained if\n--private-network\nis specified.\nIf the special value \"\nall\n\" is passed, all capabilities are retained.\nIf the special value of \"\nhelp\n\" is passed, the program will print known\ncapability names and exit.\nThis option sets the bounding set of capabilities which\nalso limits the ambient capabilities as given with the\n--ambient-capability=\n.\nAdded in version 186.\n--drop-capability=\nÂ¶\nSpecify one or more additional capabilities to\ndrop for the container. This allows running the container with\nfewer capabilities than the default (see\nabove).\nIf the special value of \"\nhelp\n\" is passed, the program will print known\ncapability names and exit.\nThis option sets the bounding set of capabilities which\nalso limits the ambient capabilities as given with the\n--ambient-capability=\n.\nAdded in version 209.\n--ambient-capability=\nÂ¶\nSpecify one or more additional capabilities to\npass in the inheritable and ambient set to the program started\nwithin the container. The value \"\nall\n\" is not\nsupported for this setting.\nAll capabilities specified here must be in the set\nallowed with the\n--capability=\nand\n--drop-capability=\noptions. Otherwise, an\nerror message will be shown.\nThis option cannot be combined with the boot mode of the\ncontainer (as requested via\n--boot\n).\nIf the special value of \"\nhelp\n\" is\npassed, the program will print known capability names and\nexit.\nAdded in version 248.\n--no-new-privileges=\nÂ¶\nTakes a boolean argument. Specifies the value of the\nPR_SET_NO_NEW_PRIVS\nflag for the container payload. Defaults to off. When turned\non the payload code of the container cannot acquire new privileges, i.e. the \"setuid\" file bit as\nwell as file system capabilities will not have an effect anymore. See\nprctl\n(2)\nfor\ndetails about this flag.\nAdded in version 239.\n--system-call-filter=\nÂ¶\nAlter the system call filter\napplied to containers. Takes a space-separated list of system call names or group names (the latter\nprefixed with \"\n@\n\", as listed by the\nsyscall-filter\ncommand of\nsystemd-analyze\n(1)\n). Passed\nsystem calls will be permitted. The list may optionally be prefixed by \"\n~\n\", in which\ncase all listed system calls are prohibited. If this command line option is used multiple times the\nconfigured lists are combined. If both a positive and a negative list (that is one system call list\nwithout and one with the \"\n~\n\" prefix) are configured, the negative list takes\nprecedence over the positive list. Note that\nsystemd-nspawn\nalways implements a\nsystem call allow list (as opposed to a deny list!), and this command line option hence adds or\nremoves entries from the default allow list, depending on the \"\n~\n\" prefix. Note that\nthe applied system call filter is also altered implicitly if additional capabilities are passed using\nthe\n--capabilities=\n.\nAdded in version 235.\n-Z\n,\n--selinux-context=\nÂ¶\nSets the SELinux security context to be used\nto label processes in the container.\nAdded in version 209.\n-L\n,\n--selinux-apifs-context=\nÂ¶\nSets the SELinux security context to be used\nto label files in the virtual API file systems in the\ncontainer.\nAdded in version 209.\nResource Options\nÂ¶\n--rlimit=\nÂ¶\nSets the specified POSIX resource limit for the container payload. Expects an assignment of the\nform\n\"\nLIMIT\n=\nSOFT\n:\nHARD\n\"\nor \"\nLIMIT\n=\nVALUE\n\", where\nLIMIT\nshould refer to a resource limit type, such as\nRLIMIT_NOFILE\nor\nRLIMIT_NICE\n. The\nSOFT\nand\nHARD\nfields should refer to the numeric soft and hard resource limit values. If the\nsecond form is used,\nVALUE\nmay specify a value that is used both as soft and hard\nlimit. In place of a numeric value the special string \"\ninfinity\n\" may be used to turn off\nresource limiting for the specific type of resource. This command line option may be used multiple times to\ncontrol limits on multiple limit types. If used multiple times for the same limit type, the last use\nwins. For details about resource limits see\nsetrlimit\n(2)\n. By default\nresource limits for the container's init process (PID 1) are set to the same values the Linux kernel originally\npassed to the host init system. Note that some resource limits are enforced on resources counted per user, in\nparticular\nRLIMIT_NPROC\n. This means that unless user namespacing is deployed\n(i.e.\n--private-users=\nis used, see above), any limits set will be applied to the resource\nusage of the same user on all local containers as well as the host. This means particular care needs to be\ntaken with these limits as they might be triggered by possibly less trusted code. Example:\n\"\n--rlimit=RLIMIT_NOFILE=8192:16384\n\".\nAdded in version 239.\n--oom-score-adjust=\nÂ¶\nChanges the OOM (\"Out Of Memory\") score adjustment value for the container payload. This controls\n/proc/self/oom_score_adj\nwhich influences the preference with which this container is\nterminated when memory becomes scarce. For details see\nproc\n(5)\n. Takes an\ninteger in the range -1000â¦1000.\nAdded in version 239.\n--cpu-affinity=\nÂ¶\nControls the CPU affinity of the container payload. Takes a comma separated list of CPU numbers\nor number ranges (the latter's start and end value separated by dashes). See\nsched_setaffinity\n(2)\nfor\ndetails.\nAdded in version 239.\n--personality=\nÂ¶\nControl the architecture (\"personality\")\nreported by\nuname\n(2)\nin the container. Currently, only \"\nx86\n\" and\n\"\nx86-64\n\" are supported. This is useful when\nrunning a 32-bit container on a 64-bit host. If this setting\nis not used, the personality reported in the container is the\nsame as the one reported on the host.\nAdded in version 209.\nIntegration Options\nÂ¶\n--resolv-conf=\nÂ¶\nConfigures how\n/etc/resolv.conf\ninside of the container shall be\nhandled (i.e. DNS configuration synchronization from host to container). Takes one of\n\"\noff\n\", \"\ncopy-host\n\", \"\ncopy-static\n\",\n\"\ncopy-uplink\n\", \"\ncopy-stub\n\", \"\nreplace-host\n\",\n\"\nreplace-static\n\", \"\nreplace-uplink\n\",\n\"\nreplace-stub\n\", \"\nbind-host\n\", \"\nbind-static\n\",\n\"\nbind-uplink\n\", \"\nbind-stub\n\", \"\ndelete\n\" or\n\"\nauto\n\".\nIf set to \"\noff\n\" the\n/etc/resolv.conf\nfile in the\ncontainer is left as it is included in the image, and neither modified nor bind mounted over.\nIf set to \"\ncopy-host\n\", the\n/etc/resolv.conf\nfile from the\nhost is copied into the container, unless the file exists already and is not a regular file (e.g. a\nsymlink). Similarly, if \"\nreplace-host\n\" is used the file is copied, replacing any\nexisting inode, including symlinks. Similarly, if \"\nbind-host\n\" is used, the file is\nbind mounted from the host into the container.\nIf set to \"\ncopy-static\n\", \"\nreplace-static\n\" or\n\"\nbind-static\n\" the static\nresolv.conf\nfile supplied with\nsystemd-resolved.service\n(8)\n(specifically:\n/usr/lib/systemd/resolv.conf\n) is copied or bind mounted into the\ncontainer.\nIf set to \"\ncopy-uplink\n\", \"\nreplace-uplink\n\" or\n\"\nbind-uplink\n\" the uplink\nresolv.conf\nfile managed by\nsystemd-resolved.service\n(specifically:\n/run/systemd/resolve/resolv.conf\n) is copied or bind mounted into the\ncontainer.\nIf set to \"\ncopy-stub\n\", \"\nreplace-stub\n\" or\n\"\nbind-stub\n\" the stub\nresolv.conf\nfile managed by\nsystemd-resolved.service\n(specifically:\n/run/systemd/resolve/stub-resolv.conf\n) is copied or bind mounted into the\ncontainer.\nIf set to \"\ndelete\n\" the\n/etc/resolv.conf\nfile in the\ncontainer is deleted if it exists.\nFinally, if set to \"\nauto\n\" the file is left as it is if private networking is\nturned on (see\n--private-network\n). Otherwise, if\nsystemd-resolved.service\nis running its stub\nresolv.conf\nfile is used, and if not the host's\n/etc/resolv.conf\nfile. In the latter cases\nthe file is copied if the image is writable, and bind mounted otherwise.\nIt's recommended to use \"\ncopy-â¦\n\" or \"\nreplace-â¦\n\" if the\ncontainer shall be able to make changes to the DNS configuration on its own, deviating from the\nhost's settings. Otherwise, \"\nbind\n\" is preferable, as it means direct changes to\n/etc/resolv.conf\nin the container are not allowed, as it is a read-only bind\nmount (but note that if the container has enough privileges, it might simply go ahead and unmount the\nbind mount anyway). Note that both if the file is bind mounted and if it is copied no further\npropagation of configuration is generally done after the one-time early initialization (this is\nbecause the file is usually updated through copying and renaming). Defaults to\n\"\nauto\n\".\nAdded in version 239.\n--timezone=\nÂ¶\nConfigures how\n/etc/localtime\ninside of the container\n(i.e. local timezone synchronization from host to container) shall be handled. Takes one of\n\"\noff\n\", \"\ncopy\n\", \"\nbind\n\", \"\nsymlink\n\",\n\"\ndelete\n\" or \"\nauto\n\". If set to \"\noff\n\" the\n/etc/localtime\nfile in the container is left as it is included in the image, and\nneither modified nor bind mounted over. If set to \"\ncopy\n\" the\n/etc/localtime\nfile of the host is copied into the container. Similarly, if\n\"\nbind\n\" is used, the file is bind mounted from the host into the container. If set to\n\"\nsymlink\n\", a symlink is created pointing from\n/etc/localtime\nin\nthe container to the timezone file in the container that matches the timezone setting on the host. If\nset to \"\ndelete\n\", the file in the container is deleted, should it exist. If set to\n\"\nauto\n\" and the\n/etc/localtime\nfile of the host is a symlink,\nthen \"\nsymlink\n\" mode is used, and \"\ncopy\n\" otherwise, except if the\nimage is read-only in which case \"\nbind\n\" is used instead. Defaults to\n\"\nauto\n\".\nAdded in version 239.\n--link-journal=\nÂ¶\nControl whether the container's journal shall\nbe made visible to the host system. If enabled, allows viewing\nthe container's journal files from the host (but not vice\nversa). Takes one of \"\nno\n\",\n\"\nhost\n\", \"\ntry-host\n\",\n\"\nguest\n\", \"\ntry-guest\n\",\n\"\nauto\n\". If \"\nno\n\", the journal\nis not linked. If \"\nhost\n\", the journal files\nare stored on the host file system (beneath\n/var/log/journal/\nmachine-id\n)\nand the subdirectory is bind-mounted into the container at the\nsame location. If \"\nguest\n\", the journal files\nare stored on the guest file system (beneath\n/var/log/journal/\nmachine-id\n)\nand the subdirectory is symlinked into the host at the same\nlocation. \"\ntry-host\n\" and\n\"\ntry-guest\n\" do the same but do not fail if\nthe host does not have persistent journaling enabled, or if\nthe container is in the\n--ephemeral\nmode. If\n\"\nauto\n\" (the default), and the right\nsubdirectory of\n/var/log/journal\nexists,\nit will be bind mounted into the container. If the\nsubdirectory does not exist, no linking is performed.\nEffectively, booting a container once with\n\"\nguest\n\" or \"\nhost\n\" will link\nthe journal persistently if further on the default of\n\"\nauto\n\" is used.\nNote that\n--link-journal=try-guest\nis the default if the\nsystemd-nspawn@.service\ntemplate unit file is used.\nAdded in version 187.\n-j\nÂ¶\nEquivalent to\n--link-journal=try-guest\n.\nAdded in version 187.\nMount Options\nÂ¶\n--bind=\n,\n--bind-ro=\nÂ¶\nBind mount a file or directory from the host into the container. Takes one of: a path\nargumentÂ â in which case the specified path will be mounted from the host to the same path in the container, or\na colon-separated pair of pathsÂ â in which case the first specified path is the source in the host, and the\nsecond path is the destination in the container, or a colon-separated triple of source path, destination path\nand mount options. The source path may optionally be prefixed with a \"\n+\n\" character. If so, the\nsource path is taken relative to the image's root directory. This permits setting up bind mounts within the\ncontainer image. The source path may be specified as empty string, in which case a temporary directory below\nthe host's\n/var/tmp/\ndirectory is used. It is automatically removed when the container is\nshut down. If the source path is not absolute, it is resolved relative to the current working directory.\nThe\n--bind-ro=\noption creates read-only bind mounts. Backslash escapes are interpreted,\nso \"\n\\:\n\" may be used to embed colons in either path. This option may be specified\nmultiple times for creating multiple independent bind mount points.\nMount options are comma-separated.\nrbind\nand\nnorbind\ncontrol whether\nto create a recursive or a regular bind mount. Defaults to\nrbind\n.\nnoidmap\n,\nidmap\n,\nrootidmap\nand\nowneridmap\ncontrol ID mapping.\nUsing\nidmap\n,\nrootidmap\nor\nowneridmap\nrequires support\nby the source filesystem for user/group ID mapped mounts. Defaults to\nnoidmap\n. With\nx\nbeing the container's UID range offset,\ny\nbeing the length of the\ncontainer's UID range, and\np\nbeing the owner UID of the bind mount source inode on the host:\nIf\nnoidmap\nis used, any user\nz\nin the range\n0 â¦ y\nseen from inside of the container is mapped to\nx + z\nin the\nx â¦ x + y\nrange on the host. Other host users are mapped to\nnobody\ninside the container.\nIf\nidmap\nis used, any user\nz\nin the UID range\n0 â¦ y\nas seen from inside the container is mapped to the same\nz\nin the same\n0 â¦ y\nrange on the host. Other host users are mapped to\nnobody\ninside the container.\nIf\nrootidmap\nis used, the user\n0\nseen from inside\nof the container is mapped to\np\non the host. Other host users are mapped to\nnobody\ninside the container.\nIf\nowneridmap\nis used, the owner of the target directory inside of the\ncontainer is mapped to\np\non the host. Other host users are mapped to\nnobody\ninside the container.\nWhichever ID mapping option is used, the same mapping will be used for users and groups IDs. If\nrootidmap\nor\nowneridmap\nare used, the group owning the bind mounted directory\nwill have no effect.\nNote that when this option is used in combination with\n--private-users\n, the resulting\nmount points will be owned by the\nnobody\nuser. That's because the mount and its files and\ndirectories continue to be owned by the relevant host users and groups, which do not exist in the container,\nand thus show up under the wildcard UID 65534 (nobody). If such bind mounts are created, it is recommended to\nmake them read-only, using\n--bind-ro=\n. Alternatively you can use the \"idmap\" mount option to\nmap the filesystem IDs.\nAdded in version 198.\n--bind-user=\nÂ¶\nBinds the home directory of the specified user on the host into the container. Takes\nthe name of an existing user on the host as argument. May be used multiple times to bind multiple\nusers into the container. This does three things:\nThe user's home directory is bind mounted from the host into\n/run/host/home/\n, using an idmapped mount to map the host user's UID/GID to its\nassigned UID/GID in the container.\nA JSON user and group record is generated in\n/run/userdb/\nthat\ndescribes the mapped user. It contains a minimized representation of the host's user record,\nadjusted to the UID/GID and home directory path assigned to the user in the container. The\nnss-systemd\n(8)\nglibc NSS module will pick up these records from there and make them available in the container's\nuser/group databases.\nThe combination of the three operations above ensures that it is possible to log into the\ncontainer using the same account information as on the host. The user is only mapped transiently,\nwhile the container is running, and the mapping itself does not result in persistent changes to the\ncontainer (except maybe for log messages generated at login time, and similar). Note that in\nparticular the UID/GID assignment in the container is not made persistently. If the user is mapped\ntransiently, it is best to not allow the user to make persistent changes to the container. If the\nuser leaves files or directories owned by the user, and those UIDs/GIDs are reused during later\ncontainer invocations (possibly with a different\n--bind-user=\nmapping), those files\nand directories will be accessible to the \"new\" user.\nThe user/group record mapping only works if the container contains systemd 249 or newer, with\nnss-systemd\nproperly configured in\nnsswitch.conf\n. See\nnss-systemd\n(8)\nfor\ndetails.\nNote that the user record propagated from the host into the container will contain the UNIX\npassword hash of the user, so that seamless logins in the container are possible. If the container is\nless trusted than the host it is hence important to use a strong UNIX password hash function\n(e.g. yescrypt or similar, with the \"\n$y$\n\" hash prefix).\nWhen binding a user from the host into the container checks are executed to ensure that the\nusername is not yet known in the container. Moreover, it is checked that the UID/GID allocated for it\nis not currently defined in the user/group databases of the container. Both checks directly access\nthe container's\n/etc/passwd\nand\n/etc/group\n, and thus might\nnot detect existing accounts in other databases.\nAdded in version 249.\n--bind-user-shell=\nÂ¶\nWhen used with\n--bind-user=\n, includes the specified shell in the\nuser records of users bound into the container. Takes either a boolean or an absolute path.\nIf false (the default), no shell is passed in the user records for users bound into\nthe container. This causes bound users to the use the container's default shell.\nIf true, the shells specified by the host user records are included in the user records of all users bound into the container.\nIf passed an absolute path, sets that path as the shell for user records of all users bound into the container.\nNote: This will not check whether the specified shells exist in the container.\nThis operation is only supported in combination with\n--bind-user=\n.\nAdded in version 258.\n--inaccessible=\nÂ¶\nMake the specified path inaccessible in the container. This over-mounts the specified path\n(which must exist in the container) with a file node of the same type that is empty and has the most\nrestrictive access mode supported. This is an effective way to mask files, directories and other file system\nobjects from the container payload. This option may be used more than once in case all specified paths are\nmasked.\nAdded in version 242.\n--tmpfs=\nÂ¶\nMount a tmpfs file system into the container.  Takes a single absolute path argument that\nspecifies where to mount the tmpfs instance to (in which case the directory access mode will be chosen as 0755,\nowned by root/root), or optionally a colon-separated pair of path and mount option string that is used for\nmounting (in which case the kernel default for access mode and owner will be chosen, unless otherwise\nspecified). Backslash escapes are interpreted in the path, so \"\n\\:\n\" may be used to embed colons\nin the path.\nNote that this option cannot be used to replace the root file system of the container with a temporary\nfile system. However, the\n--volatile=\noption described below provides similar\nfunctionality, with a focus on implementing stateless operating system images.\nAdded in version 214.\n--overlay=\n,\n--overlay-ro=\nÂ¶\nCombine multiple directory trees into one overlay file system and mount it into the\ncontainer. Takes a list of colon-separated paths to the directory trees to combine and the\ndestination mount point.\nBackslash escapes are interpreted in the paths, so \"\n\\:\n\" may be used to embed\ncolons in the paths.\nIf three or more paths are specified, then the last specified path is the destination mount\npoint in the container, all paths specified before refer to directory trees on the host and are\ncombined in the specified order into one overlay file system. The left-most path is hence the lowest\ndirectory tree, the second-to-last path the highest directory tree in the stacking order. If\n--overlay-ro=\nis used instead of\n--overlay=\n, a read-only overlay\nfile system is created. If a writable overlay file system is created, all changes made to it are\nwritten to the highest directory tree in the stacking order, i.e. the second-to-last specified.\nIf only two paths are specified, then the second specified path is used both as the top-level\ndirectory tree in the stacking order as seen from the host, as well as the mount point for the\noverlay file system in the container. At least two paths have to be specified.\nThe source paths may optionally be prefixed with \"\n+\n\" character. If so they are\ntaken relative to the image's root directory. The uppermost source path may also be specified as an\nempty string, in which case a temporary directory below the host's\n/var/tmp/\nis\nused. The directory is removed automatically when the container is shut down. This behaviour is\nuseful in order to make read-only container directories writable while the container is running. For\nexample, use \"\n--overlay=+/var::/var\n\" in order to automatically overlay a writable\ntemporary directory on a read-only\n/var/\ndirectory. If a source path is not\nabsolute, it is resolved relative to the current working directory.\nFor details about overlay file systems, see\nOverlay Filesystem\n.\nNote that the semantics of overlay file systems are substantially different from normal file systems,\nin particular regarding reported device and inode information. Device and inode information may\nchange for a file while it is being written to, and processes might see out-of-date versions of files\nat times. Note that this switch automatically derives the \"\nworkdir=\n\" mount option\nfor the overlay file system from the top-level directory tree, making it a sibling of it. It is hence\nessential that the top-level directory tree is not a mount point itself (since the working directory\nmust be on the same file system as the top-most directory tree). Also note that the\n\"\nlowerdir=\n\" mount option receives the paths to stack in the opposite order of this\nswitch.\nNote that this option cannot be used to replace the root file system of the container with an overlay\nfile system. However, the\n--volatile=\noption described above provides similar functionality,\nwith a focus on implementing stateless operating system images.\nAdded in version 220.\nInput/Output Options\nÂ¶\n--console=\nMODE\nÂ¶\nConfigures how to set up standard input, output and error output for the container\npayload, as well as the\n/dev/console\ndevice for the container. Takes one of\ninteractive\n,\nread-only\n,\npassive\n,\npipe\nor\nautopipe\n. If\ninteractive\n, a pseudo-TTY is\nallocated and made available as\n/dev/console\nin the container. It is then\nbi-directionally connected to the standard input and output passed to\nsystemd-nspawn\n.\nread-only\nis similar but only the output of the\ncontainer is propagated and no input from the caller is read. If\npassive\n, a pseudo\nTTY is allocated, but it is not connected anywhere. In\npipe\nmode no pseudo TTY is\nallocated, but the standard input, output and error output file descriptors passed to\nsystemd-nspawn\nare passed on â as they are â to the container payload, see the\nfollowing paragraph. Finally,\nautopipe\nmode operates like\ninteractive\nwhen\nsystemd-nspawn\nis invoked on a terminal, and\nlike\npipe\notherwise. Defaults to\ninteractive\nif\nsystemd-nspawn\nis invoked from a terminal, and\nread-only\notherwise.\nIn\npipe\nmode,\n/dev/console\nwill not exist in the\ncontainer. This means that the container payload generally cannot be a full init system as init\nsystems tend to require\n/dev/console\nto be available. On the other hand, in this\nmode container invocations can be used within shell pipelines. This is because intermediary pseudo\nTTYs do not permit independent bidirectional propagation of the end-of-file (EOF) condition, which is\nnecessary for shell pipelines to work correctly.\nNote that the\npipe\nmode\nshould be used carefully\n, as passing arbitrary file descriptors to less trusted container\npayloads might open up unwanted interfaces for access by the container payload. For example, if a\npassed file descriptor refers to a TTY of some form, APIs such as\nTIOCSTI\nmay be\nused to synthesize input that might be used for escaping the container. Hence\npipe\nmode should only be used if the payload is sufficiently trusted or when the standard\ninput/output/error output file descriptors are known safe, for example pipes.\nAdded in version 242.\n--pipe\n,\n-P\nÂ¶\nEquivalent to\n--console=pipe\n.\nAdded in version 242.\n--background=\nCOLOR\nÂ¶\nChange the terminal background color to the specified ANSI color as long as the\ncontainer runs. The color specified should be an ANSI X3.64 SGR background color, i.e. strings such\nas \"\n40\n\", \"\n41\n\", â¦, \"\n47\n\", \"\n48;2;â¦\n\",\n\"\n48;5;â¦\n\". See\nANSI\nEscape Code (Wikipedia)\nfor details. Assign an empty string to disable any coloring.\nAdded in version 256.\nCredentials\nÂ¶\n--load-credential=\nID\n:\nPATH\n,\n--set-credential=\nID\n:\nVALUE\nÂ¶\nPass a credential to the container. These two options correspond to the\nLoadCredential=\nand\nSetCredential=\nsettings in unit files. See\nsystemd.exec\n(5)\nfor\ndetails about these concepts, as well as the syntax of the option's arguments.\nNote: when\nsystemd-nspawn\nruns as systemd system service it can propagate\nthe credentials it received via\nLoadCredential=\n/\nSetCredential=\nto the container payload. A systemd service manager running as PID 1 in the container can further\npropagate them to the services it itself starts. It is thus possible to easily propagate credentials\nfrom a parent service manager to a container manager service and from there into its payload. This\ncan even be done recursively.\nIn order to embed binary data into the credential data for\n--set-credential=\n,\nuse C-style escaping (i.e. \"\n\\n\n\" to embed a newline, or \"\n\\x00\n\" to\nembed a\nNUL\nbyte). Note that the invoking shell might already apply unescaping\nonce, hence this might require double escaping!\nThe\nsystemd-sysusers.service\n(8)\nand\nsystemd-firstboot\n(1)\nservices read credentials configured this way for the purpose of configuring the container's root\nuser's password and shell, as well as system locale, keymap and timezone during the first boot\nprocess of the container. This is particularly useful in combination with\n--volatile=yes\nwhere every single boot appears as first boot, since configuration\napplied to\n/etc/\nis lost on container reboot cycles. See the respective man\npages for details. Example:\n# systemd-nspawn -i image.raw \\\n--volatile=yes \\\n--set-credential=firstboot.locale:de_DE.UTF-8 \\\n--set-credential=passwd.hashed-password.root:'$y$j9T$yAuRJu1o5HioZAGDYPU5d.$F64ni6J2y2nNQve90M/p0ZP0ECP/qqzipNyaY9fjGpC' \\\n-b\nThe above command line will invoke the specified image file\nimage.raw\nin\nvolatile mode, i.e. with empty\n/etc/\nand\n/var/\n.  The\ncontainer payload will recognize this as a first boot, and will invoke\nsystemd-firstboot.service\n, which then reads the two passed credentials to\nconfigure the system's initial locale and root password.\nAdded in version 247.\nOther\nÂ¶\n--no-pager\nÂ¶\nDo not pipe output into a pager.\n-h\n,\n--help\nÂ¶\nPrint a short help text and exit.\n--version\nÂ¶\nPrint a short version string and exit.\n--no-ask-password\nÂ¶\nDo not query the user for authentication for privileged operations.\nHotkeys\nÂ¶\nWhen invoked in interactive mode (i.e. the default\n--console=interactive\n), a few\nspecial keyboard shortcuts are understood that control the container runtime. These shortcuts need to be\ntyped within 1s to have effect, otherwise they will be forwarded to the container as regular\nkeypresses.\nCtrl-] Ctrl-] Ctrl-]\nÂ¶\nImmediately terminate the container, killing all processes.\nCtrl-] Ctrl-] r\nÂ¶\nIssue a reboot request to the container.\nAdded in version 258.\nCtrl-] Ctrl-] p\nÂ¶\nIssue a shutdown request to the container.\nAdded in version 258.\nEnvironment\nÂ¶\n$SYSTEMD_LOG_LEVEL\nÂ¶\nThe maximum log level of emitted messages (messages with a higher\nlog level, i.e. less important ones, will be suppressed). Takes a comma-separated list of values. A\nvalue may be either one of (in order of decreasing importance)\nemerg\n,\nalert\n,\ncrit\n,\nerr\n,\nwarning\n,\nnotice\n,\ninfo\n,\ndebug\n, or an integer in the range 0â¦7. See\nsyslog\n(3)\nfor more information. Each value may optionally be prefixed with one of\nconsole\n,\nsyslog\n,\nkmsg\nor\njournal\nfollowed by a\ncolon to set the maximum log level for that specific log target (e.g.\nSYSTEMD_LOG_LEVEL=debug,console:info\nspecifies to log at debug level except when\nlogging to the console which should be at info level). Note that the global maximum log level takes\npriority over any per target maximum log levels.\n$SYSTEMD_LOG_COLOR\nÂ¶\nA boolean. If true, messages written to the tty will be colored\naccording to priority.\nThis setting is only useful when messages are written directly to the terminal, because\njournalctl\n(1)\nand\nother tools that display logs will color messages based on the log level on their own.\n$SYSTEMD_LOG_TIME\nÂ¶\nA boolean. If true, console log messages will be prefixed with a\ntimestamp.\nThis setting is only useful when messages are written directly to the terminal or a file, because\njournalctl\n(1)\nand\nother tools that display logs will attach timestamps based on the entry metadata on their own.\n$SYSTEMD_LOG_LOCATION\nÂ¶\nA boolean. If true, messages will be prefixed with a filename\nand line number in the source code where the message originates.\nNote that the log location is often attached as metadata to journal entries anyway. Including it\ndirectly in the message text can nevertheless be convenient when debugging programs.\n$SYSTEMD_LOG_TID\nÂ¶\nA boolean. If true, messages will be prefixed with the current\nnumerical thread ID (TID).\nNote that the this information is attached as metadata to journal entries anyway. Including it\ndirectly in the message text can nevertheless be convenient when debugging programs.\n$SYSTEMD_LOG_TARGET\nÂ¶\nThe destination for log messages. One of\nconsole\n(log to the attached tty),\nconsole-prefixed\n(log to\nthe attached tty but with prefixes encoding the log level and \"facility\", see\nsyslog\n(3)\n,\nkmsg\n(log to the kernel circular log buffer),\njournal\n(log to\nthe journal),\njournal-or-kmsg\n(log to the journal if available, and to kmsg\notherwise),\nauto\n(determine the appropriate log target automatically, the default),\nnull\n(disable log output).\n$SYSTEMD_LOG_RATELIMIT_KMSG\nÂ¶\nWhether to ratelimit kmsg or not. Takes a boolean.\nDefaults to \"\ntrue\n\". If disabled, systemd will not ratelimit messages written to kmsg.\n$SYSTEMD_PAGER\n,\n$PAGER\nÂ¶\nPager to use when\n--no-pager\nis not given.\n$SYSTEMD_PAGER\nis used if set; otherwise\n$PAGER\nis used.\nIf neither\n$SYSTEMD_PAGER\nnor\n$PAGER\nare set, a set of well-known\npager implementations is tried in turn, including\nless\n(1)\nand\nmore\n(1)\n,\nuntil one is found. If no pager implementation is discovered, no pager is invoked. Setting those\nenvironment variables to an empty string or the value \"\ncat\n\" is equivalent to passing\n--no-pager\n.\nNote: if\n$SYSTEMD_PAGERSECURE\nis not set,\n$SYSTEMD_PAGER\nand\n$PAGER\ncan only be used to disable the pager (with \"\ncat\n\" or\n\"\n\"), and are otherwise ignored.\n$SYSTEMD_LESS\nÂ¶\nOverride the options passed to\nless\n(by default\n\"\nFRSXMK\n\").\nUsers might want to change two options in particular:\nK\nÂ¶\nThis option instructs the pager to exit immediately when\nCtrl\n+\nC\nis pressed. To allow\nless\nto handle\nCtrl\n+\nC\nitself to switch back to the pager command prompt, unset this option.\nIf the value of\n$SYSTEMD_LESS\ndoes not include \"\nK\n\",\nand the pager that is invoked is\nless\n,\nCtrl\n+\nC\nwill be ignored by the\nexecutable, and needs to be handled by the pager.\nX\nÂ¶\nThis option instructs the pager to not send termcap initialization and deinitialization\nstrings to the terminal. It is set by default to allow command output to remain visible in the\nterminal even after the pager exits. Nevertheless, this prevents some pager functionality from\nworking, in particular paged output cannot be scrolled with the mouse.\nNote that setting the regular\n$LESS\nenvironment variable has no effect\nfor\nless\ninvocations by systemd tools.\nSee\nless\n(1)\nfor more discussion.\n$SYSTEMD_LESSCHARSET\nÂ¶\nOverride the charset passed to\nless\n(by default \"\nutf-8\n\", if\nthe invoking terminal is determined to be UTF-8 compatible).\nNote that setting the regular\n$LESSCHARSET\nenvironment variable has no effect\nfor\nless\ninvocations by systemd tools.\n$SYSTEMD_PAGERSECURE\nÂ¶\nCommon pager commands like\nless\n(1)\n, in\naddition to \"paging\", i.e. scrolling through the output, support opening of or writing to other files\nand running arbitrary shell commands. When commands are invoked with elevated privileges, for example\nunder\nsudo\n(8)\nor\npkexec\n(1)\n, the\npager becomes a security boundary. Care must be taken that only programs with strictly limited\nfunctionality are used as pagers, and unintended interactive features like opening or creation of new\nfiles or starting of subprocesses are not allowed. \"Secure mode\" for the pager may be enabled as\ndescribed below,\nif the pager supports that\n(most pagers are not written in a way\nthat takes this into consideration). It is recommended to either explicitly enable \"secure mode\" or to\ncompletely disable the pager using\n--no-pager\nor\nPAGER=cat\nwhen\nallowing untrusted users to execute commands with elevated privileges.\nThis option takes a boolean argument. When set to true, the \"secure mode\" of the pager is\nenabled. In \"secure mode\",\nLESSSECURE=1\nwill be set when invoking the pager, which\ninstructs the pager to disable commands that open or create new files or start new subprocesses.\nCurrently only\nless\n(1)\nis known\nto understand this variable and implement \"secure mode\".\nWhen set to false, no limitation is placed on the pager. Setting\nSYSTEMD_PAGERSECURE=0\nor not removing it from the inherited environment may allow\nthe user to invoke arbitrary commands.\nWhen\n$SYSTEMD_PAGERSECURE\nis not set, systemd tools attempt to automatically\nfigure out if \"secure mode\" should be enabled and whether the pager supports it. \"Secure mode\" is\nenabled if the effective UID is not the same as the owner of the login session, see\ngeteuid\n(2)\nand\nsd_pid_get_owner_uid\n(3)\n,\nor when running under\nsudo\n(8)\nor similar\ntools (\n$SUDO_UID\nis set\n[1]\n). In those cases,\nSYSTEMD_PAGERSECURE=1\nwill be set and pagers which are not known to implement\n\"secure mode\" will not be used at all. Note that this autodetection only covers the most common\nmechanisms to elevate privileges and is intended as convenience. It is recommended to explicitly set\n$SYSTEMD_PAGERSECURE\nor disable the pager.\nNote that if the\n$SYSTEMD_PAGER\nor\n$PAGER\nvariables are to\nbe honoured, other than to disable the pager,\n$SYSTEMD_PAGERSECURE\nmust be set\ntoo.\n$SYSTEMD_COLORS\nÂ¶\nTakes a boolean argument. When true,\nsystemd\nand related utilities\nwill use colors in their output, otherwise the output will be monochrome. Additionally, the variable can\ntake one of the following special values: \"\n16\n\", \"\n256\n\" to restrict the use\nof colors to the base 16 or 256 ANSI colors, respectively. This can be specified to override the automatic\ndecision based on\n$TERM\nand what the console is connected to.\n$SYSTEMD_URLIFY\nÂ¶\nThe value must be a boolean. Controls whether clickable links should be generated in\nthe output for terminal emulators supporting this. This can be specified to override the decision that\nsystemd\nmakes based on\n$TERM\nand other conditions.\nExamples\nÂ¶\nExampleÂ 1.Â Download an Ubuntu TAR image and open a shell in it\n# importctl pull-tar -mN https://cloud-images.ubuntu.com/jammy/current/jammy-server-cloudimg-amd64-root.tar.xz\n# systemd-nspawn -M jammy-server-cloudimg-amd64-root\nThis downloads and verifies the specified\n.tar\nimage, and then uses\nsystemd-nspawn\n(1)\nto\nopen a shell in it.\nExampleÂ 2.Â Build and boot a minimal Fedora distribution in a container\n# dnf -y --releasever=42 --installroot=/var/lib/machines/f42 \\\n--use-host-config --setopt=install_weak_deps=0 \\\n--repo=fedora --repo=updates install \\\npasswd dnf fedora-release nano util-linux systemd systemd-networkd\n# systemd-nspawn -bD /var/lib/machines/f42\n(Omit\n--use-host-config\nwhen using\ndnf\n<= 4.)\nThis installs a minimal Fedora distribution into the directory\n/var/lib/machines/f42\nand then boots that OS in a namespace container. Because the installation\nis located underneath the standard\n/var/lib/machines/\ndirectory, it is also possible to start the machine using\nsystemd-nspawn -M f42\n.\nExampleÂ 3.Â Spawn a shell in a container of a minimal Debian unstable distribution\n# debootstrap unstable ~/debian-tree/\n# systemd-nspawn -D ~/debian-tree/\nThis installs a minimal Debian unstable distribution into\nthe directory\n~/debian-tree/\nand then\nspawns a shell from this image in a namespace container.\ndebootstrap\nsupports\nDebian\n,\nand\nUbuntu\nout of the box, so the same command can be used to install any of those. For other\ndistributions from the Debian family, a mirror has to be specified, see\ndebootstrap\n(8)\n.\nExampleÂ 4.Â Boot a minimal\nArch Linux\ndistribution in a container\n# pacstrap -c ~/arch-tree/ base\n# systemd-nspawn -bD ~/arch-tree/\nThis installs a minimal Arch Linux distribution into the\ndirectory\n~/arch-tree/\nand then boots an OS\nin a namespace container in it.\nExampleÂ 5.Â Install the\nOpenSUSE Tumbleweed\nrolling distribution\n# zypper --root=/var/lib/machines/tumbleweed ar -c \\\nhttps://download.opensuse.org/tumbleweed/repo/oss tumbleweed\n# zypper --root=/var/lib/machines/tumbleweed refresh\n# zypper --root=/var/lib/machines/tumbleweed install --no-recommends \\\nsystemd shadow zypper openSUSE-release vim\n# systemd-nspawn -M tumbleweed passwd root\n# systemd-nspawn -M tumbleweed -b\nExampleÂ 6.Â Boot into an ephemeral snapshot of the host system\n# systemd-nspawn -D / -xb\nThis runs a copy of the host system in a snapshot which is removed immediately when the container\nexits. All file system changes made during runtime will be lost on shutdown, hence.\nExampleÂ 7.Â Run a container with SELinux sandbox security contexts\n# chcon system_u:object_r:svirt_sandbox_file_t:s0:c0,c1 -R /srv/container\n# systemd-nspawn -L system_u:object_r:svirt_sandbox_file_t:s0:c0,c1 \\\n-Z system_u:system_r:svirt_lxc_net_t:s0:c0,c1 -D /srv/container /bin/sh\nExampleÂ 8.Â Run a container with an OSTree deployment\n# systemd-nspawn -b -i ~/image.raw \\\n--pivot-root=/ostree/deploy/$OS/deploy/$CHECKSUM:/sysroot \\\n--bind=+/sysroot/ostree/deploy/$OS/var:/var\nExit status\nÂ¶\nThe exit code of the program executed in the container is\nreturned.\nSee Also\nÂ¶\nsystemd\n(1)\n,\nsystemd.nspawn\n(5)\n,\nchroot\n(1)\n,\ndnf\n(8)\n,\ndebootstrap\n(8)\n,\npacman\n(8)\n,\nzypper\n(8)\n,\nsystemd.slice\n(5)\n,\nmachinectl\n(1)\n,\nimportctl\n(1)\n,\nsystemd-mountfsd.service\n(8)\n,\nsystemd-nsresourced.service\n(8)\n,\nbtrfs\n(8)\n[1]\nIt is recommended for other tools to set and check\n$SUDO_UID\nas appropriate,\ntreating it is a common interface.", "metadata": {"source_type": "vendor_docs", "trust": "vendor_docs", "os": "linux", "distro": "ubuntu-22.04", "license": "CC BY-SA (assumed; verify per site)", "attribution_url": "https://www.freedesktop.org/software/systemd/man/latest/systemd-nspawn.html"}}
{"text": "machinectl\nIndex\nÂ·\nDirectives\nsystemd 258\nName\nmachinectl â Control the systemd machine manager\nSynopsis\nmachinectl\n[OPTIONS...] {COMMAND} [NAME...]\nDescription\nÂ¶\nmachinectl\nmay be used to introspect and\ncontrol the state of the\nsystemd\n(1)\nvirtual machine and container registration manager\nsystemd-machined.service\n(8)\n.\nmachinectl\nmay be used to execute\noperations on machines and images. Machines in this sense are\nconsidered running instances of:\nVirtual Machines (VMs) that virtualize hardware\nto run full operating system (OS) instances (including their kernels)\nin a virtualized environment on top of the host OS.\nContainers that share the hardware and\nOS kernel with the host OS, in order to run\nOS userspace instances on top the host OS.\nThe host system itself.\nMachines are identified by names that follow the same rules\nas UNIX and DNS hostnames. For details, see below.\nMachines are instantiated from disk or file system images that\nfrequentlyÂ â but not necessarilyÂ â carry the same name as machines running\nfrom them. Images in this sense may be:\nDirectory trees containing an OS, including the\ntop-level directories\n/usr/\n,\n/etc/\n, and so on.\nbtrfs subvolumes containing OS trees, similar to regular directory trees.\nBinary \"raw\" disk image files containing MBR or GPT partition tables and Linux file\nsystems.\nSimilarly, block devices containing MBR or GPT partition tables and file systems.\nThe file system tree of the host OS itself.\nImages may be downloaded, imported and exported via the\nimportctl\n(1)\ntool.\nCommands\nÂ¶\nThe following commands are understood:\nMachine Commands\nÂ¶\nlist\nÂ¶\nList currently running (online) virtual\nmachines and containers. To enumerate machine images that can\nbe started, use\nlist-images\n(see\nbelow). Note that this command hides the special\n\"\n.host\n\" machine by default. Use the\n--all\nswitch to show it.\nAdded in version 206.\nstatus\nNAME\nâ¦\nÂ¶\nShow runtime status information about\none or more virtual machines and containers, followed by the\nmost recent log data from the journal. This function is\nintended to generate human-readable output. If you are looking\nfor computer-parsable output, use\nshow\ninstead. Note that the log data shown is reported by the\nvirtual machine or container manager, and frequently contains\nconsole output of the machine, but not necessarily journal\ncontents of the machine itself.\nAdded in version 206.\nshow\n[\nNAME\nâ¦]\nÂ¶\nShow properties of one or more registered virtual machines or containers or the manager\nitself. If no argument is specified, properties of the manager will be shown. If a NAME is specified,\nproperties of this virtual machine or container are shown. By default, empty properties are suppressed. Use\n--all\nto show those too.  To select specific properties to show, use\n--property=\n. This command is intended to be used whenever computer-parsable output is\nrequired, and does not print the control group tree or journal entries. Use\nstatus\nif you\nare looking for formatted human-readable output.\nAdded in version 206.\nstart\nNAME\nâ¦\nÂ¶\nStart a container as a system service, using\nsystemd-nspawn\n(1)\n.\nThis starts\nsystemd-nspawn@.service\n,\ninstantiated for the specified machine name, similar to the\neffect of\nsystemctl start\non the service\nname.\nsystemd-nspawn\nlooks for a container\nimage by the specified name in\n/var/lib/machines/\n(and other search\npaths, see below) and runs it. Use\nlist-images\n(see below) for listing\navailable container images to start.\nNote that\nsystemd-machined.service\n(8)\nalso interfaces with a variety of other container and VM\nmanagers,\nsystemd-nspawn\nis just one\nimplementation of it. Most of the commands available in\nmachinectl\nmay be used on containers or VMs\ncontrolled by other managers, not just\nsystemd-nspawn\n. Starting VMs and container\nimages on those managers requires manager-specific\ntools.\nTo interactively start a container on the command line\nwith full access to the container's console, please invoke\nsystemd-nspawn\ndirectly. To stop a running\ncontainer use\nmachinectl poweroff\n.\nAdded in version 219.\nlogin\n[\nNAME\n]\nÂ¶\nOpen an interactive terminal login session in\na container or on the local host. If an argument is supplied,\nit refers to the container machine to connect to. If none is\nspecified, or the container name is specified as the empty\nstring, or the special machine name \"\n.host\n\"\n(see below) is specified, the connection is made to the local\nhost instead. This will create a TTY connection to a specific\ncontainer or the local host and asks for the execution of a\ngetty on it. Note that this is only supported for containers\nrunning\nsystemd\n(1)\nas init system.\nThis command will open a full login prompt on the\ncontainer or the local host, which then asks for username and\npassword. Use\nshell\n(see below) or\nsystemd-run\n(1)\nwith the\n--machine=\nswitch to directly invoke\na single command, either interactively or in the\nbackground.\nAdded in version 209.\nshell\n[[\nNAME\n@]\nNAME\n[\nPATH\n[\nARGUMENTS\nâ¦]]]\nÂ¶\nOpen an interactive shell session in a\ncontainer or on the local host. The first argument refers to\nthe container machine to connect to. If none is specified, or\nthe machine name is specified as the empty string, or the\nspecial machine name \"\n.host\n\" (see below) is\nspecified, the connection is made to the local host\ninstead. This works similarly to\nlogin\n, but\nimmediately invokes a user process. This command runs the\nspecified executable with the specified arguments, or the\ndefault shell for the user if none is specified, or\n/bin/sh\nif no default shell is found. By default,\n--uid=\n, or by prefixing the machine name with\na username and an \"\n@\n\" character, a different\nuser may be selected. Use\n--setenv=\nto set\nenvironment variables for the executed process.\nNote that\nmachinectl shell\ndoes not propagate the exit code/status of the invoked\nshell process. Use\nsystemd-run\ninstead if that information is required (see below).\nUsing the\nshell\ncommand without arguments (thus invoking the executed shell\nor command on the local host), is in many ways similar to a\nsu\n(1)\nsession,\nbut, unlike\nsu\n, completely isolates the new session from the originating session,\nso that it shares no process or session properties and is in a clean well-defined state. It will be\ntracked in a new utmp, login, audit, security, and keyring sessions, and will not inherit any\nenvironment variables or resource limits, among other properties.\nNote that\nsystemd-run\n(1)\nwith\nits\n--machine=\nswitch may be used in place of the\nmachinectl\nshell\ncommand, and allows non-interactive operation, more detailed and low-level\nconfiguration of the invoked unit, as well as access to runtime and exit code/status information of\nthe invoked shell process. In particular, use\nsystemd-run\n's\n--wait\nswitch to propagate exit status information of the invoked process. Use\nsystemd-run\n's\n--pty\nswitch to acquire an interactive shell,\nsimilarly to\nmachinectl shell\n. In general,\nsystemd-run\nis\npreferable for scripting purposes. However, note that\nsystemd-run\nmight require\nhigher privileges than\nmachinectl shell\n.\nAdded in version 225.\nenable\nNAME\nâ¦,\ndisable\nNAME\nâ¦\nÂ¶\nEnable or disable a container as a system service to start at system boot, using\nsystemd-nspawn\n(1)\n.\nThis enables or disables\nsystemd-nspawn@.service\n, instantiated for the specified\nmachine name, similarly to the effect of\nsystemctl enable\nor\nsystemctl\ndisable\non the service name.\nThis command implicitly reloads the system manager configuration after completing the operation.\nNote that this command does not implicitly start or power off the containers that are being operated on.\nIf this is desired, combine the command with the\n--now\nswitch.\nAdded in version 219.\npoweroff\nNAME\nâ¦\nÂ¶\nPower off one or more containers. This will\ntrigger a shutdown by sending SIGRTMIN+4 to the container's init\nprocess, which causes systemd-compatible init systems to shut\ndown cleanly. Use\nstop\nas alias for\npoweroff\n.\nThis operation does not work on containers that do not run a\nsystemd\n(1)\n-compatible\ninit system, such as sysvinit. Use\nterminate\n(see below) to immediately\nterminate a container or VM, without cleanly shutting it\ndown.\nAdded in version 212.\nreboot\nNAME\nâ¦\nÂ¶\nReboot one or more containers. This will\ntrigger a reboot by sending SIGINT to the container's init\nprocess, which is roughly equivalent to pressing Ctrl+Alt+Del\non a non-containerized system, and is compatible with\ncontainers running any system manager. Use\nrestart\nas alias\nfor\nreboot\n.\nAdded in version 209.\nterminate\nNAME\nâ¦\nÂ¶\nImmediately terminates a virtual machine or\ncontainer, without cleanly shutting it down. This kills all\nprocesses of the virtual machine or container and deallocates\nall resources attached to that instance. Use\npoweroff\nto issue a clean shutdown\nrequest.\nAdded in version 206.\nkill\nNAME\nâ¦\nÂ¶\nSend a signal to one or more processes of the\nvirtual machine or container. This means processes as seen by\nthe host, not the processes inside the virtual machine or\ncontainer. Use\n--kill-whom=\nto select which\nprocess to kill. Use\n--signal=\nto select the\nsignal to send.\nAdded in version 206.\nbind\nNAME\nPATH\n[\nPATH\n]\nÂ¶\nBind mounts a file or directory from the host into the specified container. The first path\nargument is the source file or directory on the host, the second path argument is the destination file or\ndirectory in the container. When the latter is omitted, the destination path in the container is the same as\nthe source path on the host. When combined with the\n--read-only\nswitch, a read-only bind\nmount is created. When combined with the\n--mkdir\nswitch, the destination path is first created\nbefore the mount is applied. Note that this option is currently only supported for\nsystemd-nspawn\n(1)\ncontainers,\nand only if user namespacing (\n--private-users\n) is not used. This command supports bind\nmounting directories, regular files, device nodes,\nAF_UNIX\nsocket nodes, as well as\nFIFOs.\nAdded in version 219.\ncopy-to\nNAME\nPATH\n[\nPATH\n]\n--force\nÂ¶\nCopies files or directories from the host\nsystem into a running container. Takes a container name,\nfollowed by the source path on the host and the destination\npath in the container. If the destination path is omitted, the\nsame as the source path is used.\nIf host and container share the same user and group namespace, file ownership by numeric user ID and\ngroup ID is preserved for the copy, otherwise all files and directories in the copy will be owned by the root\nuser and group (UID/GID 0).\nAdded in version 219.\ncopy-from\nNAME\nPATH\n[\nPATH\n]\n--force\nÂ¶\nCopies files or directories from a container\ninto the host system. Takes a container name, followed by the\nsource path in the container and the destination path on the host.\nIf the destination path is omitted, the same as the source path\nis used.\nIf host and container share the same user and group namespace, file ownership by numeric user ID and\ngroup ID is preserved for the copy, otherwise all files and directories in the copy will be owned by the root\nuser and group (UID/GID 0).\nAdded in version 219.\nImage Commands\nÂ¶\nlist-images\nÂ¶\nShow a list of locally installed container and\nVM images. This enumerates all raw disk images and container\ndirectories and subvolumes in\n/var/lib/machines/\n(and other search\npaths, see below). Use\nstart\n(see above) to\nrun a container off one of the listed images. Note that, by\ndefault, containers whose name begins with a dot\n(\"\n.\n\") are not shown. To show these too,\nspecify\n--all\n. Note that a special image\n\"\n.host\n\" always implicitly exists and refers\nto the image the host itself is booted from.\nAdded in version 219.\nimage-status\n[\nNAME\nâ¦]\nÂ¶\nShow terse status information about one or\nmore container or VM images. This function is intended to\ngenerate human-readable output. Use\nshow-image\n(see below) to generate\ncomputer-parsable output instead.\nAdded in version 219.\nshow-image\n[\nNAME\nâ¦]\nÂ¶\nShow properties of one or more registered\nvirtual machine or container images, or the manager itself. If\nno argument is specified, properties of the manager will be\nshown. If a NAME is specified, properties of this virtual\nmachine or container image are shown. By default, empty\nproperties are suppressed. Use\n--all\nto show\nthose too. To select specific properties to show, use\n--property=\n. This command is intended to be\nused whenever computer-parsable output is required. Use\nimage-status\nif you are looking for\nformatted human-readable output.\nAdded in version 219.\nedit\nNAME|FILE\nÂ¶\nEdit the settings file of the specified machines. For the format of the settings\nfile, refer to\nsystemd.nspawn\n(5)\n.\nIf an existing settings file of the given machine cannot be found,\nedit\nautomatically create a new settings file from scratch under\n/etc/systemd/nspawn/\n.\nAdded in version 254.\ncat\nNAME|FILE\nÂ¶\nShow the settings file of the specified machines.\nAdded in version 254.\nclone\nNAME\nNAME\nÂ¶\nClones a container or VM image. The arguments specify the name of the image to clone and the\nname of the newly cloned image. Note that plain directory container images are cloned into btrfs subvolume\nimages with this command, if the underlying file system supports this.  Note that cloning a container or VM\nimage is optimized for file systems that support copy-on-write, and might not be efficient on others, due to\nfile system limitations.\nNote that this command leaves hostname, machine ID and\nall other settings that could identify the instance\nunmodified. The original image and the cloned copy will hence\nshare these credentials, and it might be necessary to manually\nchange them in the copy.\nIf combined with the\n--read-only\nswitch a read-only cloned image is\ncreated.\nAdded in version 219.\nrename\nNAME\nNAME\nÂ¶\nRenames a container or VM image. The\narguments specify the name of the image to rename and the new\nname of the image.\nAdded in version 219.\nread-only\nNAME\n[\nBOOL\n]\nÂ¶\nMarks or (unmarks) a container or VM image\nread-only. Takes a VM or container image name, followed by a\nboolean as arguments. If the boolean is omitted, positive is\nimplied, i.e. the image is marked read-only.\nAdded in version 219.\nremove\nNAME\nâ¦\nÂ¶\nRemoves one or more container or VM images.\nThe special image \"\n.host\n\", which refers to\nthe host's own directory tree, may not be\nremoved.\nAdded in version 219.\nset-limit\n[\nNAME\n]\nBYTES\nÂ¶\nSets the maximum size in bytes that a specific\ncontainer or VM image, or all images, may grow up to on disk\n(disk quota). Takes either one or two parameters. The first,\noptional parameter refers to a container or VM image name. If\nspecified, the size limit of the specified image is changed. If\nomitted, the overall size limit of the sum of all images stored\nlocally is changed. The final argument specifies the size\nlimit in bytes, possibly suffixed by the usual K, M, G, T\nunits. If the size limit shall be disabled, specify\n\"\n-\n\" as size.\nNote that per-container size limits are only supported on btrfs file systems.\nAdded in version 220.\nclean\nÂ¶\nRemove hidden VM or container images (or all). This command removes all hidden machine images\nfrom\n/var/lib/machines/\n, i.e. those whose name begins with a dot. Use\nmachinectl\nlist-images --all\nto see a list of all machine images, including the hidden ones.\nWhen combined with the\n--all\nswitch removes all images, not just hidden ones. This\ncommand effectively empties\n/var/lib/machines/\n.\nNote that commands such as\nimportctl pull-tar\nor\nimportctl\npull-raw\nusually create hidden, read-only, unmodified machine images from the downloaded image first,\nbefore cloning a writable working copy of it, in order to avoid duplicate downloads in case of images that are\nreused multiple times. Use\nmachinectl clean\nto remove old, hidden images created this\nway.\nAdded in version 230.\nOptions\nÂ¶\nThe following options are understood:\n-p\n,\n--property=\nÂ¶\nWhen showing machine or image properties,\nlimit the output to certain properties as specified by the\nargument. If not specified, all set properties are shown. The\nargument should be a property name, such as\n\"\nName\n\". If specified more than once, all\nproperties with the specified names are\nshown.\nAdded in version 206.\n--value\nÂ¶\nWhen printing properties with\nshow\n, only print the value,\nand skip the property name and \"\n=\n\".\nAdded in version 230.\n-P\nÂ¶\nEquivalent to\n--value\n--property=\n, i.e. shows the value of the\nproperty without the property name or \"\n=\n\". Note that using\n-P\nonce\nwill also affect all properties listed with\n-p\n/\n--property=\n.\nAdded in version 256.\n-a\n,\n--all\nÂ¶\nWhen showing machine or image properties, show\nall properties regardless of whether they are set or\nnot.\nWhen listing VM or container images, do not suppress\nimages beginning in a dot character\n(\"\n.\n\").\nWhen cleaning VM or container images, remove all images, not just hidden ones.\nAdded in version 206.\n-l\n,\n--full\nÂ¶\nDo not ellipsize process tree entries or table. This implies\n--max-addresses=full\n.\nAdded in version 206.\n--kill-whom=\nÂ¶\nWhen used with\nkill\n, choose which processes to kill. Must be one\nof\nleader\n,\nsupervisor\n, or\nall\nto select whether to\nkill only the leader process of the machine, the supervisor process of the machine, or all processes\nof the machine. If omitted, defaults to\nall\n.\nAdded in version 206.\n-s\n,\n--signal=\nÂ¶\nWhen used with\nkill\n, choose which signal to send to selected processes. Must\nbe one of the well-known signal specifiers such as\nSIGTERM\n,\nSIGINT\nor\nSIGSTOP\n. If omitted, defaults to\nSIGTERM\n.\nThe special value \"\nhelp\n\" will list the known values and the program will exit\nimmediately, and the special value \"\nlist\n\" will list known values along with the\nnumerical signal numbers and the program will exit immediately.\n--uid=\nÂ¶\nWhen used with the\nshell\ncommand, chooses the user ID to\nopen the interactive shell session as. If the argument to the\nshell\ncommand also specifies a user name, this option is ignored. If the name is not specified\nin either way, \"\nroot\n\" will be used by default. Note that this switch is\nnot supported for the\nlogin\ncommand (see below).\nAdded in version 225.\n-E\nNAME\n[=\nVALUE\n]\n,\n--setenv=\nNAME\n[=\nVALUE\n]\nÂ¶\nWhen used with the\nshell\ncommand, sets an environment variable for\nthe executed shell. This option may be used more than once to set multiple variables. When\n\"\n=\n\" and\nVALUE\nare omitted, the value of the variable with\nthe same name in the program environment will be used.\nNote that this option is not supported for the\nlogin\ncommand.\nAdded in version 230.\n--mkdir\nÂ¶\nWhen used with\nbind\n, creates the destination file or directory before\napplying the bind mount. Note that even though the name of this option suggests that it is suitable only for\ndirectories, this option also creates the destination file node to mount over if the object to mount is not\na directory, but a regular file, device node, socket or FIFO.\nAdded in version 219.\n--read-only\nÂ¶\nWhen used with\nbind\n, creates a read-only bind mount.\nWhen used with\nclone\na read-only container or VM image is created.\nAdded in version 219.\n-n\n,\n--lines=\nÂ¶\nWhen used with\nstatus\n,\ncontrols the number of journal lines to show, counting from\nthe most recent ones. Takes a positive integer argument.\nDefaults to 10.\nAdded in version 219.\n-o\n,\n--output=\nÂ¶\nWhen used with\nstatus\n,\ncontrols the formatting of the journal entries that are shown.\nFor the available choices, see\njournalctl\n(1)\n.\nDefaults to \"\nshort\n\".\nAdded in version 219.\n--runner=\nnspawn\n|\nvmspawn\nÂ¶\nWhen operating on machines choose whether to use\nsystemd-nspawn\n(1)\nor\nsystemd-vmspawn\n(1)\n.\nBy default\nsystemd-nspawn\n(1)\nis used.\nAdded in version 256.\n-V\nÂ¶\n-V\nis a shorthand for\n--runner=vmspawn\n.\nAdded in version 256.\n--now\nÂ¶\nWhen used with\nenable\nor\ndisable\n,\nthe containers will also be started or powered off. The start or poweroff\noperation is only carried out when the respective enable or disable\noperation has been successful.\nAdded in version 253.\n--force\nÂ¶\nReplace target file when copying files.\nAdded in version 219.\n--max-addresses=\nÂ¶\nWhen used with the\nlist-machines\ncommand, limits the number of IP\naddresses shown for every machine. Defaults to 1. All addresses can be requested with\n\"\nall\n\". If the limit is 0, the address column is not shown. Otherwise, if the machine\nhas more addresses than shown, \"\nâ¦\n\" follows the last address.\nAdded in version 232.\n-q\n,\n--quiet\nÂ¶\nSuppresses additional informational output while running.\nAdded in version 236.\n-H\n,\n--host=\nÂ¶\nExecute the operation remotely. Specify a hostname, or a\nusername and hostname separated by \"\n@\n\", to\nconnect to. The hostname may optionally be suffixed by a\nport ssh is listening on, separated by \"\n:\n\", and then a\ncontainer name, separated by \"\n/\n\", which\nconnects directly to a specific container on the specified\nhost. This will use SSH to talk to the remote machine manager\ninstance. Container names may be enumerated with\nmachinectl -H\nHOST\n. Put IPv6 addresses in brackets.\n-M\n,\n--machine=\nÂ¶\nConnect to\nsystemd-machined.service\n(8)\nrunning in a local container, to perform the specified operation within\nthe container.\nAdded in version 235.\n--no-pager\nÂ¶\nDo not pipe output into a pager.\n--no-legend\nÂ¶\nDo not print the legend, i.e. column headers and the\nfooter with hints.\n--no-ask-password\nÂ¶\nDo not query the user for authentication for privileged operations.\n-h\n,\n--help\nÂ¶\nPrint a short help text and exit.\n--version\nÂ¶\nPrint a short version string and exit.\nMachine and Image Names\nÂ¶\nThe\nmachinectl\ntool operates on machines\nand images whose names must be chosen following strict\nrules. Machine names must be suitable for use as hostnames\nfollowing a conservative subset of DNS and UNIX/Linux\nsemantics. Specifically, they must consist of one or more\nnon-empty label strings, separated by dots. No leading or trailing\ndots are allowed. No sequences of multiple dots are allowed. The\nlabel strings may only consist of alphanumeric characters as well\nas the dash. The maximum length of a machine name is 64 characters.\nA special machine with the name \"\n.host\n\"\nrefers to the running host system itself. This is useful for execution\noperations or inspecting the host system as well. Note that\nmachinectl list\nwill not show this special\nmachine unless the\n--all\nswitch is specified.\nRequirements on image names are less strict, however, they must be\nvalid UTF-8, must be suitable as file names (hence not be the\nsingle or double dot, and not include a slash), and may not\ncontain control characters. Since many operations search for an\nimage by the name of a requested machine, it is recommended to name\nimages in the same strict fashion as machines.\nA special image with the name \"\n.host\n\"\nrefers to the image of the running host system. It hence\nconceptually maps to the special \"\n.host\n\" machine\nname described above. Note that\nmachinectl\nlist-images\nwill not show this special image either, unless\n--all\nis specified.\nFiles and Directories\nÂ¶\nMachine images are preferably stored in\n/var/lib/machines/\n, but are also searched for\nin\n/usr/local/lib/machines/\nand\n/usr/lib/machines/\n. For compatibility reasons,\nthe directory\n/var/lib/container/\nis\nsearched, too. Note that images stored below\n/usr/\nare always considered read-only. It is\npossible to symlink machines images from other directories into\n/var/lib/machines/\nto make them available for\ncontrol with\nmachinectl\n.\nNote that some image operations are only supported, efficient or atomic on btrfs file systems.\nDisk images are understood by\nsystemd-nspawn\n(1)\nand\nmachinectl\nin three formats:\nA simple directory tree, containing the files\nand directories of the container to boot.\nSubvolumes (on btrfs file systems), which are\nsimilar to the simple directories, described above. However,\nthey have additional benefits, such as efficient cloning and\nquota reporting.\n\"Raw\" disk images, i.e. binary images of disks\nwith a GPT or MBR partition table. Images of this type are\nregular files with the suffix\n\"\n.raw\n\".\nSee\nsystemd-nspawn\n(1)\nfor more information on image formats, in particular its\n--directory=\nand\n--image=\noptions.\nExamples\nÂ¶\nExampleÂ 1.Â Download an Ubuntu RAW image, set a root password in it, start\nit as a service\n# importctl pull-raw -mN \\\nhttps://cloud-images.ubuntu.com/jammy/current/jammy-server-cloudimg-amd64-disk-kvm.img \\\njammy\n# systemd-firstboot --image=/var/lib/machines/jammy.raw --prompt-root-password --force\n# machinectl start jammy\n# machinectl login jammy\nThis downloads the specified\n.raw\nimage and makes it available under the\nlocal name \"\njammy\n\". Then, a root password is set with\nsystemd-firstboot\n(1)\n. Afterwards\nthe machine is started as system service. With the last command a login prompt into the container is\nrequested.\nExit status\nÂ¶\nOn success, 0 is returned, a non-zero failure code\notherwise.\nEnvironment\nÂ¶\n$SYSTEMD_LOG_LEVEL\nÂ¶\nThe maximum log level of emitted messages (messages with a higher\nlog level, i.e. less important ones, will be suppressed). Takes a comma-separated list of values. A\nvalue may be either one of (in order of decreasing importance)\nemerg\n,\nalert\n,\ncrit\n,\nerr\n,\nwarning\n,\nnotice\n,\ninfo\n,\ndebug\n, or an integer in the range 0â¦7. See\nsyslog\n(3)\nfor more information. Each value may optionally be prefixed with one of\nconsole\n,\nsyslog\n,\nkmsg\nor\njournal\nfollowed by a\ncolon to set the maximum log level for that specific log target (e.g.\nSYSTEMD_LOG_LEVEL=debug,console:info\nspecifies to log at debug level except when\nlogging to the console which should be at info level). Note that the global maximum log level takes\npriority over any per target maximum log levels.\n$SYSTEMD_LOG_COLOR\nÂ¶\nA boolean. If true, messages written to the tty will be colored\naccording to priority.\nThis setting is only useful when messages are written directly to the terminal, because\njournalctl\n(1)\nand\nother tools that display logs will color messages based on the log level on their own.\n$SYSTEMD_LOG_TIME\nÂ¶\nA boolean. If true, console log messages will be prefixed with a\ntimestamp.\nThis setting is only useful when messages are written directly to the terminal or a file, because\njournalctl\n(1)\nand\nother tools that display logs will attach timestamps based on the entry metadata on their own.\n$SYSTEMD_LOG_LOCATION\nÂ¶\nA boolean. If true, messages will be prefixed with a filename\nand line number in the source code where the message originates.\nNote that the log location is often attached as metadata to journal entries anyway. Including it\ndirectly in the message text can nevertheless be convenient when debugging programs.\n$SYSTEMD_LOG_TID\nÂ¶\nA boolean. If true, messages will be prefixed with the current\nnumerical thread ID (TID).\nNote that the this information is attached as metadata to journal entries anyway. Including it\ndirectly in the message text can nevertheless be convenient when debugging programs.\n$SYSTEMD_LOG_TARGET\nÂ¶\nThe destination for log messages. One of\nconsole\n(log to the attached tty),\nconsole-prefixed\n(log to\nthe attached tty but with prefixes encoding the log level and \"facility\", see\nsyslog\n(3)\n,\nkmsg\n(log to the kernel circular log buffer),\njournal\n(log to\nthe journal),\njournal-or-kmsg\n(log to the journal if available, and to kmsg\notherwise),\nauto\n(determine the appropriate log target automatically, the default),\nnull\n(disable log output).\n$SYSTEMD_LOG_RATELIMIT_KMSG\nÂ¶\nWhether to ratelimit kmsg or not. Takes a boolean.\nDefaults to \"\ntrue\n\". If disabled, systemd will not ratelimit messages written to kmsg.\n$SYSTEMD_PAGER\n,\n$PAGER\nÂ¶\nPager to use when\n--no-pager\nis not given.\n$SYSTEMD_PAGER\nis used if set; otherwise\n$PAGER\nis used.\nIf neither\n$SYSTEMD_PAGER\nnor\n$PAGER\nare set, a set of well-known\npager implementations is tried in turn, including\nless\n(1)\nand\nmore\n(1)\n,\nuntil one is found. If no pager implementation is discovered, no pager is invoked. Setting those\nenvironment variables to an empty string or the value \"\ncat\n\" is equivalent to passing\n--no-pager\n.\nNote: if\n$SYSTEMD_PAGERSECURE\nis not set,\n$SYSTEMD_PAGER\nand\n$PAGER\ncan only be used to disable the pager (with \"\ncat\n\" or\n\"\n\"), and are otherwise ignored.\n$SYSTEMD_LESS\nÂ¶\nOverride the options passed to\nless\n(by default\n\"\nFRSXMK\n\").\nUsers might want to change two options in particular:\nK\nÂ¶\nThis option instructs the pager to exit immediately when\nCtrl\n+\nC\nis pressed. To allow\nless\nto handle\nCtrl\n+\nC\nitself to switch back to the pager command prompt, unset this option.\nIf the value of\n$SYSTEMD_LESS\ndoes not include \"\nK\n\",\nand the pager that is invoked is\nless\n,\nCtrl\n+\nC\nwill be ignored by the\nexecutable, and needs to be handled by the pager.\nX\nÂ¶\nThis option instructs the pager to not send termcap initialization and deinitialization\nstrings to the terminal. It is set by default to allow command output to remain visible in the\nterminal even after the pager exits. Nevertheless, this prevents some pager functionality from\nworking, in particular paged output cannot be scrolled with the mouse.\nNote that setting the regular\n$LESS\nenvironment variable has no effect\nfor\nless\ninvocations by systemd tools.\nSee\nless\n(1)\nfor more discussion.\n$SYSTEMD_LESSCHARSET\nÂ¶\nOverride the charset passed to\nless\n(by default \"\nutf-8\n\", if\nthe invoking terminal is determined to be UTF-8 compatible).\nNote that setting the regular\n$LESSCHARSET\nenvironment variable has no effect\nfor\nless\ninvocations by systemd tools.\n$SYSTEMD_PAGERSECURE\nÂ¶\nCommon pager commands like\nless\n(1)\n, in\naddition to \"paging\", i.e. scrolling through the output, support opening of or writing to other files\nand running arbitrary shell commands. When commands are invoked with elevated privileges, for example\nunder\nsudo\n(8)\nor\npkexec\n(1)\n, the\npager becomes a security boundary. Care must be taken that only programs with strictly limited\nfunctionality are used as pagers, and unintended interactive features like opening or creation of new\nfiles or starting of subprocesses are not allowed. \"Secure mode\" for the pager may be enabled as\ndescribed below,\nif the pager supports that\n(most pagers are not written in a way\nthat takes this into consideration). It is recommended to either explicitly enable \"secure mode\" or to\ncompletely disable the pager using\n--no-pager\nor\nPAGER=cat\nwhen\nallowing untrusted users to execute commands with elevated privileges.\nThis option takes a boolean argument. When set to true, the \"secure mode\" of the pager is\nenabled. In \"secure mode\",\nLESSSECURE=1\nwill be set when invoking the pager, which\ninstructs the pager to disable commands that open or create new files or start new subprocesses.\nCurrently only\nless\n(1)\nis known\nto understand this variable and implement \"secure mode\".\nWhen set to false, no limitation is placed on the pager. Setting\nSYSTEMD_PAGERSECURE=0\nor not removing it from the inherited environment may allow\nthe user to invoke arbitrary commands.\nWhen\n$SYSTEMD_PAGERSECURE\nis not set, systemd tools attempt to automatically\nfigure out if \"secure mode\" should be enabled and whether the pager supports it. \"Secure mode\" is\nenabled if the effective UID is not the same as the owner of the login session, see\ngeteuid\n(2)\nand\nsd_pid_get_owner_uid\n(3)\n,\nor when running under\nsudo\n(8)\nor similar\ntools (\n$SUDO_UID\nis set\n[1]\n). In those cases,\nSYSTEMD_PAGERSECURE=1\nwill be set and pagers which are not known to implement\n\"secure mode\" will not be used at all. Note that this autodetection only covers the most common\nmechanisms to elevate privileges and is intended as convenience. It is recommended to explicitly set\n$SYSTEMD_PAGERSECURE\nor disable the pager.\nNote that if the\n$SYSTEMD_PAGER\nor\n$PAGER\nvariables are to\nbe honoured, other than to disable the pager,\n$SYSTEMD_PAGERSECURE\nmust be set\ntoo.\n$SYSTEMD_COLORS\nÂ¶\nTakes a boolean argument. When true,\nsystemd\nand related utilities\nwill use colors in their output, otherwise the output will be monochrome. Additionally, the variable can\ntake one of the following special values: \"\n16\n\", \"\n256\n\" to restrict the use\nof colors to the base 16 or 256 ANSI colors, respectively. This can be specified to override the automatic\ndecision based on\n$TERM\nand what the console is connected to.\n$SYSTEMD_URLIFY\nÂ¶\nThe value must be a boolean. Controls whether clickable links should be generated in\nthe output for terminal emulators supporting this. This can be specified to override the decision that\nsystemd\nmakes based on\n$TERM\nand other conditions.\nSee Also\nÂ¶\nsystemd\n(1)\n,\nsystemd-machined.service\n(8)\n,\nsystemd-nspawn\n(1)\n,\nsystemd.special\n(7)\n,\nimportctl\n(1)\n,\ntar\n(1)\n,\nxz\n(1)\n,\ngzip\n(1)\n,\nbzip2\n(1)\n,\nzstd\n(1)\n[1]\nIt is recommended for other tools to set and check\n$SUDO_UID\nas appropriate,\ntreating it is a common interface.", "metadata": {"source_type": "vendor_docs", "trust": "vendor_docs", "os": "linux", "distro": "ubuntu-22.04", "license": "CC BY-SA (assumed; verify per site)", "attribution_url": "https://www.freedesktop.org/software/systemd/man/latest/machinectl.html"}}
{"text": "bootctl\nIndex\nÂ·\nDirectives\nsystemd 258\nName\nbootctl â Control EFI firmware boot settings and manage boot loader\nSynopsis\nbootctl\n[OPTIONS...] {COMMAND}\nDescription\nÂ¶\nbootctl\ncan check the EFI firmware and boot loader status, list and manage\navailable boot loaders and boot loader entries, and install, update, or remove the\nsystemd-boot\n(7)\nboot\nloader on the current system.\nGeneric EFI Firmware/Boot Loader Commands\nÂ¶\nThese commands are available on any EFI system, regardless of the boot loader used.\nstatus\nÂ¶\nShows brief information about the system firmware, the boot loader that was used to\nboot the system, the boot loaders currently available in the ESP, the boot loaders listed in the\nfirmware's list of boot loaders and the current default boot loader entry. If no command is\nspecified, this is the implied default.\nSee the example below for details of the output.\nAdded in version 239.\nreboot-to-firmware\n[\nBOOL\n]\nÂ¶\nQuery or set the \"Reboot-Into-Firmware-Setup\" flag of the EFI firmware. Takes a\nboolean argument which controls whether to show the firmware setup on next system reboot. If the\nargument is omitted shows the current status of the flag, or whether the flag is supported. This\ncontrols the same flag as\nsystemctl reboot --firmware-setup\n, but is more low-level\nand allows setting the flag independently from actually requesting a reboot.\nHint: use\nsystemctl reboot --firmware-setup\nto reboot into firmware setup\nonce. See\nsystemctl\n(1)\nfor details.\nAdded in version 251.\nBoot Loader Specification Commands\nÂ¶\nThese commands are available for all boot loaders that\nimplement the\nBoot\nLoader Specification\n, such as\nsystemd-boot\n.\nlist\nÂ¶\nShows all available boot loader entries implementing the\nBoot Loader Specification\n, as well as any\nother entries discovered or automatically generated by a boot loader implementing the\nBoot Loader Interface\n.\nJSON output may be requested with\n--json=\n.\nSee the example below for details of the output.\nAdded in version 239.\nunlink\nID\nÂ¶\nRemoves a boot loader entry including the files it refers to. Takes a single boot\nloader entry ID string or a glob pattern as argument. Referenced files such as kernel or initrd are\nonly removed if no other entry refers to them.\nAdded in version 253.\ncleanup\nÂ¶\nRemoves files from the ESP and XBOOTLDR partitions that belong to the entry token but\nare not referenced in any boot loader entries.\nAdded in version 253.\nBoot Loader Interface Commands\nÂ¶\nThese commands are available for all boot loaders that implement the\nBoot Loader Specification\nand the\nBoot Loader Interface\n, such as\nsystemd-boot\n.\nset-default\nID\n,\nset-oneshot\nID\n,\nset-sysfail\nID\nÂ¶\nSets the default boot loader entry. Takes a single boot loader entry ID string or a glob\npattern as argument. The\nset-oneshot\ncommand will set the default entry only for the next boot,\nthe\nset-default\nwill set it persistently for all future boots. The\nset-sysfail\ncommand\nwill set the boot loader entry to be used in case of a system failure. System failure (SysFail) boot entries can\noptionally modify the automatic selection order in the event of a failure, such as a boot firmware update failure with\nthe failure status recorded in the EFI system table.\nbootctl list\ncan be used to list available boot loader entries and their\nIDs.\nIn addition, the boot loader entry ID may be specified as one of:\n@default\n,\n@oneshot\nor\n@current\n, which correspond to the current default boot loader\nentry for all future boots, the current default boot loader entry for the next boot, and the currently booted\nboot loader entry. These special IDs are resolved to the current values of the EFI variables\nLoaderEntryDefault\n,\nLoaderEntrySysFail\n,\nLoaderEntryOneShot\nand\nLoaderEntrySelected\n, see\nBoot Loader Specification\nfor details.\nThese special IDs are primarily useful as a quick way to persistently make the currently booted boot loader\nentry the default choice, or to upgrade the default boot loader entry for the next boot to the default boot\nloader entry for all future boots, but may be used for other operations too.\nIf set to\n@saved\nthe chosen entry will be saved as an EFI variable\non every boot and automatically selected the next time the boot loader starts.\nWhen an empty string (\"\") is specified as the ID, then the corresponding EFI variable will be\nunset.\nHint: use\nsystemctl reboot --boot-loader-entry=\nID\nto reboot into a specific boot entry and\nsystemctl reboot --boot-loader-menu=\ntimeout\nto reboot into the boot loader menu once. See\nsystemctl\n(1)\nfor details.\nAdded in version 240.\nset-timeout\nTIMEOUT\n,\nset-timeout-oneshot\nTIMEOUT\nÂ¶\nSets the boot loader menu timeout in seconds. The\nset-timeout-oneshot\ncommand will set the timeout only for the next boot. See\nsystemd.time\n(7)\nfor details about the syntax of time spans.\nIf this is set to\nmenu-disabled\nor\nmenu-hidden\nor\n0\n, no menu is shown and the default entry will be booted immediately, while\nsetting this to\nmenu-force\ndisables the timeout while always showing the menu.\nWhen an empty string (\"\") is specified the bootloader will revert to its default menu timeout.\nAdded in version 250.\nsystemd-boot\nCommands\nÂ¶\nThese commands manage the\nsystemd-boot\nEFI boot loader, and do not work in\nconjunction with other boot loaders.\ninstall\nÂ¶\nInstalls\nsystemd-boot\ninto the EFI system partition. A copy of\nsystemd-boot\nwill be stored as the EFI default/fallback loader at\nESP\n/EFI/BOOT/BOOT*.EFI\n. The boot loader is then added\nto the top of the firmware's boot loader list.\nAdded in version 239.\nupdate\nÂ¶\nUpdates all installed versions of\nsystemd-boot\n(7)\n, if the\navailable version is newer than the version installed in the EFI system partition. This also includes the EFI\ndefault/fallback loader at\nESP\n/EFI/BOOT/BOOT*.EFI\n. The boot\nloader is then added to end of the firmware's boot loader list if missing.\nAdded in version 239.\nremove\nÂ¶\nRemoves all installed versions of\nsystemd-boot\nfrom the EFI system partition\nand the firmware's boot loader list.\nAdded in version 239.\nis-installed\nÂ¶\nChecks whether\nsystemd-boot\nis installed in the ESP. Note that a\nsingle ESP might host multiple boot loaders; this hence checks whether\nsystemd-boot\nis one (of possibly many) installed boot loaders â and neither\nwhether it is the default nor whether it is registered in any EFI variables.\nAdded in version 243.\nrandom-seed\nÂ¶\nGenerates a random seed and stores it in the EFI System Partition (ESP), for use by\nthe\nsystemd-boot\nboot loader. If a random seed already exists in the ESP it is\nrefreshed. Also generates a random 'system token' and stores it persistently as an EFI variable, if\none has not been set before. If the boot loader finds the random seed in the ESP and the system token\nin the EFI variable it will derive a random seed to pass to the OS and a new seed to store in the ESP\nfrom the combination of both. The random seed passed to the OS is credited to the kernel's entropy\npool by the system manager during early boot, and permits userspace to boot up with an entropy pool\nfully initialized very early on. Also see\nsystemd-boot-random-seed.service\n(8)\n.\nSee\nRandom Seeds\nfor further\ninformation.\nAdded in version 243.\nKernel Image Commands\nÂ¶\nkernel-identify\nKERNEL-IMAGE\nÂ¶\nTakes a kernel image as argument. Checks what kind of kernel the image is. Returns\none of \"\nuki\n\", \"\naddon\n\", \"\npe\n\", and\n\"\nunknown\n\".\nAdded in version 253.\nkernel-inspect\nKERNEL-IMAGE\nÂ¶\nTakes a kernel image as argument. Prints details about the image.\nAdded in version 253.\nOptions\nÂ¶\nThe following options are understood:\n--esp-path=\nÂ¶\nPath to the EFI System Partition (ESP). If not specified,\n/efi/\n,\n/boot/\n, and\n/boot/efi/\nare checked in turn. It is\nrecommended to mount the ESP to\n/efi/\n, if possible.\n--boot-path=\nÂ¶\nPath to the Extended Boot Loader partition, as defined in the\nBoot Loader Specification\n.\nIf not specified,\n/boot/\nis checked. It is recommended to mount the Extended Boot\nLoader partition to\n/boot/\n, if possible.\n--root=\nroot\nÂ¶\nTakes a directory path as an argument. All\npaths will be prefixed with the given alternate\nroot\npath, including config search\npaths.\nAdded in version 252.\n--image=\nimage\nÂ¶\nTakes a path to a disk image file or block device node. If specified, all operations\nare applied to file system in the indicated disk image. This option is similar to\n--root=\n, but operates on file systems stored in disk images or block devices. The\ndisk image should either contain just a file system or a set of file systems within a GPT partition\ntable, following the\nDiscoverable Partitions\nSpecification\n. For further information on supported disk images, see\nsystemd-nspawn\n(1)\n's\nswitch of the same name.\nAdded in version 252.\n--image-policy=\npolicy\nÂ¶\nTakes an image policy string as argument, as per\nsystemd.image-policy\n(7)\n. The\npolicy is enforced when operating on the disk image specified via\n--image=\n, see\nabove. If not specified, defaults to the \"\n*\n\" policy, i.e. all recognized file systems\nin the image are used.\n--install-source=\nÂ¶\nWhen installing binaries with\n--root=\nor\n--image=\n, selects where to source them from. Takes one of \"\nauto\n\"\n(the default), \"\nimage\n\" or \"\nhost\n\". With \"\nauto\n\"\nbinaries will be picked from the specified directory or image, and if not found they will be picked\nfrom the host. With \"\nimage\n\" or \"\nhost\n\" no fallback search will be\nperformed if the binaries are not found in the selected source.\nAdded in version 252.\n-p\n,\n--print-esp-path\nÂ¶\nThis option modifies the behaviour of\nstatus\n. Only prints the path\nto the EFI System Partition (ESP) to standard output and exits.\nAdded in version 236.\n-x\n,\n--print-boot-path\nÂ¶\nThis option modifies the behaviour of\nstatus\n. Only prints the path\nto the Extended Boot Loader partition if it exists, and the path to the ESP otherwise to standard\noutput and exit. This command is useful to determine where to place boot loader entries, as they are\npreferably placed in the Extended Boot Loader partition if it exists and in the ESP otherwise.\nBoot Loader Specification Type #1 entries should generally be placed in the directory\n\"\n$(bootctl -x)/loader/entries/\n\". Existence of that directory may also be used as\nindication that boot loader entry support is available on the system. Similarly, Boot Loader\nSpecification Type #2 entries should be placed in the directory \"\n$(bootctl\n-x)/EFI/Linux/\n\".\nNote that this option (similarly to the\n--print-esp-path\noption mentioned\nabove), is available independently from the boot loader used, i.e. also without\nsystemd-boot\nbeing installed.\nAdded in version 242.\n--print-loader-path\nÂ¶\nThis option modifies the behaviour of\nstatus\n: it shows the\nabsolute path to the boot loader EFI binary used for the current boot if this information is\navailable. Note that no attempt is made to verify whether the binary still exists.\nAdded in version 257.\n--print-stub-path\nÂ¶\nThis option modifies the behaviour of\nstatus\n: it shows the\nabsolute path to the UKI/stub EFI binary used for the current boot if this information is\navailable. Note that no attempt is made to verify whether the binary still exists.\nAdded in version 257.\n-R\n,\n--print-root-device\nÂ¶\nPrint the path to the block device node backing the root file system of the local\nOS. This prints a path such as\n/dev/nvme0n1p5\n. If the root file system is backed\nby dm-crypt/LUKS or dm-verity the underlying block device is returned. If the root file system is\nbacked by multiple block devices (as supported by btrfs) the operation will fail. If the switch is\nspecified twice (i.e.\n-RR\n) and the discovered block device is a partition device the\n\"whole\" block device it belongs to is determined and printed\n(e.g.\n/dev/nvme0n1\n). If the root file system is \"\ntmpfs\n\" (or a\nsimilar in-memory file system), the block device backing\n/usr/\nis returned if\napplicable. If the root file system is a network file system (e.g. NFS, CIFS) the operation will\nfail.\nAdded in version 254.\n--variables=yes|no\nÂ¶\nControls whether to touch the firmware's boot loader list stored in EFI variables,\nand other EFI variables. If not specified defaults to no when execution in a container runtime is\ndetected, yes otherwise.\nAdded in version 258.\n--random-seed=yes|no\nÂ¶\nBy default, the\ninstall\ncommand initializes a random seed file in\nthe ESP. When creating an image it may be desirable to disable that in order to avoid having the\nsame seed in all instances.\nAdded in version 257.\n--graceful\nÂ¶\nIgnore failure when the EFI System Partition cannot be found, when EFI variables\ncannot be written, or a different or newer boot loader is already installed. Currently only applies\nto\nis-installed\n,\nupdate\n,\nrandom-seed\nand\ninstall\nverbs. Since version v258, it is implicitly enabled when running inside a\nchroot.\nAdded in version 244.\n-q\n,\n--quiet\nÂ¶\nSuppress printing of the results of various commands and also the hints about ESP\nbeing unavailable.\nAdded in version 251.\n--make-entry-directory=yes|no\nÂ¶\nControls creation and deletion of the\nBoot Loader Specification\nType #1 entry\ndirectory on the file system containing resources such as kernel and initrd images during\ninstall\nand\nremove\n, respectively. The directory is named after the\nentry token, as specified with\n--entry-token=\nparameter described below, and is\nplaced immediately below the\n$BOOT\nroot directory (i.e. beneath the file system\nreturned by the\n--print-boot-path\noption, see above). Defaults to\n\"\nno\n\".\nAdded in version 251.\n--entry-token=\nÂ¶\nControls how to name and identify boot loader entries for this OS\ninstallation. Accepted during\ninstall\n, and takes one of \"\nauto\n\",\n\"\nmachine-id\n\", \"\nos-id\n\", \"\nos-image-id\n\" or an\narbitrary string prefixed by \"\nliteral:\n\" as argument.\nIf set to\nmachine-id\nthe entries are named after the machine ID of the running\nsystem (e.g. \"\nb0e793a9baf14b5fa13ecbe84ff637ac\n\"). See\nmachine-id\n(5)\nfor\ndetails about the machine ID concept and file.\nIf set to\nos-id\nthe entries are named after the OS ID of the running system,\ni.e. the\nID=\nfield of\nos-release\n(5)\n(e.g.\n\"\nfedora\n\"). Similarly, if set to\nos-image-id\nthe entries are named\nafter the OS image ID of the running system, i.e. the\nIMAGE_ID=\nfield of\nos-release\n(e.g. \"\nvendorx-cashier-system\n\").\nIf set to\nauto\n(the default), the\n/etc/kernel/entry-token\nfile will be read if it exists, and the stored value used. Otherwise, if the local machine ID is\ninitialized it is used. Otherwise,\nIMAGE_ID=\nfrom\nos-release\nwill be used, if set.  Otherwise,\nID=\nfrom\nos-release\nwill be\nused, if set.\nUnless set to \"\nmachine-id\n\", or when\n--make-entry-directory=yes\nis used the selected token string is written to a file\n/etc/kernel/entry-token\n, to ensure it will be used for future entries. This file\nis also read by\nkernel-install\n(8)\n,\nin order to identify under which name to generate boot loader entries for newly installed kernels, or\nto determine the entry names for removing old ones.\nUsing the machine ID for naming the entries is generally preferable, however there are cases\nwhere using the other identifiers is a good option. Specifically: if the identification data that the\nmachine ID entails shall not be stored on the (unencrypted)\n$BOOT\npartition, or if\nthe ID shall be generated on first boot and is not known when the entries are prepared. Note that\nusing the machine ID has the benefit that multiple parallel installations of the same OS can coexist\non the same medium, and they can update their boot loader entries independently. When using another\nidentifier (such as the OS ID or the OS image ID), parallel installations of the same OS would try to\nuse the same entry name. To support parallel installations, the installer must use a different entry\ntoken when adding a second installation.\nAdded in version 251.\n--all-architectures\nÂ¶\nInstall binaries for all supported EFI architectures (this implies\n--variables=no\n).\nAdded in version 252.\n--efi-boot-option-description=\nÂ¶\nDescription of the entry added to the firmware's boot option list. Defaults to \"\nLinux\nBoot Manager\n\".\nUsing the default entry name \"\nLinux Boot Manager\n\" is generally preferable as only\none bootloader installed to a single ESP partition should be used to boot any number of OS installations\nfound on the various disks installed in the system. Specifically distributions should not use this flag\nto install a branded entry in the boot option list. However, in situations with multiple disks, each with\ntheir own ESP partition, it can be beneficial to make it easier to identify the bootloader being used in\nthe firmware's boot option menu.\nAdded in version 252.\n--dry-run\nÂ¶\nDry run for\nunlink\nand\ncleanup\n.\nIn dry run mode, the unlink and cleanup operations only print the files that would get deleted\nwithout actually deleting them.\nAdded in version 253.\n--secure-boot-auto-enroll=yes|no\n,\n--private-key=\nPATH/URI\n,\n--private-key-source=\nTYPE\n[:\nNAME\n]\n,\n--certificate=\nPATH\n,\n--certificate-source=\nTYPE\n[:\nNAME\n]\nÂ¶\nConfigure the ESP for secure boot auto-enrollment when invoking the\ninstall\ncommand. Takes a boolean argument. Disabled by default. Enabling this\noption will make\nbootctl\npopulate the ESP with signed \"\nPK\n\",\n\"\nKEK\n\" and \"\ndb\n\" signature databases, each containing the given\ncertificate in \"\nDER\n\" format as their only entry. These secure boot signature\ndatabases will be picked up and enrolled by\nsystemd-boot\nif secure boot is in\nsetup mode and secure boot auto-enrollment is enabled.\nWhen specifying this option, a certificate and private key have to be provided as well using\nthe\n--certificate=\nand\n--private-key=\noptions. The\n--certificate=\noption takes a path to a PEM encoded X.509 certificate or a URI\nthat's passed to the OpenSSL provider configured with\n--certificate-source\nwhich\ntakes one of \"\nfile\n\" or \"\nprovider\n\", with the latter being followed\nby a specific provider identifier, separated with a colon, e.g. \"\nprovider:pkcs11\n\".\nThe\n--private-key=\noption can take a path or a URI that will be passed to the\nOpenSSL engine or provider, as specified by\n--private-key-source=\nas a\n\"\ntype:name\n\" tuple, such as \"\nengine:pkcs11\n\". The specified OpenSSL\nsigning engine or provider will be used to sign the EFI signature lists.\nAdded in version 257.\n--no-pager\nÂ¶\nDo not pipe output into a pager.\n--json=\nMODE\nÂ¶\nShows output formatted as JSON. Expects one of \"\nshort\n\" (for the\nshortest possible output without any redundant whitespace or line breaks), \"\npretty\n\"\n(for a pretty version of the same, with indentation and line breaks) or \"\noff\n\" (to turn\noff JSON output, the default).\n-h\n,\n--help\nÂ¶\nPrint a short help text and exit.\n--version\nÂ¶\nPrint a short version string and exit.\nSigned .efi files\nÂ¶\nbootctl\ninstall\nand\nupdate\nwill look for a\nsystemd-boot\nfile ending with the \"\n.efi.signed\n\" suffix first, and copy\nthat instead of the normal \"\n.efi\n\" file. This allows distributions or end-users to provide\nsigned images for UEFI SecureBoot.\nExit status\nÂ¶\nOn success, 0 is returned, a non-zero failure code otherwise.\nbootctl\n--print-root-device\nreturns exit status 80 in case the root file system is not backed by single\nblock device, and other non-zero exit statuses on other errors.\nEnvironment\nÂ¶\nIf\n$SYSTEMD_RELAX_ESP_CHECKS=1\nis set the validation checks for the ESP are\nrelaxed, and the path specified with\n--esp-path=\nmay refer to any kind of file system on\nany kind of partition.\nSimilarly,\n$SYSTEMD_RELAX_XBOOTLDR_CHECKS=1\nturns off some validation checks for\nthe Extended Boot Loader partition.\nExamples\nÂ¶\nExampleÂ 1.Â Output from\nstatus\nand\nlist\n$\nbootctl status\nSystem:\nFirmware: UEFI 2.40 (\nfirmware-version\n)  â firmware vendor and version\nSecure Boot: disabled (setup)              â Secure Boot status\nTPM2 Support: yes\nBoot into FW: supported                     â does the firmware support booting into itself\nCurrent Boot Loader:                         â details about sd-boot or another boot loader\nProduct: systemd-boot\nversion\nimplementing the\nBoot Loader Interface\nFeatures: â Boot counting\nâ Menu timeout control\nâ One-shot menu timeout control\nâ Default entry control\nâ One-shot entry control\nâ Support for XBOOTLDR partition\nâ Support for passing random seed to OS\nâ Load drop-in drivers\nâ Boot loader sets ESP information\nâ Menu can be disabled\nESP: /dev/disk/by-partuuid/01234567-89ab-cdef-dead-beef00000000\nFile: ââ/EFI/systemd/systemd-bootx64.efi\nRandom Seed:                                 â random seed used for entropy in early boot\nPassed to OS: yes\nSystem Token: set\nExists: yes\nAvailable Boot Loaders on ESP:\nESP: /boot/efi (/dev/disk/by-partuuid/01234567-89ab-cdef-dead-beef00000000)\nFile: ââ/EFI/systemd/systemd-bootx64.efi (systemd-boot 251\nFile: ââ/EFI/BOOT/BOOTX64.EFI (systemd-boot 251\nBoot Loaders Listed in EFI Variables:\nTitle: Linux Boot Manager\nID: 0x0001\nStatus: active, boot-order\nPartition: /dev/disk/by-partuuid/â¦\nFile: ââ/EFI/systemd/systemd-bootx64.efi\nTitle: Fedora\nID: 0x0000\nStatus: active, boot-order\nPartition: /dev/disk/by-partuuid/â¦\nFile: ââ/EFI/fedora/shimx64.efi\nTitle: Linux-Firmware-Updater\nID: 0x0002\nStatus: active, boot-order\nPartition: /dev/disk/by-partuuid/â¦\nFile: ââ/EFI/fedora/fwupdx64.efi\nBoot Loader Entries:\n$BOOT: /boot/efi (/dev/disk/by-partuuid/01234567-89ab-cdef-dead-beef00000000)\nDefault Boot Loader Entry:\ntype: Boot Loader Specification Type #1 (.conf)\ntitle: Fedora Linux 36 (Workstation Edition)\nid: â¦\nsource: /boot/efi/loader/entries/\nentry-token\n-\nkernel-version\n.conf\nversion:\nkernel-version\nmachine-id: â¦\nlinux: /\nentry-token\n/\nkernel-version\n/linux\ninitrd: /\nentry-token\n/\nkernel-version\n/initrd\noptions: root=â¦\n$\nbootctl list\nBoot Loader Entries:\ntype: Boot Loader Specification Type #1 (.conf)\ntitle: Fedora Linux 36 (Workstation Edition) (default) (selected)\nid: â¦\nsource: /boot/efi/loader/entries/\nentry-token\n-\nkernel-version\n.conf\nversion:\nkernel-version\nmachine-id: â¦\nlinux: /\nentry-token\n/\nkernel-version\n/linux\ninitrd: /\nentry-token\n/\nkernel-version\n/initrd\noptions: root=â¦\ntype: Boot Loader Specification Type #2 (.efi)\ntitle: Fedora Linux 35 (Workstation Edition)\nid: â¦\nsource: /boot/efi/EFI/Linux/fedora-\nkernel-version\n.efi\nversion:\nkernel-version\nmachine-id: â¦\nlinux: /EFI/Linux/fedora-\nkernel-version\n.efi\noptions: root=â¦\ntype: Automatic\ntitle: Reboot Into Firmware Interface\nid: auto-reboot-to-firmware-setup\nsource: /sys/firmware/efi/efivars/LoaderEntries-4a67b082-0a4c-41cf-b6c7-440b29bb8c4f\nIn the listing, \"\n(default)\n\" specifies the entry that will be\nused by default, and \"\n(selected)\n\" specifies the entry that was\nselected the last time (i.e. is currently running).\nSee Also\nÂ¶\nsystemd-boot\n(7)\n,\nBoot Loader Specification\n,\nBoot Loader Interface\n,\nsystemd-boot-random-seed.service\n(8)", "metadata": {"source_type": "vendor_docs", "trust": "vendor_docs", "os": "linux", "distro": "ubuntu-22.04", "license": "CC BY-SA (assumed; verify per site)", "attribution_url": "https://www.freedesktop.org/software/systemd/man/latest/bootctl.html"}}
{"text": "systemd-boot\nIndex\nÂ·\nDirectives\nsystemd 258\nName\nsystemd-boot, sd-boot â A simple UEFI boot manager\nDescription\nÂ¶\nsystemd-boot\n(short:\nsd-boot\n) is a simple UEFI boot\nmanager. It provides a textual menu to select the entry to boot and an editor for the kernel command\nline.\nsystemd-boot\nsupports systems with UEFI firmware only.\nsystemd-boot\nloads boot entry information from the EFI system partition (ESP),\nusually mounted at\n/efi/\n,\n/boot/\n, or\n/boot/efi/\nduring OS runtime, as well as from the Extended Boot Loader partition\n(XBOOTLDR) if it exists (usually mounted to\n/boot/\n). Configuration file fragments,\nkernels, initrds and other EFI images to boot generally need to reside on the ESP or the Extended Boot\nLoader partition. Linux kernels must be built with\nCONFIG_EFI_STUB\nto be able to be\ndirectly executed as an EFI image. During boot\nsystemd-boot\nautomatically assembles a\nlist of boot entries from the following sources:\nBoot entries defined with\nBoot Loader Specification\nType #1\ndescription files located in\n/loader/entries/\non the ESP and the Extended Boot\nLoader Partition. These usually describe Linux kernel images with associated initrd images, but\nalternatively may also describe other arbitrary EFI executables.\nUnified kernel images,\nBoot\nLoader Specification\nType #2, which are executable EFI binaries in\n/EFI/Linux/\non the ESP and the Extended Boot Loader Partition.\nThe Microsoft Windows EFI boot manager, if installed.\nThe Apple macOS boot manager, if installed.\nThe EFI Shell binary, if installed.\nA \"\nReboot Into Firmware Interface\n\" option, if supported by the UEFI\nfirmware.\nSecure Boot variables enrollment if the UEFI firmware is in setup-mode and files are provided\non the ESP.\nsystemd-boot\nsupports the following features:\nBasic boot manager configuration changes (such as timeout\nconfiguration, default boot entry selection, â¦) may be made directly from the boot loader UI at\nboot-time, as well as during system runtime with EFI variables.\nThe boot manager integrates with the\nsystemctl\ncommand to implement\nfeatures such as\nsystemctl reboot --boot-loader-entry=â¦\n(for rebooting into a\nspecific boot menu entry, i.e. \"reboot into Windows\") and\nsystemctl reboot\n--boot-loader-menu=â¦\n(for rebooting into the boot loader menu), by implementing the\nBoot Loader Interface\n. See\nsystemctl\n(1)\nfor\ndetails.\nAn EFI variable set by the boot loader informs the OS about the EFI System Partition used\nduring boot. This is then used to automatically mount the correct EFI System Partition to\n/efi/\nor\n/boot/\nduring OS runtime. See\nsystemd-gpt-auto-generator\n(8)\nfor details.\nThe boot manager provides information about the boot time spent in UEFI firmware using\nthe\nBoot Loader Interface\n. This\ninformation can be displayed using\nsystemd-analyze\n(1)\n.\nThe boot manager implements boot counting and automatic fallback to older, working boot\nentries on failure. See\nAutomatic Boot\nAssessment\n.\nThe boot manager optionally reads a random seed from the ESP partition, combines it\nwith a 'system token' stored in a persistent EFI variable and derives a random seed to use by the OS as\nentropy pool initialization, providing a full entropy pool during early boot.\nThe boot manager allows for Secure Boot variables to be enrolled if the UEFI firmware is\nin setup-mode. Additionally, variables can be automatically enrolled if configured.\nbootctl\n(1)\nmay be used from a running system to locate the ESP and the Extended Boot Loader Partition, list\navailable entries, and install\nsystemd-boot\nitself.\nkernel-install\n(8)\nmay be used to copy kernel images onto the ESP or the Extended Boot Loader Partition and to generate\ndescription files compliant with the Boot Loader\nSpecification.\nsystemd-stub\n(7)\nmay be used as UEFI boot stub for executed kernels, which is useful to show graphical boot splashes\nbefore transitioning into the Linux world. It is also capable of automatically picking up auxiliary\ncredential files (for boot parameterization) and system extension images, as companion files to the\nbooted kernel images.\nKey bindings\nÂ¶\nThe following keys may be used in the boot menu:\nâ\n(Up),\nâ\n(Down),\nj\n,\nk\n,\nPageUp\n,\nPageDown\n,\nHome\n,\nEnd\nÂ¶\nNavigate up/down in the entry list\nAdded in version 239.\nâµ\n(Enter),\nâ\n(Right)\nÂ¶\nBoot selected entry\nAdded in version 239.\nd\nÂ¶\nMake selected entry the default\nAn EFI variable is set to allow this setting to persist.\nAdded in version 239.\ne\nÂ¶\nEdit the kernel command line for selected entry\nAdded in version 239.\n+\n,\nt\nÂ¶\nIncrease the timeout before default entry is booted\nAn EFI variable is set to allow this setting to persist.\nAdded in version 239.\n-\n,\nT\nÂ¶\nDecrease the timeout\nAn EFI variable is set to allow this setting to persist.\nAdded in version 239.\nr\nÂ¶\nChange screen resolution, skipping any unsupported modes.\nAn EFI variable is set to allow this setting to persist.\nAdded in version 250.\nR\nÂ¶\nReset screen resolution to firmware or configuration file default.\nAn EFI variable is set to allow this setting to persist.\nAdded in version 250.\np\nÂ¶\nPrint status\nAdded in version 250.\nh\n,\n?\n,\nF1\nÂ¶\nShow a help screen\nAdded in version 239.\nf\nÂ¶\nReboot into firmware interface.\nFor compatibility with the keybindings of several firmware implementations this operation\nmay also be reached with\nF2\n,\nF10\n,\nDel\nand\nEsc\n.\nAdded in version 250.\nShift\n+\no\nÂ¶\nPower off the system.\nAdded in version 255.\nShift\n+\nb\nÂ¶\nReboot the system.\nAdded in version 255.\nThe following keys may be pressed during bootup or in the boot menu to directly boot a specific\nentry:\nl\nÂ¶\nLinux\nAdded in version 239.\nw\nÂ¶\nWindows\nAdded in version 239.\na\nÂ¶\nmacOS\nAdded in version 239.\ns\nÂ¶\nEFI shell\nAdded in version 239.\n1\n,\n2\n,\n3\n,\n4\n,\n5\n,\n6\n,\n7\n,\n8\n,\n9\nÂ¶\nBoot entry number 1 â¦ 9\nAdded in version 239.\nThe boot menu is shown when a non-zero menu timeout has been configured. If the menu timeout has\nbeen set to zero, hold down a key (\nspace\nis recommended) before the boot loader\ninitializes to bring up the boot menu. Note that depending on the firmware implementation the time window\nwhere key presses are accepted before the boot loader initializes might be short. If the window is\nmissed, reboot and try again, possibly repeatedly pressing a suitable key; on most systems it should be\npossible to hit the time window after a few attempts. Keys other than the space bar may be used, except\nfor the keys listed above. If showing the menu on demand doesn't work well, consider setting a non-zero\ntimeout to show the boot menu unconditionally. Some desktop environments might offer an option to boot\ndirectly into the boot menu, which also avoids the problem altogether. Alternatively, use the command\nline\nsystemctl reboot --boot-loader-menu=\nwith a non-zero value from the shell.\nIn the editor, most keys simply insert themselves, but the following keys\nmay be used to perform additional actions:\nâ\n(Left),\nâ\n(Right),\nHome\n,\nEnd\nÂ¶\nNavigate left/right\nAdded in version 239.\nEsc\n,\nCtrl\n+\nc\nÂ¶\nAbort the edit and quit the editor\nAdded in version 239.\nCtrl\n+\nk\nÂ¶\nClear the command line forwards\nAdded in version 239.\nCtrl\n+\nw\n,\nAlt\n+\nBackspace\nÂ¶\nDelete word backwards\nAdded in version 239.\nCtrl\n+\nDel\n,\nAlt\n+\nd\nÂ¶\nDelete word forwards\nAdded in version 239.\nâµ\n(Enter)\nÂ¶\nBoot entry with the edited command line\nAdded in version 239.\nNote that unless configured otherwise in the UEFI firmware, systemd-boot will\nuse the US keyboard layout, so key labels might not match for keys like +/-.\nFiles\nÂ¶\nThe files\nsystemd-boot\nprocesses generally reside on the UEFI ESP which is\nusually mounted to\n/efi/\n,\n/boot/\nor\n/boot/efi/\nduring OS runtime. It also processes files on the Extended Boot Loader\npartition which is typically mounted to\n/boot/\n, if it\nexists.\nsystemd-boot\nreads runtime configuration such as the boot timeout and default\nentry from\n/loader/loader.conf\non the ESP (in combination with data read from EFI\nvariables). See\nloader.conf\n(5)\n.\nBoot entry description files following the\nBoot Loader Specification\nare read from\n/loader/entries/\non the ESP and the Extended Boot Loader partition.\nUnified kernel boot entries following the\nBoot Loader Specification\nare read from\n/EFI/Linux/\non the ESP and the Extended Boot Loader partition.\nOptionally, a random seed for early boot entropy pool provisioning is stored in\n/loader/random-seed\nin the ESP.\nDuring initialization,\nsd-boot\nautomatically loads all driver files placed in\nthe\n/EFI/systemd/drivers/\ndirectory of the ESP. The files placed there must have an\nextension of the EFI architecture ID followed by\n.efi\n(e.g. for x86-64 this means a\nsuffix of\nx64.efi\n). This may be used to automatically load file system drivers and\nsimilar, to extend the native firmware support.\nEnrollment of Secure Boot variables can be performed manually or automatically if files are available\nunder\n/loader/keys/\nNAME\n/{db,dbx,KEK,PK}.auth\n,\nNAME\nbeing the display name for the set of variables in the menu. If one of the sets is named\nauto\nthen it might be enrolled automatically depending on whether \"\nsecure-boot-enroll\n\" is set\nto force or not.\nEFI Variables\nÂ¶\nThe following EFI variables are defined, and may be set or read by\nsystemd-boot\nfor communication between the boot loader and the OS. The vendor UUID\n\"\n4a67b082-0a4c-41cf-b6c7-440b29bb8c4f\n\" is used in all cases.\nLoaderBootCountPath\nÂ¶\nIf boot counting is enabled, contains the path to the file in whose name the boot\ncounters are encoded. Set by the boot loader.\nsystemd-bless-boot.service\n(8)\nuses this information to mark a boot as successful as determined by the successful activation of the\nboot-complete.target\ntarget unit.\nAdded in version 240.\nLoaderConfigTimeout\n,\nLoaderConfigTimeoutOneShot\nÂ¶\nThe menu timeout in seconds. Read by the boot loader.\nLoaderConfigTimeout\nis maintained persistently, while\nLoaderConfigTimeoutOneShot\nis a one-time override which is\nread once (in which case it takes precedence over\nLoaderConfigTimeout\n) and then\nremoved.\nLoaderConfigTimeout\nmay be manipulated with the\nt\n/\nT\nkeys, see above.\nAdded in version 240.\nLoaderConfigConsoleMode\nÂ¶\nThe numerical menu console mode. Read by the boot loader.\nLoaderConfigConsoleMode\nis maintained persistently.\nLoaderConfigConsoleMode\nmay be manipulated with the\nr\n/\nR\nkeys, see above.\nAdded in version 250.\nLoaderDevicePartUUID\nÂ¶\nContains the partition UUID of the partition the boot loader has been started from on\nthe current boot (usually an EFI System Partition). Set by the boot loader. (Note that\nsystemd-stub\n(7)\nwill\nset this too, if not set yet, to support systems that boot directly into a unified kernel image,\nbypassing any boot loader.)\nsystemd-gpt-auto-generator\n(8)\nuses this information to automatically find the disk booted from, in order to discover various other\npartitions on the same disk automatically.\nAdded in version 220.\nLoaderDeviceURL\nÂ¶\nIf the boot loader has been invoked via network booting this variable contains the\noriginating URL. This may be used to automatically acquire additional resources from the same\nsource.\nAdded in version 258.\nLoaderEntries\nÂ¶\nA list of the identifiers of all discovered boot loader entries. Set by the boot\nloader.\nAdded in version 240.\nLoaderEntryDefault\n,\nLoaderEntrySysFail\n,\nLoaderEntryOneShot\nÂ¶\nThe identifier of the default boot loader entry. Can be set in the OS and the boot\nloader.\nLoaderEntryOneShot\nsets the default entry for the next boot only, while\nLoaderEntryDefault\nsets it persistently for all future boots.\nbootctl\n(1)\n's\nset-default\nand\nset-oneshot\ncommands make use of these variables.\nThe boot loader modifies\nLoaderEntryDefault\non request, when the\nd\nkey is used, see above.\nAdded in version 240.\nLoaderEntryLastBooted\nÂ¶\nThe identifier of the boot loader entry last attempted. Set and read by the boot loader,\nonly when\n/loader/loader.conf\nhas default set to \"\n@saved\n\". See\nloader.conf\n(5)\n.\nThe boot loader will ensure\nLoaderEntryLastBooted\nis up-to date for every boot,\nupdating it as needed and will omit changing it all together when\nLoaderEntryOneShot\nis set.\nThe boot loader reads the variable, which takes higher priority than\nLoaderEntryDefault\n. The variable is ignored when\nLoaderEntryOneShot\nis set.\nLoaderEntryLastBooted\ncannot be used as indication that the last boot was\nsuccessful or not.\nAdded in version 250.\nLoaderEntrySelected\nÂ¶\nThe identifier of the boot loader entry currently being booted. Set by the boot\nloader.\nAdded in version 240.\nLoaderFeatures\nÂ¶\nA set of flags indicating the features the boot loader supports. Set by the boot loader. Use\nbootctl\n(1)\nto view this\ndata.\nAdded in version 240.\nLoaderFirmwareInfo\n,\nLoaderFirmwareType\nÂ¶\nBrief firmware information. Set by the boot loader. Use\nbootctl\n(1)\nto view this\ndata.\nAdded in version 240.\nLoaderTpm2ActivePcrBanks\nÂ¶\nHexadecimal string representation of a bitmask with values defined by the TCG EFI\nProtocol Specification for TPM 2.0 as EFI_TCG2_BOOT_HASH_ALG_*. If no TPM2 support or no active\nbanks were detected, will be set to\n0\n. Set by the boot loader. Use\nsystemd-analyze\n(1)\nto view this data.\nAdded in version 258.\nLoaderImageIdentifier\nÂ¶\nThe file system path to the EFI executable of the boot loader for the current boot,\nrelative to the partition's root directory (i.e. relative to the partition indicated by\nLoaderDevicePartUUID\n, see above). Set by the boot loader. (Note that\nsystemd-stub\nwill set this too, if not set yet, to support systems that directly\nboot into a unified kernel image, bypassing any boot loader.) Use\nbootctl\n(1)\nto view\nthis data.\nAdded in version 220.\nLoaderInfo\nÂ¶\nBrief information about the boot loader. Set by the boot loader. Use\nbootctl\n(1)\nto view this\ndata.\nAdded in version 240.\nLoaderTimeExecUSec\n,\nLoaderTimeInitUSec\n,\nLoaderTimeMenuUsec\nÂ¶\nInformation about the time spent in various parts of the boot loader. Set by the boot\nloader. Use\nsystemd-analyze\n(1)\nto view this data.\nAdded in version 240.\nLoaderSystemToken\nÂ¶\nA binary random data field, that is used for generating the random seed to pass to\nthe OS (see above). Note that this random data is generally only generated once, during OS\ninstallation, and is then never updated again.\nAdded in version 243.\nMany of these variables are defined by the\nBoot Loader Interface\n.\nSMBIOS Type 11 Strings\nÂ¶\nsystemd-boot\ncan be configured using SMBIOS Type 11 strings. Applicable strings\nconsist of a name, followed by \"\n=\n\", followed by the value. Unless\nsystemd-boot\ndetects it is running inside a confidential computing environment,\nsystemd-boot\nwill search the table for a string with a specific name, and if found,\nuse its value. The following strings are read:\nio.systemd.boot.kernel-cmdline-extra\nÂ¶\nIf set, the value of this string is added to the list of kernel command line\narguments for Boot Loader Specification Type 1 entries that are measured in PCR12 and passed to the\nkernel.\nAdded in version 256.\nio.systemd.boot-entries.extra:\nID=DEFINITION\nÂ¶\nThis allows inserting additional entries into the\nsystemd-boot\nmenu. Take a pair of menu entry identifier and menu entry definition string. The former should be\nsuitable for use as a filename of a Boot Loader Specification Type #1 entry filename (note that it is\nused for identification purposes only, no file of this name is actually accessed), the latter shall\nfollow the syntax of the contents of a Type #1 entry. Any menu entry defined this way is processed\nand shown in pretty much the same way as a Type #1 entry read from the ESP or XBOOTLDR\npartition. Example:\nio.systemd.boot-entries.extra:fooos-current.conf=title FooOS (Current)\nuki-url http://example.com/somedir/fooos.efi\nNote that this example contains a newline character. When generating this string from a shell\ncare must be taken to encode it correctly.\nPass multiple strings formatted this way to generate multiple menu entries.\nAdded in version 258.\nBoot Counting\nÂ¶\nsystemd-boot\nimplements a simple boot counting mechanism on top of the\nBoot Loader Specification\n, for automatic and unattended\nfallback to older kernel versions/boot loader entries when a specific entry continuously fails. Any boot loader\nentry file and unified kernel image file that contains a \"\n+\n\" followed by one or two numbers (if\ntwo they need to be separated by a \"\n-\n\"), before the\n.conf\nor\n.efi\nsuffix is subject to boot counting: the first of the two numbers ('tries left') is\ndecreased by one on every boot attempt, the second of the two numbers ('tries done') is increased by one (if 'tries\ndone' is absent it is considered equivalent to 0). Depending on the current value of these two counters the boot\nentry is considered to be in one of three states:\nIf the 'tries left' counter of an entry is greater than zero the entry is considered to be in\n'indeterminate' state. This means the entry has not completed booting successfully yet, but also has not been\ndetermined not to work.\nIf the 'tries left' counter of an entry is zero it is considered to be in 'bad' state. This means\nno further attempts to boot this item will be made (that is, unless all other boot entries are also in 'bad'\nstate), as all attempts to boot this entry have not completed successfully.\nIf the 'tries left' and 'tries done' counters of an entry are absent it is considered to be in\n'good' state. This means further boot counting for the entry is turned off, as it successfully booted at least\nonce. The\nsystemd-bless-boot.service\n(8)\nservice moves the currently booted entry from 'indeterminate' into 'good' state when a boot attempt completed\nsuccessfully.\nGenerally, when new entries are added to the boot loader, they first start out in 'indeterminate' state,\ni.e. with a 'tries left' counter greater than zero. The boot entry remains in this state until either it managed to\ncomplete a full boot successfully at least once (in which case it will be in 'good' state) â or the 'tries left'\ncounter reaches zero (in which case it will be in 'bad' state).\nExample: let's say a boot loader entry file\nfoo.conf\nis set up for 3 boot tries. The\ninstaller will hence create it under the name\nfoo+3.conf\n. On first boot, the boot loader will\nrename it to\nfoo+2-1.conf\n. If that boot does not complete successfully, the boot loader will\nrename it to\nfoo+1-2.conf\non the following boot. If that fails too, it will finally be renamed\nfoo+0-3.conf\nby the boot loader on next boot, after which it will be considered 'bad'. If the\nboot succeeds however the entry file will be renamed to\nfoo.conf\nby the OS, so that it is\nconsidered 'good' from then on.\nThe boot menu takes the 'tries left' counter into account when sorting the menu entries: entries in 'bad'\nstate are ordered at the beginning of the list, and entries in 'good' or 'indeterminate' at the end. The user can\nfreely choose to boot any entry of the menu, including those already marked 'bad'. If the menu entry to boot is\nautomatically determined, this means that 'good' or 'indeterminate' entries are generally preferred (as the bottom\nitem of the menu is the one booted by default), and 'bad' entries will only be considered if there are no 'good' or\n'indeterminate' entries left.\nThe\nkernel-install\n(8)\nkernel\ninstall framework optionally sets the initial 'tries left' counter to the value specified in\n/etc/kernel/tries\nwhen a boot loader entry is first created.\nUsing\nsystemd-boot\nin virtual machines\nÂ¶\nWhen using qemu with OVMF (UEFI Firmware for virtual machines) the\n-kernel\nswitch\nworks not only for linux kernels, but for any EFI binary, including sd-boot and unified linux\nkernels. Example command line for loading\nsystemd-boot\non x64:\nqemu-system-x86_64\n[ ... ]\n-kernel /usr/lib/systemd/boot/efi/systemd-bootx64.efi\nsystemd-boot will detect that it was started directly instead of being loaded from ESP and will\nsearch for the ESP in that case, taking into account boot order information from the hypervisor (if\navailable).\nSee Also\nÂ¶\nbootctl\n(1)\n,\nloader.conf\n(5)\n,\nsystemd-bless-boot.service\n(8)\n,\nsystemd-boot-random-seed.service\n(8)\n,\nkernel-install\n(8)\n,\nsystemd-stub\n(7)\n,\nBoot Loader Specification\n,\nBoot Loader Interface\n,\nTPM2 PCR Measurements Made by systemd", "metadata": {"source_type": "vendor_docs", "trust": "vendor_docs", "os": "linux", "distro": "ubuntu-22.04", "license": "CC BY-SA (assumed; verify per site)", "attribution_url": "https://www.freedesktop.org/software/systemd/man/latest/systemd-boot.html"}}
